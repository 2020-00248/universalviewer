function Sanitize(){var e,t;for(t=arguments[0]||{},this.config={},this.config.elements=t.elements?t.elements:[],this.config.attributes=t.attributes?t.attributes:{},this.config.attributes[Sanitize.ALL]=this.config.attributes[Sanitize.ALL]?this.config.attributes[Sanitize.ALL]:[],this.config.allow_comments=t.allow_comments?t.allow_comments:!1,this.allowed_elements={},this.config.protocols=t.protocols?t.protocols:{},this.config.add_attributes=t.add_attributes?t.add_attributes:{},this.dom=t.dom?t.dom:document,e=0;e<this.config.elements.length;e++)this.allowed_elements[this.config.elements[e]]=!0;if(this.config.remove_element_contents={},this.config.remove_all_contents=!1,t.remove_contents)if(t.remove_contents instanceof Array)for(e=0;e<t.remove_contents.length;e++)this.config.remove_element_contents[t.remove_contents[e]]=!0;else this.config.remove_all_contents=!0;this.transformers=t.transformers?t.transformers:[]}var requirejs,require,define;!function(global){function commentReplace(e,t,n,i){return i||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,i){return t&&eachProp(t,function(t,r){(n||!hasProp(e,r))&&(!i||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,n,i)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,i){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=i,n&&(r.originalError=n),r}function newContext(e){function t(e){var t,n;for(t=0;t<e.length;t++)if(n=e[t],"."===n)e.splice(t,1),t-=1;else if(".."===n){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function n(e,n,i){var r,o,s,a,u,c,l,h,p,d,f,g,m=n&&n.split("/"),v=x.map,y=v&&v["*"];if(e&&(e=e.split("/"),l=e.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&m&&(g=m.slice(0,m.length-1),e=g.concat(e)),t(e),e=e.join("/")),i&&v&&(m||y)){s=e.split("/");e:for(a=s.length;a>0;a-=1){if(c=s.slice(0,a).join("/"),m)for(u=m.length;u>0;u-=1)if(o=getOwn(v,m.slice(0,u).join("/")),o&&(o=getOwn(o,c))){h=o,p=a;break e}!d&&y&&getOwn(y,c)&&(d=getOwn(y,c),f=a)}!h&&d&&(h=d,p=f),h&&(s.splice(0,p,h),e=s.join("/"))}return r=getOwn(x.pkgs,e),r?r:e}function i(e){isBrowser&&each(scripts(),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===E.contextName?(t.parentNode.removeChild(t),!0):void 0})}function r(e){var t=getOwn(x.paths,e);return t&&isArray(t)&&t.length>1?(t.shift(),E.require.undef(e),E.makeRequire(null,{skipMap:!0})([e]),!0):void 0}function o(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function s(e,t,i,r){var s,a,u,c,l=null,h=t?t.name:null,p=e,d=!0,f="";return e||(d=!1,e="_@r"+(R+=1)),c=o(e),l=c[0],e=c[1],l&&(l=n(l,h,r),a=getOwn(C,l)),e&&(l?f=a&&a.normalize?a.normalize(e,function(e){return n(e,h,r)}):-1===e.indexOf("!")?n(e,h,r):e:(f=n(e,h,r),c=o(f),l=c[0],f=c[1],i=!0,s=E.nameToUrl(f))),u=!l||a||i?"":"_unnormalized"+(N+=1),{prefix:l,name:f,parentMap:t,unnormalized:!!u,url:s,originalName:p,isDefine:d,id:(l?l+"!"+f:f)+u}}function a(e){var t=e.id,n=getOwn($,t);return n||(n=$[t]=new E.Module(e)),n}function u(e,t,n){var i=e.id,r=getOwn($,i);!hasProp(C,i)||r&&!r.defineEmitComplete?(r=a(e),r.error&&"error"===t?n(r.error):r.on(t,n)):"defined"===t&&n(C[i])}function c(e,t){var n=e.requireModules,i=!1;t?t(e):(each(n,function(t){var n=getOwn($,t);n&&(n.error=e,n.events.error&&(i=!0,n.emit("error",e)))}),i||req.onError(e))}function l(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(E.defQueueMap[t]=!0),T.push(e)}),globalDefQueue=[])}function h(e){delete $[e],delete _[e]}function p(e,t,n){var i=e.map.id;e.error?e.emit("error",e.error):(t[i]=!0,each(e.depMaps,function(i,r){var o=i.id,s=getOwn($,o);!s||e.depMatched[r]||n[o]||(getOwn(t,o)?(e.defineDep(r,C[o]),e.check()):p(s,t,n))}),n[i]=!0)}function d(){var e,t,n=1e3*x.waitSeconds,o=n&&E.startTime+n<(new Date).getTime(),s=[],a=[],u=!1,l=!0;if(!y){if(y=!0,eachProp(_,function(e){var n=e.map,c=n.id;if(e.enabled&&(n.isDefine||a.push(e),!e.error))if(!e.inited&&o)r(c)?(t=!0,u=!0):(s.push(c),i(c));else if(!e.inited&&e.fetched&&n.isDefine&&(u=!0,!n.prefix))return l=!1}),o&&s.length)return e=makeError("timeout","Load timeout for modules: "+s,null,s),e.contextName=E.contextName,c(e);l&&each(a,function(e){p(e,{},{})}),o&&!t||!u||!isBrowser&&!isWebWorker||S||(S=setTimeout(function(){S=0,d()},50)),y=!1}}function f(e){hasProp(C,e[0])||a(s(e[0],null,!0)).init(e[1],e[2])}function g(e,t,n,i){e.detachEvent&&!isOpera?i&&e.detachEvent(i,t):e.removeEventListener(n,t,!1)}function m(e){var t=e.currentTarget||e.srcElement;return g(t,E.onScriptLoad,"load","onreadystatechange"),g(t,E.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function v(){var e;for(l();T.length;){if(e=T.shift(),null===e[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));f(e)}E.defQueueMap={}}var y,b,E,w,S,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},$={},_={},I={},T=[],C={},A={},O={},R=1,N=1;return w={require:function(e){return e.require?e.require:e.require=E.makeRequire(e.map)},exports:function(e){return e.usingExports=!0,e.map.isDefine?e.exports?C[e.map.id]=e.exports:e.exports=C[e.map.id]={}:void 0},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(x.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},b=function(e){this.events=getOwn(I,e.id)||{},this.map=e,this.shim=getOwn(x.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,n,i){i=i||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,E.startTime=(new Date).getTime();var e=this.map;return this.shim?void E.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;A[e]||(A[e]=!0,E.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id,i=this.depExports,r=this.exports,o=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{r=E.execCb(n,o,i,r)}catch(s){e=s}else r=E.execCb(n,o,i,r);if(this.map.isDefine&&void 0===r&&(t=this.module,t?r=t.exports:this.usingExports&&(r=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",c(this.error=e)}else r=o;if(this.exports=r,this.map.isDefine&&!this.ignore&&(C[n]=r,req.onResourceLoad)){var a=[];each(this.depMaps,function(e){a.push(e.normalizedMap||e)}),req.onResourceLoad(E,this.map,a)}h(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(E.defQueueMap,n)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,i=s(e.prefix);this.depMaps.push(i),u(i,"defined",bind(this,function(i){var r,o,l,p=getOwn(O,this.map.id),d=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null,g=E.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(i.normalize&&(d=i.normalize(d,function(e){return n(e,f,!0)})||""),o=s(e.prefix+"!"+d,this.map.parentMap),u(o,"defined",bind(this,function(e){this.map.normalizedMap=o,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),l=getOwn($,o.id),void(l&&(this.depMaps.push(o),this.events.error&&l.on("error",bind(this,function(e){this.emit("error",e)})),l.enable()))):p?(this.map.url=E.nameToUrl(p),void this.load()):(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),r.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp($,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&h(e.map.id)}),c(e)}),r.fromText=bind(this,function(n,i){var o=e.name,u=s(o),l=useInteractive;i&&(n=i),l&&(useInteractive=!1),a(u),hasProp(x.config,t)&&(x.config[o]=x.config[t]);try{req.exec(n)}catch(h){return c(makeError("fromtexteval","fromText eval for "+t+" failed: "+h,h,[t]))}l&&(useInteractive=!0),this.depMaps.push(u),E.completeLoad(o),g([o],r)}),void i.load(e.name,g,r,x))})),E.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){_[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,i,r;if("string"==typeof e){if(e=s(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(w,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,u(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?u(e,"error",bind(this,this.errback)):this.events.error&&u(e,"error",bind(this,function(e){this.emit("error",e)}))}n=e.id,i=$[n],hasProp(w,n)||!i||i.enabled||E.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn($,e.id);t&&!t.enabled&&E.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},E={config:x,contextName:e,registry:$,defined:C,urlFetched:A,defQueue:T,defQueueMap:{},Module:b,makeModuleMap:s,nextTick:req.nextTick,onError:c,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,n){return(-1===n.indexOf("?")?"?":"&")+t}}var n=x.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(x[t]||(x[t]={}),mixin(x[t],e,!0,!0)):x[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(O[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=E.makeShimExports(e)),n[t]=e}),x.shim=n),e.packages&&each(e.packages,function(e){var t,n;e="string"==typeof e?{name:e}:e,n=e.name,t=e.location,t&&(x.paths[n]=e.location),x.pkgs[n]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp($,function(e,t){e.inited||e.map.unnormalized||(e.map=s(t,null,!0))}),(e.deps||e.callback)&&E.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,r){function o(n,i,u){var l,h,p;return r.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof n?isFunction(i)?c(makeError("requireargs","Invalid require call"),u):t&&hasProp(w,n)?w[n]($[t.id]):req.get?req.get(E,n,t,o):(h=s(n,t,!1,!0),l=h.id,hasProp(C,l)?C[l]:c(makeError("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(v(),E.nextTick(function(){v(),p=a(s(null,t)),p.skipMap=r.skipMap,p.init(n,i,u,{enabled:!0}),d()}),o)}return r=r||{},mixin(o,{isBrowser:isBrowser,toUrl:function(e){var i,r=e.lastIndexOf("."),o=e.split("/")[0],s="."===o||".."===o;return-1!==r&&(!s||r>1)&&(i=e.substring(r,e.length),e=e.substring(0,r)),E.nameToUrl(n(e,t&&t.id,!0),i,!0)},defined:function(e){return hasProp(C,s(e,t,!1,!0).id)},specified:function(e){return e=s(e,t,!1,!0).id,hasProp(C,e)||hasProp($,e)}}),t||(o.undef=function(e){l();var n=s(e,t,!0),r=getOwn($,e);r.undefed=!0,i(e),delete C[e],delete A[n.url],delete I[e],eachReverse(T,function(t,n){t[0]===e&&T.splice(n,1)}),delete E.defQueueMap[e],r&&(r.events.defined&&(I[e]=r.events),h(e))}),o},enable:function(e){var t=getOwn($,e.id);t&&a(e).enable()},completeLoad:function(e){var t,n,i,o=getOwn(x.shim,e)||{},s=o.exports;for(l();T.length;){if(n=T.shift(),null===n[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);f(n)}if(E.defQueueMap={},i=getOwn($,e),!t&&!hasProp(C,e)&&i&&!i.inited){if(!(!x.enforceDefine||s&&getGlobal(s)))return r(e)?void 0:c(makeError("nodefine","No define call for "+e,null,[e]));f([e,o.deps||[],o.exportsFn])}d()},nameToUrl:function(e,t,n){var i,r,o,s,a,u,c,l=getOwn(x.pkgs,e);if(l&&(e=l),c=getOwn(O,e))return E.nameToUrl(c,t,n);if(req.jsExtRegExp.test(e))a=e+(t||"");else{for(i=x.paths,r=e.split("/"),o=r.length;o>0;o-=1)if(s=r.slice(0,o).join("/"),u=getOwn(i,s)){isArray(u)&&(u=u[0]),r.splice(0,o,u);break}a=r.join("/"),a+=t||(/^data\:|^blob\:|\?/.test(a)||n?"":".js"),a=("/"===a.charAt(0)||a.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+a}return x.urlArgs&&!/^blob\:/.test(a)?a+x.urlArgs(e,a):a},load:function(e,t){req.load(E,e,t)},execCb:function(e,t,n,i){return t.apply(i,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=m(e);E.completeLoad(t.id)}},onScriptError:function(e){var t=m(e);if(!r(t.id)){var n=[];return eachProp($,function(e,i){0!==i.indexOf("_@r")&&each(e.depMaps,function(e){return e.id===t.id?(n.push(i),!0):void 0})}),c(makeError("scripterror",'Script error for "'+t.id+(n.length?'", needed by: '+n.join(", "):'"'),e,[t.id]))}}},E.require=E.makeRequire(),E}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){return"interactive"===e.readyState?interactiveScript=e:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.2.0",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,n,i){var r,o,s=defContextName;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=n,n=i):e=[]),o&&o.context&&(s=o.context),r=getOwn(contexts,s),r||(r=contexts[s]=req.s.newContext(s)),o&&r.configure(o),r.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var i=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return i.type=e.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i},req.load=function(e,t,n){var i,r=e&&e.config||{};if(isBrowser)return i=req.createNode(r,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),!i.attachEvent||i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0||isOpera?(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)),i.src=n,r.onNodeCreated&&r.onNodeCreated(i,r,t,n),currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{setTimeout(function(){},0),importScripts(n),e.completeLoad(t)}catch(o){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,o,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){return head||(head=e.parentNode),dataMain=e.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(e,t,n){var i,r;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript(),i&&(e||(e=i.getAttribute("data-requiremodule")),r=contexts[i.getAttribute("data-requirecontext")])),r?(r.defQueue.push([e,t,n]),r.defQueueMap[e]=!0):globalDefQueue.push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),define("modules/uv-shared-module/BaseCommands",["require","exports"],function(e,t){var n=function(){function e(){}return e.namespace="uv.",e.ACCEPT_TERMS=e.namespace+"onAcceptTerms",e.BOOKMARK=e.namespace+"onBookmark",e.CANVAS_INDEX_CHANGE_FAILED=e.namespace+"onCanvasIndexChangeFailed",e.CANVAS_INDEX_CHANGED=e.namespace+"onCanvasIndexChanged",e.CLICKTHROUGH=e.namespace+"onClickthrough",e.CLOSE_ACTIVE_DIALOGUE=e.namespace+"onCloseActiveDialogue",e.CLOSE_LEFT_PANEL=e.namespace+"onCloseLeftPanel",e.CLOSE_RIGHT_PANEL=e.namespace+"onCloseRightPanel",e.CREATED=e.namespace+"onCreated",e.DOWN_ARROW=e.namespace+"onDownArrow",e.DOWNLOAD=e.namespace+"onDownload",e.DROP=e.namespace+"onDrop",e.END=e.namespace+"onEnd",e.ESCAPE=e.namespace+"onEscape",e.EXTERNAL_LINK_CLICKED=e.namespace+"onExternalLinkClicked",e.FEEDBACK=e.namespace+"onFeedback",e.FORBIDDEN=e.namespace+"onForbidden",e.HIDE_CLICKTHROUGH_DIALOGUE=e.namespace+"onHideClickthroughDialogue",e.HIDE_DOWNLOAD_DIALOGUE=e.namespace+"onHideDownloadDialogue",e.HIDE_EMBED_DIALOGUE=e.namespace+"onHideEmbedDialogue",e.HIDE_EXTERNALCONTENT_DIALOGUE=e.namespace+"onHideExternalContentDialogue",e.HIDE_GENERIC_DIALOGUE=e.namespace+"onHideGenericDialogue",e.HIDE_HELP_DIALOGUE=e.namespace+"onHideHelpDialogue",e.HIDE_INFORMATION=e.namespace+"onHideInformation",e.HIDE_LOGIN_DIALOGUE=e.namespace+"onHideLoginDialogue",e.HIDE_OVERLAY=e.namespace+"onHideOverlay",e.HIDE_RESTRICTED_DIALOGUE=e.namespace+"onHideRestrictedDialogue",e.HIDE_SETTINGS_DIALOGUE=e.namespace+"onHideSettingsDialogue",e.HOME=e.namespace+"onHome",e.LEFT_ARROW=e.namespace+"onLeftArrow",e.LEFTPANEL_COLLAPSE_FULL_FINISH=e.namespace+"onLeftPanelCollapseFullFinish",e.LEFTPANEL_COLLAPSE_FULL_START=e.namespace+"onLeftPanelCollapseFullStart",e.LEFTPANEL_EXPAND_FULL_FINISH=e.namespace+"onLeftPanelExpandFullFinish",e.LEFTPANEL_EXPAND_FULL_START=e.namespace+"onLeftPanelExpandFullStart",e.LOAD=e.namespace+"onLoad",e.LOAD_FAILED=e.namespace+"onLoadFailed",e.LOGIN=e.namespace+"onLogin",e.LOGIN_FAILED=e.namespace+"onLoginFailed",e.LOGOUT=e.namespace+"onLogout",e.MINUS=e.namespace+"onMinus",e.NOT_FOUND=e.namespace+"onNotFound",e.OPEN=e.namespace+"onOpen",e.OPEN_EXTERNAL_RESOURCE=e.namespace+"onOpenExternalResource",e.OPEN_LEFT_PANEL=e.namespace+"onOpenLeftPanel",e.OPEN_RIGHT_PANEL=e.namespace+"onOpenRightPanel",e.PAGE_DOWN=e.namespace+"onPageDown",e.PAGE_UP=e.namespace+"onPageUp",e.PARENT_EXIT_FULLSCREEN=e.namespace+"onParentExitFullScreen",e.PLUS=e.namespace+"onPlus",e.REDIRECT=e.namespace+"onRedirect",e.REFRESH=e.namespace+"onRefresh",e.RESIZE=e.namespace+"onResize",e.RESOURCE_DEGRADED=e.namespace+"onResourceDegraded",e.RETRY=e.namespace+"onRetry",e.RETURN=e.namespace+"onReturn",e.RIGHT_ARROW=e.namespace+"onRightArrow",e.RIGHTPANEL_COLLAPSE_FULL_FINISH=e.namespace+"onRightPanelCollapseFullFinish",e.RIGHTPANEL_COLLAPSE_FULL_START=e.namespace+"onRightPanelCollapseFullStart",e.RIGHTPANEL_EXPAND_FULL_FINISH=e.namespace+"onRightPanelExpandFullFinish",e.RIGHTPANEL_EXPAND_FULL_START=e.namespace+"onRightPanelExpandFullStart",e.SEQUENCE_INDEX_CHANGED=e.namespace+"onSequenceIndexChanged",e.SETTINGS_CHANGED=e.namespace+"onSettingsChanged",e.SHOW_CLICKTHROUGH_DIALOGUE=e.namespace+"onShowClickThroughDialogue",e.SHOW_DOWNLOAD_DIALOGUE=e.namespace+"onShowDownloadDialogue",e.SHOW_EMBED_DIALOGUE=e.namespace+"onShowEmbedDialogue",e.SHOW_EXTERNALCONTENT_DIALOGUE=e.namespace+"onShowExternalContentDialogue",e.SHOW_GENERIC_DIALOGUE=e.namespace+"onShowGenericDialogue",e.SHOW_HELP_DIALOGUE=e.namespace+"onShowHelpDialogue",e.SHOW_INFORMATION=e.namespace+"onShowInformation",e.SHOW_LOGIN_DIALOGUE=e.namespace+"onShowLoginDialogue",e.SHOW_OVERLAY=e.namespace+"onShowOverlay",e.SHOW_RESTRICTED_DIALOGUE=e.namespace+"onShowRestrictedDialogue",e.SHOW_SETTINGS_DIALOGUE=e.namespace+"onShowSettingsDialogue",e.THUMB_SELECTED=e.namespace+"onThumbSelected",e.TOGGLE_FULLSCREEN=e.namespace+"onToggleFullScreen",e.UP_ARROW=e.namespace+"onUpArrow",e.UPDATE_SETTINGS=e.namespace+"onUpdateSettings",e.VIEW_FULL_TERMS=e.namespace+"onViewFullTerms",e.WINDOW_UNLOAD=e.namespace+"onWindowUnload",e}();return n}),define("Params",["require","exports"],function(e,t){var n;return function(e){e[e.collectionIndex=0]="collectionIndex",e[e.manifestIndex=1]="manifestIndex",e[e.sequenceIndex=2]="sequenceIndex",e[e.canvasIndex=3]="canvasIndex",e[e.zoom=4]="zoom",e[e.rotation=5]="rotation",e[e.highlight=6]="highlight",e[e.anchor=7]="anchor"}(n||(n={})),n}),define("BootstrapParams",["require","exports","./Params"],function(e,t,n){var i=function(){function e(){this.paramMap=["c","m","s","cv","z","r","h","a"],this.config=Utils.Urls.getQuerystringParameter("config"),this.domain=Utils.Urls.getQuerystringParameter("domain"),this.embedDomain=Utils.Urls.getQuerystringParameter("embedDomain"),this.embedScriptUri=Utils.Urls.getQuerystringParameter("embedScriptUri"),this.isHomeDomain="true"===Utils.Urls.getQuerystringParameter("isHomeDomain"),this.isLightbox="true"===Utils.Urls.getQuerystringParameter("isLightbox"),this.isOnlyInstance="true"===Utils.Urls.getQuerystringParameter("isOnlyInstance"),this.isReload="true"===Utils.Urls.getQuerystringParameter("isReload");var e=Utils.Urls.getQuerystringParameter("jsonp");this.jsonp=null===e?null:!("false"===e||"0"===e),this.manifestUri=Utils.Urls.getQuerystringParameter("manifestUri");var t=Utils.Urls.getQuerystringParameter("locale")||"en-GB";this.setLocale(t),this.collectionIndex=this.getParam(n.collectionIndex),this.manifestIndex=this.getParam(n.manifestIndex),this.sequenceIndex=this.getParam(n.sequenceIndex),this.canvasIndex=this.getParam(n.canvasIndex)}return e.prototype.getLocaleName=function(){return this.localeName},e.prototype.getParam=function(e){if(this.hashParamsAvailable()){var t=parseInt(Utils.Urls.getHashParameter(this.paramMap[e],parent.document));if(t||0===t)return t}return parseInt(Utils.Urls.getQuerystringParameter(this.paramMap[e]))||0},e.prototype.hashParamsAvailable=function(){return this.isHomeDomain&&!this.isReload&&this.isOnlyInstance},e.prototype.setLocale=function(e){this.locale=e,this.locales=[];for(var t=this.locale.split(","),n=0;n<t.length;n++){var i=t[n].split(":");this.locales.push({name:i[0].trim(),label:i[1]?i[1].trim():""})}this.localeName=this.locales[0].name},e}();return i}),define("Bootstrapper",["require","exports","./modules/uv-shared-module/BaseCommands","./BootstrapParams"],function(e,t,n,i){var r=function(){function e(e){this.isFullScreen=!1,this.extensions=e}return e.prototype.bootStrap=function(e){this.params=new i,e&&(this.params=$.extend(!0,this.params,e)),this.params.manifestUri&&($("#app").empty(),$("#app").addClass("loading"),$('link[type*="text/css"]').remove(),jQuery.support.cors=!0,this.loadIIIFResource())},e.prototype.isCORSEnabled=function(){return null===this.params.jsonp?Modernizr.cors:!this.params.jsonp},e.prototype.loadIIIFResource=function(){var e=this,t=this;if(t.isCORSEnabled())$.getJSON(t.params.manifestUri,function(e){t.iiifResource=t.parseIIIFResource(JSON.stringify(e)),t.loadResource().then(function(e){return e?void t.manifestLoaded(e):void t.notFound()})});else{var n={url:t.params.manifestUri,type:"GET",dataType:"jsonp",jsonp:"callback",jsonpCallback:"manifestCallback"};$.ajax(n),window.manifestCallback=function(n){e.iiifResource=t.parseIIIFResource(JSON.stringify(n)),e.loadResource().then(function(t){return t?void e.manifestLoaded(t):void e.notFound()})}}},e.prototype.parseIIIFResource=function(e){return manifesto.create(e,{locale:this.params.localeName})},e.prototype.loadResource=function(){var e=this,t=this;return new Promise(function(n){t.iiifResource.getIIIFResourceType().toString()===manifesto.IIIFResourceType.collection().toString()?t.iiifResource.collections&&t.iiifResource.collections.length?t.iiifResource.getCollectionByIndex(t.params.collectionIndex).then(function(i){i||(t.notFound(),n()),0==i.getTotalManifests()&&0==e.params.manifestIndex&&i.getTotalCollections()>0&&(t.params.collectionIndex=0,t.params.manifestUri=i.id,t.bootStrap(t.params)),i.getManifestByIndex(t.params.manifestIndex).then(function(e){n(e)})}):t.iiifResource.getManifestByIndex(t.params.manifestIndex).then(function(e){n(e)}):n(t.iiifResource)})},e.prototype.manifestLoaded=function(e){var t=this;this.manifest=e;var n=e.getTrackingLabel();n+=", URI: "+this.params.embedDomain,window.trackingLabel=n;var i,r,o;if(i=this.manifest.getSequenceByIndex(this.params.sequenceIndex),!i)return void this.notFound();if(r=i.getCanvasByIndex(this.params.canvasIndex),!r)return void this.notFound();var s=r.getType();if(o=this.extensions[s.toString()],!o){var a=r.getProperty("format");o=this.extensions[a]}o||alert("No matching UV extension found."),this.featureDetect(function(){t.configure(o,function(e){t.injectCss(o,e,function(){t.createExtension(o,e)})})})},e.prototype.notFound=function(){try{return void parent.$(parent.document).trigger(n.NOT_FOUND)}catch(e){}},e.prototype.featureDetect=function(e){yepnope({test:window.btoa&&window.atob,nope:"lib/base64.min.js",complete:function(){e()}})},e.prototype.configure=function(e,t){var n=this,i=this;this.getConfigExtension(e,function(r){var o=window.DEBUG?"extensions/"+e.name+"/build/"+i.params.getLocaleName()+".config.json":"lib/"+e.name+"."+i.params.getLocaleName()+".config.json";$.getJSON(o,function(i){n.extendConfig(e,i,r,t)})})},e.prototype.extendConfig=function(e,t,n,i){t.name=e.name,n&&(t.uri=this.params.config,$.extend(!0,t,n)),i(t)},e.prototype.getConfigExtension=function(e,t){var n=sessionStorage.getItem(e.name+"."+this.params.localeName);if(n)t(JSON.parse(n));else if(this.params.config)if(this.isCORSEnabled())$.getJSON(this.params.config,function(e){t(e)});else{var i={url:this.params.config,type:"GET",dataType:"jsonp",jsonp:"callback",jsonpCallback:"configExtensionCallback"};$.ajax(i),window.configExtensionCallback=function(e){t(e)}}else t(null)},e.prototype.injectCss=function(e,t,n){var i=window.DEBUG?"extensions/"+e.name+"/build/"+t.options.theme+".css":"themes/"+t.options.theme+"/css/"+e.name+"/theme.css";yepnope.injectCss(i,function(){n()})},e.prototype.createExtension=function(e,t){this.config=t;var n=new e.provider(this);this.extension=new e.type(this),this.extension.name=e.name,this.extension.provider=n,this.extension.create()},e}();return r}),define("modules/uv-shared-module/Panel",["require","exports","./BaseCommands"],function(e,t,n){var i=function(){function e(e,t,n){this.isResized=!1,this.$element=e,this.fitToParentWidth=t||!1,this.fitToParentHeight=n||!1,this.create()}return e.prototype.create=function(){var e=this;$.subscribe(n.RESIZE,function(){e.resize()})},e.prototype.resize=function(){var e=this.$element.parent();this.fitToParentWidth&&this.$element.width(e.width()),this.fitToParentHeight&&this.$element.height(e.height()),this.isResized=!0},e}();return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/BaseView",["require","exports","./Panel"],function(e,t,n){var i=function(e){function t(t,n,i){this.modules=[],this.bootstrapper=$("body > #app").data("bootstrapper"),e.call(this,t,n,i)}return __extends(t,e),t.prototype.create=function(){e.prototype.create.call(this),this.extension=this.bootstrapper.extension,this.provider=this.extension.provider,this.config={},this.config.content={},this.config.options={},this.content=this.config.content,this.options=this.config.options;var t=this;t.modules.length&&(t.modules=t.modules.reverse(),_.each(t.modules,function(e){t.config=$.extend(!0,t.config,t.provider.config.modules[e])}))},t.prototype.init=function(){},t.prototype.setConfig=function(e){this.modules.push(e)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/Dialogue",["require","exports","./BaseView","./BaseCommands"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t,!1,!1),this.allowClose=!0,this.isActive=!1,this.isUnopened=!0}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("dialogue"),e.prototype.create.call(this),$.subscribe(i.CLOSE_ACTIVE_DIALOGUE,function(){t.isActive&&t.allowClose&&t.close()}),$.subscribe(i.ESCAPE,function(){t.isActive&&t.allowClose&&t.close()}),this.$top=$('<div class="top"></div>'),this.$element.append(this.$top),this.$closeButton=$('<a href="#" class="close">'+this.content.close+"</a>"),this.$top.append(this.$closeButton),this.$middle=$('<div class="middle"></div>'),this.$element.append(this.$middle),this.$content=$('<div class="content"></div>'),this.$middle.append(this.$content),this.$bottom=$('<div class="bottom"></div>'),this.$element.append(this.$bottom),this.$closeButton.on("click",function(e){e.preventDefault(),t.close()}),this.returnFunc=this.close},t.prototype.enableClose=function(){this.allowClose=!0,this.$closeButton.show()},t.prototype.disableClose=function(){this.allowClose=!1,this.$closeButton.hide()},t.prototype.setArrowPosition=function(){var e=parseInt(this.$element.css("padding-left")),t=this.extension.mouseX-e-10;0>t&&(t=0),this.$bottom.css("backgroundPosition",t+"px 0px")},t.prototype.open=function(){var e=this;this.$element.show(),
this.setArrowPosition(),this.isActive=!0,setTimeout(function(){e.$element.find(".btn.default").focus()},1),$.publish(i.SHOW_OVERLAY),this.isUnopened&&(this.isUnopened=!1,this.afterFirstOpen()),this.resize()},t.prototype.afterFirstOpen=function(){},t.prototype.close=function(){this.isActive&&(this.$element.hide(),this.isActive=!1,$.publish(this.closeCommand),$.publish(i.HIDE_OVERLAY))},t.prototype.resize=function(){e.prototype.resize.call(this),this.$element.css({top:Math.floor(this.extension.height()/2-this.$element.height()/2),left:Math.floor(this.extension.width()/2-this.$element.width()/2)})},t}(n);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-dialogues-module/ClickThroughDialogue",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/Dialogue"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("clickThroughDialogue"),e.prototype.create.call(this),this.openCommand=n.SHOW_CLICKTHROUGH_DIALOGUE,this.closeCommand=n.HIDE_CLICKTHROUGH_DIALOGUE,$.subscribe(this.openCommand,function(e,n){t.acceptCallback=n.acceptCallback,t.resource=n.resource,t.open()}),$.subscribe(this.closeCommand,function(e){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="acceptTerms btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$acceptTermsButton=this.$content.find(".acceptTerms"),this.$acceptTermsButton.text("Accept Terms and Open"),this.$element.hide(),this.$acceptTermsButton.on("click",function(e){e.preventDefault(),t.close(),$.publish(n.ACCEPT_TERMS),t.acceptCallback&&t.acceptCallback()})},t.prototype.open=function(){e.prototype.open.call(this),this.$title.text(this.resource.clickThroughService.getProperty("label")),this.$message.html(this.resource.clickThroughService.getProperty("description")),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var e=$(this).attr("href");$.publish(n.EXTERNAL_LINK_CLICKED,[e])}),this.resize()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i);return r}),define("modules/uv-shared-module/ExternalResource",["require","exports"],function(e,t){var n=function(){function e(e,t){this.isResponseHandled=!1,e.externalResource=this,this.dataUri=t(e),this._parseAuthServices(e)}return e.prototype._parseAuthServices=function(e){this.clickThroughService=manifesto.getService(e,manifesto.ServiceProfile.clickThrough().toString()),this.loginService=manifesto.getService(e,manifesto.ServiceProfile.login().toString()),this.restrictedService=manifesto.getService(e,manifesto.ServiceProfile.restricted().toString()),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(manifesto.ServiceProfile.logout().toString()),this.tokenService=this.clickThroughService.getService(manifesto.ServiceProfile.token().toString())):this.loginService?(this.logoutService=this.loginService.getService(manifesto.ServiceProfile.logout().toString()),this.tokenService=this.loginService.getService(manifesto.ServiceProfile.token().toString())):this.restrictedService&&(this.logoutService=this.restrictedService.getService(manifesto.ServiceProfile.logout().toString()),this.tokenService=this.restrictedService.getService(manifesto.ServiceProfile.token().toString()))},e.prototype.isAccessControlled=function(){return this.clickThroughService||this.loginService||this.restrictedService?!0:!1},e.prototype.getData=function(e){var t=this;return new Promise(function(n,i){var r="GET";if(!_.endsWith(t.dataUri,"info.json")){if(!t.isAccessControlled())return t.status=HTTPStatusCode.OK,void n(t);r="HEAD"}$.ajax({url:t.dataUri,type:r,dataType:"json",beforeSend:function(t){e&&t.setRequestHeader("Authorization","Bearer "+e.accessToken)}}).done(function(e){if(e){var i=unescape(e["@id"]);t.data=e,t._parseAuthServices(t.data),_.endsWith(i,"/info.json")&&(i=i.substr(0,_.lastIndexOf(i,"/")));var r=t.dataUri;_.endsWith(r,"/info.json")&&(r=r.substr(0,_.lastIndexOf(r,"/"))),i!==r&&t.loginService?t.status=HTTPStatusCode.MOVED_TEMPORARILY:t.status=HTTPStatusCode.OK,n(t)}else t.status=HTTPStatusCode.OK,n(t)}).fail(function(e){t.status=e.status,t.error=e,e.responseJSON&&t._parseAuthServices(e.responseJSON),n(t)})})},e}();return n}),define("modules/uv-shared-module/InformationArgs",["require","exports"],function(e,t){var n=function(){function e(e,t){this.informationType=e,this.param=t}return e}();return n}),define("modules/uv-shared-module/InformationType",["require","exports"],function(e,t){var n;return function(e){e[e.AUTH_CORS_ERROR=0]="AUTH_CORS_ERROR",e[e.DEGRADED_RESOURCE=1]="DEGRADED_RESOURCE"}(n||(n={})),n});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-dialogues-module/LoginDialogue",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/Dialogue"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("loginDialogue"),e.prototype.create.call(this),this.openCommand=n.SHOW_LOGIN_DIALOGUE,this.closeCommand=n.HIDE_LOGIN_DIALOGUE,$.subscribe(this.openCommand,function(e,n){t.loginCallback=n.loginCallback,t.logoutCallback=n.logoutCallback,t.options=n.options,t.resource=n.resource,t.open()}),$.subscribe(this.closeCommand,function(e){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="logout btn btn-primary" href="#" target="_parent"></a>                    <a class="login btn btn-primary" href="#" target="_parent"></a>                    <a class="cancel btn btn-primary" href="#"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$loginButton=this.$content.find(".login"),this.$loginButton.text(this.content.login),this.$logoutButton=this.$content.find(".logout"),this.$logoutButton.text(this.content.logout),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$loginButton.on("click",function(e){e.preventDefault(),t.close(),t.loginCallback&&t.loginCallback()}),this.$logoutButton.on("click",function(e){e.preventDefault(),t.close(),t.logoutCallback&&t.logoutCallback()}),this.$cancelButton.on("click",function(e){e.preventDefault(),t.close()}),this.updateLogoutButton()},t.prototype.open=function(){e.prototype.open.call(this),this.$title.text(this.resource.loginService.getProperty("label"));var t=this.resource.loginService.getProperty("description");this.options.warningMessage&&(t='<span class="warning">'+this.provider.config.content[this.options.warningMessage]+'</span><span class="description">'+t+"</span>"),this.updateLogoutButton(),this.$message.html(t),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var e=$(this).attr("href");$.publish(n.EXTERNAL_LINK_CLICKED,[e])}),this.options.showCancelButton?this.$cancelButton.show():this.$cancelButton.hide(),this.resize()},t.prototype.updateLogoutButton=function(){this.extension.isLoggedIn?this.$logoutButton.show():this.$logoutButton.hide()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i);return r}),define("modules/uv-shared-module/LoginWarningMessages",["require","exports"],function(e,t){var n=function(){function e(){}return e.FORBIDDEN="forbiddenResourceMessage",e}();return n});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-dialogues-module/RestrictedDialogue",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/Dialogue"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("restrictedDialogue"),e.prototype.create.call(this),this.openCommand=n.SHOW_RESTRICTED_DIALOGUE,this.closeCommand=n.HIDE_RESTRICTED_DIALOGUE,$.subscribe(this.openCommand,function(e,n){t.acceptCallback=n.acceptCallback,t.options=n.options,t.resource=n.resource,t.open()}),$.subscribe(this.closeCommand,function(e){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="cancel btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$message.targetBlank(),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$cancelButton.on("click",function(e){e.preventDefault(),t.close()})},t.prototype.open=function(){e.prototype.open.call(this),this.isAccepted=!1,this.$title.text(this.resource.restrictedService.getProperty("label"));var t=this.resource.restrictedService.getProperty("description");this.$message.html(t),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var e=$(this).attr("href");$.publish(n.EXTERNAL_LINK_CLICKED,[e])}),this.resize()},t.prototype.close=function(){e.prototype.close.call(this),!this.isAccepted&&this.acceptCallback&&(this.isAccepted=!0,this.acceptCallback())},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/GenericDialogue",["require","exports","./BaseCommands","./Dialogue"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("genericDialogue"),e.prototype.create.call(this),this.openCommand=n.SHOW_GENERIC_DIALOGUE,this.closeCommand=n.HIDE_GENERIC_DIALOGUE,$.subscribe(this.openCommand,function(e,n){t.acceptCallback=n.acceptCallback,t.showMessage(n)}),$.subscribe(this.closeCommand,function(e){t.close()}),this.$message=$("<p></p>"),this.$content.append(this.$message),this.$acceptButton=$('<a href="#" class="btn btn-primary accept default"></a>'),this.$content.append(this.$acceptButton),this.$acceptButton.text(this.content.ok),this.$acceptButton.onPressed(function(){t.accept()}),this.returnFunc=function(){t.isActive&&t.accept()},this.$element.hide()},t.prototype.accept=function(){$.publish(n.CLOSE_ACTIVE_DIALOGUE),this.acceptCallback&&this.acceptCallback()},t.prototype.showMessage=function(e){this.$message.html(e.message),e.buttonText?this.$acceptButton.text(e.buttonText):this.$acceptButton.text(this.content.ok),e.allowClose===!1&&this.disableClose(),this.open()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/Shell",["require","exports","./BaseCommands","./BaseView","./GenericDialogue"],function(e,t,n,i,r){var o=function(e){function t(n){t.$element=n,e.call(this,t.$element,!0,!0)}return __extends(t,e),t.prototype.create=function(){e.prototype.create.call(this),$.subscribe(n.SHOW_OVERLAY,function(){t.$overlays.show()}),$.subscribe(n.HIDE_OVERLAY,function(){t.$overlays.hide()}),t.$headerPanel=$('<div class="headerPanel"></div>'),t.$element.append(t.$headerPanel),t.$mainPanel=$('<div class="mainPanel"></div>'),t.$element.append(t.$mainPanel),t.$centerPanel=$('<div class="centerPanel"></div>'),t.$mainPanel.append(t.$centerPanel),t.$leftPanel=$('<div class="leftPanel"></div>'),t.$mainPanel.append(t.$leftPanel),t.$rightPanel=$('<div class="rightPanel"></div>'),t.$mainPanel.append(t.$rightPanel),t.$footerPanel=$('<div class="footerPanel"></div>'),t.$element.append(t.$footerPanel),t.$overlays=$('<div class="overlays"></div>'),t.$element.append(t.$overlays),t.$genericDialogue=$('<div class="overlay genericDialogue"></div>'),t.$overlays.append(t.$genericDialogue),t.$overlays.on("click",function(e){$(e.target).hasClass("overlays")&&(e.preventDefault(),$.publish(n.CLOSE_ACTIVE_DIALOGUE))}),new r(t.$genericDialogue)},t.prototype.resize=function(){e.prototype.resize.call(this),t.$overlays.width(this.extension.width()),t.$overlays.height(this.extension.height());var n=this.$element.height()-parseInt(t.$mainPanel.css("marginTop"))-t.$headerPanel.height()-t.$footerPanel.height();t.$mainPanel.height(n)},t}(i);return o}),define("modules/uv-shared-module/BaseExtension",["require","exports","./BaseCommands","../../BootstrapParams","../../modules/uv-dialogues-module/ClickThroughDialogue","./ExternalResource","./InformationArgs","./InformationType","../../modules/uv-dialogues-module/LoginDialogue","./LoginWarningMessages","../../Params","../../modules/uv-dialogues-module/RestrictedDialogue","./Shell"],function(e,t,n,i,r,o,s,a,u,c,l,h,p){var d=function(){function t(e){this.isCreated=!1,this.isLoggedIn=!1,this.shifted=!1,this.tabbing=!1,this.bootstrapper=e}return t.prototype.create=function(e){var t=this,r=this;this.$element=$("#app"),this.$element.data("bootstrapper",this.bootstrapper);var o=$(window);if(this.embedWidth=o.width(),this.embedHeight=o.height(),this.$element.width(this.embedWidth),this.$element.height(this.embedHeight),!this.provider.isReload&&Utils.Documents.isInIFrame()&&(this.bootstrapper.socket=new easyXDM.Socket({onMessage:function(e,n){e=$.parseJSON(e),t.handleParentFrameEvent(e)}})),this.triggerSocket(n.LOAD,{bootstrapper:{config:this.provider.bootstrapper.config,params:this.provider.bootstrapper.params},settings:this.provider.getSettings(),preview:this.getSharePreview()}),this.$element.empty(),this.$element.removeClass(),this.$element.addClass("browser-"+window.browserDetect.browser),this.$element.addClass("browser-version-"+window.browserDetect.version),this.provider.isHomeDomain||this.$element.addClass("embedded"),this.provider.isLightbox&&this.$element.addClass("lightbox"),$(document).on("mousemove",function(e){t.mouseX=e.pageX,t.mouseY=e.pageY}),!this.provider.isReload){window.onresize=function(){var e=$(window);$("body").height(e.height()),t.resize()};var s=Utils.Documents.getHiddenProp();if(s){var a=s.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(a,function(){Utils.Documents.isHidden()||t.resize()})}this.$element.on("drop",function(e){e.preventDefault();var r=e.originalEvent.dataTransfer.getData("URL"),o=Utils.Urls.getUrlParts(r),s=Utils.Urls.getQuerystringParameterFromString("manifest",o.search);if(s){t.triggerSocket(n.DROP,s);var a=new i;a.manifestUri=s,t.provider.reload(a)}}),this.$element.on("dragover",function(e){e.preventDefault()}),$(document).on("keyup keydown",function(e){t.shifted=e.shiftKey,t.tabbing=e.keyCode===KeyCodes.KeyDown.Tab}),$(document).keydown(function(e){var t=null,i=!0;e.ctrlKey||e.altKey||e.shiftKey||(e.keyCode===KeyCodes.KeyDown.Enter&&(t=n.RETURN),e.keyCode===KeyCodes.KeyDown.Escape&&(t=n.ESCAPE),e.keyCode===KeyCodes.KeyDown.PageUp&&(t=n.PAGE_UP),e.keyCode===KeyCodes.KeyDown.PageDown&&(t=n.PAGE_DOWN),e.keyCode===KeyCodes.KeyDown.End&&(t=n.END),e.keyCode===KeyCodes.KeyDown.Home&&(t=n.HOME),(e.keyCode===KeyCodes.KeyDown.NumpadPlus||171===e.keyCode||e.keyCode===KeyCodes.KeyDown.Equals)&&(t=n.PLUS,i=!1),(e.keyCode===KeyCodes.KeyDown.NumpadMinus||173===e.keyCode||e.keyCode===KeyCodes.KeyDown.Dash)&&(t=n.MINUS,i=!1),r.useArrowKeysToNavigate()&&(e.keyCode===KeyCodes.KeyDown.LeftArrow&&(t=n.LEFT_ARROW),e.keyCode===KeyCodes.KeyDown.UpArrow&&(t=n.UP_ARROW),e.keyCode===KeyCodes.KeyDown.RightArrow&&(t=n.RIGHT_ARROW),e.keyCode===KeyCodes.KeyDown.DownArrow&&(t=n.DOWN_ARROW))),t&&(i&&e.preventDefault(),$.publish(t))}),this.bootstrapper.params.isHomeDomain&&Utils.Documents.isInIFrame()&&$.subscribe(n.PARENT_EXIT_FULLSCREEN,function(){t.isOverlayActive()&&$.publish(n.ESCAPE),$.publish(n.ESCAPE),$.publish(n.RESIZE)})}this.$element.append('<a href="/" id="top"></a>'),this.$element.append('<iframe id="commsFrame" style="display:none"></iframe>'),$.subscribe(n.ACCEPT_TERMS,function(){t.triggerSocket(n.ACCEPT_TERMS)}),$.subscribe(n.LOGIN_FAILED,function(){t.triggerSocket(n.LOGIN_FAILED),t.showMessage(t.provider.config.content.authorisationFailedMessage)}),$.subscribe(n.LOGIN,function(){t.isLoggedIn=!0,t.triggerSocket(n.LOGIN)}),$.subscribe(n.LOGOUT,function(){t.isLoggedIn=!1,t.triggerSocket(n.LOGOUT)}),$.subscribe(n.BOOKMARK,function(){t.bookmark(),t.triggerSocket(n.BOOKMARK)}),$.subscribe(n.CANVAS_INDEX_CHANGE_FAILED,function(){t.triggerSocket(n.CANVAS_INDEX_CHANGE_FAILED)}),$.subscribe(n.CANVAS_INDEX_CHANGED,function(e,i){t.triggerSocket(n.CANVAS_INDEX_CHANGED,i)}),$.subscribe(n.CLICKTHROUGH,function(){t.triggerSocket(n.CLICKTHROUGH)}),$.subscribe(n.CLOSE_ACTIVE_DIALOGUE,function(){t.triggerSocket(n.CLOSE_ACTIVE_DIALOGUE)}),$.subscribe(n.CLOSE_LEFT_PANEL,function(){t.triggerSocket(n.CLOSE_LEFT_PANEL),t.resize()}),$.subscribe(n.CLOSE_RIGHT_PANEL,function(){t.triggerSocket(n.CLOSE_RIGHT_PANEL),t.resize()}),$.subscribe(n.CREATED,function(){t.isCreated=!0,t.triggerSocket(n.CREATED)}),$.subscribe(n.DOWN_ARROW,function(){t.triggerSocket(n.DOWN_ARROW)}),$.subscribe(n.DOWNLOAD,function(e,i){t.triggerSocket(n.DOWNLOAD,i)}),$.subscribe(n.END,function(){t.triggerSocket(n.END)}),$.subscribe(n.ESCAPE,function(){t.triggerSocket(n.ESCAPE),t.isFullScreen()&&!t.isOverlayActive()&&$.publish(n.TOGGLE_FULLSCREEN)}),$.subscribe(n.FEEDBACK,function(){t.feedback()}),$.subscribe(n.FORBIDDEN,function(){t.triggerSocket(n.FORBIDDEN),$.publish(n.OPEN_EXTERNAL_RESOURCE)}),$.subscribe(n.HIDE_DOWNLOAD_DIALOGUE,function(){t.triggerSocket(n.HIDE_DOWNLOAD_DIALOGUE)}),$.subscribe(n.HIDE_EMBED_DIALOGUE,function(){t.triggerSocket(n.HIDE_EMBED_DIALOGUE)}),$.subscribe(n.HIDE_EXTERNALCONTENT_DIALOGUE,function(){t.triggerSocket(n.HIDE_EXTERNALCONTENT_DIALOGUE)}),$.subscribe(n.HIDE_GENERIC_DIALOGUE,function(){t.triggerSocket(n.HIDE_GENERIC_DIALOGUE)}),$.subscribe(n.HIDE_HELP_DIALOGUE,function(){t.triggerSocket(n.HIDE_HELP_DIALOGUE)}),$.subscribe(n.HIDE_INFORMATION,function(){t.triggerSocket(n.HIDE_INFORMATION)}),$.subscribe(n.HIDE_LOGIN_DIALOGUE,function(){t.triggerSocket(n.HIDE_LOGIN_DIALOGUE)}),$.subscribe(n.HIDE_OVERLAY,function(){t.triggerSocket(n.HIDE_OVERLAY)}),$.subscribe(n.HIDE_RESTRICTED_DIALOGUE,function(){t.triggerSocket(n.HIDE_RESTRICTED_DIALOGUE)}),$.subscribe(n.HIDE_SETTINGS_DIALOGUE,function(){t.triggerSocket(n.HIDE_SETTINGS_DIALOGUE)}),$.subscribe(n.HOME,function(){t.triggerSocket(n.HOME)}),$.subscribe(n.LEFT_ARROW,function(){t.triggerSocket(n.LEFT_ARROW)}),$.subscribe(n.LEFTPANEL_COLLAPSE_FULL_FINISH,function(){t.triggerSocket(n.LEFTPANEL_COLLAPSE_FULL_FINISH)}),$.subscribe(n.LEFTPANEL_COLLAPSE_FULL_START,function(){t.triggerSocket(n.LEFTPANEL_COLLAPSE_FULL_START)}),$.subscribe(n.LEFTPANEL_EXPAND_FULL_FINISH,function(){t.triggerSocket(n.LEFTPANEL_EXPAND_FULL_FINISH)}),$.subscribe(n.LEFTPANEL_EXPAND_FULL_START,function(){t.triggerSocket(n.LEFTPANEL_EXPAND_FULL_START)}),$.subscribe(n.LOAD_FAILED,function(){t.triggerSocket(n.LOAD_FAILED),_.isNull(r.provider.lastCanvasIndex)||r.provider.lastCanvasIndex===r.provider.canvasIndex||t.viewCanvas(r.provider.lastCanvasIndex)}),$.subscribe(n.EXTERNAL_LINK_CLICKED,function(e,i){t.triggerSocket(n.EXTERNAL_LINK_CLICKED,i)}),$.subscribe(n.NOT_FOUND,function(){t.triggerSocket(n.NOT_FOUND)}),$.subscribe(n.OPEN,function(){t.triggerSocket(n.OPEN);var e=String.format(t.provider.config.options.openTemplate,t.provider.manifestUri);window.open(e)}),$.subscribe(n.OPEN_LEFT_PANEL,function(){t.triggerSocket(n.OPEN_LEFT_PANEL),t.resize()}),$.subscribe(n.OPEN_EXTERNAL_RESOURCE,function(){t.triggerSocket(n.OPEN_EXTERNAL_RESOURCE)}),$.subscribe(n.OPEN_RIGHT_PANEL,function(){t.triggerSocket(n.OPEN_RIGHT_PANEL),t.resize()}),$.subscribe(n.PAGE_DOWN,function(){t.triggerSocket(n.PAGE_DOWN)}),$.subscribe(n.PAGE_UP,function(){t.triggerSocket(n.PAGE_UP)}),$.subscribe(n.RESOURCE_DEGRADED,function(e,i){t.triggerSocket(n.RESOURCE_DEGRADED),t.handleDegraded(i)}),$.subscribe(n.RETURN,function(){t.triggerSocket(n.RETURN)}),$.subscribe(n.RIGHT_ARROW,function(){t.triggerSocket(n.RIGHT_ARROW)}),$.subscribe(n.RIGHTPANEL_COLLAPSE_FULL_FINISH,function(){t.triggerSocket(n.RIGHTPANEL_COLLAPSE_FULL_FINISH)}),$.subscribe(n.RIGHTPANEL_COLLAPSE_FULL_START,function(){t.triggerSocket(n.RIGHTPANEL_COLLAPSE_FULL_START)}),$.subscribe(n.RIGHTPANEL_EXPAND_FULL_FINISH,function(){t.triggerSocket(n.RIGHTPANEL_EXPAND_FULL_FINISH)}),$.subscribe(n.RIGHTPANEL_EXPAND_FULL_START,function(){t.triggerSocket(n.RIGHTPANEL_EXPAND_FULL_START)}),$.subscribe(n.SEQUENCE_INDEX_CHANGED,function(){t.triggerSocket(n.SEQUENCE_INDEX_CHANGED)}),$.subscribe(n.SETTINGS_CHANGED,function(e,i){t.triggerSocket(n.SETTINGS_CHANGED,i)}),$.subscribe(n.SHOW_DOWNLOAD_DIALOGUE,function(){t.triggerSocket(n.SHOW_DOWNLOAD_DIALOGUE)}),$.subscribe(n.SHOW_EMBED_DIALOGUE,function(){t.triggerSocket(n.SHOW_EMBED_DIALOGUE)}),$.subscribe(n.SHOW_EXTERNALCONTENT_DIALOGUE,function(){t.triggerSocket(n.SHOW_EXTERNALCONTENT_DIALOGUE)}),$.subscribe(n.SHOW_GENERIC_DIALOGUE,function(){t.triggerSocket(n.SHOW_GENERIC_DIALOGUE)}),$.subscribe(n.SHOW_HELP_DIALOGUE,function(){t.triggerSocket(n.SHOW_HELP_DIALOGUE)}),$.subscribe(n.SHOW_INFORMATION,function(){t.triggerSocket(n.SHOW_INFORMATION)}),$.subscribe(n.SHOW_LOGIN_DIALOGUE,function(){t.triggerSocket(n.SHOW_LOGIN_DIALOGUE)}),$.subscribe(n.SHOW_CLICKTHROUGH_DIALOGUE,function(){t.triggerSocket(n.SHOW_CLICKTHROUGH_DIALOGUE)}),$.subscribe(n.SHOW_RESTRICTED_DIALOGUE,function(){t.triggerSocket(n.SHOW_RESTRICTED_DIALOGUE)}),$.subscribe(n.SHOW_OVERLAY,function(){t.triggerSocket(n.SHOW_OVERLAY)}),$.subscribe(n.SHOW_SETTINGS_DIALOGUE,function(){t.triggerSocket(n.SHOW_SETTINGS_DIALOGUE)}),$.subscribe(n.THUMB_SELECTED,function(e,i){t.triggerSocket(n.THUMB_SELECTED,i)}),$.subscribe(n.TOGGLE_FULLSCREEN,function(){$("#top").focus(),t.bootstrapper.isFullScreen=!t.bootstrapper.isFullScreen,t.triggerSocket(n.TOGGLE_FULLSCREEN,{isFullScreen:t.bootstrapper.isFullScreen,overrideFullScreen:t.provider.config.options.overrideFullScreen})}),$.subscribe(n.UP_ARROW,function(){t.triggerSocket(n.UP_ARROW)}),$.subscribe(n.UPDATE_SETTINGS,function(){t.triggerSocket(n.UPDATE_SETTINGS)}),$.subscribe(n.VIEW_FULL_TERMS,function(){t.triggerSocket(n.VIEW_FULL_TERMS)}),$.subscribe(n.WINDOW_UNLOAD,function(){t.triggerSocket(n.WINDOW_UNLOAD)}),this.shell=new p(this.$element),this.canvasIndex=-1,e?this.loadDependencies(e):this.getDependencies(function(e){t.loadDependencies(e)})},t.prototype.createModules=function(){this.$clickThroughDialogue=$('<div class="overlay clickthrough"></div>'),p.$overlays.append(this.$clickThroughDialogue),this.clickThroughDialogue=new r(this.$clickThroughDialogue),this.$restrictedDialogue=$('<div class="overlay login"></div>'),p.$overlays.append(this.$restrictedDialogue),this.restrictedDialogue=new h(this.$restrictedDialogue),this.$loginDialogue=$('<div class="overlay login"></div>'),p.$overlays.append(this.$loginDialogue),this.loginDialogue=new u(this.$loginDialogue)},t.prototype.modulesCreated=function(){},t.prototype.getDependencies=function(t){var n=this,i=window.DEBUG?"../../extensions/"+this.name+"/dependencies":this.name+"-dependencies",r=$("script[data-requiremodule]").filter(function(){var e=$(this).attr("data-requiremodule");return-1!=e.indexOf(n.name)&&-1!=e.indexOf("dependencies")});r.length?t(null):e([i],function(e){for(var i=window.DEBUG?"../../extensions/"+n.name+"/lib/":"",r=0;r<e.dependencies.length;r++)e.dependencies[r]=i+e.dependencies[r];t(e)})},t.prototype.loadDependencies=function(t){var n=this;t?e(t.dependencies,function(){n.dependenciesLoaded()}):n.dependenciesLoaded()},t.prototype.dependenciesLoaded=function(){this.createModules(),this.modulesCreated(),$.publish(n.RESIZE),$.publish(n.CREATED),this.setParams(),this.setDefaultFocus(),this.viewCanvas(this.provider.getCanvasIndexParam())},t.prototype.setParams=function(){this.provider.isHomeDomain&&(this.setParam(l.collectionIndex,this.provider.collectionIndex),this.setParam(l.manifestIndex,this.provider.manifestIndex),this.setParam(l.sequenceIndex,this.provider.sequenceIndex),this.setParam(l.canvasIndex,this.provider.canvasIndex))},t.prototype.setDefaultFocus=function(){setTimeout(function(){$("[tabindex=1]").focus()},1)},t.prototype.width=function(){return $(window).width()},t.prototype.height=function(){return $(window).height()},t.prototype.triggerSocket=function(e,t){jQuery(document).trigger(e,[t]),this.bootstrapper.socket&&this.bootstrapper.socket.postMessage(JSON.stringify({eventName:e,eventObject:t}))},t.prototype.redirect=function(e){this.triggerSocket(n.REDIRECT,e)},t.prototype.refresh=function(){this.triggerSocket(n.REFRESH,null)},t.prototype.resize=function(){$.publish(n.RESIZE)},t.prototype.handleParentFrameEvent=function(e){var t=this;Utils.Async.waitFor(function(){return t.isCreated},function(){switch(e.eventName){case n.TOGGLE_FULLSCREEN:$.publish(n.TOGGLE_FULLSCREEN,e.eventObject);break;case n.PARENT_EXIT_FULLSCREEN:$.publish(n.PARENT_EXIT_FULLSCREEN)}})},t.prototype.getSharePreview=function(){var e={};e.title=this.provider.getLabel();var t=this.provider.getCurrentCanvas(),n=t.getProperty("thumbnail");return n&&_.isString(n)||(n=t.getCanonicalImageUri(this.provider.config.options.bookmarkThumbWidth)),e.image=n,e},t.prototype.getExternalResources=function(e){var t=this,i=this.provider.getPagedIndices(),r=[];_.each(i,function(n){var i=t.provider.getCanvasByIndex(n),s=new o(i,t.provider.getInfoUri);if(e){var a=_.find(e,function(e){return e.dataUri===s.dataUri});a?r.push(a):r.push(s)}else r.push(s)});var s=this.provider.config.options.tokenStorage;return new Promise(function(e){manifesto.loadExternalResources(r,s,t.clickThrough,t.restricted,t.login,t.getAccessToken,t.storeAccessToken,t.getStoredAccessToken,t.handleExternalResourceResponse).then(function(n){t.provider.resources=_.map(n,function(e){return _.toPlainObject(e.data)}),e(t.provider.resources)})["catch"](function(e){switch(e.name){case manifesto.StatusCodes.AUTHORIZATION_FAILED.toString():$.publish(n.LOGIN_FAILED);break;case manifesto.StatusCodes.FORBIDDEN.toString():$.publish(n.FORBIDDEN);break;case manifesto.StatusCodes.RESTRICTED.toString():break;default:t.showMessage(e.message||e)}})})},t.prototype.getParam=function(e){var t;return this.provider.isDeepLinkingEnabled()&&(t=Utils.Urls.getHashParameter(this.provider.bootstrapper.params.paramMap[e],parent.document)),t||(t=Utils.Urls.getQuerystringParameter(this.provider.bootstrapper.params.paramMap[e])),t},t.prototype.setParam=function(e,t){this.provider.isDeepLinkingEnabled()&&Utils.Urls.setHashParameter(this.provider.bootstrapper.params.paramMap[e],t,parent.document)},t.prototype.viewCanvas=function(e){-1!==e&&(this.provider.isCanvasIndexOutOfRange(e)&&(this.showMessage(this.provider.config.content.canvasIndexOutOfRange),e=0),this.provider.lastCanvasIndex=this.provider.canvasIndex,this.provider.canvasIndex=e,$.publish(n.CANVAS_INDEX_CHANGED,[e]),$.publish(n.OPEN_EXTERNAL_RESOURCE),this.setParam(l.canvasIndex,e))},t.prototype.showMessage=function(e,t,i,r){this.closeActiveDialogue(),$.publish(n.SHOW_GENERIC_DIALOGUE,[{message:e,acceptCallback:t,buttonText:i,allowClose:r}])},t.prototype.closeActiveDialogue=function(){$.publish(n.CLOSE_ACTIVE_DIALOGUE)},t.prototype.isOverlayActive=function(){return p.$overlays.is(":visible")},t.prototype.viewManifest=function(e){var t=new i;t.manifestUri=this.provider.manifestUri,t.collectionIndex=this.provider.getCollectionIndex(e),t.manifestIndex=e.index,t.sequenceIndex=0,t.canvasIndex=0,this.provider.reload(t)},t.prototype.viewCollection=function(e){var t=new i;t.manifestUri=this.provider.manifestUri,t.collectionIndex=e.index,t.manifestIndex=0,t.sequenceIndex=0,t.canvasIndex=0,this.provider.reload(t)},t.prototype.isFullScreen=function(){return this.bootstrapper.isFullScreen},t.prototype.isLeftPanelEnabled=function(){if(Utils.Bools.getBool(this.provider.config.options.leftPanelEnabled,!0)){if(this.provider.hasParentCollection())return!0;if(this.provider.isMultiCanvas()&&this.provider.getViewingHint().toString()!==manifesto.ViewingHint.continuous().toString())return!0}return!1},t.prototype.isRightPanelEnabled=function(){return Utils.Bools.getBool(this.provider.config.options.rightPanelEnabled,!0)},t.prototype.useArrowKeysToNavigate=function(){return Utils.Bools.getBool(this.provider.config.options.useArrowKeysToNavigate,!0)},t.prototype.bookmark=function(){},t.prototype.feedback=function(){this.triggerSocket(n.FEEDBACK,new i)},t.prototype.getBookmarkUri=function(){var e=parent.document.URL,t=Utils.Urls.getUrlParts(e),n=t.pathname+t.search+parent.document.location.hash;return n.startsWith("/")||(n="/"+n),n},t.prototype.clickThrough=function(e){return new Promise(function(t){$.publish(n.SHOW_CLICKTHROUGH_DIALOGUE,[{resource:e,acceptCallback:function(){var i=window.open(e.clickThroughService.id),r=window.setInterval(function(){i.closed&&(window.clearInterval(r),$.publish(n.CLICKTHROUGH),t())},500)}}])})},t.prototype.restricted=function(e){return new Promise(function(t,i){$.publish(n.SHOW_RESTRICTED_DIALOGUE,[{resource:e,acceptCallback:function(){$.publish(n.LOAD_FAILED),i(e)}}])})},t.prototype.login=function(e){return new Promise(function(t){var i={};e.status===HTTPStatusCode.FORBIDDEN&&(i.warningMessage=c.FORBIDDEN,i.showCancelButton=!0),$.publish(n.SHOW_LOGIN_DIALOGUE,[{resource:e,loginCallback:function(){var i=window.open(e.loginService.id+"?t="+(new Date).getTime()),r=window.setInterval(function(){i.closed&&(window.clearInterval(r),$.publish(n.LOGIN),t())},500)},logoutCallback:function(){var i=window.open(e.logoutService.id+"?t="+(new Date).getTime()),r=window.setInterval(function(){i.closed&&(window.clearInterval(r),$.publish(n.LOGOUT),t())},500)},options:i}])})},t.prototype.getAccessToken=function(e,t){return new Promise(function(n,i){var r=e.tokenService.id,o=r+"|"+(new Date).getTime(),s=function(e){window.removeEventListener("message",s);var r=e.data;r.error?t?i(r.errorDescription):n(null):n(r)};window.addEventListener("message",s,!1);var a=r+"?messageId="+o;$("#commsFrame").prop("src",a)})},t.prototype.storeAccessToken=function(e,t,n){return new Promise(function(i,r){Utils.Storage.set(e.tokenService.id,t,t.expiresIn,new Utils.StorageType(n)),i()})},t.prototype.getStoredAccessToken=function(e,t){return new Promise(function(n,i){var r,o=[];if(e.tokenService&&(r=Utils.Storage.get(e.tokenService.id,new Utils.StorageType(t))),r)o.push(r);else for(var s=Utils.Urls.getUrlParts(e.dataUri).hostname,a=Utils.Storage.getItems(new Utils.StorageType(t)),u=0;u<a.length;u++)r=a[u],r.key.contains(s)&&o.push(r);o=_.sortBy(o,function(e){return e.expiresAt});var c;o.length&&(c=o.last().value),n(c)})},t.prototype.handleExternalResourceResponse=function(e){return new Promise(function(t,i){if(e.isResponseHandled=!0,e.status===HTTPStatusCode.OK)t(e);else if(e.status===HTTPStatusCode.MOVED_TEMPORARILY)t(e),$.publish(n.RESOURCE_DEGRADED,[e]);else if(e.error.status===HTTPStatusCode.UNAUTHORIZED||e.error.status===HTTPStatusCode.INTERNAL_SERVER_ERROR)if(Modernizr.cors)i(e.error.statusText);else{var r=new s(a.AUTH_CORS_ERROR,null);$.publish(n.SHOW_INFORMATION,[r]),t(e)}else if(e.error.status===HTTPStatusCode.FORBIDDEN){var o=new Error;
o.message="Forbidden",o.name=manifesto.StatusCodes.FORBIDDEN.toString(),i(o)}else i(e.error.statusText)})},t.prototype.handleDegraded=function(e){var t=new s(a.DEGRADED_RESOURCE,e);$.publish(n.SHOW_INFORMATION,[t])},t}();return d}),define("modules/uv-shared-module/Bookmark",["require","exports"],function(e,t){var n=function(){function e(){}return e}();return n}),define("extensions/uv-mediaelement-extension/Commands",["require","exports"],function(e,t){var n=function(){function e(){}return e.namespace="mediaelementExtension.",e.MEDIA_ENDED=e.namespace+"onMediaEnded",e.MEDIA_PAUSED=e.namespace+"onMediaPaused",e.MEDIA_PLAYED=e.namespace+"onMediaPlayed",e}();return n}),define("modules/uv-shared-module/DownloadOption",["require","exports"],function(e,t){var n=function(){function e(e){this.value=e}return e.prototype.toString=function(){return this.value},e.currentViewAsJpg=new e("currentViewAsJpg"),e.dynamicCanvasRenderings=new e("dynamicCanvasRenderings"),e.dynamicImageRenderings=new e("dynamicImageRenderings"),e.dynamicSequenceRenderings=new e("dynamicSequenceRenderings"),e.entireFileAsOriginal=new e("entireFileAsOriginal"),e.selection=new e("selection"),e.wholeImageHighRes=new e("wholeImageHighRes"),e.wholeImageLowResAsJpg=new e("wholeImageLowResAsJpg"),e}();return n});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-dialogues-module/DownloadDialogue",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/Dialogue","../uv-shared-module/DownloadOption"],function(e,t,n,i,r){var o=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("downloadDialogue"),e.prototype.create.call(this),this.openCommand=n.SHOW_DOWNLOAD_DIALOGUE,this.closeCommand=n.HIDE_DOWNLOAD_DIALOGUE,$.subscribe(this.openCommand,function(e,n){t.open()}),$.subscribe(this.closeCommand,function(e){t.close()}),this.$title=$("<h1>"+this.content.title+"</h1>"),this.$content.append(this.$title),this.$noneAvailable=$('<div class="noneAvailable">'+this.content.noneAvailable+"</div>"),this.$content.append(this.$noneAvailable),this.$downloadOptions=$('<ol class="options"></ol>'),this.$content.append(this.$downloadOptions),this.$element.hide()},t.prototype.addEntireFileDownloadOptions=function(){var e=this;if(this.isDownloadOptionAvailable(r.entireFileAsOriginal)){this.$downloadOptions.empty();var t=this.provider.getCurrentCanvas(),n=!1;_.each(t.getRenderings(),function(t){var i=t.getFormat(),r="";i&&(r=i.toString()),e.addEntireFileDownloadOption(t.id,t.getLabel(),r),n=!0}),n||this.addEntireFileDownloadOption(t.id,null,null)}},t.prototype.addEntireFileDownloadOption=function(e,t,n){t?t+=" ({0})":t=this.content.entireFileAsOriginal;var i;i=n?Utils.Files.simplifyMimeType(n):this.getFileExtension(e),this.$downloadOptions.append('<li><a href="'+e+'" target="_blank" download>'+String.format(t,i)+"</li>")},t.prototype.updateNoneAvailable=function(){this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show()},t.prototype.getFileExtension=function(e){return e.split(".").pop()},t.prototype.isDownloadOptionAvailable=function(e){switch(e){case r.entireFileAsOriginal:this.provider.manifest.getService(manifesto.ServiceProfile.uiExtensions());if(!this.provider.isUIEnabled("mediaDownload"))return!1}return!0},t.prototype.close=function(){e.prototype.close.call(this)},t.prototype.resize=function(){this.$element.css({top:Math.floor(this.extension.height()-this.$element.outerHeight(!0))})},t}(i);return o});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-mediaelement-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("downloadDialogue"),e.prototype.create.call(this)},t.prototype.open=function(){e.prototype.open.call(this),this.addEntireFileDownloadOptions(),this.updateNoneAvailable(),this.resize()},t.prototype.isDownloadOptionAvailable=function(t){return e.prototype.isDownloadOptionAvailable.call(this,t)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-dialogues-module/EmbedDialogue",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/Dialogue"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("embedDialogue"),e.prototype.create.call(this),this.openCommand=n.SHOW_EMBED_DIALOGUE,this.closeCommand=n.HIDE_EMBED_DIALOGUE,$.subscribe(this.openCommand,function(e,n){t.open(),t.update()}),$.subscribe(this.closeCommand,function(e){t.close()}),this.smallWidth=560,this.smallHeight=420,this.mediumWidth=640,this.mediumHeight=480,this.largeWidth=800,this.largeHeight=600,this.currentWidth=this.smallWidth,this.currentHeight=this.smallHeight,this.$title=$("<h1>"+this.content.title+"</h1>"),this.$content.append(this.$title),this.$firstRow=$('<div class="firstRow"><div class="leftCol"></div><div class="rightCol"></div></div>'),this.$content.append(this.$firstRow),this.$secondRow=$('<div class="secondRow"></div>'),this.$content.append(this.$secondRow),this.$link=$('<a target="_blank"></a>'),this.$firstRow.find(".leftCol").append(this.$link),this.$image=$('<img class="share" />'),this.$link.append(this.$image),this.$url=$('<input class="url" type="text" />'),this.$firstRow.find(".rightCol").append(this.$url),this.$intro=$("<p>"+this.content.instructions+"</p>"),this.$firstRow.find(".rightCol").append(this.$intro),this.$code=$('<textarea class="code"></textarea>'),this.$secondRow.append(this.$code),this.$sizes=$('<div class="sizes"></div>'),this.$secondRow.append(this.$sizes),this.$smallSize=$('<div class="size small"></div>'),this.$sizes.append(this.$smallSize),this.$smallSize.append("<p>"+this.smallWidth+" x "+this.smallHeight+"</p>"),this.$smallSize.append('<div class="box"></div>'),this.$mediumSize=$('<div class="size medium"></div>'),this.$sizes.append(this.$mediumSize),this.$mediumSize.append("<p>"+this.mediumWidth+" x "+this.mediumHeight+"</p>"),this.$mediumSize.append('<div class="box"></div>'),this.$largeSize=$('<div class="size large"></div>'),this.$sizes.append(this.$largeSize),this.$largeSize.append("<p>"+this.largeWidth+" x "+this.largeHeight+"</p>"),this.$largeSize.append('<div class="box"></div>'),this.$customSize=$('<div class="size custom"></div>'),this.$sizes.append(this.$customSize),this.$customSize.append("<p>"+this.content.customSize+"</p>"),this.$customSizeWrap=$('<div class="wrap"></div>'),this.$customSize.append(this.$customSizeWrap),this.$customSizeWidthWrap=$('<div class="width"></div>'),this.$customSizeWrap.append(this.$customSizeWidthWrap),this.$customSizeWidthWrap.append('<label for="width">'+this.content.width+"</label>"),this.$customWidth=$('<input id="width" type="text" maxlength="5" />'),this.$customSizeWidthWrap.append(this.$customWidth),this.$customSizeWidthWrap.append("<span>px</span>"),this.$customSizeHeightWrap=$('<div class="height"></div>'),this.$customSizeWrap.append(this.$customSizeHeightWrap),this.$customSizeHeightWrap.append('<label for="height">'+this.content.height+"</label>"),this.$customHeight=$('<input id="height" type="text" maxlength="5" />'),this.$customSizeHeightWrap.append(this.$customHeight),this.$customSizeHeightWrap.append("<span>px</span>"),this.$url.click(function(){$(this).select()}),this.provider.isDeepLinkingEnabled()||this.$url.hide(),this.$code.focus(function(){$(this).select()}),this.$code.mouseup(function(e){e.preventDefault()}),this.$smallSize.click(function(e){e.preventDefault(),t.selectSmall()}),this.$mediumSize.click(function(e){e.preventDefault(),t.selectMedium()}),this.$largeSize.click(function(e){e.preventDefault(),t.selectLarge()}),this.$customSize.click(function(e){e.preventDefault(),t.selectCustom()}),this.$customWidth.keydown(function(e){Utils.Numbers.numericalInput(e)}),this.$customWidth.keyup(function(e){t.getCustomSize()}),this.$customHeight.keydown(function(e){Utils.Numbers.numericalInput(e)}),this.$customHeight.keyup(function(e){t.getCustomSize()});var i=this.extension.width(),r=this.extension.height();i===this.smallWidth&&r===this.smallHeight?this.selectSmall():i===this.mediumWidth&&r===this.mediumHeight?this.selectMedium():i===this.largeWidth&&r===this.largeHeight?this.selectLarge():this.selectCustom(),this.$element.hide()},t.prototype.selectSmall=function(){this.currentWidth=this.smallWidth,this.currentHeight=this.smallHeight,this.$sizes.find(".size").removeClass("selected"),this.$smallSize.addClass("selected"),this.update()},t.prototype.selectMedium=function(){this.currentWidth=this.mediumWidth,this.currentHeight=this.mediumHeight,this.$sizes.find(".size").removeClass("selected"),this.$mediumSize.addClass("selected"),this.update()},t.prototype.selectLarge=function(){this.currentWidth=this.largeWidth,this.currentHeight=this.largeHeight,this.$sizes.find(".size").removeClass("selected"),this.$largeSize.addClass("selected"),this.update()},t.prototype.selectCustom=function(){this.$customWidth.val()||this.$customWidth.val(this.extension.embedWidth.toString()),this.$customHeight.val()||this.$customHeight.val(this.extension.embedHeight.toString()),this.$sizes.find(".size").removeClass("selected"),this.$customSize.addClass("selected"),this.getCustomSize()},t.prototype.getCustomSize=function(){this.currentWidth=this.$customWidth.val(),this.currentHeight=this.$customHeight.val(),this.update()},t.prototype.update=function(){var e=this.provider.getCurrentCanvas(),t=e.getProperty("thumbnail");t&&_.isString(t)||(t=e.getCanonicalImageUri(this.provider.config.options.bookmarkThumbWidth)),this.$link.attr("href",t),this.$image.attr("src",t),this.$url.val(this.provider.getShareUrl())},t.prototype.close=function(){e.prototype.close.call(this)},t.prototype.resize=function(){this.$element.css({top:Math.floor(this.extension.height()-this.$element.outerHeight(!0))})},t}(i);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-mediaelement-extension/EmbedDialogue",["require","exports","../../modules/uv-dialogues-module/EmbedDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("embedDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this),this.code=this.provider.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/FooterPanel",["require","exports","./BaseCommands","./BaseView"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("footerPanel"),e.prototype.create.call(this),$.subscribe(n.TOGGLE_FULLSCREEN,function(){t.updateFullScreenButton()}),$.subscribe(n.SETTINGS_CHANGED,function(){t.updateDownloadButton()}),this.$options=$('<div class="options"></div>'),this.$element.append(this.$options),this.$feedbackButton=$('<a class="feedback" title="'+this.content.feedback+'">'+this.content.feedback+"</a>"),this.$options.prepend(this.$feedbackButton),this.$openButton=$('<a class="open" title="'+this.content.open+'">'+this.content.open+"</a>"),this.$options.prepend(this.$openButton),this.$bookmarkButton=$('<a class="bookmark" title="'+this.content.bookmark+'">'+this.content.bookmark+"</a>"),this.$options.prepend(this.$bookmarkButton),this.$embedButton=$('<a href="#" class="embed" title="'+this.content.embed+'">'+this.content.embed+"</a>"),this.$options.append(this.$embedButton),this.$embedButton.attr("tabindex","6"),this.$downloadButton=$('<a class="download" title="'+this.content.download+'">'+this.content.download+"</a>"),this.$options.prepend(this.$downloadButton),this.$fullScreenBtn=$('<a href="#" class="fullScreen" title="'+this.content.fullScreen+'">'+this.content.fullScreen+"</a>"),this.$options.append(this.$fullScreenBtn),this.$fullScreenBtn.attr("tabindex","5"),this.$openButton.onPressed(function(){$.publish(n.OPEN)}),this.$feedbackButton.onPressed(function(){$.publish(n.FEEDBACK)}),this.$bookmarkButton.onPressed(function(){$.publish(n.BOOKMARK)}),this.$embedButton.onPressed(function(){$.publish(n.SHOW_EMBED_DIALOGUE)}),this.$downloadButton.on("click",function(e){e.preventDefault(),$.publish(n.SHOW_DOWNLOAD_DIALOGUE)}),this.$fullScreenBtn.on("click",function(e){e.preventDefault(),$.publish(n.TOGGLE_FULLSCREEN)}),Utils.Bools.getBool(this.options.embedEnabled,!0)||this.$embedButton.hide(),this.updateOpenButton(),this.updateFeedbackButton(),this.updateBookmarkButton(),this.updateEmbedButton(),this.updateDownloadButton(),this.updateFullScreenButton(),Utils.Bools.getBool(this.options.minimiseButtons,!1)&&this.$options.addClass("minimiseButtons")},t.prototype.updateOpenButton=function(){var e=Utils.Bools.getBool(this.options.openEnabled,!1);e&&!this.provider.isHomeDomain?this.$openButton.show():this.$openButton.hide()},t.prototype.updateFullScreenButton=function(){Utils.Bools.getBool(this.options.fullscreenEnabled,!0)||this.$fullScreenBtn.hide(),this.provider.isLightbox&&this.$fullScreenBtn.addClass("lightbox"),this.extension.isFullScreen()?(this.$fullScreenBtn.swapClass("fullScreen","exitFullscreen"),this.$fullScreenBtn.text(this.content.exitFullScreen),this.$fullScreenBtn.attr("title",this.content.exitFullScreen)):(this.$fullScreenBtn.swapClass("exitFullscreen","fullScreen"),this.$fullScreenBtn.text(this.content.fullScreen),this.$fullScreenBtn.attr("title",this.content.fullScreen))},t.prototype.updateEmbedButton=function(){this.provider.isUIEnabled("embed")?this.$embedButton.show():this.$embedButton.hide()},t.prototype.updateDownloadButton=function(){var e=Utils.Bools.getBool(this.options.downloadEnabled,!0);e?this.$downloadButton.show():this.$downloadButton.hide()},t.prototype.updateFeedbackButton=function(){var e=Utils.Bools.getBool(this.options.feedbackEnabled,!1);e?this.$feedbackButton.show():this.$feedbackButton.hide()},t.prototype.updateBookmarkButton=function(){var e=Utils.Bools.getBool(this.options.bookmarkEnabled,!1);e?this.$bookmarkButton.show():this.$bookmarkButton.hide()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i);return r}),define("modules/uv-shared-module/Information",["require","exports"],function(e,t){var n=function(){function e(e,t){this.message=e,this.actions=t}return e}();return n}),define("modules/uv-shared-module/InformationAction",["require","exports"],function(e,t){var n=function(){function e(){}return e}();return n}),define("modules/uv-shared-module/InformationFactory",["require","exports","./BaseCommands","./Information","./InformationAction","./InformationType"],function(e,t,n,i,r,o){var s=function(){function e(e){this.provider=e}return e.prototype.Get=function(e){switch(e.informationType){case o.AUTH_CORS_ERROR:return new i(this.provider.config.content.authCORSError,[]);case o.DEGRADED_RESOURCE:var t=[],s=new r;return s.label=this.provider.config.content.degradedResourceLogin,s.action=function(){$.publish(n.HIDE_INFORMATION),$.publish(n.OPEN_EXTERNAL_RESOURCE,[[e.param]])},t.push(s),new i(this.provider.config.content.degradedResourceMessage,t)}},e}();return s});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/HeaderPanel",["require","exports","./BaseCommands","./BaseView","../uv-shared-module/InformationFactory"],function(e,t,n,i,r){var o=function(e){function t(t){e.call(this,t,!1,!1)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("headerPanel"),e.prototype.create.call(this),$.subscribe(n.SHOW_INFORMATION,function(e,n){t.showInformation(n)}),$.subscribe(n.HIDE_INFORMATION,function(){t.hideInformation()}),this.$options=$('<div class="options"></div>'),this.$element.append(this.$options),this.$centerOptions=$('<div class="centerOptions"></div>'),this.$options.append(this.$centerOptions),this.$rightOptions=$('<div class="rightOptions"></div>'),this.$options.append(this.$rightOptions),this.$localeToggleButton=$('<a class="localeToggle"></a>'),this.$rightOptions.append(this.$localeToggleButton),this.$settingsButton=$('<a class="imageBtn settings" tabindex="3"></a>'),this.$settingsButton.attr("title",this.content.settings),this.$rightOptions.append(this.$settingsButton),this.$informationBox=$('<div class="informationBox">                                     <div class="message"></div>                                     <div class="actions"></div>                                     <div class="close"></div>                                   </div>'),this.$element.append(this.$informationBox),this.$informationBox.hide(),this.$informationBox.find(".close").attr("title",this.content.close),this.$informationBox.find(".close").on("click",function(e){e.preventDefault(),$.publish(n.HIDE_INFORMATION)}),this.updateLocaleToggle(),this.$localeToggleButton.on("click",function(){t.provider.changeLocale(String(t.$localeToggleButton.data("locale")))}),this.$settingsButton.onPressed(function(){$.publish(n.SHOW_SETTINGS_DIALOGUE)}),this.options.localeToggleEnabled===!1&&this.$localeToggleButton.hide()},t.prototype.updateLocaleToggle=function(){if(!this.localeToggleIsVisible())return void this.$localeToggleButton.hide();var e=this.provider.getAlternateLocale(),t=e.name.split("-")[0].toUpperCase();this.$localeToggleButton.data("locale",e.name),this.$localeToggleButton.attr("title",e.label),this.$localeToggleButton.text(t)},t.prototype.localeToggleIsVisible=function(){return this.provider.getLocales().length>1&&this.options.localeToggleEnabled},t.prototype.showInformation=function(e){var t=new r(this.provider);this.information=t.Get(e);var n=this.$informationBox.find(".message");n.html(this.information.message).find("a").attr("target","_top");var i=this.$informationBox.find(".actions");i.empty();for(var o=0;o<this.information.actions.length;o++){var s=this.information.actions[o],a=$('<a href="#" class="btn btn-default">'+s.label+"</a>");a.on("click",s.action),i.append(a)}this.$informationBox.show(),this.$element.addClass("showInformation"),this.extension.resize()},t.prototype.hideInformation=function(){this.$element.removeClass("showInformation"),this.$informationBox.hide(),this.extension.resize()},t.prototype.getSettings=function(){return this.provider.getSettings()},t.prototype.updateSettings=function(e){this.provider.updateSettings(e),$.publish(n.UPDATE_SETTINGS,[e])},t.prototype.resize=function(){e.prototype.resize.call(this);var t=this.$element.width(),n=t/2,i=this.$centerOptions.outerWidth(),r=n-i/2;if(this.$centerOptions.css({left:r}),this.$informationBox.is(":visible")){var o=this.$informationBox.find(".actions"),s=this.$informationBox.find(".message");s.width(this.$element.width()-s.horizontalMargins()-o.outerWidth(!0)-this.$informationBox.find(".close").outerWidth(!0)-1),s.ellipsisFill(this.information.message)}this.extension.width()<this.provider.config.options.minWidthBreakPoint?this.localeToggleIsVisible()&&this.$localeToggleButton.hide():this.localeToggleIsVisible()&&this.$localeToggleButton.show()},t}(i);return o});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-dialogues-module/HelpDialogue",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/Dialogue"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("helpDialogue"),e.prototype.create.call(this),this.openCommand=n.SHOW_HELP_DIALOGUE,this.closeCommand=n.HIDE_HELP_DIALOGUE,$.subscribe(this.openCommand,function(e,n){t.open()}),$.subscribe(this.closeCommand,function(e){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$scroll=$('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$message=$("<p></p>"),this.$scroll.append(this.$message),this.$title.text(this.content.title),this.$message.html(this.content.text),this.$message.targetBlank(),this.$element.hide()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/CenterPanel",["require","exports","./Shell","./BaseView"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t,!1,!0)}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.$title=$('<div class="title"></div>'),this.$element.append(this.$title),this.$content=$('<div id="content" class="content"></div>'),this.$element.append(this.$content),this.$acknowledgements=$('<div class="acknowledgements">                                   <div class="header">                                       <div class="title"></div>                                       <div class="close"></div>                                   </div>                                   <div class="main">                                       <div class="attribution"></div>                                       <div class="license"></div>                                       <div class="logo"></div>                                   </div>                              </div>'),this.$acknowledgements.find(".header .title").text(this.content.acknowledgements),this.$content.append(this.$acknowledgements),this.$acknowledgements.hide(),this.$closeAttributionButton=this.$acknowledgements.find(".header .close"),this.$closeAttributionButton.on("click",function(e){e.preventDefault(),t.$acknowledgements.hide()}),this.options.titleEnabled===!1&&this.$title.hide()},t.prototype.showAttribution=function(){var e=this,t=this.provider.getAttribution();if(t){this.$acknowledgements.show();var n=this.$acknowledgements.find(".attribution"),i=this.$acknowledgements.find(".license"),r=this.$acknowledgements.find(".logo");n.html(this.provider.sanitize(t)),n.find("img").one("load",function(){e.resize()}).each(function(){this.complete&&$(this).load()}),n.targetBlank(),n.toggleExpandText(this.options.trimAttributionCount,function(){e.resize()}),i.hide(),r.hide()}},t.prototype.resize=function(){e.prototype.resize.call(this),this.$element.css({left:Math.floor(n.$leftPanel.width()),width:Math.floor(this.$element.parent().width()-n.$leftPanel.width()-n.$rightPanel.width())});var t;t=this.options&&this.options.titleEnabled===!1?0:this.$title.height(),this.$content.height(this.$element.height()-t),this.$content.width(this.$element.width()),this.$acknowledgements&&this.$acknowledgements.is(":visible")&&this.$acknowledgements.css("top",this.$content.height()-this.$acknowledgements.outerHeight()-this.$acknowledgements.verticalMargins())},t}(i);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-mediaelementcenterpanel-module/MediaElementCenterPanel",["require","exports","../uv-shared-module/BaseCommands","../../extensions/uv-mediaelement-extension/Commands","../uv-shared-module/CenterPanel"],function(e,t,n,i,r){var o=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("mediaelementCenterPanel"),e.prototype.create.call(this);var t=this;this.provider.isVideo()&&$.subscribe(n.TOGGLE_FULLSCREEN,function(e){t.bootstrapper.isFullScreen?(t.$container.css("backgroundColor","#000"),t.player.enterFullScreen(!1)):(t.$container.css("backgroundColor","transparent"),t.player.exitFullScreen(!1))}),$.subscribe(n.OPEN_EXTERNAL_RESOURCE,function(e,n){t.openMedia(n)}),this.$container=$('<div class="container"></div>'),this.$content.append(this.$container),this.title=this.extension.provider.getLabel()},t.prototype.openMedia=function(e){var t=this,n=this;this.extension.getExternalResources(e).then(function(){t.$container.empty();var e=t.provider.getCurrentCanvas();t.mediaHeight=t.config.defaultHeight,t.mediaWidth=t.config.defaultWidth,t.$container.height(t.mediaHeight),t.$container.width(t.mediaWidth);var r=Utils.Dates.getTimeStamp(),o=t.provider.getPosterImageUri(),s=o?' poster="'+o+'"':"",a=[];if(_.each(e.getRenderings(),function(e){a.push({type:e.getFormat().toString(),src:e.id})}),t.provider.isVideo())t.media=t.$container.append('<video id="'+r+'" type="video/mp4" class="mejs-uv" controls="controls" preload="none"'+s+"></video>"),t.player=new MediaElementPlayer("#"+r,{type:["video/mp4","video/webm","video/flv"],plugins:["flash"],alwaysShowControls:!1,autosizeProgress:!1,success:function(e){e.addEventListener("canplay",function(e){n.resize()}),e.addEventListener("play",function(e){$.publish(i.MEDIA_PLAYED,[Math.floor(n.player.media.currentTime)])}),e.addEventListener("pause",function(e){Math.floor(n.player.media.currentTime)!=Math.floor(n.player.media.duration)&&$.publish(i.MEDIA_PAUSED,[Math.floor(n.player.media.currentTime)])}),e.addEventListener("ended",function(e){$.publish(i.MEDIA_ENDED,[Math.floor(n.player.media.duration)])}),e.setSrc(a);try{e.load()}catch(t){}}});else{var u=0;for(var c in a)if("audio/mp3"===a[c].type){u=c;break}t.media=t.$container.append('<audio id="'+r+'" type="'+a[u].type+'" src="'+a[u].src+'" class="mejs-uv" controls="controls" preload="none"'+s+"></audio>"),t.player=new MediaElementPlayer("#"+r,{plugins:["flash"],alwaysShowControls:!1,autosizeProgress:!1,defaultVideoWidth:n.mediaWidth,defaultVideoHeight:n.mediaHeight,success:function(e){e.addEventListener("canplay",function(e){n.resize()}),e.addEventListener("play",function(e){$.publish(i.MEDIA_PLAYED,[Math.floor(n.player.media.currentTime)])}),e.addEventListener("pause",function(e){Math.floor(n.player.media.currentTime)!=Math.floor(n.player.media.duration)&&$.publish(i.MEDIA_PAUSED,[Math.floor(n.player.media.currentTime)])}),e.addEventListener("ended",function(e){$.publish(i.MEDIA_ENDED,[Math.floor(n.player.media.duration)])});try{e.load()}catch(t){}}})}t.resize()})},t.prototype.resize=function(){if(e.prototype.resize.call(this),"Firefox"===window.browserDetect.browser&&window.browserDetect.version<13)this.$container.width(this.mediaWidth),this.$container.height(this.mediaHeight);else{var t=Utils.Measurements.Dimensions.fitRect(this.mediaWidth,this.mediaHeight,this.$content.width(),this.$content.height());this.$container.height(t.height),this.$container.width(t.width)}this.player&&!this.extension.isFullScreen()&&this.player.resize();var n=Math.floor((this.$content.width()-this.$container.width())/2),i=Math.floor((this.$content.height()-this.$container.height())/2);this.$container.css({left:n,top:i}),this.$title.ellipsisFill(this.title)},t}(r);return o});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/BaseExpandPanel",["require","exports","./BaseView"],function(e,t,n){var i=function(e){function t(t){e.call(this,t,!1,!0),this.isExpanded=!1,this.isFullyExpanded=!1,this.isUnopened=!0,this.autoToggled=!1}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.$top=$('<div class="top"></div>'),this.$element.append(this.$top),this.$title=$('<div class="title"></div>'),this.$title.prop("title",this.content.title),this.$top.append(this.$title),this.$expandFullButton=$('<a class="expandFullButton"></a>'),this.$expandFullButton.prop("title",this.content.expandFull),this.$top.append(this.$expandFullButton),Utils.Bools.getBool(this.config.options.expandFullEnabled,!0)||this.$expandFullButton.hide(),this.$collapseButton=$('<div class="collapseButton"></div>'),this.$collapseButton.prop("title",this.content.collapse),this.$top.append(this.$collapseButton),this.$closed=$('<div class="closed"></div>'),this.$element.append(this.$closed),this.$expandButton=$('<a class="expandButton"></a>'),this.$expandButton.prop("title",this.content.expand),this.$closed.append(this.$expandButton),this.$closedTitle=$('<a class="title"></a>'),this.$closedTitle.prop("title",this.content.title),this.$closed.append(this.$closedTitle),this.$main=$('<div class="main"></div>'),this.$element.append(this.$main),this.$expandButton.onPressed(function(){t.toggle()}),this.$expandFullButton.onPressed(function(){t.expandFull()}),this.$closedTitle.onPressed(function(){t.toggle()}),this.$title.onPressed(function(){t.isFullyExpanded?t.collapseFull():t.toggle()}),this.$collapseButton.onPressed(function(){t.isFullyExpanded?t.collapseFull():t.toggle()}),this.$top.hide(),this.$main.hide()},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.setTitle=function(e){this.$title.text(e),this.$closedTitle.text(e)},t.prototype.toggle=function(e){var t=this;e?this.autoToggled=!0:this.autoToggled=!1,this.isExpanded&&(this.$top.hide(),this.$main.hide(),this.$closed.show()),this.$element.stop().animate({width:this.getTargetWidth(),left:this.getTargetLeft()},this.options.panelAnimationDuration,function(){t.toggled()})},t.prototype.toggled=function(){this.toggleStart(),this.isExpanded=!this.isExpanded,this.isExpanded&&(this.$closed.hide(),this.$top.show(),this.$main.show()),this.toggleFinish(),this.isUnopened=!1},t.prototype.expandFull=function(){var e=this,t=this.getFullTargetWidth(),n=this.getFullTargetLeft();this.expandFullStart(),this.$element.stop().animate({width:t,left:n},this.options.panelAnimationDuration,function(){e.expandFullFinish()})},t.prototype.collapseFull=function(){var e=this,t=this.getTargetWidth(),n=this.getTargetLeft();this.collapseFullStart(),this.$element.stop().animate({width:t,left:n},this.options.panelAnimationDuration,function(){e.collapseFullFinish()})},t.prototype.getTargetWidth=function(){return 0},t.prototype.getTargetLeft=function(){return 0},t.prototype.getFullTargetWidth=function(){return 0},t.prototype.getFullTargetLeft=function(){return 0},t.prototype.toggleStart=function(){},t.prototype.toggleFinish=function(){this.isExpanded&&!this.autoToggled?this.focusCollapseButton():this.focusExpandButton()},t.prototype.expandFullStart=function(){},t.prototype.expandFullFinish=function(){this.isFullyExpanded=!0,this.$expandFullButton.hide(),this.focusCollapseButton()},t.prototype.collapseFullStart=function(){},t.prototype.collapseFullFinish=function(){this.isFullyExpanded=!1,this.$expandFullButton.show(),this.focusExpandFullButton()},t.prototype.focusExpandButton=function(){var e=this;setTimeout(function(){e.$expandButton.focus()},1)},t.prototype.focusExpandFullButton=function(){var e=this;setTimeout(function(){e.$expandFullButton.focus()},1)},t.prototype.focusCollapseButton=function(){
var e=this;setTimeout(function(){e.$collapseButton.focus()},1)},t.prototype.resize=function(){e.prototype.resize.call(this),this.$main.height(this.$element.parent().height()-this.$top.outerHeight(!0))},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/RightPanel",["require","exports","./BaseCommands","./BaseExpandPanel"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){e.prototype.create.call(this),this.$element.width(this.options.panelCollapsedWidth)},t.prototype.init=function(){e.prototype.init.call(this),this.options.panelOpen&&this.toggle(!0)},t.prototype.getTargetWidth=function(){return this.isExpanded?this.options.panelCollapsedWidth:this.options.panelExpandedWidth},t.prototype.getTargetLeft=function(){return this.isExpanded?this.$element.parent().width()-this.options.panelCollapsedWidth:this.$element.parent().width()-this.options.panelExpandedWidth},t.prototype.toggleFinish=function(){e.prototype.toggleFinish.call(this),this.isExpanded?$.publish(n.OPEN_RIGHT_PANEL):$.publish(n.CLOSE_RIGHT_PANEL)},t.prototype.resize=function(){e.prototype.resize.call(this),this.$element.css({left:Math.floor(this.$element.parent().width()-this.$element.outerWidth())})},t}(i);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-moreinforightpanel-module/MoreInfoRightPanel",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/RightPanel"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t),this.limitType="lines",this.limit=4}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("moreInfoRightPanel"),e.prototype.create.call(this),this.config.options.textLimitType&&(this.limitType=this.config.options.textLimitType),"lines"===this.limitType?this.limit=this.config.options.textLimit?this.config.options.textLimit:4:"chars"===this.limitType&&(this.limit=this.config.options.textLimit?this.config.options.textLimit:130),this.aggregateValuesConfig=this.readConfig(this.options.aggregateValues),this.canvasExcludeConfig=this.readConfig(this.options.canvasExclude),this.manifestData=this.getManifestData(),this.canvasData=[],this.moreInfoItemTemplate=$('<div class="item">                                           <div class="header"></div>                                           <div class="text"></div>                                       </div>'),this.copyTextTemplate=$('<div class="copyText" alt="'+this.content.copyToClipboard+'" title="'+this.content.copyToClipboard+'">                                     <div class="copiedText">'+this.content.copiedToClipboard+" </div>                                   </div>"),this.$items=$('<div class="items"></div>'),this.$main.append(this.$items),this.$canvasItems=$('<div class="items"></div>'),this.$main.append(this.$canvasItems),this.$noData=$('<div class="noData">'+this.content.noData+"</div>"),this.$main.append(this.$noData),this.$expandButton.attr("tabindex","4"),this.$collapseButton.attr("tabindex","4"),this.setTitle(this.content.title),$.subscribe(n.CANVAS_INDEX_CHANGED,function(e,n){t.canvasData=t.getCanvasData(t.provider.getCanvasByIndex(n)),t.displayInfo()})},t.prototype.getManifestData=function(){var e=this.provider.getMetadata();return this.options.displayOrder&&(e=this.sort(e,this.readConfig(this.options.displayOrder))),this.options.manifestExclude&&(e=this.exclude(e,this.readConfig(this.options.manifestExclude))),this.flatten(e)},t.prototype.getCanvasData=function(e){var t=this.provider.getCanvasMetadata(e);return 0!==this.canvasExcludeConfig.length&&(t=this.exclude(t,this.canvasExcludeConfig)),this.flatten(t)},t.prototype.readConfig=function(e){return e?e.toLowerCase().replace(/ /g,"").split(","):[]},t.prototype.toggleFinish=function(){e.prototype.toggleFinish.call(this),this.isUnopened&&this.getInfo()},t.prototype.getInfo=function(){this.$main.addClass("loading"),this.displayInfo()},t.prototype.displayInfo=function(){if(this.$main.removeClass("loading"),0==this.manifestData.length&&0==this.canvasData.length)return void this.$noData.show();this.$noData.hide();var e=$.extend(!0,[],this.manifestData),t=$.extend(!0,[],this.canvasData);this.aggregateValues(e,t),this.renderElement(this.$items,e,this.content.manifestHeader,0!==t.length),this.renderElement(this.$canvasItems,t,this.content.canvasHeader,0!==e.length)},t.prototype.sort=function(e,t){var n=[];return _.each(t,function(t){var i=e.en().where(function(e){return e.label.toLowerCase()===t}).first();i&&(n.push(i),e.remove(i))}),_.each(e,function(e){n.push(e)}),n},t.prototype.exclude=function(e,t){var n=$.extend(!0,[],e);return _.each(t,function(e){var t=n.en().where(function(t){return t.label.toLowerCase()===e}).first();t&&n.remove(t)}),n},t.prototype.flatten=function(e){var t=[];return _.each(e,function(e){_.isArray(e.value)?t=t.concat(e.value):t.push(e)}),t},t.prototype.aggregateValues=function(e,t){var n=this;0!==this.aggregateValuesConfig.length&&_.each(t,function(t){_.each(n.aggregateValuesConfig,function(n){if(t.label.toLowerCase()==n){var i=_.findIndex(e,function(e){return e.label.toLowerCase()==n.toLowerCase()});if(-1!=i){var r=e.splice(i,1)[0];t.value=r.value+t.value}}})})},t.prototype.renderElement=function(e,t,n,i){var r=this;e.empty(),0!==t.length&&(i&&n&&e.append(this.buildHeader(n)),_.each(t,function(t){var n=r.buildItem(t);e.append(n),"lines"===r.limitType?n.find(".text").toggleExpandTextByLines(r.limit,r.content.less,r.content.more):"chars"===r.limitType&&n.find(".text").ellipsisHtmlFixed(r.limit,null)}))},t.prototype.buildHeader=function(e){var t=$('<div class="header"></div>');return t.html(this.provider.sanitize(e)),t},t.prototype.buildItem=function(e){var t=this.moreInfoItemTemplate.clone(),n=t.find(".header"),i=t.find(".text");if(e.label=this.provider.sanitize(e.label),e.value=this.provider.sanitize(e.value),e.isRootLevel)switch(e.label.toLowerCase()){case"attribution":e.label=this.content.attribution;break;case"description":e.label=this.content.description;break;case"license":e.label=this.content.license;break;case"logo":e.label=this.content.logo}return e.value=e.value.replace("\n","<br>"),n.html(e.label),i.html(e.value),i.targetBlank(),e.label=e.label.trim(),e.label=e.label.toLowerCase(),t.addClass(e.label.toCssClass()),this.config.options.copyToClipboardEnabled&&Utils.Clipboard.supportsCopy()&&i.text()&&n.text()&&this.addCopyButton(t,n),t},t.prototype.addCopyButton=function(e,t){var n=this,i=this.copyTextTemplate.clone(),r=i.children();t.append(i),Utils.Device.isTouch()?i.show():(e.on("mouseenter",function(){i.show()}),e.on("mouseleave",function(){i.hide()}),i.on("mouseleave",function(){r.hide()})),i.on("click",function(e){var t=e.target,i=t.previousSibling.textContent||t.previousSibling.nodeValue;n.copyValueForLabel(i)})},t.prototype.copyValueForLabel=function(e){var t=this.flatten(this.manifestData),n=this.flatten(this.canvasData),i=$(t.concat(n)).filter(function(t,n){return n.label&&e&&n.label.toLowerCase()==e.toLowerCase()}),r=i.map(function(e,t){return t.value}).get().join("");if(r){Utils.Clipboard.copy(r);var o=$(".items .item .header:contains("+e+") .copiedText");o.show(),setTimeout(function(){o.hide()},2e3)}},t.prototype.resize=function(){e.prototype.resize.call(this),this.$main.height(this.$element.height()-this.$top.height()-this.$main.verticalMargins())},t}(i);return r}),define("_Version",["require","exports"],function(e,t){t.Version="1.7.34"});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-dialogues-module/SettingsDialogue",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/BaseCommands","../uv-shared-module/Dialogue","../../_Version"],function(e,t,n,i,r,o){var s=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("settingsDialogue"),e.prototype.create.call(this),this.openCommand=n.SHOW_SETTINGS_DIALOGUE,this.closeCommand=n.HIDE_SETTINGS_DIALOGUE,$.subscribe(this.openCommand,function(e,n){t.open()}),$.subscribe(this.closeCommand,function(e){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$scroll=$('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$version=$('<div class="version"></div>'),this.$content.append(this.$version),this.$website=$('<div class="website"></div>'),this.$content.append(this.$website),this.$locale=$('<div class="setting locale"></div>'),this.$scroll.append(this.$locale),this.$localeLabel=$('<label for="locale">'+this.content.locale+"</label>"),this.$locale.append(this.$localeLabel),this.$localeDropDown=$('<select id="locale"></select>'),this.$locale.append(this.$localeDropDown),this.$title.text(this.content.title),this.$version.text("v"+o.Version),this.$website.html(this.content.website),this.$website.targetBlank();for(var i=this.provider.getLocales(),r=0;r<i.length;r++){var s=i[r];this.$localeDropDown.append('<option value="'+s.name+'">'+s.label+"</option>")}this.$localeDropDown.val(this.provider.locale),this.$localeDropDown.change(function(){t.provider.changeLocale(t.$localeDropDown.val())}),this.provider.getLocales().length<2&&this.$locale.hide(),this.$element.hide()},t.prototype.getSettings=function(){return this.provider.getSettings()},t.prototype.updateSettings=function(e){this.provider.updateSettings(e),$.publish(i.UPDATE_SETTINGS,[e])},t.prototype.open=function(){e.prototype.open.call(this)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(r);return s});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-mediaelement-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("settingsDialogue"),e.prototype.create.call(this)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/LeftPanel",["require","exports","./BaseCommands","./BaseExpandPanel"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){e.prototype.create.call(this),this.$element.width(this.options.panelCollapsedWidth)},t.prototype.init=function(){e.prototype.init.call(this),this.options.panelOpen&&this.toggle(!0)},t.prototype.getTargetWidth=function(){return this.isFullyExpanded||!this.isExpanded?this.options.panelExpandedWidth:this.options.panelCollapsedWidth},t.prototype.getFullTargetWidth=function(){return this.$element.parent().width()},t.prototype.toggleFinish=function(){e.prototype.toggleFinish.call(this),this.isExpanded?$.publish(n.OPEN_LEFT_PANEL):$.publish(n.CLOSE_LEFT_PANEL)},t.prototype.resize=function(){e.prototype.resize.call(this),this.isFullyExpanded&&this.$element.width(this.$element.parent().width())},t}(i);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-shared-module/ThumbsView",["require","exports","./BaseCommands","./BaseView"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t,!0,!0),this.isCreated=!1,this.isOpen=!1}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),$.subscribe(n.CANVAS_INDEX_CHANGED,function(e,n){t.selectIndex(parseInt(n))}),$.subscribe(n.LOGIN,function(){t.loadThumbs()}),$.subscribe(n.CLICKTHROUGH,function(){t.loadThumbs()}),this.$thumbs=$('<div class="thumbs"></div>'),this.$element.append(this.$thumbs),this.$thumbs.addClass(this.provider.getViewingDirection().toString());var i=this;$.templates({thumbsTemplate:'<div class="{{:~className()}}" data-src="{{>uri}}" data-visible="{{>visible}}">                                <div class="wrap" style="height:{{>height + ~extraHeight()}}px"></div>                                <span class="index">{{:#index + 1}}</span>                                <span class="label" title="{{>label}}">{{>label}}&nbsp;</span>                             </div>                             {{if ~separator()}}                                  <div class="separator"></div>                              {{/if}}'});var r=this.options.thumbsExtraHeight;$.views.helpers({separator:function(){return!1},extraHeight:function(){return r},className:function(){var e="thumb";0===this.data.index&&(e+=" first"),this.data.uri||(e+=" placeholder");var t=i.provider.getViewingDirection().toString();return e+=t===manifesto.ViewingDirection.topToBottom().toString()||t===manifesto.ViewingDirection.bottomToTop().toString()?" oneCol":" twoCol"}}),this.$element.on("scroll",function(){t.scrollStop()},100),this.resize()},t.prototype.dataBind=function(){this.thumbs&&this.createThumbs()},t.prototype.createThumbs=function(){var e=this;if(!this.isCreated&&this.thumbs){for(var t=[],i=0;i<this.thumbs.length;i++){var r=this.thumbs[i];t.push(r.height)}for(var o=Math.median(t),s=0;s<this.thumbs.length;s++){var r=this.thumbs[s];r.height=o}this.$thumbs.link($.templates.thumbsTemplate,this.thumbs),this.$thumbs.delegate(".thumb","click",function(t){t.preventDefault();var i=$.view(this).data;e.lastThumbClickedIndex=i.index,$.publish(n.THUMB_SELECTED,[i.index])}),this.selectIndex(this.provider.canvasIndex),this.setLabel(),this.loadThumbs(0),this.isCreated=!0}},t.prototype.selectAll=function(e){},t.prototype.scrollStop=function(){var e=1/((this.$thumbs.height()-this.$element.height())/this.$element.scrollTop());e>1&&(e=1);var t=Math.floor((this.thumbs.length-1)*e);this.loadThumbs(t)},t.prototype.loadThumbs=function(e){if(this.thumbs&&this.thumbs.length){_.isUndefined(e)&&(e=this.provider.canvasIndex);for(var t=e,n=this.options.thumbsLoadRange,i={start:t>n?t-n:0,end:t<this.thumbs.length-1-n?t+n:this.thumbs.length-1},r=this.options.thumbsImageFadeInDuration,o=i.start;o<=i.end;o++){var s=this.getThumbByIndex(o),a=s.find(".wrap");if(!a.hasClass("loading")&&!a.hasClass("loaded")){var u=s.attr("data-visible");if("false"!==u){a.removeClass("loadingFailed"),a.addClass("loading");var c=s.attr("data-src");c+="?t="+Utils.Dates.getTimeStamp();var l=$('<img src="'+c+'" />');$(l).hide().load(function(){$(this).fadeIn(r,function(){$(this).parent().swapClass("loading","loaded")})}).error(function(){$(this).parent().swapClass("loading","loadingFailed")}),a.append(l)}else a.addClass("hidden")}}}},t.prototype.show=function(){var e=this;this.isOpen=!0,this.$element.show(),setTimeout(function(){e.selectIndex(e.provider.canvasIndex)},1)},t.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},t.prototype.isPDF=function(){return this.provider.getElementType().toString().contains("pdf")},t.prototype.setLabel=function(){$(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").show()},t.prototype.addSelectedClassToThumbs=function(e){this.getThumbByIndex(e).addClass("selected")},t.prototype.selectIndex=function(e){-1!=e&&this.thumbs&&this.thumbs.length&&(this.getAllThumbs().removeClass("selected"),this.$selectedThumb=this.getThumbByIndex(e),this.addSelectedClassToThumbs(e),this.lastThumbClickedIndex!=e&&this.$element.scrollTop(this.$selectedThumb.position().top),this.loadThumbs(e))},t.prototype.getAllThumbs=function(){return this.$thumbs.find(".thumb")},t.prototype.getThumbByIndex=function(e){return $(this.getAllThumbs()[e])},t.prototype.scrollToThumb=function(e){var t=this.getThumbByIndex(e);this.$element.scrollTop(t.position().top)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-resourcesleftpanel-module/ThumbsView",["require","exports","../uv-shared-module/ThumbsView"],function(e,t,n){var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.create=function(){this.setConfig("resourcesLeftPanel"),e.prototype.create.call(this)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-resourcesleftpanel-module/ResourcesLeftPanel",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/LeftPanel","./ThumbsView"],function(e,t,n,i,r){var o=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("resourcesLeftPanel"),e.prototype.create.call(this),this.$expandButton.attr("tabindex","7"),this.$collapseButton.attr("tabindex","7"),this.$expandFullButton.attr("tabindex","8"),this.setTitle(this.content.title),this.$tabsContent=$('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$views=$('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$thumbsView=$('<div class="thumbsView"></div>'),this.$views.append(this.$thumbsView),this.$resourcesView=$('<div class="resourcesView"></div>'),this.$resources=$("<ul></ul>"),this.$resourcesView.append(this.$resources),this.$views.append(this.$resourcesView),this.thumbsView=new r(this.$thumbsView),this.dataBind()},t.prototype.dataBind=function(){this.dataBindThumbsView();var e=this.provider.getResources();0===e.length&&this.$resourcesView.hide();for(var t=0;t<e.length;t++){var n=e[t],i=n.getResource(),r=$('<li><a href="'+i.id+'" target="_blank">'+i.getLabel()+" ("+Utils.Files.simplifyMimeType(i.getFormat().toString())+")</li>");this.$resources.append(r)}},t.prototype.dataBindThumbsView=function(){if(this.thumbsView){var e,t,n=this.provider.getViewingDirection().toString();n===manifesto.ViewingDirection.topToBottom().toString()||n===manifesto.ViewingDirection.bottomToTop().toString()?(e=this.config.options.oneColThumbWidth,t=this.config.options.oneColThumbHeight):(e=this.config.options.twoColThumbWidth,t=this.config.options.twoColThumbHeight),"undefined"==typeof e&&(e=100),"undefined"==typeof t&&(t=100),this.thumbsView.thumbs=this.provider.getThumbs(e,t),this.thumbsView.thumbs.length<2&&this.$thumbsView.hide(),this.thumbsView.dataBind()}},t.prototype.expandFullStart=function(){e.prototype.expandFullStart.call(this),$.publish(n.LEFTPANEL_EXPAND_FULL_START)},t.prototype.expandFullFinish=function(){e.prototype.expandFullFinish.call(this),$.publish(n.LEFTPANEL_EXPAND_FULL_FINISH)},t.prototype.collapseFullStart=function(){e.prototype.collapseFullStart.call(this),$.publish(n.LEFTPANEL_COLLAPSE_FULL_START)},t.prototype.collapseFullFinish=function(){e.prototype.collapseFullFinish.call(this),$.publish(n.LEFTPANEL_COLLAPSE_FULL_FINISH)},t.prototype.resize=function(){e.prototype.resize.call(this),this.$views.height(this.$main.height()),this.$resources.height(this.$main.height())},t}(i);return o});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-mediaelement-extension/Extension",["require","exports","../../modules/uv-shared-module/BaseCommands","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","./Commands","./DownloadDialogue","./EmbedDialogue","../../modules/uv-shared-module/FooterPanel","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-dialogues-module/HelpDialogue","../../modules/uv-mediaelementcenterpanel-module/MediaElementCenterPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","./SettingsDialogue","../../modules/uv-shared-module/Shell","../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel"],function(e,t,n,i,r,o,s,a,u,c,l,h,p,d,f,g){var m=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(t){var i=this;e.prototype.create.call(this,t),$(window).bind("enterfullscreen",function(){$.publish(n.TOGGLE_FULLSCREEN)}),$(window).bind("exitfullscreen",function(){$.publish(n.TOGGLE_FULLSCREEN)}),$.subscribe(n.THUMB_SELECTED,function(e,t){i.viewCanvas(t)}),$.subscribe(n.LEFTPANEL_EXPAND_FULL_START,function(e){f.$centerPanel.hide(),f.$rightPanel.hide()}),$.subscribe(n.LEFTPANEL_COLLAPSE_FULL_FINISH,function(e){f.$centerPanel.show(),f.$rightPanel.show(),i.resize()}),$.subscribe(o.MEDIA_ENDED,function(e){i.triggerSocket(o.MEDIA_ENDED)}),$.subscribe(o.MEDIA_PAUSED,function(e){i.triggerSocket(o.MEDIA_PAUSED)}),$.subscribe(o.MEDIA_PLAYED,function(e){i.triggerSocket(o.MEDIA_PLAYED)})},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.headerPanel=new c(f.$headerPanel),this.isLeftPanelEnabled()&&(this.leftPanel=new g(f.$leftPanel)),this.centerPanel=new h(f.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new p(f.$rightPanel)),this.footerPanel=new u(f.$footerPanel),this.$helpDialogue=$('<div class="overlay help"></div>'),f.$overlays.append(this.$helpDialogue),this.helpDialogue=new l(this.$helpDialogue),this.$downloadDialogue=$('<div class="overlay download"></div>'),f.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new s(this.$downloadDialogue),this.$embedDialogue=$('<div class="overlay embed"></div>'),f.$overlays.append(this.$embedDialogue),this.embedDialogue=new a(this.$embedDialogue),this.$settingsDialogue=$('<div class="overlay settings"></div>'),f.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new d(this.$settingsDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()},t.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.provider.config.options.leftPanelEnabled,!0)&&(this.provider.isMultiCanvas()||this.provider.isMultiSequence()||this.provider.hasResources())},t.prototype.bookmark=function(){e.prototype.bookmark.call(this);var t=this.provider.getCurrentCanvas(),i=new r;i.index=this.provider.canvasIndex,i.label=t.getLabel(),i.path=this.getBookmarkUri(),i.thumb=t.getProperty("thumbnail"),i.title=this.provider.getLabel(),i.trackingLabel=window.trackingLabel,this.provider.isVideo()?i.type=manifesto.ElementType.movingimage().toString():i.type=manifesto.ElementType.sound().toString(),this.triggerSocket(n.BOOKMARK,i)},t}(i);return m}),define("modules/uv-shared-module/UriLabeller",["require","exports"],function(e,t){var n=function(){function e(e){this.labels=e}return e.prototype.format=function(e){if(-1!=e.indexOf("<a"))return e;var t=this.labels[e]?this.labels[e]:e;return'<a href="'+e+'">'+t+"</a>"},e}();return n}),define("modules/uv-shared-module/BaseProvider",["require","exports","../../BootstrapParams","../../Params","./UriLabeller"],function(e,t,n,i,r){var o=function(){function e(e){this.options={thumbsUriTemplate:"{0}{1}",timestampUris:!1,mediaUriTemplate:"{0}{1}"},this.bootstrapper=e,this.config=this.bootstrapper.config,this.iiifResource=this.bootstrapper.iiifResource,this.manifest=this.bootstrapper.manifest,this.manifestUri=this.bootstrapper.params.manifestUri,this.jsonp=this.bootstrapper.params.jsonp,this.locale=this.bootstrapper.params.getLocaleName(),this.isHomeDomain=this.bootstrapper.params.isHomeDomain,this.isReload=this.bootstrapper.params.isReload,this.embedDomain=this.bootstrapper.params.embedDomain,this.isOnlyInstance=this.bootstrapper.params.isOnlyInstance,this.embedScriptUri=this.bootstrapper.params.embedScriptUri,this.domain=this.bootstrapper.params.domain,this.isLightbox=this.bootstrapper.params.isLightbox,this.collectionIndex=this.bootstrapper.params.collectionIndex,this.manifestIndex=this.bootstrapper.params.manifestIndex,this.sequenceIndex=this.bootstrapper.params.sequenceIndex,this.canvasIndex=this.bootstrapper.params.canvasIndex,this.licenseFormatter=new r(this.config.license?this.config.license:{})}return e.prototype.reload=function(e){var t=new n;e&&(t=$.extend(t,e)),t.isReload=!0,$.disposePubSub(),this.bootstrapper.bootStrap(t)},e.prototype.getCollectionIndex=function(e){var t;return e.parentCollection&&(t=e.parentCollection.index),t},e.prototype.getManifestType=function(){var e=this.manifest.getManifestType();return""===e.toString()&&(e=manifesto.ManifestType.monograph()),e},e.prototype.getCanvasIndexParam=function(){return this.bootstrapper.params.getParam(i.canvasIndex)},e.prototype.getSequenceIndexParam=function(){return this.bootstrapper.params.getParam(i.sequenceIndex)},e.prototype.getElementType=function(e){return e||(e=this.getCurrentCanvas()),e.getType()},e.prototype.getAttribution=function(){return this.manifest.getAttribution()},e.prototype.getLicense=function(){return this.manifest.getLicense()},e.prototype.getLogo=function(){return this.manifest.getLogo()},e.prototype.getLabel=function(){return this.manifest.getLabel()},e.prototype.getSeeAlso=function(){return this.manifest.getSeeAlso()},e.prototype.isMultiSequence=function(){return this.manifest.isMultiSequence()},e.prototype.getLastCanvasLabel=function(e){return this.getCurrentSequence().getLastCanvasLabel(e)},e.prototype.isCanvasIndexOutOfRange=function(e){return this.getCurrentSequence().isCanvasIndexOutOfRange(e)},e.prototype.isTotalCanvasesEven=function(){return this.getCurrentSequence().isTotalCanvasesEven()},e.prototype.isFirstCanvas=function(e){return this.getCurrentSequence().isFirstCanvas(e)},e.prototype.isLastCanvas=function(e){return this.getCurrentSequence().isLastCanvas(e)},e.prototype.isSeeAlsoEnabled=function(){return this.config.options.seeAlsoEnabled!==!1},e.prototype.getCanvases=function(){return this.getCurrentSequence().getCanvases()},e.prototype.getCanvasById=function(e){return this.getCurrentSequence().getCanvasById(e)},e.prototype.getCanvasesById=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push(this.getCanvasById(i))}return t},e.prototype.getCanvasByIndex=function(e){return this.getCurrentSequence().getCanvasByIndex(e)},e.prototype.getSequenceByIndex=function(e){return this.manifest.getSequenceByIndex(e)},e.prototype.getCanvasRange=function(e){return this.getCanvasRanges(e).last()},e.prototype.getCanvasRanges=function(e){return e.ranges?e.ranges:(e.ranges=this.manifest.getRanges().en().where(function(t){return t.getCanvasIds().en().any(function(t){return t===e.id})}).toArray(),e.ranges)},e.prototype.getCurrentCanvas=function(){return this.getCurrentSequence().getCanvasByIndex(this.canvasIndex)},e.prototype.getCurrentSequence=function(){return this.getSequenceByIndex(this.sequenceIndex)},e.prototype.getRangeCanvases=function(e){var t=e.getCanvasIds();return this.getCanvasesById(t)},e.prototype.getTotalCanvases=function(){return this.getCurrentSequence().getTotalCanvases()},e.prototype.isMultiCanvas=function(){return this.getCurrentSequence().isMultiCanvas()},e.prototype.isUIEnabled=function(e){var t=this.manifest.getService(manifesto.ServiceProfile.uiExtensions());if(t){var n=t.getProperty("disableUI");if(n&&(n.contains(e)||n.contains(e.toLowerCase())))return!1}return!0},e.prototype.getInfoUri=function(e){var t=e.getService(manifesto.ServiceProfile.ixif());return t?t.getInfoUri():e.id},e.prototype.getPagedIndices=function(e){return"undefined"==typeof e&&(e=this.canvasIndex),[e]},e.prototype.getViewingDirection=function(){var e=this.getCurrentSequence().getViewingDirection();return e.toString()||(e=this.manifest.getViewingDirection()),e},e.prototype.getViewingHint=function(){var e=this.getCurrentSequence().getViewingHint();return e.toString()||(e=this.manifest.getViewingHint()),e},e.prototype.getFirstPageIndex=function(){return 0},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getStartCanvasIndex=function(){return this.getCurrentSequence().getStartCanvasIndex()},e.prototype.getShareUrl=function(){return Utils.Documents.isInIFrame()&&this.isDeepLinkingEnabled()?parent.document.location.href:document.location.href},e.prototype.addTimestamp=function(e){return e+"?t="+Utils.Dates.getTimeStamp()},e.prototype.isDeepLinkingEnabled=function(){return this.isHomeDomain&&this.isOnlyInstance},e.prototype.getThumbs=function(e,t){return this.getCurrentSequence().getThumbs(e,t)},e.prototype.getRangeByPath=function(e){return this.manifest.getRangeByPath(e)},e.prototype.getCanvasIndexById=function(e){return this.getCurrentSequence().getCanvasIndexById(e)},e.prototype.getCanvasIndexByLabel=function(e){var t=this.getManifestType().toString()===manifesto.ManifestType.manuscript().toString();return this.getCurrentSequence().getCanvasIndexByLabel(e,t)},e.prototype.getRanges=function(){return this.manifest.getRanges()},e.prototype.getTree=function(){return this.iiifResource.getTree()},e.prototype.getDomain=function(){var e=Utils.Urls.getUrlParts(this.manifestUri);return e.host},e.prototype.getEmbedDomain=function(){return this.embedDomain},e.prototype.getMetadata=function(){var e=[],t=this.manifest.getMetadata();return t&&e.push({label:"metadata",value:t,isRootLevel:!0}),this.manifest.getDescription()&&e.push({label:"description",value:this.manifest.getDescription(),isRootLevel:!0}),this.manifest.getAttribution()&&e.push({label:"attribution",value:this.manifest.getAttribution(),isRootLevel:!0}),this.manifest.getLicense()&&e.push({label:"license",value:this.licenseFormatter.format(this.manifest.getLicense()),isRootLevel:!0}),this.manifest.getLogo()&&e.push({label:"logo",value:'<img src="'+this.manifest.getLogo()+'"/>',isRootLevel:!0}),e},e.prototype.getCanvasMetadata=function(e){var t=[],n=e.getMetadata();return n&&t.push({label:"metadata",value:n,isRootLevel:!0}),t},e.prototype.getSettings=function(){if(Utils.Bools.getBool(this.config.options.saveUserSettings,!1)){var e=Utils.Storage.get("uv.settings",Utils.StorageType.local);if(e)return $.extend(this.config.options,e.value)}return this.config.options},e.prototype.updateSettings=function(e){if(Utils.Bools.getBool(this.config.options.saveUserSettings,!1)){var t=Utils.Storage.get("uv.settings",Utils.StorageType.local);t&&(e=$.extend(t.value,e)),Utils.Storage.set("uv.settings",e,31536e4,Utils.StorageType.local)}this.config.options=$.extend(this.config.options,e)},e.prototype.sanitize=function(e){var t=document.createElement("div"),n=$(t);n.html(e);var i=new Sanitize({elements:["a","b","br","img","p","i","span"],attributes:{a:["href"],img:["src","alt"]},protocols:{a:{href:["http","https"]}}});return n.html(i.clean_node(t)),n.html()},e.prototype.getLocales=function(){if(this.locales)return this.locales;var e=this.config.localisation.locales.clone(),t=this.bootstrapper.params.locales,n=[];_.each(t,function(t){var i=_.filter(e,function(e){return e.name===t.name});if(i.length){var r=i[0];t.label&&(r.label=t.label),r.added=!0,n.push(r)}});var i=Utils.Bools.getBool(this.config.options.limitLocales,!1);return i||_.each(e,function(e){e.added||n.push(e),delete e.added}),this.locales=n},e.prototype.getAlternateLocale=function(){for(var e,t=this.getLocales(),n=0;n<t.length;n++){var i=t[n];i.name!==this.locale&&(e=i)}return i},e.prototype.changeLocale=function(e){var t=this.locales.clone(),i=t.indexOfTest(function(t){return t.name===e});t.move(i,0);var r=this.serializeLocales(t),o=new n;o.setLocale(r),this.reload(o)},e.prototype.serializeLocales=function(e){
for(var t="",n=0;n<e.length;n++){var i=e[n];n>0&&(t+=","),t+=i.name,i.label&&(t+=":"+i.label)}return t},e.prototype.getSerializedLocales=function(){return this.serializeLocales(this.locales)},e.prototype.getCurrentElement=function(){return this.getCanvasByIndex(this.canvasIndex)},e.prototype.getResources=function(){var e=this.getCurrentElement();return e.getResources()},e.prototype.hasParentCollection=function(){return!!this.manifest.parentCollection},e.prototype.hasResources=function(){return this.getResources().length>0},e}();return o});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-mediaelement-extension/Provider",["require","exports","../../modules/uv-shared-module/BaseProvider"],function(e,t,n){var i=function(e){function t(t){e.call(this,t),this.config.options=$.extend(!0,this.options,{},t.config.options)}return __extends(t,e),t.prototype.getEmbedScript=function(e,t,n){var i=this.config.uri||"",r=String.format(e,this.getSerializedLocales(),i,this.manifestUri,this.collectionIndex,this.manifestIndex,this.sequenceIndex,this.canvasIndex,t,n,this.embedScriptUri);return r},t.prototype.getPosterImageUri=function(){return this.getCurrentCanvas().getProperty("thumbnail")},t.prototype.isVideo=function(){var e=this.getElementType();return e.toString()===manifesto.ElementType.movingimage().toString()},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-pdf-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("downloadDialogue"),e.prototype.create.call(this)},t.prototype.open=function(){e.prototype.open.call(this),this.addEntireFileDownloadOptions(),this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show(),this.resize()},t.prototype.isDownloadOptionAvailable=function(t){return e.prototype.isDownloadOptionAvailable.call(this,t)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-pdf-extension/EmbedDialogue",["require","exports","../../modules/uv-dialogues-module/EmbedDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("embedDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this),this.code=this.provider.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-pdfcenterpanel-module/PDFCenterPanel",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/CenterPanel","../../Params"],function(e,t,n,i,r){var o=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("pdfCenterPanel"),e.prototype.create.call(this),$.subscribe(n.OPEN_EXTERNAL_RESOURCE,function(e,n){t.openMedia(n)})},t.prototype.openMedia=function(e){var t=this,n=this;this.extension.getExternalResources(e).then(function(){var e=t.provider.getCurrentCanvas(),i=e.id,o=window.browserDetect.browser,s=window.browserDetect.version;if("Explorer"===o&&10>s||!t.config.options.usePdfJs)new PDFObject({url:i,id:"PDF"}).embed("content");else{var a;a=window.DEBUG?"modules/uv-pdfcenterpanel-module/html/viewer.html":"html/uv-pdfcenterpanel-module/viewer.html",t.$content.load(a,function(){window.DEBUG?PDFJS.workerSrc="extensions/uv-pdf-extension/lib/pdf.worker.min.js":PDFJS.workerSrc="lib/pdf.worker.min.js",PDFJS.DEFAULT_URL=i;var e=1+parseInt(n.extension.getParam(r.anchor))||0;PDFView.initialBookmark="page="+e,window.webViewerLoad(),t.resize()})}})},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i);return o});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-pdf-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("settingsDialogue"),e.prototype.create.call(this)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-pdf-extension/Extension",["require","exports","../../modules/uv-shared-module/BaseCommands","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","./DownloadDialogue","./EmbedDialogue","../../modules/uv-shared-module/FooterPanel","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-pdfcenterpanel-module/PDFCenterPanel","./SettingsDialogue","../../modules/uv-shared-module/Shell","../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel"],function(e,t,n,i,r,o,s,a,u,c,l,h,p,d){var f=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(t){var i=this;e.prototype.create.call(this),$.subscribe(n.THUMB_SELECTED,function(e,t){i.viewCanvas(t)}),$.subscribe(n.LEFTPANEL_EXPAND_FULL_START,function(e){p.$centerPanel.hide(),p.$rightPanel.hide()}),$.subscribe(n.LEFTPANEL_COLLAPSE_FULL_FINISH,function(e){p.$centerPanel.show(),p.$rightPanel.show(),i.resize()}),$.subscribe(n.SHOW_OVERLAY,function(e,t){i.IsOldIE()&&i.centerPanel.$element.hide()}),$.subscribe(n.HIDE_OVERLAY,function(e,t){i.IsOldIE()&&i.centerPanel.$element.show()})},t.prototype.IsOldIE=function(){var e=window.browserDetect.browser,t=window.browserDetect.version;return"Explorer"===e&&9>=t?!0:!1},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.headerPanel=new u(p.$headerPanel),this.isLeftPanelEnabled()&&(this.leftPanel=new d(p.$leftPanel)),this.centerPanel=new l(p.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new c(p.$rightPanel)),this.footerPanel=new a(p.$footerPanel),this.$downloadDialogue=$('<div class="overlay download"></div>'),p.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new o(this.$downloadDialogue),this.$embedDialogue=$('<div class="overlay embed"></div>'),p.$overlays.append(this.$embedDialogue),this.embedDialogue=new s(this.$embedDialogue),this.$settingsDialogue=$('<div class="overlay settings"></div>'),p.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new h(this.$settingsDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()},t.prototype.bookmark=function(){e.prototype.bookmark.call(this);var t=this.provider.getCurrentCanvas(),i=new r;i.index=this.provider.canvasIndex,i.label=t.getLabel(),i.path=this.getBookmarkUri(),i.thumb=t.getProperty("thumbnail"),i.title=this.provider.getLabel(),i.trackingLabel=window.trackingLabel,i.type=manifesto.ElementType.document().toString(),this.triggerSocket(n.BOOKMARK,i)},t}(i);return f});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-pdf-extension/Provider",["require","exports","../../modules/uv-shared-module/BaseProvider"],function(e,t,n){var i=function(e){function t(t){e.call(this,t),this.config.options=$.extend(!0,this.options,{},t.config.options)}return __extends(t,e),t.prototype.getEmbedScript=function(e,t,n){var i=this.config.uri||"",r=String.format(e,this.getSerializedLocales(),i,this.manifestUri,this.collectionIndex,this.manifestIndex,this.sequenceIndex,this.canvasIndex,t,n,this.embedScriptUri);return r},t}(n);return i}),define("extensions/uv-seadragon-extension/Commands",["require","exports"],function(e,t){var n=function(){function e(){}return e.namespace="seadragonExtension.",e.CLEAR_SEARCH=e.namespace+"onClearSearch",e.CURRENT_VIEW_URI=e.namespace+"onCurrentViewUri",e.ENTER_MULTISELECT_MODE=e.namespace+"onEnterMultiSelectMode",e.EXIT_MULTISELECT_MODE=e.namespace+"onExitMultiSelectMode",e.FIRST=e.namespace+"onFirst",e.GALLERY_DECREASE_SIZE=e.namespace+"onGalleryDecreaseSize",e.GALLERY_INCREASE_SIZE=e.namespace+"onGalleryIncreaseSize",e.GALLERY_THUMB_SELECTED=e.namespace+"onGalleryThumbSelected",e.IMAGE_SEARCH=e.namespace+"onImageSearch",e.LAST=e.namespace+"onLast",e.MODE_CHANGED=e.namespace+"onModeChanged",e.MULTISELECT_CHANGE=e.namespace+"onMultiSelectChange",e.MULTISELECTION_MADE=e.namespace+"onMultiSelectionMade",e.NEXT=e.namespace+"onNext",e.NEXT_SEARCH_RESULT=e.namespace+"onNextSearchResult",e.OPEN_THUMBS_VIEW=e.namespace+"onOpenThumbsView",e.OPEN_TREE_VIEW=e.namespace+"onOpenTreeView",e.PAGE_SEARCH=e.namespace+"onPageSearch",e.PAGING_TOGGLED=e.namespace+"onPagingToggled",e.PREV=e.namespace+"onPrev",e.PREV_SEARCH_RESULT=e.namespace+"onPrevSearchResult",e.PRINT=e.namespace+"onPrint",e.SEADRAGON_ANIMATION=e.namespace+"onAnimation",e.SEADRAGON_ANIMATION_FINISH=e.namespace+"onAnimationfinish",e.SEADRAGON_ANIMATION_START=e.namespace+"onAnimationStart",e.SEADRAGON_OPEN=e.namespace+"onOpen",e.SEADRAGON_RESIZE=e.namespace+"onResize",e.SEADRAGON_ROTATION=e.namespace+"onRotation",e.SEARCH=e.namespace+"onSearch",e.SEARCH_PREVIEW_FINISH=e.namespace+"onSearchPreviewFinish",e.SEARCH_PREVIEW_START=e.namespace+"onSearchPreviewStart",e.SEARCH_RESULTS=e.namespace+"onSearchResults",e.SEARCH_RESULTS_EMPTY=e.namespace+"onSearchResultsEmpty",e.THUMB_MULTISELECTED=e.namespace+"onThumbMultiSelected",e.TREE_NODE_MULTISELECTED=e.namespace+"onTreeNodeMultiSelected",e.TREE_NODE_SELECTED=e.namespace+"onTreeNodeSelected",e.VIEW_PAGE=e.namespace+"onViewPage",e}();return n}),define("extensions/uv-seadragon-extension/DownloadType",["require","exports"],function(e,t){var n=function(){function e(){}return e.CURRENTVIEW="currentView",e.ENTIREDOCUMENTASPDF="entireDocumentAsPdf",e.ENTIREDOCUMENTASTEXT="entireDocumentAsText",e.WHOLEIMAGEHIGHRES="wholeImageHighRes",e.WHOLEIMAGELOWRES="wholeImageLowRes",e.UNKNOWN="unknown",e}();return n});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-seadragon-extension/DownloadDialogue",["require","exports","../../modules/uv-shared-module/BaseCommands","../../modules/uv-dialogues-module/DownloadDialogue","./Commands","../../modules/uv-shared-module/DownloadOption","./DownloadType"],function(e,t,n,i,r,o,s){var a=Utils.Measurements.Size,u=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("downloadDialogue"),e.prototype.create.call(this),this.$settingsButton=$('<a class="settings" href="#">'+this.content.editSettings+"</a>"),this.$pagingNote=$('<div class="pagingNote">'+this.content.pagingNote+" </div>"),this.$pagingNote.append(this.$settingsButton),this.$content.append(this.$pagingNote),this.$imageOptionsContainer=$('<li class="group image"></li>'),this.$downloadOptions.append(this.$imageOptionsContainer),this.$imageOptions=$("<ul></ul>"),this.$imageOptionsContainer.append(this.$imageOptions),this.$currentViewAsJpgButton=$('<li class="option"><input id="'+o.currentViewAsJpg.toString()+'" type="radio" name="downloadOptions" /><label for="'+o.currentViewAsJpg.toString()+'"></label></li>'),this.$imageOptions.append(this.$currentViewAsJpgButton),this.$currentViewAsJpgButton.hide(),this.$wholeImageHighResButton=$('<li class="option"><input id="'+o.wholeImageHighRes.toString()+'" type="radio" name="downloadOptions" /><label id="'+o.wholeImageHighRes.toString()+'label" for="'+o.wholeImageHighRes.toString()+'"></label></li>'),this.$imageOptions.append(this.$wholeImageHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImageLowResAsJpgButton=$('<li class="option"><input id="'+o.wholeImageLowResAsJpg.toString()+'" type="radio" name="downloadOptions" /><label for="'+o.wholeImageLowResAsJpg.toString()+'">'+this.content.wholeImageLowResAsJpg+"</label></li>"),this.$imageOptions.append(this.$wholeImageLowResAsJpgButton),this.$wholeImageLowResAsJpgButton.hide(),this.$canvasOptionsContainer=$('<li class="group canvas"></li>'),this.$downloadOptions.append(this.$canvasOptionsContainer),this.$canvasOptions=$("<ul></ul>"),this.$canvasOptionsContainer.append(this.$canvasOptions),this.$sequenceOptionsContainer=$('<li class="group sequence"></li>'),this.$downloadOptions.append(this.$sequenceOptionsContainer),this.$sequenceOptions=$("<ul></ul>"),this.$sequenceOptionsContainer.append(this.$sequenceOptions),this.$selectionButton=$('<li class="option"><input id="'+o.selection.toString()+'" type="radio" name="downloadOptions" /><label id="'+o.selection.toString()+'label" for="'+o.selection.toString()+'"></label></li>'),this.$sequenceOptions.append(this.$selectionButton),this.$selectionButton.hide(),this.$buttonsContainer=$('<div class="buttons"></div>'),this.$content.append(this.$buttonsContainer),this.$downloadButton=$('<a class="btn btn-primary" href="#">'+this.content.download+"</a>"),this.$buttonsContainer.append(this.$downloadButton);var i=this;this.$downloadButton.on("click",function(e){e.preventDefault();var a=i.getSelectedOption(),u=a.attr("id"),c=a.attr("title"),l=a.data("mime"),h=s.UNKNOWN,p=t.provider.getCurrentCanvas();if(t.renderingUrls[u])l&&(-1!==l.toLowerCase().indexOf("pdf")?h=s.ENTIREDOCUMENTASPDF:-1!==l.toLowerCase().indexOf("txt")&&(h=s.ENTIREDOCUMENTASTEXT)),window.open(t.renderingUrls[u]);else switch(u){case o.currentViewAsJpg.toString():var d=i.extension.getViewer();window.open(i.provider.getCroppedImageUri(p,d)),h=s.CURRENTVIEW;break;case o.selection.toString():$.publish(r.ENTER_MULTISELECT_MODE,[t.content.downloadSelectionButton]);break;case o.wholeImageHighRes.toString():window.open(t.getHighResImageUriForCurrentCanvas()),h=s.WHOLEIMAGEHIGHRES;break;case o.wholeImageLowResAsJpg.toString():window.open(i.provider.getConfinedImageUri(p,i.options.confinedImageSize)),h=s.WHOLEIMAGELOWRES}$.publish(n.DOWNLOAD,[{type:h,label:c}]),t.close()}),this.$settingsButton.onPressed(function(){$.publish(n.HIDE_DOWNLOAD_DIALOGUE),$.publish(n.SHOW_SETTINGS_DIALOGUE)})},t.prototype.open=function(){e.prototype.open.call(this);var t=this.provider.getCurrentCanvas();if(this.isDownloadOptionAvailable(o.currentViewAsJpg)){var n=this.$currentViewAsJpgButton.find("input"),i=this.$currentViewAsJpgButton.find("label"),r=this.content.currentViewAsJpg,s=this.extension.getViewer(),a=this.provider.getCroppedImageDimensions(t,s);a?(r=String.format(r,a.size.width,a.size.height),i.text(r),n.prop("title",r),this.$currentViewAsJpgButton.show()):this.$currentViewAsJpgButton.hide()}else this.$currentViewAsJpgButton.hide();if(this.isDownloadOptionAvailable(o.wholeImageHighRes)){var n=this.$wholeImageHighResButton.find("input"),i=this.$wholeImageHighResButton.find("label"),u=this.getMimeTypeForCurrentCanvas();u=u?Utils.Files.simplifyMimeType(u):"?";var c=this.getComputedDimensionsForCurrentCanvas(),r=String.format(this.content.wholeImageHighRes,c.width,c.height,u);i.text(r),n.prop("title",r),this.$wholeImageHighResButton.show()}else this.$wholeImageHighResButton.hide();if(this.isDownloadOptionAvailable(o.wholeImageLowResAsJpg)){var n=this.$wholeImageLowResAsJpgButton.find("input"),i=this.$wholeImageLowResAsJpgButton.find("label"),c=this.provider.getConfinedImageDimensions(t,this.options.confinedImageSize),r=String.format(this.content.wholeImageLowResAsJpg,c.width,c.height);i.text(r),n.prop("title",r),this.$wholeImageLowResAsJpgButton.show()}else this.$wholeImageLowResAsJpgButton.hide();if(this.isDownloadOptionAvailable(o.selection)){var n=this.$selectionButton.find("input"),i=this.$selectionButton.find("label");i.text(this.content.downloadSelection),n.prop("title",this.content.downloadSelection),this.$selectionButton.show()}else this.$selectionButton.hide();if(this.resetDynamicDownloadOptions(),this.isDownloadOptionAvailable(o.dynamicImageRenderings))for(var l=t.getImages(),h=0;h<l.length;h++)this.addDownloadOptionsForRenderings(l[h].getResource(),this.content.entireFileAsOriginal,o.dynamicImageRenderings);this.isDownloadOptionAvailable(o.dynamicCanvasRenderings)&&this.addDownloadOptionsForRenderings(t,this.content.entireFileAsOriginal,o.dynamicCanvasRenderings),this.isDownloadOptionAvailable(o.dynamicSequenceRenderings)&&this.addDownloadOptionsForRenderings(this.provider.getCurrentSequence(),this.content.entireDocument,o.dynamicSequenceRenderings);var p=this.$downloadOptions.find("li.group");p.each(function(e,t){var n=$(t);n.show(),n.find("li.option:hidden").length===n.find("li.option").length&&n.hide()}),this.$downloadOptions.find("li.group:visible").last().addClass("lastVisible"),this.provider.isPagingSettingEnabled()?this.$pagingNote.show():this.$pagingNote.hide(),this.$downloadOptions.find("li.option:visible").length?(this.$downloadOptions.find("li.option input:visible:first").prop("checked",!0),this.$noneAvailable.hide(),this.$downloadButton.show()):(this.$noneAvailable.show(),this.$downloadButton.hide()),this.resize()},t.prototype.resetDynamicDownloadOptions=function(){this.renderingUrls=[],this.renderingUrlsCount=0,this.$downloadOptions.find("li.dynamic").remove()},t.prototype.addDownloadOptionsForRenderings=function(e,t,n){for(var i=e.getRenderings(),r=0;r<i.length;r++){var s=i[r];if(s){var a=s.getLabel(),u="downloadOption"+ ++this.renderingUrlsCount;a?a+=" ({0})":a=t;var c=Utils.Files.simplifyMimeType(s.getFormat().toString());a=String.format(a,c),this.renderingUrls[u]=s.id;var l=$('<li class="option dynamic"><input id="'+u+'" data-mime="'+c+'" title="'+a+'" type="radio" name="downloadOptions" /><label for="'+u+'">'+a+"</label></li>");switch(n){case o.dynamicImageRenderings:this.$imageOptions.append(l);break;case o.dynamicCanvasRenderings:this.$canvasOptions.append(l);break;case o.dynamicSequenceRenderings:this.$sequenceOptions.append(l)}}}},t.prototype.getSelectedOption=function(){return this.$downloadOptions.find("li.option input:checked")},t.prototype.getCurrentCanvasImageResource=function(){var e=this.provider.getCurrentCanvas().getImages();return e[0]?e[0].getResource():null},t.prototype.getHighResImageUriForCurrentCanvas=function(){var e=this.provider.getCurrentCanvas(),t=this.getComputedDimensionsForCurrentCanvas().width;return e.getCanonicalImageUri(t)},t.prototype.getMimeTypeForCurrentCanvas=function(){var e=this.getCurrentCanvasImageResource(),t=e.getFormat();return t?t.toString():null},t.prototype.getDimensionsForCurrentCanvas=function(){var e=this.provider.getCurrentCanvas();return new a(e.externalResource.data.width,e.externalResource.data.height)},t.prototype.getMaxDimensionsForCurrentCanvas=function(){var e=this.provider.getCurrentCanvas();return new a(e.externalResource.data.profile[1].maxWidth,e.externalResource.data.profile[1].maxHeight)},t.prototype.getComputedDimensionsForCurrentCanvas=function(){var e=this.getDimensionsForCurrentCanvas(),t=this.getMaxDimensionsForCurrentCanvas(),n=e.width,i=e.height;if(!_.isUndefined(t.width)&&t.width<e.width)if(n=t.width,_.isUndefined(t.height)){var r=Math.normalise(t.width,0,e.width);i=Math.floor(e.height*r)}else i=t.height;return new a(n,i)},t.prototype.isDownloadOptionAvailable=function(t){switch(t){case o.currentViewAsJpg:case o.dynamicCanvasRenderings:case o.dynamicImageRenderings:case o.wholeImageHighRes:if(!this.provider.isPagingSettingEnabled()){var n=this.getMaxDimensionsForCurrentCanvas();if(_.isUndefined(n.width))return!0;if(n.width<=this.options.maxImageWidth)return!0}return!1;case o.wholeImageLowResAsJpg:var i=this.getComputedDimensionsForCurrentCanvas();return!this.provider.isPagingSettingEnabled()&&i.width>this.options.confinedImageSize;case o.selection:return this.options.selectionEnabled;default:return e.prototype.isDownloadOptionAvailable.call(this,t)}},t}(i);return u});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-seadragon-extension/EmbedDialogue",["require","exports","../../modules/uv-dialogues-module/EmbedDialogue","./Commands"],function(e,t,n,i){var r=function(e){function t(t){var n=this;e.call(this,t),$.subscribe(i.SEADRAGON_OPEN,function(e){n.update()}),$.subscribe(i.SEADRAGON_ANIMATION_FINISH,function(e){n.update()})}return __extends(t,e),t.prototype.create=function(){this.setConfig("embedDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this);var t=this.extension.getViewerBounds(),n=this.extension.getViewerRotation();this.code=this.provider.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight,t,n),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-dialogues-module/ExternalContentDialogue",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/Dialogue"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("externalContentDialogue"),e.prototype.create.call(this),this.openCommand=n.SHOW_EXTERNALCONTENT_DIALOGUE,this.closeCommand=n.HIDE_EXTERNALCONTENT_DIALOGUE,$.subscribe(this.openCommand,function(e,n){t.open(),t.$iframe.prop("src",n.uri)}),$.subscribe(this.closeCommand,function(e){t.close()}),this.$iframe=$("<iframe></iframe>"),this.$content.append(this.$iframe),this.$element.hide()},t.prototype.resize=function(){e.prototype.resize.call(this),this.$iframe.width(this.$content.width()),this.$iframe.height(this.$content.height())},t}(i);return r}),define("modules/uv-shared-module/AutoComplete",["require","exports"],function(e,t){var n=function(){function e(e,t,n,i,r,o,s){var a=this;void 0===r&&(r=300),void 0===o&&(o=2),void 0===s&&(s=!1),this.validKeyDownCodes=[KeyCodes.KeyDown.Backspace,KeyCodes.KeyDown.Spacebar,KeyCodes.KeyDown.Tab,KeyCodes.KeyDown.LeftArrow,KeyCodes.KeyDown.RightArrow,KeyCodes.KeyDown.Delete],this.lastKeyDownWasValid=!1,this.$element=e,this.autoCompleteFunc=t,this.delay=r,this.minChars=o,this.onSelect=i,this.parseResultsFunc=n,this.positionAbove=s,this.$searchResultsList=$('<ul class="autocomplete"></ul>'),this.positionAbove?this.$element.parent().prepend(this.$searchResultsList):this.$element.parent().append(this.$searchResultsList),this.$searchResultTemplate=$('<li class="result"><a href="#"></a></li>');var u=function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}(),c=this;this.$element.on("keydown",function(e){var t=e.originalEvent;c.lastKeyDownWasValid=c.isValidKeyDown(t);var n=Utils.Keyboard.getCharCode(t),i=!1;n===KeyCodes.KeyDown.LeftArrow?i=!0:n===KeyCodes.KeyDown.RightArrow&&(i=!0),i&&(t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation())}),this.$element.on("keypress",function(e){var t=c.isValidKeyPress(e.originalEvent);return c.lastKeyDownWasValid||t?!0:(e.preventDefault(),!1)}),this.$element.on("keyup",function(e){if(!c.getSelectedListItem().length&&e.keyCode===KeyCodes.KeyDown.Enter)return void c.onSelect(c.getTerms());if(c.$searchResultsList.is(":visible")&&c.results.length)if(e.keyCode===KeyCodes.KeyDown.Enter)c.searchForItem(c.getSelectedListItem());else{if(e.keyCode===KeyCodes.KeyDown.DownArrow)return void c.setSelectedResultIndex(1);if(e.keyCode===KeyCodes.KeyDown.UpArrow)return void c.setSelectedResultIndex(-1)}e.keyCode!==KeyCodes.KeyDown.Enter&&u(function(){var e=c.getTerms();e&&e.length>c.minChars&&!e.contains(" ")?c.search(e):(c.clearResults(),c.hideResults())},c.delay)}),$(document).on("mouseup",function(e){0===a.$searchResultsList.parent().has($(e.target)[0]).length&&(a.clearResults(),a.hideResults())}),this.hideResults()}return e.prototype.isValidKeyDown=function(e){return this.validKeyDownCodes.contains(Utils.Keyboard.getCharCode(e))},e.prototype.isValidKeyPress=function(e){var t=String.fromCharCode(Utils.Keyboard.getCharCode(e));return t.isAlphanumeric()},e.prototype.getTerms=function(){return this.$element.val().trim()},e.prototype.setSelectedResultIndex=function(e){var t;t=1===e?this.selectedResultIndex+1:this.selectedResultIndex-1;var n=this.$searchResultsList.find("li");0>t?t=n.length-1:t>n.length-1&&(t=0),this.selectedResultIndex=t,n.removeClass("selected");var i=n.eq(this.selectedResultIndex);i.addClass("selected");var r=i.outerHeight(!0)*this.selectedResultIndex;this.$searchResultsList.scrollTop(r)},e.prototype.search=function(e){this.results=[],this.clearResults(),this.showResults(),this.$searchResultsList.append('<li class="loading"></li>'),this.updateListPosition();var t=this;this.autoCompleteFunc(e,function(e){t.listResults(e)})},e.prototype.clearResults=function(){this.$searchResultsList.empty()},e.prototype.hideResults=function(){this.$searchResultsList.hide()},e.prototype.showResults=function(){this.selectedResultIndex=-1,this.$searchResultsList.show()},e.prototype.updateListPosition=function(){this.positionAbove?this.$searchResultsList.css({top:-1*this.$searchResultsList.outerHeight(!0)}):this.$searchResultsList.css({top:this.$element.outerHeight(!0)})},e.prototype.listResults=function(e){if(this.results=this.parseResultsFunc(e),this.clearResults(),!this.results.length)return void this.hideResults();for(var t=0;t<this.results.length;t++){var n=this.results[t],i=this.$searchResultTemplate.clone(),r=i.find("a");r.text(n),this.$searchResultsList.append(i)}this.updateListPosition();var o=this;this.$searchResultsList.find("li").on("click",function(e){e.preventDefault(),o.searchForItem($(this))})},e.prototype.searchForItem=function(e){var t=e.find("a").text();this.$element.val(t),this.hideResults(),this.onSelect(t),this.clearResults(),this.hideResults()},e.prototype.getSelectedListItem=function(){return this.$searchResultsList.find("li.selected")},e}();return n}),define("extensions/uv-seadragon-extension/Mode",["require","exports"],function(e,t){var n=function(){function e(e){this.value=e}return e.prototype.toString=function(){return this.value},e.image=new e("image"),e.page=new e("page"),e}();return n});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-searchfooterpanel-module/FooterPanel",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/FooterPanel","../../extensions/uv-seadragon-extension/Commands","../uv-shared-module/AutoComplete","../../extensions/uv-seadragon-extension/Mode"],function(e,t,n,i,r,o,s){var a=function(e){function t(t){e.call(this,t),this.placemarkerTouched=!1}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("searchFooterPanel"),e.prototype.create.call(this),$.subscribe(n.CANVAS_INDEX_CHANGED,function(e,n){t.canvasIndexChanged()}),$.subscribe(r.MODE_CHANGED,function(e,n){t.settingsChanged()}),$.subscribe(r.SEARCH,function(e,n){t.terms=n}),$.subscribe(r.SEARCH_RESULTS,function(e,n){t.displaySearchResults(n.terms,n.results)}),this.$printButton=$('<a class="print" title="'+this.content.print+'">'+this.content.print+"</a>"),this.$options.prepend(this.$printButton),this.$searchContainer=$('<div class="search"></div>'),this.$element.prepend(this.$searchContainer),this.$searchOptions=$('<div class="searchOptions"></div>'),this.$searchContainer.append(this.$searchOptions),this.$searchLabel=$('<span class="label">'+this.content.searchWithin+"</span>"),this.$searchOptions.append(this.$searchLabel),this.$searchTextContainer=$('<div class="searchTextContainer"></div>'),this.$searchOptions.append(this.$searchTextContainer),this.$searchText=$('<input class="searchText" type="text" maxlength="100" value="'+this.content.enterKeyword+'" />'),this.$searchTextContainer.append(this.$searchText),this.$searchButton=$('<a class="imageButton searchButton"></a>'),this.$searchTextContainer.append(this.$searchButton),this.$searchPagerContainer=$('<div class="searchPager"></div>'),this.$element.prepend(this.$searchPagerContainer),this.$searchPagerControls=$('<div class="controls"></div>'),this.$searchPagerContainer.prepend(this.$searchPagerControls),this.$previousResultButton=$('<a class="previousResult" title="'+this.content.previousResult+'">'+this.content.previousResult+"</a>"),this.$searchPagerControls.append(this.$previousResultButton),this.$searchResultsInfo=$('<div class="searchResultsInfo"><span class="number">x</span> <span class="foundFor"></span> \'<span class="terms">y</span>\'</div>'),this.$searchPagerControls.append(this.$searchResultsInfo),this.$clearSearchResultsButton=$('<a class="clearSearch" title="'+this.content.clearSearch+'">'+this.content.clearSearch+"</a>"),this.$searchResultsInfo.append(this.$clearSearchResultsButton),this.$nextResultButton=$('<a class="nextResult" title="'+this.content.nextResult+'">'+this.content.nextResult+"</a>"),this.$searchPagerControls.append(this.$nextResultButton),this.$searchResultsContainer=$('<div class="searchResults"></div>'),this.$element.prepend(this.$searchResultsContainer),this.$line=$('<div class="line"></div>'),this.$searchResultsContainer.append(this.$line),this.$pagePositionMarker=$('<div class="positionPlacemarker"></div>'),this.$searchResultsContainer.append(this.$pagePositionMarker),this.$pagePositionLabel=$('<div class="label"></div>'),this.$searchResultsContainer.append(this.$pagePositionLabel),this.$placemarkerDetails=$('<div class="placeMarkerDetails"></div>'),this.$searchResultsContainer.append(this.$placemarkerDetails),this.$placemarkerDetailsTop=$("<h1></h1>"),this.$placemarkerDetails.append(this.$placemarkerDetailsTop),this.$placemarkerDetailsBottom=$("<p></p>"),this.$placemarkerDetails.append(this.$placemarkerDetailsBottom),this.$searchPagerContainer.hide(),this.$placemarkerDetails.hide();var i=this;this.$searchButton.on("click",function(e){e.preventDefault(),t.search(t.$searchText.val())}),this.$searchText.on("focus",function(){t.$searchText.val()===t.content.enterKeyword&&t.$searchText.val("")}),this.$placemarkerDetails.on("mouseover",function(){$.publish(r.SEARCH_PREVIEW_START,[t.currentPlacemarkerIndex])}),this.$placemarkerDetails.on("mouseleave",function(){$(this).hide(),$.publish(r.SEARCH_PREVIEW_FINISH);var e=i.getSearchResultPlacemarkers();e.removeClass("hover")}),this.$placemarkerDetails.on("click",function(e){$.publish(r.VIEW_PAGE,[t.currentPlacemarkerIndex])}),this.$previousResultButton.on("click",function(e){e.preventDefault(),$.publish(r.PREV_SEARCH_RESULT)}),this.$nextResultButton.on("click",function(e){e.preventDefault(),$.publish(r.NEXT_SEARCH_RESULT)}),this.$clearSearchResultsButton.on("click",function(e){e.preventDefault(),$.publish(r.CLEAR_SEARCH),t.clearSearchResults()}),this.provider.isSearchWithinEnabled()||(this.$searchContainer.hide(),
this.$searchPagerContainer.hide(),this.$searchResultsContainer.hide(),this.$element.addClass("min"));var s=this.provider.getAutoCompleteUri();s&&new o(this.$searchText,function(e,t){$.getJSON(String.format(s,e),function(e){t(e)})},function(e){return _.map(e.terms,function(e){return e.match})},function(e){t.search(e)},300,2,!0),this.$printButton.onPressed(function(){$.publish(r.PRINT)}),this.updatePrintButton()},t.prototype.updatePrintButton=function(){var e=Utils.Bools.getBool(this.options.printEnabled,!1);e?this.$printButton.show():this.$printButton.hide()},t.prototype.search=function(e){return this.terms=e,""===this.terms||this.terms===this.content.enterKeyword?void this.extension.showMessage(this.config.modules.genericDialogue.content.emptyValue,function(){this.$searchText.focus()}):(this.$searchText.blur(),void $.publish(r.SEARCH,[this.terms]))},t.prototype.getSearchResultPlacemarkers=function(){return this.$searchResultsContainer.find(".searchResultPlacemarker")},t.prototype.positionSearchResultPlacemarkers=function(){var e=this.provider.searchResults;if(e.length){var t=this.getSearchResultPlacemarkers();t.remove();for(var n=this.getPageLineRatio(),i=this.$line.position().top,r=this.$line.position().left,o=this,s=0;s<e.length;s++){var a=e[s],u=a.canvasIndex*n,c=$('<div class="searchResultPlacemarker" data-index="'+a.canvasIndex+'"></div>');c[0].ontouchstart=function(e){o.onPlacemarkerTouchStart.call(this,o)},c.click(function(e){o.onPlacemarkerClick.call(this,o)}),c.mouseenter(function(e){o.onPlacemarkerMouseEnter.call(this,o)}),c.mouseleave(function(e){o.onPlacemarkerMouseLeave.call(this,e,o)}),this.$searchResultsContainer.append(c);var l=i-c.height(),h=r+u-c.width()/2;c.css({top:l,left:h})}}},t.prototype.onPlacemarkerTouchStart=function(e){e.placemarkerTouched=!0;var t=$(this),n=parseInt(t.attr("data-index"));$.publish(r.VIEW_PAGE,[n])},t.prototype.onPlacemarkerClick=function(e){if(!e.placemarkerTouched){e.placemarkerTouched=!1;var t=$(this),n=parseInt(t.attr("data-index"));$.publish(r.VIEW_PAGE,[n])}},t.prototype.onPlacemarkerMouseEnter=function(e){if(!e.placemarkerTouched){var t=$(this);t.addClass("hover");var n=parseInt(t.attr("data-index"));$.publish(r.SEARCH_PREVIEW_START,[n]);var i=e.getSearchResultPlacemarkers(),o=i.index(t[0]);e.currentPlacemarkerIndex=n,e.$placemarkerDetails.show();var a="{0} {1}",u=e.extension.getMode();if(u.toString()===s.page.toString()){var c=e.provider.getCanvasByIndex(n),l=c.getLabel();""===l&&(l=this.provider.manifest.options.defaultLabel),a=String.format(a,e.content.pageCaps,l)}else a=String.format(a,e.content.imageCaps,n+1);e.$placemarkerDetailsTop.html(a);var h,p=e.provider.searchResults[o],d=Utils.Strings.ellipsis(e.terms,e.options.elideDetailsTermsCount);1==p.rects.length?(h=e.content.instanceFound,h=String.format(h,d)):(h=e.content.instancesFound,h=String.format(h,p.rects.length,d)),e.$placemarkerDetailsBottom.html(h);var f=t.position(),g=f.top-e.$placemarkerDetails.height(),m=f.left;m<e.$placemarkerDetails.width()/2?m=0-t.width()/2:m>e.$line.width()-e.$placemarkerDetails.width()/2?m=e.$line.width()-e.$placemarkerDetails.width()+t.width()/2:m-=e.$placemarkerDetails.width()/2,e.$placemarkerDetails.css({top:g,left:m})}},t.prototype.onPlacemarkerMouseLeave=function(e,t){$.publish(r.SEARCH_PREVIEW_FINISH);var n=$(this),i=e.toElement||e.relatedTarget,o=$(i).closest(t.$placemarkerDetails).length;i!=t.$placemarkerDetails.get(0)&&0==o&&(t.$placemarkerDetails.hide(),n.removeClass("hover"))},t.prototype.setPageMarkerPosition=function(){if(null!=this.provider.canvasIndex){var e=this.getPageLineRatio(),t=this.$line.position().top,n=this.$line.position().left,i=this.provider.canvasIndex*e,r=t,o=n+i;this.$pagePositionMarker.css({top:r,left:o});var s=this.$line.width();o+this.$pagePositionLabel.outerWidth(!0)>s?(o-=this.$pagePositionLabel.outerWidth(!0),this.$pagePositionLabel.removeClass("right"),this.$pagePositionLabel.addClass("left")):(this.$pagePositionLabel.removeClass("left"),this.$pagePositionLabel.addClass("right")),this.$pagePositionLabel.css({top:r,left:o})}},t.prototype.clearSearchResults=function(){this.provider.searchResults=[];var e=this.getSearchResultPlacemarkers();e.remove(),this.$searchText.val(this.content.enterKeyword),this.$searchContainer.show(),this.$searchPagerContainer.hide(),this.$searchText.focus()},t.prototype.getPageLineRatio=function(){var e=this.$line.width();return 1===this.provider.getTotalCanvases()?0:e/(this.provider.getTotalCanvases()-1)},t.prototype.canvasIndexChanged=function(){this.setPageMarkerPosition(),this.setPlacemarkerLabel()},t.prototype.settingsChanged=function(){this.setPlacemarkerLabel()},t.prototype.setPlacemarkerLabel=function(){var e=this.content.displaying,t=this.provider.canvasIndex;if(this.isPageModeEnabled()){var n=this.provider.getCanvasByIndex(t),i=n.getLabel();""===i&&(i=this.content.defaultLabel);var r=this.provider.getLastCanvasLabel(!0);this.$pagePositionLabel.html(String.format(e,this.content.page,i,r))}else this.$pagePositionLabel.html(String.format(e,this.content.image,t+1,this.provider.getTotalCanvases()))},t.prototype.isPageModeEnabled=function(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===s.page.toString()},t.prototype.displaySearchResults=function(e,t){if(t){this.positionSearchResultPlacemarkers(),this.$searchContainer.hide(),this.$searchPagerControls.css({left:0});var n=this.$searchPagerContainer.find(".number");n.text(t.resources.length);var i=this.$searchResultsInfo.find(".foundFor");1===t.resources.length?i.html(this.content.resultFoundFor):i.html(this.content.resultsFoundFor);var r=this.$searchPagerContainer.find(".terms");r.html(Utils.Strings.ellipsis(e,this.options.elideResultsTermsCount)),r.prop("title",e),this.$searchPagerContainer.show(),this.resize()}},t.prototype.resize=function(){e.prototype.resize.call(this),this.provider.searchResults.length&&this.positionSearchResultPlacemarkers(),this.setPageMarkerPosition(),this.$searchPagerContainer.width(this.$element.width());var t=this.$element.width()/2;this.$searchPagerControls.css({left:t-this.$searchPagerControls.width()/2}),this.$searchOptions.css({left:t-this.$searchOptions.outerWidth()/2})},t}(i);return a});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-pagingheaderpanel-module/PagingHeaderPanel",["require","exports","../uv-shared-module/AutoComplete","../uv-shared-module/BaseCommands","../../extensions/uv-seadragon-extension/Commands","../uv-shared-module/HeaderPanel","../../extensions/uv-seadragon-extension/Mode"],function(e,t,n,i,r,o,s){var a=function(e){function t(t){e.call(this,t),this.firstButtonEnabled=!1,this.lastButtonEnabled=!1,this.nextButtonEnabled=!1,this.prevButtonEnabled=!1}return __extends(t,e),t.prototype.create=function(){var t=this;if(this.setConfig("pagingHeaderPanel"),e.prototype.create.call(this),$.subscribe(i.CANVAS_INDEX_CHANGED,function(e,n){t.canvasIndexChanged(n)}),$.subscribe(i.SETTINGS_CHANGED,function(e){t.modeChanged(),t.updatePagingToggle()}),$.subscribe(i.CANVAS_INDEX_CHANGE_FAILED,function(e){t.setSearchFieldValue(t.provider.canvasIndex)}),this.$prevOptions=$('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=$('<a class="imageBtn first" tabindex="15"></a>'),this.$prevOptions.append(this.$firstButton),this.$prevButton=$('<a class="imageBtn prev" tabindex="16"></a>'),this.$prevOptions.append(this.$prevButton),this.$modeOptions=$('<div class="mode"></div>'),this.$centerOptions.append(this.$modeOptions),this.$imageModeLabel=$('<label for="image">'+this.content.image+"</label>"),this.$modeOptions.append(this.$imageModeLabel),this.$imageModeOption=$('<input type="radio" id="image" name="mode" tabindex="17"/>'),this.$modeOptions.append(this.$imageModeOption),this.$pageModeLabel=$('<label for="page"></label>'),this.$modeOptions.append(this.$pageModeLabel),this.$pageModeOption=$('<input type="radio" id="page" name="mode" tabindex="18"/>'),this.$modeOptions.append(this.$pageModeOption),this.$search=$('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=$('<input class="searchText" maxlength="50" type="text" tabindex="19"/>'),this.$search.append(this.$searchText),this.options.autoCompleteBoxEnabled===!0)this.$searchText.hide(),this.$autoCompleteBox=$('<input class="autocompleteText" type="text" maxlength="100" />'),this.$search.append(this.$autoCompleteBox),new n(this.$autoCompleteBox,function(e,n){var i=[],r=t.provider.getCanvases();if(t.isPageModeEnabled())for(var o=0;o<r.length;o++){var s=r[o];s.getLabel().startsWith(e)&&i.push(s.getLabel())}else for(var o=0;o<r.length;o++){var s=r[o];s.index.toString().startsWith(e)&&i.push(s.index.toString())}n(i)},function(e){return e},function(e){t.search(e)},300,0);else if(this.options.imageSelectionBoxEnabled===!0){this.$selectionBoxOptions=$('<div class="image-selectionbox-options"></div>'),this.$centerOptions.append(this.$selectionBoxOptions),this.$imageSelectionBox=$('<select class="image-selectionbox" name="image-select" tabindex="20" ></select>'),this.$selectionBoxOptions.append(this.$imageSelectionBox);for(var o=0;o<this.provider.getTotalCanvases();o++){var a=this.provider.getCanvasByIndex(o),u=this.provider.sanitize(a.getLabel());this.$imageSelectionBox.append("<option value="+o+">"+u+"</option>")}this.$imageSelectionBox.change(function(){var e=parseInt(t.$imageSelectionBox.val());$.publish(r.IMAGE_SEARCH,[e])})}this.$total=$('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=$('<a class="go btn btn-primary" tabindex="21">'+this.content.go+"</a>"),this.$search.append(this.$searchButton),this.$nextOptions=$('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=$('<a class="imageBtn next" tabindex="1"></a>'),this.$nextOptions.append(this.$nextButton),this.$lastButton=$('<a class="imageBtn last" tabindex="2"></a>'),this.$nextOptions.append(this.$lastButton),this.isPageModeEnabled()?(this.$pageModeOption.attr("checked","checked"),this.$pageModeOption.removeAttr("disabled"),this.$pageModeLabel.removeClass("disabled")):(this.$imageModeOption.attr("checked","checked"),this.$pageModeOption.attr("disabled","disabled"),this.$pageModeLabel.addClass("disabled")),this.provider.getManifestType().toString()===manifesto.ManifestType.manuscript().toString()?this.$pageModeLabel.text(this.content.folio):this.$pageModeLabel.text(this.content.page),this.$pagingToggleButton=$('<a class="imageBtn pagingToggle"></a>'),this.$rightOptions.prepend(this.$pagingToggleButton),this.updatePagingToggle(),this.$pagingToggleButton.on("click",function(){var e=!t.getSettings().pagingEnabled;t.updateSettings({pagingEnabled:e}),$.publish(r.PAGING_TOGGLED,[e])}),this.setTitles(),this.setTotal();var c=this.provider.getViewingDirection();1===this.provider.getTotalCanvases()&&this.$centerOptions.hide(),this.$firstButton.onPressed(function(){switch(c.toString()){case manifesto.ViewingDirection.leftToRight().toString():$.publish(r.FIRST);break;case manifesto.ViewingDirection.rightToLeft().toString():$.publish(r.LAST)}}),this.$prevButton.onPressed(function(){switch(c.toString()){case manifesto.ViewingDirection.leftToRight().toString():$.publish(r.PREV);break;case manifesto.ViewingDirection.rightToLeft().toString():$.publish(r.NEXT)}}),this.$nextButton.onPressed(function(){switch(c.toString()){case manifesto.ViewingDirection.leftToRight().toString():$.publish(r.NEXT);break;case manifesto.ViewingDirection.rightToLeft().toString():$.publish(r.PREV)}}),this.config.options.pageModeEnabled?(this.$imageModeOption.on("click",function(e){$.publish(r.MODE_CHANGED,[s.image.toString()])}),this.$pageModeOption.on("click",function(e){$.publish(r.MODE_CHANGED,[s.page.toString()])})):(this.$imageModeOption.hide(),this.$pageModeLabel.hide(),this.$pageModeOption.hide()),this.$searchText.onEnter(function(){t.$searchText.blur(),t.search(t.$searchText.val())}),this.$searchText.click(function(){$(this).select()}),this.$searchButton.onPressed(function(){t.options.autoCompleteBoxEnabled?t.search(t.$autoCompleteBox.val()):t.search(t.$searchText.val())}),this.$lastButton.onPressed(function(){switch(c.toString()){case manifesto.ViewingDirection.leftToRight().toString():$.publish(r.LAST);break;case manifesto.ViewingDirection.rightToLeft().toString():$.publish(r.FIRST)}}),this.options.modeOptionsEnabled===!1&&(this.$modeOptions.hide(),this.$centerOptions.addClass("modeOptionsDisabled")),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$search.hide(),this.options.helpEnabled===!1&&this.$helpButton.hide();var l=this.$centerOptions.getVisibleElementWithGreatestTabIndex();l&&l.blur(function(){t.extension.tabbing&&!t.extension.shifted&&t.$nextButton.focus()}),this.$nextButton.blur(function(){t.extension.tabbing&&t.extension.shifted&&setTimeout(function(){l.focus()},100)}),this.options.pagingToggleEnabled===!1&&this.$pagingToggleButton.hide()},t.prototype.isPageModeEnabled=function(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===s.page.toString()},t.prototype.setTitles=function(){this.isPageModeEnabled()?(this.$firstButton.prop("title",this.content.firstPage),this.$prevButton.prop("title",this.content.previousPage),this.$nextButton.prop("title",this.content.nextPage),this.$lastButton.prop("title",this.content.lastPage)):(this.$firstButton.prop("title",this.content.firstImage),this.$prevButton.prop("title",this.content.previousImage),this.$nextButton.prop("title",this.content.nextImage),this.$lastButton.prop("title",this.content.lastImage)),this.$searchButton.prop("title",this.content.go)},t.prototype.updatePagingToggle=function(){return this.pagingToggleIsVisible()?void(this.provider.isPagingSettingEnabled()?(this.$pagingToggleButton.removeClass("two-up"),this.$pagingToggleButton.addClass("one-up"),this.$pagingToggleButton.prop("title",this.content.oneUp)):(this.$pagingToggleButton.removeClass("one-up"),this.$pagingToggleButton.addClass("two-up"),this.$pagingToggleButton.prop("title",this.content.twoUp))):void this.$pagingToggleButton.hide()},t.prototype.pagingToggleIsVisible=function(){return this.options.pagingToggleEnabled&&this.provider.isPagingAvailable()},t.prototype.setTotal=function(){var e=this.content.of;this.isPageModeEnabled()?this.$total.html(String.format(e,this.provider.getLastCanvasLabel(!0))):this.$total.html(String.format(e,this.provider.getTotalCanvases()))},t.prototype.setSearchFieldValue=function(e){var t,n=this.provider.getCanvasByIndex(e);if(this.isPageModeEnabled()){var i=n.getLabel();t="-"===i?"":i}else e+=1,t=e;this.options.autoCompleteBoxEnabled?this.$autoCompleteBox.val(t):this.$searchText.val(t)},t.prototype.search=function(e){if(!e)return this.extension.showMessage(this.content.emptyValue),void $.publish(i.CANVAS_INDEX_CHANGE_FAILED);if(this.isPageModeEnabled())$.publish(r.PAGE_SEARCH,[e]);else{var t;if(t=this.options.autoCompleteBoxEnabled?parseInt(this.$autoCompleteBox.val(),10):parseInt(this.$searchText.val(),10),t-=1,isNaN(t))return this.extension.showMessage(this.provider.config.modules.genericDialogue.content.invalidNumber),void $.publish(i.CANVAS_INDEX_CHANGE_FAILED);var n=this.provider.getCanvasByIndex(t);if(!n)return this.extension.showMessage(this.provider.config.modules.genericDialogue.content.pageNotFound),void $.publish(i.CANVAS_INDEX_CHANGE_FAILED);$.publish(r.IMAGE_SEARCH,[t])}},t.prototype.canvasIndexChanged=function(e){this.setSearchFieldValue(e),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$imageSelectionBox.val(e),this.provider.isFirstCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton()),this.provider.isLastCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton())},t.prototype.disableFirstButton=function(){this.firstButtonEnabled=!1,this.$firstButton.disable()},t.prototype.enableFirstButton=function(){this.firstButtonEnabled=!0,this.$firstButton.enable()},t.prototype.disableLastButton=function(){this.lastButtonEnabled=!1,this.$lastButton.disable()},t.prototype.enableLastButton=function(){this.lastButtonEnabled=!0,this.$lastButton.enable()},t.prototype.disablePrevButton=function(){this.prevButtonEnabled=!1,this.$prevButton.disable()},t.prototype.enablePrevButton=function(){this.prevButtonEnabled=!0,this.$prevButton.enable()},t.prototype.disableNextButton=function(){this.nextButtonEnabled=!1,this.$nextButton.disable()},t.prototype.enableNextButton=function(){this.nextButtonEnabled=!0,this.$nextButton.enable()},t.prototype.modeChanged=function(){this.setSearchFieldValue(this.provider.canvasIndex),this.setTitles(),this.setTotal()},t.prototype.resize=function(){e.prototype.resize.call(this),this.extension.width()<this.provider.config.options.minWidthBreakPoint?this.pagingToggleIsVisible()&&this.$pagingToggleButton.hide():this.pagingToggleIsVisible()&&this.$pagingToggleButton.show()},t}(o);return a}),define("extensions/uv-seadragon-extension/PrintArgs",["require","exports"],function(e,t){var n=function(){function e(){}return e}();return n});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-seadragoncenterpanel-module/SeadragonCenterPanel",["require","exports","../uv-shared-module/BaseCommands","../../extensions/uv-seadragon-extension/Commands","../uv-shared-module/CenterPanel","../../Params"],function(e,t,n,i,r,o){var s=function(e){function t(t){e.call(this,t),this.controlsVisible=!1,this.isCreated=!1,this.isFirstLoad=!0,this.nextButtonEnabled=!1,this.prevButtonEnabled=!1}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("seadragonCenterPanel"),e.prototype.create.call(this),this.$viewer=$('<div id="viewer"></div>'),this.$content.prepend(this.$viewer),$.subscribe(n.OPEN_EXTERNAL_RESOURCE,function(e,n){Utils.Async.waitFor(function(){return t.isResized},function(){t.isCreated||t.createUI(),t.openMedia(n)})})},t.prototype.createUI=function(){var e=this;this.$spinner=$('<div class="spinner"></div>'),this.$content.append(this.$spinner),this.showAttribution();var t=window.DEBUG?"modules/uv-seadragoncenterpanel-module/img/":"themes/"+this.provider.config.options.theme+"/img/uv-seadragoncenterpanel-module/";window.openSeadragonViewer=this.viewer=OpenSeadragon({id:"viewer",ajaxWithCredentials:!1,showNavigationControl:!0,showNavigator:!0,showRotationControl:!0,showHomeControl:this.config.options.showHomeControl||!1,showFullPageControl:!1,defaultZoomLevel:this.config.options.defaultZoomLevel||0,controlsFadeDelay:this.config.options.controlsFadeDelay||250,controlsFadeLength:this.config.options.controlsFadeLength||250,navigatorPosition:this.config.options.navigatorPosition||"BOTTOM_RIGHT",animationTime:this.config.options.animationTime||1.2,visibilityRatio:this.config.options.visibilityRatio||.5,constrainDuringPan:this.config.options.constrainDuringPan||!1,immediateRender:this.config.options.immediateRender||!1,maxZoomLevel:this.config.options.maxZoomLevel||null,blendTime:this.config.options.blendTime||0,autoHideControls:null==this.config.options.autoHideControls?!0:this.config.options.autoHideControls,prefixUrl:t,navImages:{zoomIn:{REST:"zoom_in.png",GROUP:"zoom_in.png",HOVER:"zoom_in.png",DOWN:"zoom_in.png"},zoomOut:{REST:"zoom_out.png",GROUP:"zoom_out.png",HOVER:"zoom_out.png",DOWN:"zoom_out.png"},home:{REST:"home.png",GROUP:"home.png",HOVER:"home.png",DOWN:"home.png"},rotateright:{REST:"rotate_right.png",GROUP:"rotate_right.png",HOVER:"rotate_right.png",DOWN:"rotate_right.png"},rotateleft:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},next:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},previous:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"}}}),this.$zoomInButton=this.$viewer.find('div[title="Zoom in"]'),this.$zoomInButton.attr("tabindex",11),this.$zoomInButton.prop("title",this.content.zoomIn),this.$zoomInButton.addClass("zoomIn"),this.$zoomOutButton=this.$viewer.find('div[title="Zoom out"]'),this.$zoomOutButton.attr("tabindex",12),this.$zoomOutButton.prop("title",this.content.zoomOut),this.$zoomOutButton.addClass("zoomOut"),this.$goHomeButton=this.$viewer.find('div[title="Go home"]'),this.$goHomeButton.attr("tabindex",13),this.$goHomeButton.prop("title",this.content.goHome),this.$goHomeButton.addClass("goHome"),this.$rotateButton=this.$viewer.find('div[title="Rotate right"]'),this.$rotateButton.attr("tabindex",14),this.$rotateButton.prop("title",this.content.rotateRight),this.$rotateButton.addClass("rotate"),this.$navigator=this.$viewer.find(".navigator"),this.setNavigatorVisible(),this.$element.on("mousemove",function(t){e.controlsVisible||(e.controlsVisible=!0,e.viewer.setControlsEnabled(!0))}),this.$element.on("mouseleave",function(t){e.controlsVisible&&(e.controlsVisible=!1,e.viewer.setControlsEnabled(!1))}),this.$element.on("mousemove",function(t){if(!e.$viewer.find(".navigator").ismouseover()){if(!e.controlsVisible)return;e.controlsVisible=!1,e.viewer.setControlsEnabled(!1)}},this.config.options.controlsFadeAfterInactive),this.viewer.addHandler("open",function(t){$.publish(i.SEADRAGON_OPEN,[t]),e.openPagesHandler()}),this.viewer.addHandler("tile-drawn",function(){e.$spinner.hide()}),this.viewer.addHandler("resize",function(t){$.publish(i.SEADRAGON_RESIZE,[t]),e.viewerResize(t)}),this.viewer.addHandler("animation-start",function(e){$.publish(i.SEADRAGON_ANIMATION_START,[e])}),this.viewer.addHandler("animation",function(e){$.publish(i.SEADRAGON_ANIMATION,[e])}),this.viewer.addHandler("animation-finish",function(t){e.currentBounds=e.getBounds(),$.publish(i.SEADRAGON_ANIMATION_FINISH,[t])}),this.$rotateButton.on("click",function(){$.publish(i.SEADRAGON_ROTATION,[e.viewer.viewport.getRotation()])}),this.title=this.extension.provider.getLabel(),this.createNavigationButtons(),this.hidePrevButton(),this.hideNextButton(),this.isCreated=!0,this.resize()},t.prototype.createNavigationButtons=function(){this.$leftButton=$('<div class="paging btn prev"></div>'),this.$leftButton.prop("title",this.content.previous),this.viewer.addControl(this.$leftButton[0],{anchor:OpenSeadragon.ControlAnchor.TOP_LEFT}),this.$rightButton=$('<div class="paging btn next"></div>'),this.$rightButton.prop("title",this.content.next),this.viewer.addControl(this.$rightButton[0],{anchor:OpenSeadragon.ControlAnchor.TOP_RIGHT});var e=this,t=this.provider.getViewingDirection();this.$leftButton.on("touchstart click",function(n){if(n.preventDefault(),OpenSeadragon.cancelEvent(n),e.prevButtonEnabled)switch(t.toString()){case manifesto.ViewingDirection.leftToRight().toString():$.publish(i.PREV);break;case manifesto.ViewingDirection.rightToLeft().toString():$.publish(i.NEXT)}}),this.$rightButton.on("touchstart click",function(n){if(n.preventDefault(),OpenSeadragon.cancelEvent(n),e.nextButtonEnabled)switch(t.toString()){case manifesto.ViewingDirection.leftToRight().toString():$.publish(i.NEXT);break;case manifesto.ViewingDirection.rightToLeft().toString():$.publish(i.PREV)}})},t.prototype.openMedia=function(e){var t=this;this.$spinner.show(),this.extension.getExternalResources(e).then(function(e){t.viewer.open(e)})},t.prototype.positionPages=function(){var e,t,n,i,r,o,s,a,u,c,l,h,p,d,f,g=this.provider.resources;if(g.length>1)if(2===g.length)this.provider.isVerticallyAligned()?(s=this.viewer.world.getItemAt(0),a=s.getBounds(!0),t=a.y+a.height,u=this.viewer.world.getItemAt(1),c=u.getBounds(!0).getTopLeft(),c.y=t+this.config.options.pageGap,u.setPosition(c,!0)):(l=this.viewer.world.getItemAt(0),h=l.getBounds(!0),e=h.x+h.width,p=this.viewer.world.getItemAt(1),d=p.getBounds(!0),f=d.getTopLeft(),f.x=e+this.config.options.pageGap,p.setPosition(f,!0),p.source.width>p.source.height?p.setWidth(h.width):p.setHeight(h.height));else if(this.provider.isVerticallyAligned())if(this.provider.isTopToBottom())for(var m=0;m<g.length-1;m++)n=this.viewer.world.getItemAt(m),i=n.getBounds(!0),t=i.y+i.height,r=this.viewer.world.getItemAt(m+1),o=r.getBounds(!0).getTopLeft(),o.y=t,r.setPosition(o,!0);else for(var m=g.length;m>0;m--)n=this.viewer.world.getItemAt(m),i=n.getBounds(!0),t=i.y-i.height,r=this.viewer.world.getItemAt(m-1),o=r.getBounds(!0).getTopLeft(),o.y=t,r.setPosition(o,!0);else if(this.provider.isLeftToRight())for(var m=0;m<g.length-1;m++)n=this.viewer.world.getItemAt(m),i=n.getBounds(!0),e=i.x+i.width,r=this.viewer.world.getItemAt(m+1),o=r.getBounds(!0).getTopLeft(),o.x=e,r.setPosition(o,!0);else for(var m=g.length-1;m>0;m--)n=this.viewer.world.getItemAt(m),i=n.getBounds(!0),e=i.x-i.width,r=this.viewer.world.getItemAt(m-1),o=r.getBounds(!0).getTopLeft(),o.x=e,r.setPosition(o,!0)},t.prototype.openPagesHandler=function(){if(this.positionPages(),this.isFirstLoad)this.initialRotation=this.extension.getParam(o.rotation),this.initialRotation&&this.viewer.viewport.setRotation(parseInt(this.initialRotation)),this.initialBounds=this.extension.getParam(o.zoom),this.initialBounds&&(this.initialBounds=this.deserialiseBounds(this.initialBounds),this.currentBounds=this.initialBounds,this.fitToBounds(this.currentBounds));else{var e=this.provider.getSettings();e.preserveViewport&&this.currentBounds?this.fitToBounds(this.currentBounds):this.goHome()}this.provider.isMultiCanvas()&&!this.provider.isContinuous()&&(this.showPrevButton(),this.showNextButton(),$(".navigator").addClass("extraMargin"),this.provider.isFirstCanvas()?this.disablePrevButton():this.enablePrevButton(),this.provider.isLastCanvas()?this.disableNextButton():this.enableNextButton()),this.setNavigatorVisible(),this.isFirstLoad=!1,this.overlaySearchResults()},t.prototype.goHome=function(){var e=this.provider.getViewingDirection().toString();switch(e.toString()){case manifesto.ViewingDirection.topToBottom().toString():this.viewer.viewport.fitBounds(new OpenSeadragon.Rect(0,0,1,this.viewer.world.getItemAt(0).normHeight*this.provider.resources.length),!0);break;case manifesto.ViewingDirection.leftToRight().toString():case manifesto.ViewingDirection.rightToLeft().toString():this.viewer.viewport.fitBounds(new OpenSeadragon.Rect(0,0,this.provider.resources.length,this.viewer.world.getItemAt(0).normHeight),!0)}},t.prototype.disablePrevButton=function(){this.prevButtonEnabled=!1,this.$leftButton.addClass("disabled")},t.prototype.enablePrevButton=function(){this.prevButtonEnabled=!0,this.$leftButton.removeClass("disabled")},t.prototype.hidePrevButton=function(){this.disablePrevButton(),this.$leftButton.hide()},t.prototype.showPrevButton=function(){this.enablePrevButton(),this.$leftButton.show()},t.prototype.disableNextButton=function(){this.nextButtonEnabled=!1,this.$rightButton.addClass("disabled")},t.prototype.enableNextButton=function(){this.nextButtonEnabled=!0,this.$rightButton.removeClass("disabled")},t.prototype.hideNextButton=function(){this.disableNextButton(),this.$rightButton.hide()},t.prototype.showNextButton=function(){this.enableNextButton(),this.$rightButton.show()},t.prototype.serialiseBounds=function(e){return e.x+","+e.y+","+e.width+","+e.height},t.prototype.deserialiseBounds=function(e){var t=e.split(",");return{x:Number(t[0]),y:Number(t[1]),width:Number(t[2]),height:Number(t[3])}},t.prototype.fitToBounds=function(e){var t=new OpenSeadragon.Rect;t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,this.viewer.viewport.fitBounds(t,!0)},t.prototype.getBounds=function(){if(!this.viewer||!this.viewer.viewport)return null;var e=this.viewer.viewport.getBounds(!0);return{x:Math.roundToDecimalPlace(e.x,4),y:Math.roundToDecimalPlace(e.y,4),width:Math.roundToDecimalPlace(e.width,4),height:Math.roundToDecimalPlace(e.height,4)}},t.prototype.viewerResize=function(e){if(e.viewport){var t=e.viewport.getCenter(!0);t&&setTimeout(function(){e.viewport.panTo(t,!0)},1)}},t.prototype.overlaySearchResults=function(){var e=this.provider.searchResults;if(e.length)for(var t=this.provider.getPagedIndices(),n=0;n<t.length;n++){for(var i=t[n],r=null,o=0;o<e.length;o++)if(e[o].canvasIndex===i){r=e[o];break}if(r)for(var s=this.getSearchOverlayRects(r.rects,n),a=0;a<s.length;a++){var u=s[a],c=document.createElement("div");c.className="searchOverlay",this.viewer.addOverlay(c,u)}}},t.prototype.getSearchOverlayRects=function(e,t){var n=[],i=this.viewer.world.getItemAt(t).source.dimensions.x,r=0;t>0&&(r=this.viewer.world.getItemAt(t-1).source.dimensions.x);for(var o=0;o<e.length;o++){var s=e[o],a=1/i,u=a*(Number(s.x)+r)+(t>0?this.config.options.pageGap:0),c=a*Number(s.y),l=a*Number(s.width),h=a*Number(s.height),p=new OpenSeadragon.Rect(u,c,l,h);n.push(p)}return n},t.prototype.resize=function(){var t=this;e.prototype.resize.call(this),this.$viewer.height(this.$content.height()-this.$viewer.verticalMargins()),this.$viewer.width(this.$content.width()-this.$viewer.horizontalMargins()),this.isCreated&&(this.currentBounds&&this.fitToBounds(this.currentBounds),this.$title.ellipsisFill(this.provider.sanitize(this.title)),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2),this.provider.isMultiCanvas()&&this.$leftButton&&this.$rightButton&&(this.$leftButton.css("top",(this.$content.height()-this.$leftButton.height())/2),this.$rightButton.css("top",(this.$content.height()-this.$rightButton.height())/2)),setTimeout(function(){if(t.provider.isContinuous())if(t.provider.isHorizontallyAligned()){var e=t.$viewer.width()-t.$viewer.rightMargin();console.log(e),t.$navigator.width(e)}else t.$navigator.height(t.$viewer.height())},100))},t.prototype.setFocus=function(){var e=$(this.viewer.canvas);e.is(":focus")||e.focus()},t.prototype.setNavigatorVisible=function(){var e=Utils.Bools.getBool(this.provider.getSettings().navigatorEnabled,!0);this.viewer.navigator.setVisible(e),e?this.$navigator.show():this.$navigator.hide()},t}(r);return s});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-seadragon-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("settingsDialogue"),e.prototype.create.call(this),this.$navigatorEnabled=$('<div class="setting navigatorEnabled"></div>'),this.$scroll.append(this.$navigatorEnabled),this.$navigatorEnabledCheckbox=$('<input id="navigatorEnabled" type="checkbox" />'),this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox),this.$navigatorEnabledLabel=$('<label for="navigatorEnabled">'+this.content.navigatorEnabled+"</label>"),this.$navigatorEnabled.append(this.$navigatorEnabledLabel),this.$pagingEnabled=$('<div class="setting pagingEnabled"></div>'),this.$scroll.append(this.$pagingEnabled),this.$pagingEnabledCheckbox=$('<input id="pagingEnabled" type="checkbox" />'),this.$pagingEnabled.append(this.$pagingEnabledCheckbox),this.$pagingEnabledLabel=$('<label for="pagingEnabled">'+this.content.pagingEnabled+"</label>"),this.$pagingEnabled.append(this.$pagingEnabledLabel),this.$preserveViewport=$('<div class="setting preserveViewport"></div>'),this.$scroll.append(this.$preserveViewport),this.$preserveViewportCheckbox=$('<input id="preserveViewport" type="checkbox" />'),this.$preserveViewport.append(this.$preserveViewportCheckbox),this.$preserveViewportLabel=$('<label for="preserveViewport">'+this.content.preserveViewport+"</label>"),this.$preserveViewport.append(this.$preserveViewportLabel),this.$navigatorEnabledCheckbox.change(function(){
var e={};t.$navigatorEnabledCheckbox.is(":checked")?e.navigatorEnabled=!0:e.navigatorEnabled=!1,t.updateSettings(e)}),this.$pagingEnabledCheckbox.change(function(){var e={};t.$pagingEnabledCheckbox.is(":checked")?e.pagingEnabled=!0:e.pagingEnabled=!1,t.updateSettings(e)}),this.$preserveViewportCheckbox.change(function(){var e={};t.$preserveViewportCheckbox.is(":checked")?e.preserveViewport=!0:e.preserveViewport=!1,t.updateSettings(e)})},t.prototype.open=function(){e.prototype.open.call(this);var t=this.getSettings();t.navigatorEnabled?this.$navigatorEnabledCheckbox.prop("checked",!0):this.$navigatorEnabledCheckbox.removeAttr("checked"),this.provider.isPagingAvailable()?t.pagingEnabled?this.$pagingEnabledCheckbox.prop("checked",!0):this.$pagingEnabledCheckbox.removeAttr("checked"):this.$pagingEnabled.hide(),t.preserveViewport?this.$preserveViewportCheckbox.prop("checked",!0):this.$preserveViewportCheckbox.removeAttr("checked")},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-contentleftpanel-module/GalleryView",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/BaseView","../../extensions/uv-seadragon-extension/Commands","../../extensions/uv-seadragon-extension/Mode"],function(e,t,n,i,r,o){var s=function(e){function t(t){e.call(this,t,!0,!0),this.isOpen=!1}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("contentLeftPanel"),e.prototype.create.call(this),$.subscribe(n.CANVAS_INDEX_CHANGED,function(e,n){t.selectIndex(parseInt(n))}),$.subscribe(n.SETTINGS_CHANGED,function(){t.setLabel()}),$.subscribe(r.SEARCH_PREVIEW_START,function(e,n){t.searchPreviewStart(n)}),$.subscribe(r.SEARCH_PREVIEW_FINISH,function(){t.searchPreviewFinish()}),$.subscribe(r.ENTER_MULTISELECT_MODE,function(){t.dataBind(),t.resize()}),$.subscribe(r.EXIT_MULTISELECT_MODE,function(){t.dataBind()}),$.subscribe(r.MULTISELECT_CHANGE,function(e,n){t._multiSelectStateChange(n)}),this.$header=$('<div class="header"></div>'),this.$element.append(this.$header),this.$sizeDownButton=$('<input class="btn btn-default size-down" type="button" value="-" />'),this.$header.append(this.$sizeDownButton),this.$sizeRange=$('<input type="range" name="size" min="1" max="10" value="6" />'),this.$header.append(this.$sizeRange),this.$sizeUpButton=$('<input class="btn btn-default size-up" type="button" value="+" />'),this.$header.append(this.$sizeUpButton),this.$main=$('<div class="main"></div>'),this.$element.append(this.$main),this.$thumbs=$('<div class="thumbs"></div>'),this.$main.append(this.$thumbs),this.$thumbs.addClass(this.provider.getViewingDirection().toString()),this.$sizeDownButton.on("click",function(){var e=Number(t.$sizeRange.val())-1;e>=Number(t.$sizeRange.attr("min"))&&(t.$sizeRange.val(e.toString()),t.$sizeRange.trigger("change"),$.publish(r.GALLERY_DECREASE_SIZE))}),this.$sizeUpButton.on("click",function(){var e=Number(t.$sizeRange.val())+1;e<=Number(t.$sizeRange.attr("max"))&&(t.$sizeRange.val(e.toString()),t.$sizeRange.trigger("change"),$.publish(r.GALLERY_INCREASE_SIZE))}),this.$sizeRange.on("change",function(){t.updateThumbs(),t.scrollToThumb(t.getSelectedThumbIndex())}),this._setRange(),$.templates({galleryThumbsTemplate:'                <div class="{{:~className()}}" data-src="{{>uri}}" data-index="{{>index}}" data-visible="{{>visible}}" data-width="{{>width}}" data-height="{{>height}}" data-initialwidth="{{>initialWidth}}" data-initialheight="{{>initialHeight}}">                    <div class="wrap" style="width:{{>initialWidth}}px; height:{{>initialHeight}}px" data-link="class{merge:multiSelected toggle=\'multiSelected\'}">                    {^{if multiSelectionEnabled}}                        <input id="thumb-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? \'checked\' : \'\'}" class="multiSelect" />                    {{/if}}                    </div>                    <span class="index">{{:#index + 1}}</span>                    <span class="label" style="width:{{>initialWidth}}px" title="{{>label}}">{{>label}}&nbsp;</span>                </div>'}),$.views.helpers({className:function(){var e="thumb preLoad";return 0===this.data.index&&(e+=" first"),this.data.uri||(e+=" placeholder"),e}}),this.$main.on("scroll",function(){t.updateThumbs()},100),Modernizr.inputtypes.range||this.$sizeRange.hide(),this.resize()},t.prototype.dataBind=function(){this.thumbs&&(this._reset(),this.createThumbs())},t.prototype.createThumbs=function(){var e=this;if(this.thumbs){this.isChunkedResizingEnabled()&&this.$thumbs.addClass("chunked");for(var t=[],i=0;i<this.thumbs.length;i++){var o=this.thumbs[i],s=o.width,a=o.height;o.initialWidth=s,t.push(a)}for(var u=Math.median(t),c=0;c<this.thumbs.length;c++){var o=this.thumbs[c];o.initialHeight=u}this.$thumbs.link($.templates.galleryThumbsTemplate,this.thumbs),e.multiSelectState.enabled?$.each(this.$thumbs.find(".thumb"),function(t,n){var i=$(n);i.checkboxButton(function(t){var n=$.view(this).data;e._setThumbMultiSelected(n,!n.multiSelected),$.publish(r.THUMB_MULTISELECTED,[n])})}):this.$thumbs.delegate(".thumb","click",function(t){t.preventDefault();var i=$.view(this).data;e.lastThumbClickedIndex=i.index,$.publish(n.THUMB_SELECTED,[i.index])}),this.selectIndex(this.provider.canvasIndex),this.setLabel(),this.updateThumbs()}},t.prototype._getThumbsByRange=function(e){for(var t=[],n=0;n<this.thumbs.length;n++){var i=this.thumbs[n],r=i.data,o=this.provider.getCanvasRange(r);o&&o.id===e.id&&t.push(i)}return t},t.prototype._multiSelectStateChange=function(e){this.multiSelectState=e,e.enabled?this.$thumbs.addClass("multiSelect"):this.$thumbs.removeClass("multiSelect");for(var t=0;t<e.canvases.length;t++){var n=e.canvases[t],i=this._getThumbByCanvas(n);this._setThumbMultiSelected(i,n.multiSelected)}for(var r=0;r<e.ranges.length;r++)for(var o=e.ranges[r],s=this._getThumbsByRange(o),a=0;a<s.length;a++){var i=s[a];this._setThumbMultiSelected(i,o.multiSelected)}},t.prototype._getThumbByCanvas=function(e){return this.thumbs.en().where(function(t){return t.data.id===e.id}).first()},t.prototype._setThumbMultiSelected=function(e,t){$.observable(e).setProperty("multiSelected",t)},t.prototype._setRange=function(){var e=Math.normalise(Number(this.$sizeRange.val()),0,10);this.range=Math.clamp(e,.05,1)},t.prototype.updateThumbs=function(){if(this.thumbs&&this.thumbs.length){var e=!1;this._setRange();var t=this.$main.scrollTop(),n=this.$main.height(),i=t+n;e&&console.log("scrollTop %s, scrollBottom %s",t,i);for(var r=this.getAllThumbs(),o=0;o<r.length;o++){var s=$(r[o]),a=s.position().top,u=s.outerHeight(),c=a+u;if(e){var l=s.find("span:visible");l.empty().append("t: "+a+", b: "+c)}this.isChunkedResizingEnabled()||this.sizeThumb(s);var h=u*this.options.galleryThumbLoadPadding;i+h>=a&&c>=t-h?(this.isChunkedResizingEnabled()&&this.sizeThumb(s),s.removeClass("outsideScrollArea"),e&&l.append(", i: true"),this.loadThumb(s)):(s.addClass("outsideScrollArea"),e&&l.append(", i: false"))}}},t.prototype.isChunkedResizingEnabled=function(){return this.options.galleryThumbChunkedResizingEnabled&&this.thumbs.length>this.options.galleryThumbChunkedResizingThreshold?!0:!1},t.prototype.sizeThumb=function(e){var t=e.find(".wrap"),n=Number(e.data().initialwidth),i=Number(e.data().initialheight),r=e.find(".label"),o=Math.floor(n*this.range),s=Math.floor(i*this.range);t.outerWidth(o),t.outerHeight(s),r.outerWidth(o)},t.prototype.loadThumb=function(e,t){var n=e.find(".wrap");if(!n.hasClass("loading")&&!n.hasClass("loaded")){e.removeClass("preLoad");var i=e.attr("data-visible"),r=this.options.thumbsImageFadeInDuration;if("false"!==i){n.addClass("loading");var o=e.attr("data-src"),s=$('<img class="thumbImage" src="'+o+'" />');$(s).hide().load(function(){$(this).fadeIn(r,function(){$(this).parent().swapClass("loading","loaded")})}),n.prepend(s),t&&t(s)}else n.addClass("hidden")}},t.prototype.show=function(){var e=this;this.isOpen=!0,this.$element.show(),setTimeout(function(){e.selectIndex(e.provider.canvasIndex),e.scrollToThumb(e.getSelectedThumbIndex())},10)},t.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},t.prototype.setLabel=function(){this.isPageModeEnabled()?($(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").show()):($(this.$thumbs).find("span.index").show(),$(this.$thumbs).find("span.label").hide())},t.prototype.isPageModeEnabled=function(){return"function"==typeof this.extension.getMode?this.config.options.pageModeEnabled&&this.extension.getMode().toString()===o.page.toString():this.config.options.pageModeEnabled},t.prototype.selectIndex=function(e){-1!==e&&this.thumbs&&this.thumbs.length&&(e=parseInt(e),this.getAllThumbs().removeClass("selected"),this.$selectedThumb=this.getThumbByIndex(e),this.$selectedThumb.addClass("selected"),this.updateThumbs())},t.prototype._setMultiSelectionEnabled=function(e){for(var t=0;t<this.thumbs.length;t++){var n=this.thumbs[t];n.multiSelectionEnabled=e}},t.prototype._reset=function(){this.$thumbs.undelegate(".thumb","click"),this._setMultiSelectionEnabled(this.multiSelectState.enabled)},t.prototype.getSelectedThumbIndex=function(){return Number(this.$selectedThumb.data("index"))},t.prototype.getAllThumbs=function(){return this.$thumbs.find(".thumb")},t.prototype.getThumbByIndex=function(e){return $(this.getAllThumbs()[e])},t.prototype.scrollToThumb=function(e){var t=this.getThumbByIndex(e);this.$main.scrollTop(t.position().top)},t.prototype.searchPreviewStart=function(e){this.scrollToThumb(e);var t=this.getThumbByIndex(e);t.addClass("searchpreview")},t.prototype.searchPreviewFinish=function(){this.scrollToThumb(this.provider.canvasIndex),this.getAllThumbs().removeClass("searchpreview")},t.prototype.resize=function(){e.prototype.resize.call(this),this.$main.height(this.$element.height()-this.$header.height())},t}(i);return s});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-contentleftpanel-module/ThumbsView",["require","exports","../uv-shared-module/ThumbsView","../../extensions/uv-seadragon-extension/Commands","../../extensions/uv-seadragon-extension/Mode"],function(e,t,n,i,r){var o=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("contentLeftPanel"),e.prototype.create.call(this),$.subscribe(i.MODE_CHANGED,function(e,n){t.setLabel()}),$.subscribe(i.SEARCH_PREVIEW_START,function(e,n){t.searchPreviewStart(n)}),$.subscribe(i.SEARCH_PREVIEW_FINISH,function(){t.searchPreviewFinish()}),this.provider.isPaged()&&this.$thumbs.addClass("paged");var n=this;$.views.helpers({separator:function(){return n.provider.isVerticallyAligned()?!0:n.provider.isPaged()?(this.data.index-1)%2==0?!1:!0:!1}})},t.prototype.addSelectedClassToThumbs=function(e){var t=this;if(this.provider.isPagingSettingEnabled()){var n=this.provider.getPagedIndices(e);_.each(n,function(e){t.getThumbByIndex(e).addClass("selected")})}else this.getThumbByIndex(e).addClass("selected")},t.prototype.isPageModeEnabled=function(){return"function"==typeof this.extension.getMode?this.config.options.pageModeEnabled&&this.extension.getMode().toString()===r.page.toString():this.config.options.pageModeEnabled},t.prototype.searchPreviewStart=function(e){this.scrollToThumb(e);var t=this.getThumbByIndex(e);t.addClass("searchpreview")},t.prototype.searchPreviewFinish=function(){this.scrollToThumb(this.provider.canvasIndex),this.getAllThumbs().removeClass("searchpreview")},t.prototype.setLabel=function(){this.isPDF()?($(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").hide()):this.isPageModeEnabled()?($(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").show()):($(this.$thumbs).find("span.index").show(),$(this.$thumbs).find("span.label").hide())},t}(n);return o}),define("extensions/uv-seadragon-extension/TreeSortType",["require","exports"],function(e,t){var n;return function(e){e[e.date=0]="date",e[e.none=1]="none"}(n||(n={})),n});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-contentleftpanel-module/TreeView",["require","exports","../uv-shared-module/BaseView","../../extensions/uv-seadragon-extension/Commands"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t,!0,!0),this.isOpen=!1}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this);var n=this;$.subscribe(i.ENTER_MULTISELECT_MODE,function(){t.dataBind()}),$.subscribe(i.MULTISELECT_CHANGE,function(e,n){t._multiSelectStateChange(n)}),this.$tree=$('<ul class="tree"></ul>'),this.$element.append(this.$tree),$.templates({pageTemplate:"{^{for nodes}}                               {^{tree/}}                           {{/for}}",treeTemplate:'<li>                               {^{if nodes && nodes.length}}                                   <div class="toggle" data-link="class{merge:expanded toggle=\'expanded\'}"></div>                               {{else}}                               <div class="spacer"></div>                               {{/if}}                               {^{if multiSelectionEnabled}}                                    <input id="tree-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? \'checked\' : \'\'}" class="multiSelect" />                               {{/if}}                               {^{if selected}}                                   <a id="tree-link-{{>id}}" href="#" title="{{>label}}" class="selected" data-link="~elide(text)"></a>                               {{else}}                                   <a id="tree-link-{{>id}}" href="#" title="{{>label}}" data-link="~elide(text)"></a>                               {{/if}}                           </li>                           {^{if expanded}}                               <li>                                   <ul>                                       {^{for nodes}}                                           {^{tree/}}                                       {{/for}}                                   </ul>                               </li>                           {{/if}}'}),$.views.helpers({elide:function(e){var t=$(this.linkCtx.elem),n=Math.floor(t.parent().width()/7);return Utils.Strings.htmlDecode(Utils.Strings.ellipsis(e,n))}}),$.views.tags({tree:{toggleExpanded:function(){n._setNodeExpanded(this.data,!this.data.expanded)},toggleMultiSelect:function(){n._multiSelectTreeNode(this.data,!this.data.multiSelected),n._updateParentNodes(this.data)},init:function(e,t,n){var i=e.view.data;i.text=i.label,this.data=e.view.data},onAfterLink:function(){var e=this;e.contents("li").first().on("click",".toggle",function(){e.toggleExpanded()}).on("click","a",function(t){t.preventDefault(),e.data.nodes.length&&e.toggleExpanded(),n.multiSelectState.enabled?e.toggleMultiSelect():$.publish(i.TREE_NODE_SELECTED,[e.data.data])}).on("click","input.multiSelect",function(t){e.toggleMultiSelect()})},template:$.templates.treeTemplate}})},t.prototype.dataBind=function(){this.rootNode&&(this._reset(),this.$tree.link($.templates.pageTemplate,this.rootNode),this.resize())},t.prototype._multiSelectStateChange=function(e){this.multiSelectState=e;for(var t=0;t<this.multiSelectState.ranges.length;t++){var n=this.multiSelectState.ranges[t],i=this._getMultiSelectableNodes().en().where(function(e){return e.data.id===n.id}).first();this._setNodeMultiSelected(i,n.multiSelected)}this.dataBind()},t.prototype._reset=function(){this.allNodes=null,this.multiSelectableNodes=null,this._setMultiSelectionEnabled(this.multiSelectState.enabled)},t.prototype.allNodesSelected=function(){var e=this._getMultiSelectableNodes(),t=this.getMultiSelectedNodes();return e.length===t.length},t.prototype._getMultiSelectableNodes=function(){var e=this;return this.multiSelectableNodes?this.multiSelectableNodes:this.multiSelectableNodes=this._getAllNodes().en().where(function(t){return e._nodeIsMultiSelectable(t)}).toArray()},t.prototype._nodeIsMultiSelectable=function(e){return e.isManifest()&&e.nodes.length>0||e.isRange()},t.prototype._getAllNodes=function(){return this.allNodes?this.allNodes:this.allNodes=this.rootNode.nodes.en().traverseUnique(function(e){return e.nodes}).toArray()},t.prototype.getMultiSelectedNodes=function(){var e=this;return this._getAllNodes().en().where(function(t){return e._nodeIsMultiSelectable(t)&&t.multiSelected}).toArray()},t.prototype.getNodeById=function(e){return this._getAllNodes().en().where(function(t){return t.id===e}).first()},t.prototype._multiSelectTreeNode=function(e,t){if(this._nodeIsMultiSelectable(e)){this._setNodeMultiSelected(e,t),$.publish(i.TREE_NODE_MULTISELECTED,[e]);for(var n=0;n<e.nodes.length;n++){var r=e.nodes[n];this._multiSelectTreeNode(r,t)}}},t.prototype._updateParentNodes=function(e){var t=e.parentNode;if(t){e.selected&&this._expandParents(e);var n=t.nodes.en().where(function(e){return e.multiSelected}).count();this._setNodeMultiSelected(t,n>0);var i=n>0&&n<t.nodes.length;this._setNodeIndeterminate(t,i),this._updateParentNodes(t)}},t.prototype._expandParents=function(e){e.parentNode&&(this._setNodeExpanded(e.parentNode,!0),this._expandParents(e.parentNode))},t.prototype._setNodeSelected=function(e,t){$.observable(e).setProperty("selected",t)},t.prototype._setNodeExpanded=function(e,t){$.observable(e).setProperty("expanded",t)},t.prototype._setNodeMultiSelected=function(e,t){$.observable(e).setProperty("multiSelected",t),t||this._setNodeIndeterminate(e,!1)},t.prototype._setNodeIndeterminate=function(e,t){var n=this._getNodeCheckbox(e);n.prop("indeterminate",t)},t.prototype._getNodeCheckbox=function(e){return $("#tree-checkbox-"+e.id)},t.prototype._getNodeSiblings=function(e){var t=[];return e.parentNode&&(t=e.parentNode.nodes.en().where(function(t){return t!==e}).toArray()),t},t.prototype._setMultiSelectionEnabled=function(e){for(var t=this._getAllNodes(),n=0;n<t.length;n++){var i=t[n];this._nodeIsMultiSelectable(i)&&(i.multiSelectionEnabled=e)}},t.prototype.selectPath=function(e){if(this.rootNode){var t=e.split("/");t.length>=1&&t.shift();var n=this.getNodeByPath(this.rootNode,t);this.selectNode(n)}},t.prototype.deselectCurrentNode=function(){this.selectedNode&&this._setNodeSelected(this.selectedNode,!1)},t.prototype.selectNode=function(e){this.rootNode&&(this.deselectCurrentNode(),this.selectedNode=e,this._setNodeSelected(this.selectedNode,!0),this._updateParentNodes(this.selectedNode))},t.prototype.getNodeByPath=function(e,t){if(0===t.length)return e;var n=t.shift(),i=e.nodes[n];return this.getNodeByPath(i,t)},t.prototype.show=function(){this.isOpen=!0,this.$element.show()},t.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},t.prototype.elide=function(e){if(e.is(":visible")){var t=Math.floor(e.parent().width()/7);e.text(Utils.Strings.htmlDecode(Utils.Strings.ellipsis(e.attr("title"),t)))}},t.prototype.elideAll=function(){var e=this;this.$tree.find("a").each(function(){var t=$(this);e.elide(t)})},t.prototype.resize=function(){e.prototype.resize.call(this),this.elideAll()},t}(n);return r}),define("modules/uv-shared-module/MultiSelectState",["require","exports"],function(e,t){var n=function(){function e(){}return e}();return n});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-contentleftpanel-module/ContentLeftPanel",["require","exports","../uv-shared-module/BaseCommands","../../extensions/uv-seadragon-extension/Commands","./GalleryView","../uv-shared-module/LeftPanel","./ThumbsView","../../extensions/uv-seadragon-extension/TreeSortType","./TreeView","../uv-shared-module/MultiSelectState"],function(e,t,n,i,r,o,s,a,u,c){var l=function(e){function t(t){e.call(this,t),this.isTreeViewOpen=!1,this.isThumbsViewOpen=!1}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("contentLeftPanel"),e.prototype.create.call(this);var r=this;$.subscribe(n.SETTINGS_CHANGED,function(){t.dataBind()}),$.subscribe(i.GALLERY_THUMB_SELECTED,function(){t.collapseFull()}),$.subscribe(n.CANVAS_INDEX_CHANGED,function(e,n){t.isFullyExpanded&&t.collapseFull(),t.selectCurrentTreeNode()}),$.subscribe(i.ENTER_MULTISELECT_MODE,function(e,n){r._reset(),r.multiSelectState.enabled=!0,t._publishMultiSelectStateChange(),r.setTitle(r.content.selection),r.isFullyExpanded?t._showMultiSelectOptions():r.expandFull(),t.$selectButton.text(n)}),$.subscribe(i.EXIT_MULTISELECT_MODE,function(){r._reset(),r.multiSelectState.enabled=!1,$.publish(i.MULTISELECT_CHANGE,[r.multiSelectState]),r.setTitle(r.content.title),r.$multiSelectOptions.hide()}),$.subscribe(n.LEFTPANEL_COLLAPSE_FULL_START,function(){r.multiSelectState.enabled&&$.publish(i.EXIT_MULTISELECT_MODE)}),$.subscribe(n.LEFTPANEL_EXPAND_FULL_START,function(){r.multiSelectState.enabled&&r._showMultiSelectOptions()}),$.subscribe(i.TREE_NODE_MULTISELECTED,function(e,n){n.isRange()&&t._updateRangeMultiSelectState(n.data,n.multiSelected)}),$.subscribe(i.THUMB_MULTISELECTED,function(e,n){var i=t.provider.getCanvasRange(n.data);i&&t._updateRangeMultiSelectState(i,n.multiSelected),t._updateCanvasMultiSelectState(n.data,n.multiSelected)}),this.$tabs=$('<div class="tabs"></div>'),this.$main.append(this.$tabs),this.$treeButton=$('<a class="index tab">'+this.content.index+"</a>"),this.$treeButton.prop("title",this.content.index),this.$tabs.append(this.$treeButton),this.$thumbsButton=$('<a class="thumbs tab">'+this.content.thumbnails+"</a>"),this.$thumbsButton.prop("title",this.content.thumbnails),this.$tabs.append(this.$thumbsButton),this.$tabsContent=$('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$options=$('<div class="options"></div>'),this.$tabsContent.append(this.$options),this.$leftOptions=$('<div class="left"></div>'),this.$options.append(this.$leftOptions),this.$rightOptions=$('<div class="right"></div>'),this.$options.append(this.$rightOptions),this.$treeViewOptions=$('<div class="treeView"></div>'),this.$leftOptions.append(this.$treeViewOptions),this.$sortByLabel=$('<span class="sort">'+this.content.sortBy+"</span>"),this.$treeViewOptions.append(this.$sortByLabel),this.$sortButtonGroup=$('<div class="btn-group"></div>'),this.$treeViewOptions.append(this.$sortButtonGroup),this.$sortByDateButton=$('<button class="btn">'+this.content.date+"</button>"),this.$sortButtonGroup.append(this.$sortByDateButton),this.$sortByVolumeButton=$('<button class="btn">'+this.content.volume+"</button>"),this.$sortButtonGroup.append(this.$sortByVolumeButton),this.$multiSelectOptions=$('<div class="multiSelect"></div>'),this.$rightOptions.append(this.$multiSelectOptions),this.$selectAllButton=$('<div class="multiSelectAll"><input id="multiSelectAll" type="checkbox" /><label for="multiSelectAll">'+this.content.selectAll+"</label></div>"),this.$multiSelectOptions.append(this.$selectAllButton),this.$selectAllButtonCheckbox=$(this.$selectAllButton.find("input:checkbox")),this.$selectButton=$('<a class="btn btn-primary">'+this.content.select+"</a>"),this.$multiSelectOptions.append(this.$selectButton),this.$views=$('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$treeView=$('<div class="treeView"></div>'),this.$views.append(this.$treeView),this.$thumbsView=$('<div class="thumbsView"></div>'),this.$views.append(this.$thumbsView),this.$galleryView=$('<div class="galleryView"></div>'),this.$views.append(this.$galleryView),this.$multiSelectOptions.hide(),this.$sortByDateButton.on("click",function(){t.sortByDate()}),this.$sortByVolumeButton.on("click",function(){t.sortByVolume()}),this.$treeViewOptions.hide(),this.$treeButton.onPressed(function(){t.openTreeView(),$.publish(i.OPEN_TREE_VIEW)}),this.$thumbsButton.onPressed(function(){t.openThumbsView(),$.publish(i.OPEN_THUMBS_VIEW)}),this.$selectAllButton.checkboxButton(function(e){t._multiSelectAll(e)}),this.$selectButton.on("click",function(){var e=_.map(r._getAllSelectedCanvases(),function(e){return e.id});$.publish(i.MULTISELECTION_MADE,[e])}),this.$expandButton.attr("tabindex","7"),this.$collapseButton.attr("tabindex","7"),this.$expandFullButton.attr("tabindex","8"),this.setTitle(this.content.title),this.$sortByVolumeButton.addClass("on");var o=this.options.tabOrder;if(o){o=o.toLowerCase(),o=o.replace(/ /g,"");var s=o.split(",");"thumbs"===s[0]?(this.$treeButton.before(this.$thumbsButton),this.$thumbsButton.addClass("first")):this.$treeButton.addClass("first")}this._reset()},t.prototype.createTreeView=function(){this.treeView=new u(this.$treeView),this.treeView.elideCount=this.config.options.elideCount,this.treeView.multiSelectState=this.multiSelectState,this.dataBindTreeView(),this.updateTreeViewOptions()},t.prototype.dataBind=function(){this._reset(),this.dataBindThumbsView(),this.dataBindTreeView(),this.dataBindGalleryView()},t.prototype._reset=function(){this.multiSelectState=new c,this.multiSelectState.ranges=this.provider.getRanges(),this.multiSelectState.canvases=this.provider.getCurrentSequence().getCanvases()},t.prototype._showMultiSelectOptions=function(){this.$multiSelectOptions.show(),this.resize()},t.prototype.updateTreeViewOptions=function(){this.isCollection()&&this.treeData.nodes.length&&!isNaN(this.treeData.nodes[0].navDate.getTime())?this.$treeViewOptions.show():this.$treeViewOptions.hide()},t.prototype._multiSelectAll=function(e){this._multiSelectRanges(this.multiSelectState.ranges,e),this._multiSelectCanvases(this.multiSelectState.canvases,e),this._publishMultiSelectStateChange()},t.prototype._multiSelectRanges=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];i.multiSelected=t;var r=this._getCanvasesByIds(i.getCanvasIds());this._multiSelectCanvases(r,t)}},t.prototype._multiSelectCanvases=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];i.multiSelected=t}},t.prototype._getCanvasById=function(e){return this.multiSelectState.canvases.en().where(function(t){return t.id===e}).first()},t.prototype._getCanvasesByIds=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push(this._getCanvasById(i))}return t},t.prototype._updateRangeMultiSelectState=function(e,t){var n=this.multiSelectState.ranges.en().where(function(t){return t.id===e.id}).first();n.multiSelected=t;var i=this.provider.getRangeCanvases(n);this._multiSelectCanvases(i,t),this._publishMultiSelectStateChange()},t.prototype._updateCanvasMultiSelectState=function(e,t){var n=this.multiSelectState.canvases.en().where(function(t){return t.id===e.id}).first();n.multiSelected=t,this._publishMultiSelectStateChange()},t.prototype._publishMultiSelectStateChange=function(){this.$selectAllButtonCheckbox.prop("checked",this._allRangesSelected()&&this._allCanvasesSelected()),$.publish(i.MULTISELECT_CHANGE,[this.multiSelectState])},t.prototype._allRangesSelected=function(){return this._getAllSelectedRanges().length===this.multiSelectState.ranges.length},t.prototype._getAllSelectedRanges=function(){return this.multiSelectState.ranges.en().where(function(e){return e.multiSelected}).toArray()},t.prototype._allCanvasesSelected=function(){return this._getAllSelectedCanvases().length===this.multiSelectState.canvases.length},t.prototype._getAllSelectedCanvases=function(){return this.multiSelectState.canvases.en().where(function(e){return e.multiSelected}).toArray()},t.prototype.sortByDate=function(){this.treeView.rootNode=this.provider.getSortedTree(a.date),this.treeView.dataBind(),this.selectCurrentTreeNode(),this.$sortByDateButton.addClass("on"),this.$sortByVolumeButton.removeClass("on"),this.resize()},t.prototype.sortByVolume=function(){this.treeView.rootNode=this.provider.getSortedTree(a.none),this.treeView.dataBind(),this.selectCurrentTreeNode(),this.$sortByDateButton.removeClass("on"),this.$sortByVolumeButton.addClass("on"),this.resize()},t.prototype.isCollection=function(){return this.treeData.data.type===manifesto.TreeNodeType.collection().toString()},t.prototype.dataBindTreeView=function(){this.treeView&&(this.treeView.rootNode=this.treeData,this.treeView.dataBind(),this._publishMultiSelectStateChange())},t.prototype.createThumbsView=function(){this.thumbsView=new s(this.$thumbsView),this.dataBindThumbsView()},t.prototype.dataBindThumbsView=function(){if(this.thumbsView){var e,t,n=this.provider.getViewingDirection().toString();n===manifesto.ViewingDirection.topToBottom().toString()||n===manifesto.ViewingDirection.bottomToTop().toString()?(e=this.config.options.oneColThumbWidth,t=this.config.options.oneColThumbHeight):(e=this.config.options.twoColThumbWidth,t=this.config.options.twoColThumbHeight),this.thumbsView.thumbs=this.provider.getThumbs(e,t),this.thumbsView.dataBind()}},t.prototype.createGalleryView=function(){this.galleryView=new r(this.$galleryView),this.galleryView.multiSelectState=this.multiSelectState,this.dataBindGalleryView()},t.prototype.dataBindGalleryView=function(){if(this.galleryView){var e=this.config.options.galleryThumbWidth,t=this.config.options.galleryThumbHeight;this.galleryView.thumbs=this.provider.getThumbs(e,t),this.galleryView.dataBind(),this._publishMultiSelectStateChange()}},t.prototype.toggleFinish=function(){if(e.prototype.toggleFinish.call(this),this.isUnopened){var t=Utils.Bools.getBool(this.config.options.treeEnabled,!0),n=Utils.Bools.getBool(this.config.options.thumbsEnabled,!0);this.treeData="function"==typeof this.provider.getSortedTree?this.provider.getSortedTree(a.none):null,this.treeData&&this.treeData.nodes.length||(t=!1),t&&n||this.$tabs.hide(),n&&this.defaultToThumbsView()?this.openThumbsView():t&&this.openTreeView()}this.isExpanded?(this.$treeButton.attr("tabindex","9"),this.$thumbsButton.attr("tabindex","10")):(this.$treeButton.attr("tabindex",""),this.$thumbsButton.attr("tabindex",""))},t.prototype.defaultToThumbsView=function(){var e=Utils.Bools.getBool(this.config.options.defaultToTreeEnabled,!1),t=this.config.options.defaultToTreeIfGreaterThan||0;return e&&this.treeData.nodes.length>t?!1:!0},t.prototype.expandFullStart=function(){e.prototype.expandFullStart.call(this),$.publish(n.LEFTPANEL_EXPAND_FULL_START)},t.prototype.expandFullFinish=function(){e.prototype.expandFullFinish.call(this),this.$treeButton.hasClass("on")?this.openTreeView():this.$thumbsButton.hasClass("on")&&this.openThumbsView(),$.publish(n.LEFTPANEL_EXPAND_FULL_FINISH)},t.prototype.collapseFullStart=function(){e.prototype.collapseFullStart.call(this),$.publish(n.LEFTPANEL_COLLAPSE_FULL_START)},t.prototype.collapseFullFinish=function(){e.prototype.collapseFullFinish.call(this),this.$thumbsButton.hasClass("on")&&this.openThumbsView(),$.publish(n.LEFTPANEL_COLLAPSE_FULL_FINISH)},t.prototype.openTreeView=function(){var e=this;this.isTreeViewOpen=!0,this.isThumbsViewOpen=!1,this.treeView||this.createTreeView(),this.$treeButton.addClass("on"),this.$thumbsButton.removeClass("on"),this.treeView.show(),setTimeout(function(){var t=e.provider.getCanvasRange(e.provider.getCurrentCanvas());e.treeView&&t&&t.treeNode&&e.treeView.selectNode(t.treeNode)},1),this.thumbsView&&this.thumbsView.hide(),this.galleryView&&this.galleryView.hide(),this.updateTreeViewOptions(),this.selectCurrentTreeNode(),this.resize(),this.treeView.resize()},t.prototype.openThumbsView=function(){this.isTreeViewOpen=!1,this.isThumbsViewOpen=!0,this.thumbsView||this.createThumbsView(),this.isFullyExpanded&&!this.galleryView&&this.createGalleryView(),this.$treeButton.removeClass("on"),this.$thumbsButton.addClass("on"),this.treeView&&this.treeView.hide(),this.$treeViewOptions.hide(),this.resize(),this.isFullyExpanded?(this.thumbsView.hide(),this.galleryView&&this.galleryView.show(),
this.galleryView&&this.galleryView.resize()):(this.galleryView&&this.galleryView.hide(),this.thumbsView.show(),this.thumbsView.resize())},t.prototype.selectCurrentTreeNode=function(){if(this.treeView){var e,t,n=this.provider.getCanvasRange(this.provider.getCurrentCanvas());n&&(e=n.treeNode.id,t=this.treeView.getNodeById(e)),t||(e=this.provider.manifest.treeRoot.id,t=this.treeView.getNodeById(e)),t&&this.treeView.selectNode(t)}},t.prototype.resize=function(){e.prototype.resize.call(this),this.$tabsContent.height(this.$main.height()-(this.$tabs.is(":visible")?this.$tabs.height():0)-this.$tabsContent.verticalPadding()),this.$views.height(this.$tabsContent.height()-this.$options.outerHeight())},t}(o);return l});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-seadragon-extension/Extension",["require","exports","../../modules/uv-shared-module/BaseCommands","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","./Commands","./DownloadDialogue","./EmbedDialogue","../../modules/uv-dialogues-module/ExternalContentDialogue","../../modules/uv-searchfooterpanel-module/FooterPanel","../../modules/uv-dialogues-module/HelpDialogue","./Mode","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-pagingheaderpanel-module/PagingHeaderPanel","../../Params","./PrintArgs","../../modules/uv-seadragoncenterpanel-module/SeadragonCenterPanel","./SettingsDialogue","../../modules/uv-shared-module/Shell","../../modules/uv-contentleftpanel-module/ContentLeftPanel"],function(e,t,n,i,r,o,s,a,u,c,l,h,p,d,f,g,m,v,y,b){var E=function(e){function t(t){e.call(this,t),this.currentRotation=0}return __extends(t,e),t.prototype.create=function(t){var i=this;e.prototype.create.call(this,t);var r=this;$.subscribe(o.CLEAR_SEARCH,function(e){i.triggerSocket(o.CLEAR_SEARCH)}),$.subscribe(n.DOWN_ARROW,function(e){i.useArrowKeysToNavigate()||i.centerPanel.setFocus()}),$.subscribe(n.END,function(e){i.viewPage(i.provider.getLastPageIndex())}),$.subscribe(o.FIRST,function(e){i.triggerSocket(o.FIRST),i.viewPage(i.provider.getFirstPageIndex())}),$.subscribe(o.GALLERY_DECREASE_SIZE,function(e){i.triggerSocket(o.GALLERY_DECREASE_SIZE)}),$.subscribe(o.GALLERY_INCREASE_SIZE,function(e){i.triggerSocket(o.GALLERY_INCREASE_SIZE)}),$.subscribe(o.GALLERY_THUMB_SELECTED,function(e){i.triggerSocket(o.GALLERY_THUMB_SELECTED)}),$.subscribe(n.HOME,function(e){i.viewPage(i.provider.getFirstPageIndex())}),$.subscribe(o.IMAGE_SEARCH,function(e,t){i.triggerSocket(o.IMAGE_SEARCH,t),i.viewPage(t)}),$.subscribe(o.LAST,function(e){i.triggerSocket(o.LAST),i.viewPage(i.provider.getLastPageIndex())}),$.subscribe(n.LEFT_ARROW,function(e){i.useArrowKeysToNavigate()?i.viewPage(i.provider.getPrevPageIndex()):i.centerPanel.setFocus()}),$.subscribe(n.LEFTPANEL_COLLAPSE_FULL_FINISH,function(e){y.$centerPanel.show(),y.$rightPanel.show(),i.resize()}),$.subscribe(n.LEFTPANEL_EXPAND_FULL_START,function(e){y.$centerPanel.hide(),y.$rightPanel.hide()}),$.subscribe(n.MINUS,function(e){i.centerPanel.setFocus()}),$.subscribe(o.MODE_CHANGED,function(e,t){i.triggerSocket(o.MODE_CHANGED,t),i.mode=new h(t);var r=i.provider.getSettings();$.publish(n.SETTINGS_CHANGED,[r])}),$.subscribe(o.MULTISELECTION_MADE,function(e,t){i.triggerSocket(o.MULTISELECTION_MADE,t)}),$.subscribe(o.NEXT,function(e){i.triggerSocket(o.NEXT),i.viewPage(i.provider.getNextPageIndex())}),$.subscribe(o.NEXT_SEARCH_RESULT,function(){i.triggerSocket(o.NEXT_SEARCH_RESULT),i.nextSearchResult()}),$.subscribe(o.OPEN_THUMBS_VIEW,function(e){i.triggerSocket(o.OPEN_THUMBS_VIEW)}),$.subscribe(o.OPEN_TREE_VIEW,function(e){i.triggerSocket(o.OPEN_TREE_VIEW)}),$.subscribe(n.PAGE_DOWN,function(e){i.viewPage(i.provider.getNextPageIndex())}),$.subscribe(o.PAGE_SEARCH,function(e,t){i.triggerSocket(o.PAGE_SEARCH,t),i.viewLabel(t)}),$.subscribe(n.PAGE_UP,function(e){i.viewPage(i.provider.getPrevPageIndex())}),$.subscribe(o.PAGING_TOGGLED,function(e,t){i.triggerSocket(o.PAGING_TOGGLED,t)}),$.subscribe(n.PLUS,function(e){i.centerPanel.setFocus()}),$.subscribe(o.PREV,function(e){i.triggerSocket(o.PREV),i.viewPage(i.provider.getPrevPageIndex())}),$.subscribe(o.PREV_SEARCH_RESULT,function(){i.triggerSocket(o.PREV_SEARCH_RESULT),i.prevSearchResult()}),$.subscribe(o.PRINT,function(){i.print()}),$.subscribe(n.RIGHT_ARROW,function(e){i.useArrowKeysToNavigate()?i.viewPage(i.provider.getNextPageIndex()):i.centerPanel.setFocus()}),$.subscribe(o.SEADRAGON_ANIMATION,function(){i.triggerSocket(o.SEADRAGON_ANIMATION)}),$.subscribe(o.SEADRAGON_ANIMATION_FINISH,function(e,t){i.centerPanel&&i.centerPanel.currentBounds&&i.setParam(f.zoom,i.centerPanel.serialiseBounds(i.centerPanel.currentBounds));var n=i.provider.getCurrentCanvas();i.triggerSocket(o.CURRENT_VIEW_URI,{cropUri:r.provider.getCroppedImageUri(n,i.getViewer()),fullUri:r.provider.getConfinedImageUri(n,n.getWidth(),n.getHeight())})}),$.subscribe(o.SEADRAGON_ANIMATION_START,function(){i.triggerSocket(o.SEADRAGON_ANIMATION_START)}),$.subscribe(o.SEADRAGON_OPEN,function(){i.useArrowKeysToNavigate()||i.centerPanel.setFocus()}),$.subscribe(o.SEADRAGON_RESIZE,function(){i.triggerSocket(o.SEADRAGON_RESIZE)}),$.subscribe(o.SEADRAGON_ROTATION,function(e,t){i.triggerSocket(o.SEADRAGON_ROTATION),i.currentRotation=t,i.setParam(f.rotation,t)}),$.subscribe(o.SEARCH,function(e,t){i.triggerSocket(o.SEARCH,t),i.searchWithin(t)}),$.subscribe(o.SEARCH_PREVIEW_FINISH,function(e){i.triggerSocket(o.SEARCH_PREVIEW_FINISH)}),$.subscribe(o.SEARCH_PREVIEW_START,function(e){i.triggerSocket(o.SEARCH_PREVIEW_START)}),$.subscribe(o.SEARCH_RESULTS,function(e,t){i.triggerSocket(o.SEARCH_RESULTS,t)}),$.subscribe(o.SEARCH_RESULTS_EMPTY,function(e){i.triggerSocket(o.SEARCH_RESULTS_EMPTY)}),$.subscribe(n.THUMB_SELECTED,function(e,t){i.viewPage(t)}),$.subscribe(o.TREE_NODE_SELECTED,function(e,t){i.triggerSocket(o.TREE_NODE_SELECTED,t.path),i.treeNodeSelected(t)}),$.subscribe(n.UP_ARROW,function(e){i.useArrowKeysToNavigate()||i.centerPanel.setFocus()}),$.subscribe(n.UPDATE_SETTINGS,function(e){i.updateSettings()}),$.subscribe(o.VIEW_PAGE,function(e,t){i.triggerSocket(o.VIEW_PAGE,t),i.viewPage(t)}),Utils.Async.waitFor(function(){return i.centerPanel&&i.centerPanel.isCreated},function(){i.checkForSearchParam()})},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.headerPanel=new d(y.$headerPanel),this.isLeftPanelEnabled()?this.leftPanel=new b(y.$leftPanel):y.$leftPanel.hide(),this.centerPanel=new m(y.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new p(y.$rightPanel):y.$rightPanel.hide(),this.footerPanel=new c(y.$footerPanel),this.$helpDialogue=$('<div class="overlay help"></div>'),y.$overlays.append(this.$helpDialogue),this.helpDialogue=new l(this.$helpDialogue),this.$embedDialogue=$('<div class="overlay embed"></div>'),y.$overlays.append(this.$embedDialogue),this.embedDialogue=new a(this.$embedDialogue),this.$downloadDialogue=$('<div class="overlay download"></div>'),y.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new s(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings"></div>'),y.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new v(this.$settingsDialogue),this.$externalContentDialogue=$('<div class="overlay externalContent"></div>'),y.$overlays.append(this.$externalContentDialogue),this.externalContentDialogue=new u(this.$externalContentDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()},t.prototype.checkForSearchParam=function(){if(this.provider.isDeepLinkingEnabled()){var e=this.getParam(f.highlight);e&&(e.replace(/\+/g," ").replace(/"/g,""),$.publish(o.SEARCH,[e]))}},t.prototype.updateSettings=function(){this.viewPage(this.provider.canvasIndex,!0);var e=this.provider.getSettings();$.publish(n.SETTINGS_CHANGED,[e])},t.prototype.viewPage=function(e,t){if(-1!==e){if(this.provider.isCanvasIndexOutOfRange(e)&&(this.showMessage(this.provider.config.content.canvasIndexOutOfRange),e=0),this.provider.isPagingSettingEnabled()&&!t){var n=this.provider.getPagedIndices(e);if(n.contains(this.provider.canvasIndex))return void this.viewCanvas(e)}this.viewCanvas(e)}},t.prototype.getViewer=function(){return this.centerPanel.viewer},t.prototype.getMode=function(){if(this.mode)return this.mode;switch(this.provider.getManifestType().toString()){case manifesto.ManifestType.monograph().toString():return h.page;case manifesto.ManifestType.manuscript().toString():return h.page;default:return h.image}},t.prototype.getViewerBounds=function(){if(!this.centerPanel)return null;var e=this.centerPanel.getBounds();return e?this.centerPanel.serialiseBounds(e):""},t.prototype.getViewerRotation=function(){return this.centerPanel?this.currentRotation:null},t.prototype.viewRange=function(e){var t=this.provider.getRangeByPath(e);if(t){var n=t.getCanvasIds()[0],i=this.provider.getCanvasIndexById(n);this.viewPage(i)}},t.prototype.viewLabel=function(e){if(!e)return this.showMessage(this.provider.config.modules.genericDialogue.content.emptyValue),void $.publish(n.CANVAS_INDEX_CHANGE_FAILED);var t=this.provider.getCanvasIndexByLabel(e);-1!=t?this.viewPage(t):(this.showMessage(this.provider.config.modules.genericDialogue.content.pageNotFound),$.publish(n.CANVAS_INDEX_CHANGE_FAILED))},t.prototype.treeNodeSelected=function(e){if(e.type)switch(e.type){case manifesto.IIIFResourceType.manifest().toString():this.viewManifest(e);break;case manifesto.IIIFResourceType.collection().toString():this.viewCollection(e);break;default:this.viewRange(e.path)}},t.prototype.searchWithin=function(e){var t=this;this.provider.searchWithin(e,function(n){n.resources&&n.resources.length?($.publish(o.SEARCH_RESULTS,[{terms:e,results:n}]),t.viewPage(t.provider.canvasIndex,!0)):t.showMessage(t.provider.config.modules.genericDialogue.content.noMatches,function(){$.publish(o.SEARCH_RESULTS_EMPTY)})})},t.prototype.clearSearch=function(){this.provider.searchResults=[],this.viewPage(this.provider.canvasIndex)},t.prototype.prevSearchResult=function(){for(var e=this.provider.searchResults.length-1;e>=0;e--){var t=this.provider.searchResults[e];if(t.canvasIndex<this.provider.canvasIndex){this.viewPage(t.canvasIndex);break}}},t.prototype.nextSearchResult=function(){for(var e=0;e<this.provider.searchResults.length;e++){var t=this.provider.searchResults[e];if(t.canvasIndex>this.provider.canvasIndex){this.viewPage(t.canvasIndex);break}}},t.prototype.bookmark=function(){e.prototype.bookmark.call(this);var t=this.provider.getCurrentCanvas(),i=new r;i.index=this.provider.canvasIndex,i.label=t.getLabel(),i.path=this.provider.getCroppedImageUri(t,this.getViewer()),i.thumb=t.getCanonicalImageUri(this.provider.config.options.bookmarkThumbWidth),i.title=this.provider.getLabel(),i.trackingLabel=window.trackingLabel,i.type=manifesto.ElementType.image().toString(),this.triggerSocket(n.BOOKMARK,i)},t.prototype.print=function(){var e=new g;e.ids="all",e.mimeType=this.provider.config.options.printMimeType,this.triggerSocket(o.PRINT,e)},t}(i);return E});var Utils;!function(e){var t=function(){function e(){}return e.waitFor=function(t,n,i,r,o,s){r||(r=200),o||(o=100),s||(s=0),s+=1,s>o?i&&i():t()?n():setTimeout(function(){e.waitFor(t,n,i,r,o,s)},r)},e}();e.Async=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.getBool=function(e,t){return null===e||"undefined"==typeof e?t:e},e}();e.Bools=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.copy=function(e){var t=$("<div style='position:absolute;left:-9999px'>"),n=/<br\s*[\/]?>/gi;e=e.replace(n,"\n"),$("body").append(t),t.append(e);var i=$("<textarea>");t.append(i),i.val(t.text()).select(),document.execCommand("copy"),t.remove()},e.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},e}();e.Clipboard=t}(Utils||(Utils={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},Utils;!function(e){var t;!function(e){function t(e,t){return t>e?-1:e===t?0:1}function n(e,t){return e===t}function i(e){return null===e?"COLLECTION_NULL":l.isUndefined(e)?"COLLECTION_UNDEFINED":l.isString(e)?"$s"+e:"$o"+e.toString()}function r(e,t){if(void 0===t&&(t=","),null===e)return"COLLECTION_NULL";if(l.isUndefined(e))return"COLLECTION_UNDEFINED";if(l.isString(e))return e.toString();var n="{",i=!0;for(var r in e)p(e,r)&&(i?i=!1:n+=t,n=n+r+":"+e[r]);return n+"}"}function o(e){return"function"==typeof e}function s(e){return"undefined"==typeof e}function a(e){return"[object String]"===Object.prototype.toString.call(e)}function u(e){return l.isFunction(e)?function(t,n){return-1*e(t,n)}:function(e,t){return t>e?1:e===t?0:-1}}function c(e){return function(t,n){return 0===e(t,n)}}var l=e,h=Object.prototype.hasOwnProperty,p=function(e,t){return h.call(e,t)};e.defaultCompare=t,e.defaultEquals=n,e.defaultToString=i,e.makeString=r,e.isFunction=o,e.isUndefined=s,e.isString=a,e.reverseCompareFunction=u,e.compareToEquals=c;var d;!function(e){function t(e,t,n){for(var i=n||l.defaultEquals,r=e.length,o=0;r>o;o++)if(i(e[o],t))return o;return-1}function n(e,t,n){for(var i=n||l.defaultEquals,r=e.length,o=r-1;o>=0;o--)if(i(e[o],t))return o;return-1}function i(t,n,i){return e.indexOf(t,n,i)>=0}function r(t,n,i){var r=e.indexOf(t,n,i);return 0>r?!1:(t.splice(r,1),!0)}function o(e,t,n){for(var i=n||l.defaultEquals,r=e.length,o=0,s=0;r>s;s++)i(e[s],t)&&o++;return o}function s(e,t,n){var i=n||l.defaultEquals;if(e.length!==t.length)return!1;for(var r=e.length,o=0;r>o;o++)if(!i(e[o],t[o]))return!1;return!0}function a(e){return e.concat()}function u(e,t,n){if(0>t||t>=e.length||0>n||n>=e.length)return!1;var i=e[t];return e[t]=e[n],e[n]=i,!0}function c(e){return"["+e.toString()+"]"}function h(e,t){for(var n=e.length,i=0;n>i;i++)if(t(e[i])===!1)return}e.indexOf=t,e.lastIndexOf=n,e.contains=i,e.remove=r,e.frequency=o,e.equals=s,e.copy=a,e.swap=u,e.toString=c,e.forEach=h}(d=e.arrays||(e.arrays={}));var f=function(){function e(){this.firstNode=null,this.lastNode=null,this.nElements=0}return e.prototype.add=function(e,t){if(l.isUndefined(t)&&(t=this.nElements),0>t||t>this.nElements||l.isUndefined(e))return!1;var n=this.createNode(e);if(0===this.nElements)this.firstNode=n,this.lastNode=n;else if(t===this.nElements)this.lastNode.next=n,this.lastNode=n;else if(0===t)n.next=this.firstNode,this.firstNode=n;else{var i=this.nodeAtIndex(t-1);n.next=i.next,i.next=n}return this.nElements++,!0},e.prototype.first=function(){return null!==this.firstNode?this.firstNode.element:void 0},e.prototype.last=function(){return null!==this.lastNode?this.lastNode.element:void 0},e.prototype.elementAtIndex=function(e){var t=this.nodeAtIndex(e);if(null!==t)return t.element},e.prototype.indexOf=function(e,t){var n=t||l.defaultEquals;if(l.isUndefined(e))return-1;for(var i=this.firstNode,r=0;null!==i;){if(n(i.element,e))return r;r++,i=i.next}return-1},e.prototype.contains=function(e,t){return this.indexOf(e,t)>=0},e.prototype.remove=function(e,t){var n=t||l.defaultEquals;if(this.nElements<1||l.isUndefined(e))return!1;for(var i=null,r=this.firstNode;null!==r;){if(n(r.element,e))return r===this.firstNode?(this.firstNode=this.firstNode.next,r===this.lastNode&&(this.lastNode=null)):r===this.lastNode?(this.lastNode=i,i.next=r.next,r.next=null):(i.next=r.next,r.next=null),this.nElements--,!0;i=r,r=r.next}return!1},e.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},e.prototype.equals=function(e,t){var n=t||l.defaultEquals;return e instanceof l.LinkedList?this.size()!==e.size()?!1:this.equalsAux(this.firstNode,e.firstNode,n):!1},e.prototype.equalsAux=function(e,t,n){for(;null!==e;){if(!n(e.element,t.element))return!1;e=e.next,t=t.next}return!0},e.prototype.removeElementAtIndex=function(e){if(!(0>e||e>=this.nElements)){var t;if(1===this.nElements)t=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var n=this.nodeAtIndex(e-1);null===n?(t=this.firstNode.element,this.firstNode=this.firstNode.next):n.next===this.lastNode&&(t=this.lastNode.element,this.lastNode=n),null!==n&&(t=n.next.element,n.next=n.next.next)}return this.nElements--,t}},e.prototype.forEach=function(e){for(var t=this.firstNode;null!==t&&e(t.element)!==!1;)t=t.next},e.prototype.reverse=function(){for(var e=null,t=this.firstNode,n=null;null!==t;)n=t.next,t.next=e,e=t,t=n;n=this.firstNode,this.firstNode=this.lastNode,this.lastNode=n},e.prototype.toArray=function(){for(var e=[],t=this.firstNode;null!==t;)e.push(t.element),t=t.next;return e},e.prototype.size=function(){return this.nElements},e.prototype.isEmpty=function(){return this.nElements<=0},e.prototype.toString=function(){return l.arrays.toString(this.toArray())},e.prototype.nodeAtIndex=function(e){if(0>e||e>=this.nElements)return null;if(e===this.nElements-1)return this.lastNode;for(var t=this.firstNode,n=0;e>n;n++)t=t.next;return t},e.prototype.createNode=function(e){return{element:e,next:null}},e}();e.LinkedList=f;var g=function(){function e(e){this.table={},this.nElements=0,this.toStr=e||l.defaultToString}return e.prototype.getValue=function(e){var t=this.table["$"+this.toStr(e)];if(!l.isUndefined(t))return t.value},e.prototype.setValue=function(e,t){if(!l.isUndefined(e)&&!l.isUndefined(t)){var n,i="$"+this.toStr(e),r=this.table[i];return l.isUndefined(r)?(this.nElements++,n=void 0):n=r.value,this.table[i]={key:e,value:t},n}},e.prototype.remove=function(e){var t="$"+this.toStr(e),n=this.table[t];return l.isUndefined(n)?void 0:(delete this.table[t],this.nElements--,n.value)},e.prototype.keys=function(){var e=[];for(var t in this.table)if(p(this.table,t)){var n=this.table[t];e.push(n.key)}return e},e.prototype.values=function(){var e=[];for(var t in this.table)if(p(this.table,t)){var n=this.table[t];e.push(n.value)}return e},e.prototype.forEach=function(e){for(var t in this.table)if(p(this.table,t)){var n=this.table[t],i=e(n.key,n.value);if(i===!1)return}},e.prototype.containsKey=function(e){return!l.isUndefined(this.getValue(e))},e.prototype.clear=function(){this.table={},this.nElements=0},e.prototype.size=function(){return this.nElements},e.prototype.isEmpty=function(){return this.nElements<=0},e.prototype.toString=function(){var e="{";return this.forEach(function(t,n){e=e+"\n	"+t.toString()+" : "+n.toString()}),e+"\n}"},e}();e.Dictionary=g;var m=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},e}(),v=function(e){function t(t){e.call(this,t),this.head=new m(null,null),this.tail=new m(null,null),this.head.next=this.tail,this.tail.prev=this.head}return __extends(t,e),t.prototype.appendToTail=function(e){var t=this.tail.prev;t.next=e,e.prev=t,e.next=this.tail,this.tail.prev=e},t.prototype.getLinkedDictionaryPair=function(e){if(!l.isUndefined(e)){var t="$"+this.toStr(e),n=this.table[t];return n}},t.prototype.getValue=function(e){var t=this.getLinkedDictionaryPair(e);return l.isUndefined(t)?void 0:t.value},t.prototype.remove=function(t){var n=this.getLinkedDictionaryPair(t);return l.isUndefined(n)?void 0:(e.prototype.remove.call(this,t),n.unlink(),n.value)},t.prototype.clear=function(){e.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},t.prototype.replace=function(e,t){var n="$"+this.toStr(t.key);t.next=e.next,t.prev=e.prev,this.remove(e.key),t.prev.next=t,t.next.prev=t,this.table[n]=t,++this.nElements},t.prototype.setValue=function(e,t){if(!l.isUndefined(e)&&!l.isUndefined(t)){var n=this.getLinkedDictionaryPair(e),i=new m(e,t),r="$"+this.toStr(e);return l.isUndefined(n)?(this.appendToTail(i),this.table[r]=i,void++this.nElements):(this.replace(n,i),n.value)}},t.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(t)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},t.prototype.forEach=function(e){for(var t=this.head.next;null!=t.next;){var n=e(t.key,t.value);if(n===!1)return;t=t.next}},t}(g);e.LinkedDictionary=v;var y=function(){function e(e,t,n){void 0===n&&(n=!1),this.dict=new g(e),this.equalsF=t||l.defaultEquals,this.allowDuplicate=n}return e.prototype.getValue=function(e){var t=this.dict.getValue(e);return l.isUndefined(t)?[]:l.arrays.copy(t)},e.prototype.setValue=function(e,t){if(l.isUndefined(e)||l.isUndefined(t))return!1;if(!this.containsKey(e))return this.dict.setValue(e,[t]),!0;var n=this.dict.getValue(e);return!this.allowDuplicate&&l.arrays.contains(n,t,this.equalsF)?!1:(n.push(t),!0)},e.prototype.remove=function(e,t){if(l.isUndefined(t)){var n=this.dict.remove(e);return!l.isUndefined(n)}var i=this.dict.getValue(e);return l.arrays.remove(i,t,this.equalsF)?(0===i.length&&this.dict.remove(e),!0):!1},e.prototype.keys=function(){return this.dict.keys()},e.prototype.values=function(){for(var e=this.dict.values(),t=[],n=0;n<e.length;n++)for(var i=e[n],r=0;r<i.length;r++)t.push(i[r]);return t},e.prototype.containsKey=function(e){return this.dict.containsKey(e)},e.prototype.clear=function(){this.dict.clear()},e.prototype.size=function(){return this.dict.size()},e.prototype.isEmpty=function(){return this.dict.isEmpty()},e}();e.MultiDictionary=y;var b=function(){function e(e){this.data=[],this.compare=e||l.defaultCompare}return e.prototype.leftChildIndex=function(e){return 2*e+1},e.prototype.rightChildIndex=function(e){return 2*e+2},e.prototype.parentIndex=function(e){return Math.floor((e-1)/2)},e.prototype.minIndex=function(e,t){return t>=this.data.length?e>=this.data.length?-1:e:this.compare(this.data[e],this.data[t])<=0?e:t},e.prototype.siftUp=function(e){for(var t=this.parentIndex(e);e>0&&this.compare(this.data[t],this.data[e])>0;)l.arrays.swap(this.data,t,e),e=t,t=this.parentIndex(e)},e.prototype.siftDown=function(e){for(var t=this.minIndex(this.leftChildIndex(e),this.rightChildIndex(e));t>=0&&this.compare(this.data[e],this.data[t])>0;)l.arrays.swap(this.data,t,e),e=t,t=this.minIndex(this.leftChildIndex(e),this.rightChildIndex(e))},e.prototype.peek=function(){return this.data.length>0?this.data[0]:void 0},e.prototype.add=function(e){return l.isUndefined(e)?void 0:(this.data.push(e),this.siftUp(this.data.length-1),!0)},e.prototype.removeRoot=function(){if(this.data.length>0){var e=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),e}},e.prototype.contains=function(e){var t=l.compareToEquals(this.compare);return l.arrays.contains(this.data,e,t)},e.prototype.size=function(){return this.data.length},e.prototype.isEmpty=function(){return this.data.length<=0},e.prototype.clear=function(){this.data.length=0},e.prototype.forEach=function(e){l.arrays.forEach(this.data,e)},e}();e.Heap=b;var E=function(){function e(){this.list=new f}return e.prototype.push=function(e){return this.list.add(e,0)},e.prototype.add=function(e){return this.list.add(e,0)},e.prototype.pop=function(){return this.list.removeElementAtIndex(0)},e.prototype.peek=function(){return this.list.first()},e.prototype.size=function(){return this.list.size()},e.prototype.contains=function(e,t){return this.list.contains(e,t)},e.prototype.isEmpty=function(){return this.list.isEmpty()},e.prototype.clear=function(){this.list.clear()},e.prototype.forEach=function(e){this.list.forEach(e)},e}();e.Stack=E;var w=function(){function e(){this.list=new f}return e.prototype.enqueue=function(e){return this.list.add(e)},e.prototype.add=function(e){return this.list.add(e)},e.prototype.dequeue=function(){if(0!==this.list.size()){var e=this.list.first();return this.list.removeElementAtIndex(0),e}},e.prototype.peek=function(){return 0!==this.list.size()?this.list.first():void 0},e.prototype.size=function(){return this.list.size()},e.prototype.contains=function(e,t){return this.list.contains(e,t)},e.prototype.isEmpty=function(){return this.list.size()<=0},e.prototype.clear=function(){this.list.clear()},e.prototype.forEach=function(e){this.list.forEach(e)},e}();e.Queue=w;var S=function(){function e(e){this.heap=new b(l.reverseCompareFunction(e))}return e.prototype.enqueue=function(e){return this.heap.add(e)},e.prototype.add=function(e){return this.heap.add(e)},e.prototype.dequeue=function(){if(0!==this.heap.size()){var e=this.heap.peek();return this.heap.removeRoot(),e}},e.prototype.peek=function(){return this.heap.peek()},e.prototype.contains=function(e){return this.heap.contains(e)},e.prototype.isEmpty=function(){return this.heap.isEmpty()},e.prototype.size=function(){return this.heap.size()},e.prototype.clear=function(){this.heap.clear()},e.prototype.forEach=function(e){this.heap.forEach(e)},e}();e.PriorityQueue=S;var x=function(){function e(e){this.dictionary=new g(e)}return e.prototype.contains=function(e){return this.dictionary.containsKey(e)},e.prototype.add=function(e){return this.contains(e)||l.isUndefined(e)?!1:(this.dictionary.setValue(e,e),!0)},e.prototype.intersection=function(e){var t=this;this.forEach(function(n){return e.contains(n)||t.remove(n),!0})},e.prototype.union=function(e){var t=this;e.forEach(function(e){return t.add(e),!0})},e.prototype.difference=function(e){var t=this;e.forEach(function(e){return t.remove(e),!0})},e.prototype.isSubsetOf=function(e){if(this.size()>e.size())return!1;var t=!0;return this.forEach(function(n){return e.contains(n)?!0:(t=!1,!1)}),t},e.prototype.remove=function(e){return this.contains(e)?(this.dictionary.remove(e),!0):!1},e.prototype.forEach=function(e){this.dictionary.forEach(function(t,n){return e(n)})},e.prototype.toArray=function(){return this.dictionary.values()},e.prototype.isEmpty=function(){return this.dictionary.isEmpty()},e.prototype.size=function(){return this.dictionary.size()},e.prototype.clear=function(){this.dictionary.clear()},e.prototype.toString=function(){return l.arrays.toString(this.toArray())},e}();e.Set=x;var $=function(){function e(e){this.toStrF=e||l.defaultToString,this.dictionary=new g(this.toStrF),this.nElements=0}return e.prototype.add=function(e,t){if(void 0===t&&(t=1),l.isUndefined(e)||0>=t)return!1;if(this.contains(e))this.dictionary.getValue(e).copies+=t;else{var n={value:e,copies:t};this.dictionary.setValue(e,n)}return this.nElements+=t,!0},e.prototype.count=function(e){return this.contains(e)?this.dictionary.getValue(e).copies:0},e.prototype.contains=function(e){return this.dictionary.containsKey(e)},e.prototype.remove=function(e,t){if(void 0===t&&(t=1),l.isUndefined(e)||0>=t)return!1;if(this.contains(e)){var n=this.dictionary.getValue(e);return t>n.copies?this.nElements-=n.copies:this.nElements-=t,n.copies-=t,n.copies<=0&&this.dictionary.remove(e),!0}return!1},e.prototype.toArray=function(){for(var e=[],t=this.dictionary.values(),n=t.length,i=0;n>i;i++)for(var r=t[i],o=r.value,s=r.copies,a=0;s>a;a++)e.push(o);return e},e.prototype.toSet=function(){for(var e=new x(this.toStrF),t=this.dictionary.values(),n=t.length,i=0;n>i;i++){var r=t[i].value;e.add(r)}return e},e.prototype.forEach=function(e){this.dictionary.forEach(function(t,n){for(var i=n.value,r=n.copies,o=0;r>o;o++)if(e(i)===!1)return!1;return!0})},e.prototype.size=function(){return this.nElements},e.prototype.isEmpty=function(){return 0===this.nElements},e.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},e}();e.Bag=$;var _=function(){function e(e){this.root=null,this.compare=e||l.defaultCompare,this.nElements=0}return e.prototype.add=function(e){return l.isUndefined(e)?!1:null!==this.insertNode(this.createNode(e))?(this.nElements++,!0):!1},e.prototype.clear=function(){this.root=null,this.nElements=0},e.prototype.isEmpty=function(){return 0===this.nElements},e.prototype.size=function(){return this.nElements},e.prototype.contains=function(e){return l.isUndefined(e)?!1:null!==this.searchNode(this.root,e)},e.prototype.remove=function(e){var t=this.searchNode(this.root,e);return null===t?!1:(this.removeNode(t),this.nElements--,!0)},e.prototype.inorderTraversal=function(e){this.inorderTraversalAux(this.root,e,{stop:!1})},e.prototype.preorderTraversal=function(e){this.preorderTraversalAux(this.root,e,{stop:!1})},e.prototype.postorderTraversal=function(e){this.postorderTraversalAux(this.root,e,{stop:!1})},e.prototype.levelTraversal=function(e){this.levelTraversalAux(this.root,e)},e.prototype.minimum=function(){return this.isEmpty()?void 0:this.minimumAux(this.root).element},e.prototype.maximum=function(){return this.isEmpty()?void 0:this.maximumAux(this.root).element},e.prototype.forEach=function(e){this.inorderTraversal(e)},e.prototype.toArray=function(){var e=[];return this.inorderTraversal(function(t){return e.push(t),!0}),e},e.prototype.height=function(){return this.heightAux(this.root)},e.prototype.searchNode=function(e,t){for(var n=null;null!==e&&0!==n;)n=this.compare(t,e.element),0>n?e=e.leftCh:n>0&&(e=e.rightCh);return e},e.prototype.transplant=function(e,t){null===e.parent?this.root=t:e===e.parent.leftCh?e.parent.leftCh=t:e.parent.rightCh=t,null!==t&&(t.parent=e.parent)},e.prototype.removeNode=function(e){if(null===e.leftCh)this.transplant(e,e.rightCh);else if(null===e.rightCh)this.transplant(e,e.leftCh);else{var t=this.minimumAux(e.rightCh);t.parent!==e&&(this.transplant(t,t.rightCh),t.rightCh=e.rightCh,t.rightCh.parent=t),this.transplant(e,t),t.leftCh=e.leftCh,t.leftCh.parent=t}},e.prototype.inorderTraversalAux=function(e,t,n){null===e||n.stop||(this.inorderTraversalAux(e.leftCh,t,n),n.stop||(n.stop=t(e.element)===!1,n.stop||this.inorderTraversalAux(e.rightCh,t,n)))},e.prototype.levelTraversalAux=function(e,t){var n=new w;for(null!==e&&n.enqueue(e);!n.isEmpty();){if(e=n.dequeue(),t(e.element)===!1)return;null!==e.leftCh&&n.enqueue(e.leftCh),null!==e.rightCh&&n.enqueue(e.rightCh)}},e.prototype.preorderTraversalAux=function(e,t,n){null===e||n.stop||(n.stop=t(e.element)===!1,n.stop||(this.preorderTraversalAux(e.leftCh,t,n),n.stop||this.preorderTraversalAux(e.rightCh,t,n)))},e.prototype.postorderTraversalAux=function(e,t,n){null===e||n.stop||(this.postorderTraversalAux(e.leftCh,t,n),n.stop||(this.postorderTraversalAux(e.rightCh,t,n),n.stop||(n.stop=t(e.element)===!1)))},e.prototype.minimumAux=function(e){for(;null!==e.leftCh;)e=e.leftCh;return e},e.prototype.maximumAux=function(e){for(;null!==e.rightCh;)e=e.rightCh;return e},e.prototype.heightAux=function(e){return null===e?-1:Math.max(this.heightAux(e.leftCh),this.heightAux(e.rightCh))+1},e.prototype.insertNode=function(e){for(var t=null,n=this.root,i=null;null!==n;){if(i=this.compare(e.element,n.element),0===i)return null;0>i?(t=n,n=n.leftCh):(t=n,n=n.rightCh)}return e.parent=t,null===t?this.root=e:this.compare(e.element,t.element)<0?t.leftCh=e:t.rightCh=e,e},e.prototype.createNode=function(e){return{element:e,leftCh:null,rightCh:null,parent:null}},e}();e.BSTree=_}(t=e.Collections||(e.Collections={}))}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.float32ColorToARGB=function(e){var t=(4278190080&e)>>>24,n=(16711680&e)>>>16,i=(65280&e)>>>8,r=255&e,o=[t,n,i,r];return o},e._componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},e.rgbToHexString=function(t){return e.coalesce(t),"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])},e.argbToHexString=function(t){return"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])+e._componentToHex(t[3])},e.coalesce=function(e){for(var t=1;t<e.length;t++)"undefined"==typeof e[t]&&(e[t]=e[t-1])},e}();e.Colors=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.getTimeStamp=function(){return(new Date).getTime()},e}();e.Dates=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.getPixelRatio=function(e){var t=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;
return t/n},e.isTouch=function(){return!!("ontouchstart"in window)||window.navigator.msMaxTouchPoints>0},e}();e.Device=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.isInIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},e.supportsFullscreen=function(){var e=document.documentElement,t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen;return void 0!=t},e.isHidden=function(){var t=e.getHiddenProp();return t?document[t]:!1},e.getHiddenProp=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null},e}();e.Documents=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.debounce=function(e,t){return t=t||100,function(){if(!e.debouncing){var n=Array.prototype.slice.apply(arguments);e.lastReturnVal=e.apply(window,n),e.debouncing=!0}return clearTimeout(e.debounceTimeout),e.debounceTimeout=setTimeout(function(){e.debouncing=!1},t),e.lastReturnVal}},e}();e.Events=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.simplifyMimeType=function(e){switch(e){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var t=e.split("/");return t[t.length-1]}},e}();e.Files=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.getCharCode=function(e){var t="number"==typeof e.which?e.which:e.keyCode;return t},e}();e.Keyboard=t}(Utils||(Utils={}));var Utils;!function(e){var t;!function(e){var t=function(){function e(e,t){this.X=e,this.Y=t}return e.prototype.get=function(){return new e(this.X,this.Y)},e.prototype.set=function(e,t){this.X=e,this.Y=t},e.prototype.add=function(e){this.X+=e.X,this.Y+=e.Y},e.add=function(t,n){return new e(t.X+n.X,t.Y+n.Y)},e.prototype.sub=function(e){this.X-=e.X,this.Y-=e.Y},e.sub=function(t,n){return new e(t.X-n.X,t.Y-n.Y)},e.prototype.mult=function(e){this.X=this.X*e,this.Y=this.Y*e},e.mult=function(t,n){return new e(t.X*n.X,t.Y*n.Y)},e.multN=function(t,n){return new e(t.X*n,t.Y*n)},e.prototype.Div=function(e){this.X=this.X/e,this.Y=this.Y/e},e.div=function(t,n){return new e(t.X/n.X,t.Y/n.Y)},e.divN=function(t,n){return new e(t.X/n,t.Y/n)},e.prototype.mag=function(){return Math.sqrt(this.X*this.X+this.Y*this.Y)},e.prototype.magSq=function(){return this.X*this.X+this.Y*this.Y},e.prototype.normalise=function(){var e=this.mag();0!=e&&1!=e&&this.Div(e)},e.prototype.limit=function(e){this.magSq()>e*e&&(this.normalise(),this.mult(e))},e.prototype.equals=function(e){return this.X==e.X&&this.Y==e.Y},e.prototype.heading=function(){var e=Math.atan2(-this.Y,this.X);return-1*e},e.random2D=function(){return e.fromAngle(Math.random()*Math.TAU)},e.fromAngle=function(t){return new e(Math.cos(t),Math.sin(t))},e}();e.Vector=t}(t=e.Maths||(e.Maths={}))}(Utils||(Utils={}));var Utils;!function(e){var t;!function(e){var t=function(){function e(e,t){this.width=e,this.height=t}return e}();e.Size=t;var n=function(){function e(){}return e.fitRect=function(e,n,i,r){var o,s,a,u=n/e,c=r/i;return c>u&&(a=i/e,o=e*a,s=n*a),u>c&&(a=r/n,o=e*a,s=n*a),new t(Math.floor(o),Math.floor(s))},e.hitRect=function(e,t,n,i,r,o){return r>e&&e+n>r&&o>t&&t+i>o?!0:!1},e}();e.Dimensions=n}(t=e.Measurements||(e.Measurements={}))}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.numericalInput=function(e){return 46==e.keyCode||8==e.keyCode||9==e.keyCode||27==e.keyCode||65==e.keyCode&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39?!0:e.shiftKey||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)?(e.preventDefault(),!1):!0},e}();e.Numbers=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function t(){}return t.clear=function(t){switch(void 0===t&&(t=e.StorageType.memory),t.value){case e.StorageType.memory.value:this._memoryStorage={};break;case e.StorageType.session.value:sessionStorage.clear();break;case e.StorageType.local.value:localStorage.clear()}},t.clearExpired=function(t){void 0===t&&(t=e.StorageType.memory);for(var n=this.getItems(t),i=0;i<n.length;i++){var r=n[i];this._isExpired(r)&&this.remove(r.key)}},t.get=function(t,n){void 0===n&&(n=e.StorageType.memory);var i;switch(n.value){case e.StorageType.memory.value:i=this._memoryStorage[t];break;case e.StorageType.session.value:i=sessionStorage.getItem(t);break;case e.StorageType.local.value:i=localStorage.getItem(t)}if(!i)return null;var r=JSON.parse(i);return this._isExpired(r)?null:(r.key=t,r)},t._isExpired=function(e){return(new Date).getTime()<e.expiresAt?!1:!0},t.getItems=function(t){void 0===t&&(t=e.StorageType.memory);var n=[];switch(t.value){case e.StorageType.memory.value:for(var i=Object.keys(this._memoryStorage),r=0;r<i.length;r++){var o=this.get(i[r],e.StorageType.memory);o&&n.push(o)}break;case e.StorageType.session.value:for(var r=0;r<sessionStorage.length;r++){var s=sessionStorage.key(r),o=this.get(s,e.StorageType.session);o&&n.push(o)}break;case e.StorageType.local.value:for(var r=0;r<localStorage.length;r++){var s=localStorage.key(r),o=this.get(s,e.StorageType.local);o&&n.push(o)}}return n},t.remove=function(t,n){switch(void 0===n&&(n=e.StorageType.memory),n.value){case e.StorageType.memory.value:delete this._memoryStorage[t];break;case e.StorageType.session.value:sessionStorage.removeItem(t);break;case e.StorageType.local.value:localStorage.removeItem(t)}},t.set=function(t,n,i,r){void 0===r&&(r=e.StorageType.memory);var o=1e3*i,s=new e.StorageItem;switch(s.value=n,s.expiresAt=(new Date).getTime()+o,r.value){case e.StorageType.memory.value:this._memoryStorage[t]=JSON.stringify(s);break;case e.StorageType.session.value:sessionStorage.setItem(t,JSON.stringify(s));break;case e.StorageType.local.value:localStorage.setItem(t,JSON.stringify(s))}return s},t._memoryStorage={},t}();e.Storage=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e}();e.StorageItem=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(e){this.value=e}return e.prototype.toString=function(){return this.value},e.memory=new e("memory"),e.session=new e("session"),e.local=new e("local"),e}();e.StorageType=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.ellipsis=function(e,t){if(e.length<=t)return e;var n=e.substr(0,t),i=n.lastIndexOf(" ");return-1!=i&&(n=n.substr(0,Math.min(n.length,i))),n+"&hellip;"},e.htmlDecode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild.nodeValue},e}();e.Strings=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.getHashParameter=function(e,t){t||(t=window.document);var n=new RegExp("#.*[?&]"+e+"=([^&]+)(&|$)"),i=n.exec(t.location.hash);return i?decodeURIComponent(i[1].replace(/\+/g," ")):null},e.setHashParameter=function(e,t,n){n||(n=window.document);var i=this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t),r="#?"+i,o=n.URL,s=o.indexOf("#");-1!=s&&(o=o.substr(0,o.indexOf("#"))),n.location.replace(o+r)},e.getQuerystringParameter=function(e,t){return t||(t=window),this.getQuerystringParameterFromString(e,t.location.search)},e.getQuerystringParameterFromString=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=n.exec(t);return i?decodeURIComponent(i[1].replace(/\+/g," ")):null},e.setQuerystringParameter=function(e,t,n){n||(n=window.document);var i=this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t);window.location.search=i},e.updateURIKeyValuePair=function(e,t,n){t=encodeURIComponent(t),n=encodeURIComponent(n);var i=e.split("&");""==i[0]&&i.shift();for(var r,o=i.length;o--;)if(r=i[o].split("="),r[0]==t){r[1]=n,i[o]=r.join("=");break}return 0>o&&(i[i.length]=[t,n].join("=")),i.join("&")},e.getUrlParts=function(e){var t=document.createElement("a");return t.href=e,t},e.convertToRelativeUrl=function(e){var t=this.getUrlParts(e),n=t.pathname+t.searchWithin;return n.startsWith("/")||(n="/"+n),n},e}();e.Urls=t}(Utils||(Utils={})),define("utils",function(){}),define("extensions/uv-seadragon-extension/CroppedImageDimensions",["require","exports","utils"],function(e,t){var n=Utils.Measurements.Size,i=Utils.Maths.Vector,r=function(){function e(){this.region=new n(0,0),this.regionPos=new i(0,0),this.size=new n(0,0)}return e}();return r}),define("extensions/uv-seadragon-extension/SearchResultRect",["require","exports"],function(e,t){var n=function(){function e(e){this.index=e.resource.resultIndex;var t=e.on.match(/.*xywh=(\d*),(\d*),(\d*),(\d*)/);this.x=t[1],this.y=t[2],this.width=t[3],this.height=t[4]}return e}();return n}),define("extensions/uv-seadragon-extension/SearchResult",["require","exports","./SearchResultRect"],function(e,t,n){var i=function(){function e(e,t){this.rects=[],this.canvasIndex=t.getCanvasIndexById(e.on.match(/(.*)#/)[1]),this.addRect(e)}return e.prototype.addRect=function(e){var t=new n(e);this.rects.push(t),this.rects.sort(function(e,t){return e.index-t.index})},e}();return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-seadragon-extension/Provider",["require","exports","../../modules/uv-shared-module/BaseProvider","./CroppedImageDimensions","./SearchResult","./TreeSortType"],function(e,t,n,i,r,o){var s=Utils.Measurements.Size,a=Utils.Maths.Vector,u=function(e){function t(t){e.call(this,t),this.searchResults=[],this.config.options=$.extend(!0,this.options,{autoCompleteUriTemplate:"{0}{1}",iiifImageUriTemplate:"{0}/{1}/{2}/{3}/{4}/{5}.jpg"},t.config.options)}return __extends(t,e),t.prototype.getCroppedImageDimensions=function(e,t){if(!t)return null;if(!t.viewport)return null;if(!e.getHeight()||!e.getWidth())return null;var n=t.viewport.getBounds(!0),r=t.viewport.getContainerSize(),o=t.viewport.getZoom(!0),u=Math.max(0,n.y),c=Math.max(0,n.x);u=1/(e.getHeight()/parseInt(String(e.getWidth()*u)));var l=r.x,h=r.y,p=parseInt(String(l*o)),d=e.getWidth()/p,f=parseInt(String(e.getHeight()/d)),g=parseInt(String(c*p)),m=parseInt(String(u*f)),v=0,y=p,b=0,E=f,w=g,S=g+l,x=m,$=m+h,_=Math.max(0,Math.min(y,S)-Math.max(v,w)),I=Math.max(0,Math.min(E,$)-Math.max(b,x)),T=e.getWidth()/p,C=parseInt(String(_*T)),A=parseInt(String(I*T)),O=parseInt(String(e.getHeight()*u)),R=parseInt(String(e.getWidth()*c));0>O&&(O=0),0>R&&(R=0);var N=new i;return N.region=new s(C,A),N.regionPos=new a(R,O),N.size=new s(_,I),N},t.prototype.getCroppedImageUri=function(e,t){if(!t)return null;if(!t.viewport)return null;var n=this.getCroppedImageDimensions(e,t),i=this.getImageBaseUri(e),r=this.getImageId(e),o=n.regionPos.X+","+n.regionPos.Y+","+n.region.width+","+n.region.height,s=n.size.width+","+n.size.height,a=0,u="default";return String.format(this.config.options.iiifImageUriTemplate,i,r,o,s,a,u)},t.prototype.getConfinedImageDimensions=function(e,t){var n=new s(0,0);n.width=t;var i=Math.normalise(t,0,e.getWidth());return n.height=Math.floor(e.getHeight()*i),n},t.prototype.getConfinedImageUri=function(e,t){var n=this.getImageBaseUri(e),i=this.getImageId(e),r="full",o=this.getConfinedImageDimensions(e,t),s=o.width+","+o.height,a=0,u="default",c=String.format(this.config.options.iiifImageUriTemplate,n,i,r,s,a,u);return c},t.prototype.getImageId=function(e){var t=this.getInfoUri(e);return t=t.substr(0,t.lastIndexOf("/")),t.substr(t.lastIndexOf("/")+1)},t.prototype.getImageBaseUri=function(e){var t=this.getInfoUri(e);return t=t.substr(0,t.lastIndexOf("/")),t.substr(0,t.lastIndexOf("/"))},t.prototype.getInfoUri=function(e){var t,n=e.getImages();if(n&&n.length)for(var i=n[0],r=i.getResource(),o=r.getServices(),s=0;s<o.length;s++){var a=o[s],u=a.id;_.endsWith(u,"/")||(u+="/"),manifesto.isImageProfile(a.getProfile())&&(t=u+"info.json")}return t||(t=window.DEBUG?"/src/extensions/uv-seadragon-extension/lib/imageunavailable.json":"lib/imageunavailable.json"),t},t.prototype.getEmbedScript=function(e,t,n,i,r){var o=this.config.uri||"",s=String.format(e,this.getSerializedLocales(),o,this.manifestUri,this.collectionIndex,this.manifestIndex,this.sequenceIndex,this.canvasIndex,i,r,t,n,this.embedScriptUri);return s},t.prototype.getPrevPageIndex=function(e){_.isUndefined(e)&&(e=this.canvasIndex);var t;if(this.isPagingSettingEnabled()){var n=this.getPagedIndices(e);t=this.isRightToLeft()?n.last()-1:n[0]-1}else t=e-1;return t},t.prototype.getPagedIndices=function(e){_.isUndefined(e)&&(e=this.canvasIndex);var t=[];return this.isContinuous()?t=_.map(this.getCanvases(),function(e,t){return t}):this.isPagingSettingEnabled()?(t=this.isFirstCanvas(e)||this.isLastCanvas(e)&&this.isTotalCanvasesEven()?[e]:e%2?[e,e+1]:[e-1,e],this.isRightToLeft()&&(t=t.reverse())):t.push(this.canvasIndex),t},t.prototype.isSearchWithinEnabled=function(){return Utils.Bools.getBool(this.config.options.searchWithinEnabled,!1)&&this.getSearchWithinService()?!0:!1},t.prototype.isContinuous=function(){return this.getViewingHint().toString()===manifesto.ViewingHint.continuous().toString()},t.prototype.isPaged=function(){return this.getViewingHint().toString()===manifesto.ViewingHint.paged().toString()},t.prototype.isBottomToTop=function(){return this.getViewingDirection().toString()===manifesto.ViewingDirection.bottomToTop().toString()},t.prototype.isTopToBottom=function(){return this.getViewingDirection().toString()===manifesto.ViewingDirection.topToBottom().toString()},t.prototype.isLeftToRight=function(){return this.getViewingDirection().toString()===manifesto.ViewingDirection.leftToRight().toString()},t.prototype.isRightToLeft=function(){return this.getViewingDirection().toString()===manifesto.ViewingDirection.rightToLeft().toString()},t.prototype.isHorizontallyAligned=function(){return this.isLeftToRight()||this.isRightToLeft()},t.prototype.isVerticallyAligned=function(){return this.isTopToBottom()||this.isBottomToTop()},t.prototype.isPagingAvailable=function(){return this.isPagingEnabled()&&this.getTotalCanvases()>2},t.prototype.isPagingEnabled=function(){return this.getCurrentSequence().isPagingEnabled()},t.prototype.isPagingSettingEnabled=function(){return this.isPagingAvailable()?this.getSettings().pagingEnabled:!1},t.prototype.getNextPageIndex=function(e){_.isUndefined(e)&&(e=this.canvasIndex);var t;if(this.isPagingSettingEnabled()){var n=this.getPagedIndices(e);t=this.isRightToLeft()?n[0]+1:n.last()+1}else t=e+1;return t>this.getTotalCanvases()-1?-1:t},t.prototype.getAutoCompleteService=function(){var e=this.getSearchWithinService();return e?e.getService(manifesto.ServiceProfile.autoComplete()):null},t.prototype.getAutoCompleteUri=function(){var e=this.getAutoCompleteService();return e?e.id+"?q={0}":null},t.prototype.getSearchWithinService=function(){return this.manifest.getService(manifesto.ServiceProfile.searchWithin())},t.prototype.getSearchWithinServiceUri=function(){var e=this.getSearchWithinService();if(!e)return null;var t=e.id;return t+="?q={0}"},t.prototype.searchWithin=function(e,t){var n=this,i=this.getSearchWithinServiceUri();i=String.format(i,e),$.getJSON(i,function(e){e.resources&&e.resources.length&&n.parseSearchWithinResults(e),t(e)})},t.prototype.parseSearchWithinResults=function(e){this.searchResults=[];for(var t=0;t<e.resources.length;t++){var n=e.resources[t],i=new r(n,this),o=this.getSearchResultByCanvasIndex(i.canvasIndex);o?o.addRect(n):this.searchResults.push(i)}},t.prototype.getSearchResultByCanvasIndex=function(e){for(var t=0;t<this.searchResults.length;t++){var n=this.searchResults[t];if(n.canvasIndex===e)return n}return null},t.prototype.getSortedTree=function(e){var t=this.iiifResource.getTree(),n=manifesto.getTreeNode();return e===o.date?this.getSortedTreeNodesByDate(n,t):e===o.none&&(n=t),n},t.prototype.getSortedTreeNodesByDate=function(e,t){var n=t.nodes.en().traverseUnique(function(e){return e.nodes}).where(function(e){return e.data.type===manifesto.TreeNodeType.collection().toString()||e.data.type===manifesto.TreeNodeType.manifest().toString()}).toArray(),i=t.nodes.en().traverseUnique(function(e){return e.nodes}).where(function(e){return e.data.type===manifesto.TreeNodeType.manifest().toString()}).toArray();this.createDecadeNodes(e,n),this.sortDecadeNodes(e),this.createYearNodes(e,n),this.sortYearNodes(e),this.createMonthNodes(e,i),this.sortMonthNodes(e),this.createDateNodes(e,i),this.pruneDecadeNodes(e)},t.prototype.createDecadeNodes=function(e,t){for(var n,i=0;i<t.length;i++){var r=t[i],o=this.getNodeYear(r),s=(Number(o.toString().substr(2,1)),Number(o.toString().substr(0,3)+"9"));this.getDecadeNode(e,o)||(n=manifesto.getTreeNode(),n.label=o+" - "+s,n.navDate=r.navDate,n.data.startYear=o,n.data.endYear=s,e.addNode(n))}},t.prototype.pruneDecadeNodes=function(e){for(var t=[],n=0;n<e.nodes.length;n++){var i=e.nodes[n];i.nodes.length||t.push(i)}for(var r=0;r<t.length;r++){var o=t[r];e.nodes.remove(o)}},t.prototype.sortDecadeNodes=function(e){e.nodes=e.nodes.sort(function(e,t){return e.data.startYear-t.data.startYear})},t.prototype.getDecadeNode=function(e,t){for(var n=0;n<e.nodes.length;n++){var i=e.nodes[n];if(t>=i.data.startYear&&t<=i.data.endYear)return i}return null},t.prototype.createYearNodes=function(e,t){for(var n,i=0;i<t.length;i++){var r=t[i],o=this.getNodeYear(r),s=this.getDecadeNode(e,o);s&&!this.getYearNode(s,o)&&(n=manifesto.getTreeNode(),n.label=o.toString(),n.navDate=r.navDate,n.data.year=o,s.addNode(n))}},t.prototype.sortYearNodes=function(e){for(var t=this,n=0;n<e.nodes.length;n++){var i=e.nodes[n];i.nodes=i.nodes.sort(function(e,n){return t.getNodeYear(e)-t.getNodeYear(n)})}},t.prototype.getYearNode=function(e,t){for(var n=0;n<e.nodes.length;n++){var i=e.nodes[n];if(t===this.getNodeYear(i))return i}return null},t.prototype.createMonthNodes=function(e,t){for(var n,i=0;i<t.length;i++){var r=t[i],o=this.getNodeYear(r),s=this.getNodeMonth(r),a=this.getDecadeNode(e,o),u=this.getYearNode(a,o);a&&u&&!this.getMonthNode(u,s)&&(n=manifesto.getTreeNode(),n.label=this.getNodeDisplayMonth(r),n.navDate=r.navDate,n.data.year=o,n.data.month=s,u.addNode(n))}},t.prototype.sortMonthNodes=function(e){for(var t=this,n=0;n<e.nodes.length;n++)for(var i=e.nodes[n],r=0;r<i.nodes.length;r++){var o=i.nodes[r];o.nodes=o.nodes.sort(function(e,n){return t.getNodeMonth(e)-t.getNodeMonth(n)})}},t.prototype.getMonthNode=function(e,t){for(var n=0;n<e.nodes.length;n++){var i=e.nodes[n];if(t===this.getNodeMonth(i))return i}return null},t.prototype.createDateNodes=function(e,t){for(var n=0;n<t.length;n++){var i=t[n],r=this.getNodeYear(i),o=this.getNodeMonth(i),s=manifesto.getTreeNode();s.id=i.id,s.label=this.getNodeDisplayDate(i),s.data=i.data,s.data.type=manifesto.TreeNodeType.manifest().toString(),s.data.year=r,s.data.month=o;var a=this.getDecadeNode(e,r);if(a){var u=this.getYearNode(a,r);if(u){var c=this.getMonthNode(u,o);c&&c.addNode(s)}}}},t.prototype.getNodeYear=function(e){return e.navDate.getFullYear()},t.prototype.getNodeMonth=function(e){return e.navDate.getMonth()},t.prototype.getNodeDisplayMonth=function(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"];return t[e.navDate.getMonth()]},t.prototype.getNodeDisplayDate=function(e){return e.navDate.toDateString()},t}(n);return u});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-virtex-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("downloadDialogue"),e.prototype.create.call(this)},t.prototype.open=function(){e.prototype.open.call(this),this.addEntireFileDownloadOptions(),this.updateNoneAvailable(),this.resize()},t.prototype.isDownloadOptionAvailable=function(t){return e.prototype.isDownloadOptionAvailable.call(this,t)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-virtex-extension/EmbedDialogue",["require","exports","../../modules/uv-dialogues-module/EmbedDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("embedDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this),this.code=this.provider.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-virtex-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){var i=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){this.setConfig("settingsDialogue"),e.prototype.create.call(this)},t}(n);return i});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/uv-virtexcenterpanel-module/VirtexCenterPanel",["require","exports","../uv-shared-module/BaseCommands","../uv-shared-module/CenterPanel"],function(e,t,n,i){var r=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("virtexCenterPanel"),e.prototype.create.call(this);var i=this;$.subscribe(n.OPEN_EXTERNAL_RESOURCE,function(e,t){i.openMedia(t)}),this.$navigation=$('<div class="navigation"></div>'),this.$content.prepend(this.$navigation),this.$zoomInButton=$('<a class="imageBtn zoomIn" title="'+this.content.zoomIn+'"></a>'),this.$navigation.append(this.$zoomInButton),this.$zoomOutButton=$('<a class="imageBtn zoomOut" title="'+this.content.zoomOut+'"></a>'),this.$navigation.append(this.$zoomOutButton),this.$viewport=$('<div class="virtex"></div>'),this.$content.prepend(this.$viewport),this.title=this.extension.provider.getLabel(),this.showAttribution(),this.$zoomInButton.on("click",function(e){e.preventDefault(),t.viewport.zoomIn()}),this.$zoomOutButton.on("click",function(e){e.preventDefault(),t.viewport.zoomOut()})},t.prototype.openMedia=function(e){var t=this;this.extension.getExternalResources(e).then(function(){t.$viewport.empty();var e=t.provider.getCurrentCanvas();t.viewport=virtex.create({element:"#content .virtex",object:e.id,showStats:t.options.showStats}),t.resize()})},t.prototype.resize=function(){e.prototype.resize.call(this),this.$title.ellipsisFill(this.title),this.$viewport.width(this.$content.width()),this.$viewport.height(this.$content.height())},t}(i);return r});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-virtex-extension/Extension",["require","exports","../../modules/uv-shared-module/BaseCommands","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","./DownloadDialogue","./EmbedDialogue","../../modules/uv-shared-module/FooterPanel","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","./SettingsDialogue","../../modules/uv-shared-module/Shell","../../modules/uv-contentleftpanel-module/ContentLeftPanel","../../modules/uv-virtexcenterpanel-module/VirtexCenterPanel"],function(e,t,n,i,r,o,s,a,u,c,l,h,p,d){var f=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.create=function(t){var i=this;e.prototype.create.call(this,t),$.subscribe(n.THUMB_SELECTED,function(e,t){i.viewCanvas(t)})},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.headerPanel=new u(h.$headerPanel),this.isLeftPanelEnabled()&&(this.leftPanel=new p(h.$leftPanel)),this.centerPanel=new d(h.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new c(h.$rightPanel)),this.footerPanel=new a(h.$footerPanel),this.$downloadDialogue=$('<div class="overlay download"></div>'),h.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new o(this.$downloadDialogue),this.$embedDialogue=$('<div class="overlay embed"></div>'),h.$overlays.append(this.$embedDialogue),this.embedDialogue=new s(this.$embedDialogue),this.$settingsDialogue=$('<div class="overlay settings"></div>'),h.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new l(this.$settingsDialogue),this.isLeftPanelEnabled()?this.leftPanel.init():h.$leftPanel.hide(),this.isRightPanelEnabled()?this.rightPanel.init():h.$rightPanel.hide()},t.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.provider.config.options.leftPanelEnabled,!0)&&(this.provider.isMultiCanvas()||this.provider.isMultiSequence())},t.prototype.bookmark=function(){e.prototype.bookmark.call(this);var t=this.provider.getCurrentCanvas(),i=new r;i.index=this.provider.canvasIndex,i.label=t.getLabel(),i.path=this.getBookmarkUri(),i.thumb=t.getProperty("thumbnail"),i.title=this.provider.getLabel(),i.trackingLabel=window.trackingLabel,i.type=manifesto.ElementType.physicalobject().toString(),this.triggerSocket(n.BOOKMARK,i)},t}(i);return f});var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("extensions/uv-virtex-extension/Provider",["require","exports","../../modules/uv-shared-module/BaseProvider"],function(e,t,n){var i=function(e){function t(t){e.call(this,t),this.config.options=$.extend(!0,this.options,{},t.config.options)}return __extends(t,e),t.prototype.getEmbedScript=function(e,t,n){var i=this.config.uri||"",r=String.format(e,this.getSerializedLocales(),i,this.manifestUri,this.collectionIndex,this.manifestIndex,this.sequenceIndex,this.canvasIndex,t,n,this.embedScriptUri);return r},t}(n);return i}),window.browserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown","Explorer"==this.browser&&"7"==this.version&&navigator.userAgent.match(/Trident/i)&&(this.version=this.searchVersionIE())},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string;if(this.versionSearchString=e[t].subString,-1!=n.indexOf(e[t].subString))return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},searchVersionIE:function(){var e,t=navigator.userAgent.toString().toLowerCase(),n=/(trident)(?:.*rv:([\w.]+))?/.exec(t)||/(msie) ([\w.]+)/.exec(t)||["",null,-1];try{e=n[2].split(".")[0]}catch(i){e="unknown"}return e},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]},window.browserDetect.init(),define("browserdetect",function(){});var exjs;!function(e){e.version="0.4.0"}(exjs||(exjs={}));var exjs;!function(e){Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)})}(exjs||(exjs={}));var exjs;!function(e){var t=function(){function e(){}return e.prototype.getEnumerator=function(){return{moveNext:function(){return!1},current:void 0}},e.prototype.aggregate=function(e,t){for(var n=e,i=this.getEnumerator();i.moveNext();)n=t(n,i.current);return n},e.prototype.all=function(e){if(e)for(var t=this.getEnumerator(),n=0;t.moveNext();){if(!e(t.current,n))return!1;n++}return!0},e.prototype.any=function(e){for(var t=this.getEnumerator(),n=0;t.moveNext();){if(!e)return!0;if(e(t.current,n))return!0;n++}return!1},e.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];throw new Error("Not implemented")},e.prototype.apply=function(e){throw new Error("Not implemented")},e.prototype.at=function(e){for(var t=this.getEnumerator(),n=0;t.moveNext();){if(n===e)return t.current;n++}},e.prototype.average=function(e){var t=0,n=0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var i=this.getEnumerator();i.moveNext();)n+=e(i.current),t++;return 0===t?0:n/t},e.prototype.concat=function(e){throw new Error("Not implemented")},e.prototype.count=function(e){for(var t=0,n=this.getEnumerator();n.moveNext();)(!e||e(n.current))&&t++;return t},e.prototype.difference=function(e,t){return t=t||function(e,t){return e===t},e instanceof Array&&(e=e.en()),{intersection:this.intersect(e,t).toArray().en(),aNotB:this.except(e,t).toArray().en(),bNotA:e.except(this,t).toArray().en()}},e.prototype.distinct=function(e){throw new Error("Not implemented")},e.prototype.except=function(e,t){throw new Error("Not implemented")},e.prototype.first=function(e){for(var t=this.getEnumerator();t.moveNext();)if(!e||e(t.current))return t.current},e.prototype.firstIndex=function(e){for(var t=this.getEnumerator(),n=0;t.moveNext();n++)if(!e||e(t.current))return n;return-1},e.prototype.forEach=function(e){for(var t=this.getEnumerator();t.moveNext();)e(t.current)},e.prototype.groupBy=function(e,t){throw new Error("Not implemented")},e.prototype.intersect=function(e,t){throw new Error("Not implemented")},e.prototype.join=function(e,t,n,i,r){throw new Error("Not implemented")},e.prototype.last=function(e){for(var t,n=this.getEnumerator();n.moveNext();)(!e||e(n.current))&&(t=n.current);return t},e.prototype.lastIndex=function(e){for(var t=-1,n=this.getEnumerator(),i=0;n.moveNext();i++)(!e||e(n.current))&&(t=i);return t},e.prototype.max=function(e){var t=this.getEnumerator();if(!t.moveNext())return 0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var n=e(t.current);t.moveNext();)n=Math.max(n,e(t.current));return n},e.prototype.min=function(e){var t=this.getEnumerator();if(!t.moveNext())return 0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var n=e(t.current);t.moveNext();)n=Math.min(n,e(t.current));return n},e.prototype.orderBy=function(e,t){throw new Error("Not implemented")},e.prototype.orderByDescending=function(e,t){throw new Error("Not implemented")},e.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];throw new Error("Not implemented")},e.prototype.reverse=function(){throw new Error("Not implemented")},e.prototype.select=function(e){throw new Error("Not implemented")},e.prototype.selectMany=function(e){throw new Error("Not implemented")},e.prototype.skip=function(e){throw new Error("Not implemented")},e.prototype.skipWhile=function(e){throw new Error("Not implemented")},e.prototype.standardDeviation=function(e){var t=this.average(e),n=0,i=0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var r=this.getEnumerator();r.moveNext();){var o=e(r.current)-t;n+=o*o,i++}return Math.sqrt(n/i)},e.prototype.sum=function(e){var t=0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");
return e};for(var n=this.getEnumerator();n.moveNext();)t+=e(n.current);return t},e.prototype.take=function(e){throw new Error("Not implemented")},e.prototype.takeWhile=function(e){throw new Error("Not implemented")},e.prototype.traverse=function(e){throw new Error("Not implemented")},e.prototype.traverseUnique=function(e,t){throw new Error("Not implemented")},e.prototype.toArray=function(){for(var e=[],t=this.getEnumerator();t.moveNext();)e.push(t.current);return e},e.prototype.toMap=function(e,t){throw new Error("Not implemented")},e.prototype.toList=function(){throw new Error("Not implemented")},e.prototype.union=function(e,t){throw new Error("Not implemented")},e.prototype.where=function(e){throw new Error("Not implemented")},e.prototype.zip=function(e,t){throw new Error("Not implemented")},e}();e.Enumerable=t}(exjs||(exjs={}));var Symbol,exjs;!function(e){function t(e){var t;return{next:function(){var n={done:!0,value:void 0};return e&&(t=t||e.getEnumerator())?(n.done=!t.moveNext(),n.value=t.current,n):n}}}Symbol&&Symbol.iterator&&(e.Enumerable.prototype[Symbol.iterator]=function(){return t(this)})}(exjs||(exjs={}));var exjs;!function(e){var t=function(){function t(e){this.size=0,this._keys=[],this._values=[];var t;if(e instanceof Array?t=e.en():e&&e.getEnumerator instanceof Function&&(t=e),t)for(var n=t.getEnumerator();n&&n.moveNext();)this.set(n.current[0],n.current[1])}return t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this.size=0},t.prototype["delete"]=function(e){var t=this._keys.indexOf(e);return t>-1?(this._keys.splice(t,1),this._values.splice(t,1),this.size--,!0):!1},t.prototype.entries=function(){var t=this;return e.range(0,this.size).select(function(e){return[t._keys[e],t._values[e]]})},t.prototype.forEach=function(e,t){null==t&&(t=this);for(var n=0,i=this._keys,r=this._values,o=i.length;o>n;n++)e.call(t,r[n],i[n],this)},t.prototype.get=function(e){var t=this._keys.indexOf(e);return this._values[t]},t.prototype.has=function(e){return this._keys.indexOf(e)>-1},t.prototype.keys=function(){return this._keys.en()},t.prototype.set=function(e,t){var n=this._keys.indexOf(e);n>-1?this._values[n]=t:(this._keys.push(e),this._values.push(t),this.size++)},t.prototype.values=function(){return this._values.en()},t}();e.Map3=t,e.Enumerable.prototype.toMap=function(e,n){for(var i=new t,r=this.getEnumerator();r.moveNext();)i.set(e(r.current),n(r.current));return i},e.List&&(e.List.prototype.toMap=e.Enumerable.prototype.toMap)}(exjs||(exjs={})),function(e){e.Map||(e.Map=exjs.Map3)}("undefined"==typeof window?global:window);var exjs;!function(e){function t(t){var n=new e.Enumerable;return n.getEnumerator=function(){var e={current:void 0,moveNext:function(){return t(e)}};return e},n}e.anonymous=t}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i,r=1,o={current:void 0,moveNext:function(){if(2>r){if(n=n||e.getEnumerator(),n.moveNext())return o.current=n.current,!0;r++}return i=i||t.en().getEnumerator(),i.moveNext()?(o.current=i.current,!0):(o.current=void 0,!1)}};return o}e.Enumerable.prototype.append=function(){for(var n=this,i=[],r=0;r<arguments.length;r++)i[r-0]=arguments[r];var o=new e.Enumerable;return o.getEnumerator=function(){return t(n,i)},o},e.List&&(e.List.prototype.append=e.Enumerable.prototype.append)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),n.moveNext()?(t(r.current=n.current,i),i++,!0):!1}};return r}e.Enumerable.prototype.apply=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.List&&(e.List.prototype.apply=e.Enumerable.prototype.apply)}(exjs||(exjs={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},exjs;!function(e){function t(e){var t=e.length,n={moveNext:void 0,current:void 0},i=-1;return n.moveNext=function(){return i++,i>=t?(n.current=void 0,!1):(n.current=e[i],!0)},n}function n(){return this&&Array.isArray(this)?new i(this):new e.Enumerable}var i=function(e){function n(n){e.call(this),this.getEnumerator=function(){return t(n)},this.toArray=function(){return n.slice(0)}}return __extends(n,e),n}(e.Enumerable);try{Object.defineProperty(Array.prototype,"en",{value:n,enumerable:!1,writable:!1,configurable:!1})}catch(r){Array.prototype.en=n}}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=!1,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),r.current=void 0,n.moveNext()?(r.current=n.current,!0):i?!1:(i=!0,n=t.getEnumerator(),n.moveNext()?(r.current=n.current,!0):!1)}};return r}e.Enumerable.prototype.concat=function(n){var i=this,r=n instanceof Array?n.en():n,o=new e.Enumerable;return o.getEnumerator=function(){return t(i,r)},o},e.List&&(e.List.prototype.concat=e.Enumerable.prototype.concat)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=[],r={current:void 0,moveNext:function(){if(n||(n=e.getEnumerator()),r.current=void 0,!t){for(;n.moveNext();)if(i.indexOf(n.current)<0)return i.push(r.current=n.current),!0;return!1}for(;n.moveNext();){for(var o=0,s=i.length,a=!1;s>o&&!a;o++)a=!!t(i[o],n.current);if(!a)return i.push(r.current=n.current),!0}return!1}};return r}e.Enumerable.prototype.distinct=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.List&&(e.List.prototype.distinct=e.Enumerable.prototype.distinct)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t,n){n=n||function(e,t){return e===t};var i,r={current:void 0,moveNext:function(){for(i||(i=e.getEnumerator()),r.current=void 0;i.moveNext();){for(var o=!1,s=t.getEnumerator();s.moveNext()&&!o;)o=n(i.current,s.current);if(!o)return r.current=i.current,!0}return!1}};return r}e.Enumerable.prototype.except=function(n,i){var r=this,o=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(r,o,i)},s},e.List&&(e.List.prototype.except=e.Enumerable.prototype.except)}(exjs||(exjs={})),Function.prototype.fromJson=function(e,t){function n(e,t){if(null==e)return e;if(t instanceof Function)return t(e);if(t instanceof Array){if(t=t[0],!(t instanceof Function&&e instanceof Array))return;for(var n=[],i=0;i<e.length;i++)n.push(t(e[i]));return n}}var i=new this;if(null==e)return i;var r=[];for(var o in t){var s=n(e[o],t[o]);void 0!==s&&(i[o]=s,r.push(o))}for(var o in this.$jsonMappings)if(!(r.indexOf(o)>-1)){var s=n(e[o],this.$jsonMappings[o]);void 0!==s&&(i[o]=s,r.push(o))}for(var o in e)r.indexOf(o)>-1||(i[o]=e[o]);return i};var exjs;!function(e){function t(e,t,i){var r,o=0,s={current:void 0,moveNext:function(){return r||(r=n(e,t,i)),s.current=void 0,o>=r.length?!1:(s.current=r[o],o++,!0)}};return s}function n(e,t,n){n=n||function(e,t){return e===t};for(var r,o=[],s=[],a=e.getEnumerator();a.moveNext();){r=t(a.current);for(var u=-1,c=0,l=s.length;l>c;c++)if(n(r,s[c])){u=c;break}var h;0>u?(s.push(r),o.push(h=new i(r))):h=o[u],h._add(a.current)}return o}var i=function(e){function t(t){var n=this;e.call(this),this.key=t,this._arr=[],this.getEnumerator=function(){return n._arr.en().getEnumerator()}}return __extends(t,e),t.prototype._add=function(e){this._arr.push(e)},t}(e.Enumerable);e.Enumerable.prototype.groupBy=function(n,i){var r=this,o=new e.Enumerable;return o.getEnumerator=function(){return t(r,n,i)},o},e.List&&(e.List.prototype.groupBy=e.Enumerable.prototype.groupBy)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n,i){i=i||function(e,t){return e===t};var r,o={current:void 0,moveNext:function(){for(r||(r=e.en(t).distinct().getEnumerator()),o.current=void 0;r.moveNext();){for(var s=!1,a=n.getEnumerator();a.moveNext()&&!s;)s=i(r.current,a.current);if(s)return o.current=r.current,!0}return!1}};return o}e.Enumerable.prototype.intersect=function(n,i){var r=this,o=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(r,o,i)},s},e.List&&(e.List.prototype.intersect=e.Enumerable.prototype.intersect)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n,i,r,o,s){s=s||function(e,t){return e===t};var a,u,c=0,l={current:void 0,moveNext:function(){if(l.current=void 0,!a){if(a=t.getEnumerator(),!a.moveNext())return!1;u=e.en(n).toArray()}var h;do{for(;c<u.length;c++)if(h=u[c],s(i(a.current),r(h)))return c++,l.current=o(a.current,h),!0;c=0}while(a.moveNext());return!1}};return l}e.Enumerable.prototype.join=function(n,i,r,o,s){var a=this,u=n instanceof Array?n.en():n,c=new e.Enumerable;return c.getEnumerator=function(){return t(a,u,i,r,o,s)},c},e.List&&(e.List.prototype.join=e.Enumerable.prototype.join)}(exjs||(exjs={}));var exjs;!function(e){function t(){this.constructor=n}e.Enumerable.prototype.toList=function(){for(var e=new n,t=this.getEnumerator();t.moveNext();)e.push(t.current);return e};var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.toString=function(){throw new Error("Not implemented")},t.prototype.toLocaleString=function(){throw new Error("Not implemented")},t.prototype.pop=function(){throw new Error("Not implemented")},t.prototype.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];throw new Error("Not implemented")},t.prototype.shift=function(){throw new Error("Not implemented")},t.prototype.slice=function(e,t){throw new Error("Not implemented")},t.prototype.sort=function(e){throw new Error("Not implemented")},t.prototype.splice=function(){throw new Error("Not implemented")},t.prototype.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];throw new Error("Not implemented")},t.prototype.indexOf=function(e,t){throw new Error("Not implemented")},t.prototype.lastIndexOf=function(e,t){throw new Error("Not implemented")},t.prototype.every=function(e,t){throw new Error("Not implemented")},t.prototype.some=function(e,t){throw new Error("Not implemented")},t.prototype.forEach=function(e,t){throw new Error("Not implemented")},t.prototype.map=function(e,t){throw new Error("Not implemented")},t.prototype.filter=function(e,t){throw new Error("Not implemented")},t.prototype.reduce=function(e,t){throw new Error("Not implemented")},t.prototype.reduceRight=function(e,t){throw new Error("Not implemented")},t.prototype.remove=function(e){throw new Error("Not implemented")},t.prototype.removeWhere=function(e){throw new Error("Not implemented")},t}(e.Enumerable);e.List=n;for(var i in Array)Array.hasOwnProperty(i)&&(n[i]=Array[i]);t.prototype=Array.prototype,n.prototype=new t;for(var r in e.Enumerable.prototype)"getEnumerator"!==r&&(n.prototype[r]=e.Enumerable.prototype[r]);n.prototype.getEnumerator=function(){var e=this,t=e.length,n={moveNext:void 0,current:void 0},i=-1;return n.moveNext=function(){return i++,i>=t?(n.current=void 0,!1):(n.current=e[i],!0)},n},n.prototype.remove=function(e){return this.removeWhere(function(t){return t===e}).any()},n.prototype.removeWhere=function(e){for(var t,n=[],i=this.length-1;i>=0;i--)t=this[i],e(t,i)===!0&&(this.splice(i,1),n.push(t));return n.en().reverse()}}(exjs||(exjs={}));var exjs;!function(e){function t(e,t,i,r){return new n(e,t,i,r)}var n=function(t){function n(e,n,i,r){t.call(this),this.Source=e,r=r||function(e,t){return e>t?1:t>e?-1:0};var o=i===!0?-1:1;this.Sorter=function(e,t){return o*r(n(e),n(t))}}return __extends(n,t),n.prototype.getEnumerator=function(){var t,n=this.Source,i=this.Sorter,r=0,o={current:void 0,moveNext:function(){return t||(t=e.en(n).toArray(),t.sort(i)),o.current=void 0,r>=t.length?!1:(o.current=t[r],r++,!0)}};return o},n.prototype.thenBy=function(e,t){return new i(this,e,!1,t)},n.prototype.thenByDescending=function(e,t){return new i(this,e,!0,t)},n}(e.Enumerable),i=function(e){function t(t,n,i,r){e.call(this,t,n,i,r);var o=t.Sorter,s=this.Sorter;this.Sorter=function(e,t){return o(e,t)||s(e,t)}}return __extends(t,e),t}(n),r=e.Enumerable.prototype;r.orderBy=function(e,n){return t(this,e,!1,n)},r.orderByDescending=function(e,n){return t(this,e,!0,n)},e.List&&(e.List.prototype.orderBy=e.Enumerable.prototype.orderBy,e.List.prototype.orderByDescending=e.Enumerable.prototype.orderByDescending)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i,r=1,o={current:void 0,moveNext:function(){if(2>r){if(n=n||t.en().getEnumerator(),n.moveNext())return o.current=n.current,!0;r++}return i=i||e.getEnumerator(),i.moveNext()?(o.current=i.current,!0):(o.current=void 0,!1)}};return o}e.Enumerable.prototype.prepend=function(){for(var n=this,i=[],r=0;r<arguments.length;r++)i[r-0]=arguments[r];var o=new e.Enumerable;return o.getEnumerator=function(){return t(n,i)},o},e.List&&(e.List.prototype.prepend=e.Enumerable.prototype.prepend)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t,n){var i=e-n,r={current:void 0,moveNext:function(){return i+=n,i>=t?!1:(r.current=i,!0)}};return r}function n(n,i,r){if(n=n||0,i=i||0,n>i)throw new Error("Start cannot be greater than end.");null==r&&(r=1);var o=new e.Enumerable;return o.getEnumerator=function(){return t(n,i,r)},o}e.range=n}(exjs||(exjs={}));var exjs;!function(e){function t(t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.en(t).toArray(),i=n.length),i--,r.current=n[i],i>=0}};return r}e.Enumerable.prototype.reverse=function(){var n=this,i=new e.Enumerable;return i.getEnumerator=function(){return t(n)},i},e.List&&(e.List.prototype.reverse=e.Enumerable.prototype.reverse)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){if(t=t||0,0===t)return Math.round(e);var n=Math.pow(10,t);return Math.round(e*n)/n}e.round=t}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),n.moveNext()?(r.current=t(n.current,i),i++,!0):!1}};return r}function n(t,n){var i,r,o={current:void 0,moveNext:function(){for(o.current=void 0,i||(i=t.getEnumerator());!r||!r.moveNext();){if(!i.moveNext())return!1;r=e.selectorEnumerator(n(i.current))}return o.current=r.current,!0}};return o}e.Enumerable.prototype.select=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.Enumerable.prototype.selectMany=function(t){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return n(i,t)},r},e.List&&(e.List.prototype.select=e.Enumerable.prototype.select,e.List.prototype.selectMany=e.Enumerable.prototype.selectMany)}(exjs||(exjs={}));var exjs;!function(e){function t(e){return Array.isArray(e)?e.en().getEnumerator():null!=e&&"function"==typeof e.getEnumerator?e.getEnumerator():null}e.selectorEnumerator=t}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i={current:void 0,moveNext:function(){if(!n){n=e.getEnumerator();for(var r=0;t>r;r++)if(!n.moveNext())return!1}return n.moveNext()?(i.current=n.current,!0):(i.current=void 0,!1)}};return i}function n(e,t){var n,i={current:void 0,moveNext:function(){if(!n){n=e.getEnumerator();for(var r=0;n.moveNext();r++)if(!t(i.current=n.current,r))return!0;return i.current=void 0,!1}return n.moveNext()?(i.current=n.current,!0):(i.current=void 0,!1)}};return i}e.Enumerable.prototype.skip=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.Enumerable.prototype.skipWhile=function(t){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return n(i,t)},r},e.List&&(e.List.prototype.skip=e.Enumerable.prototype.skip,e.List.prototype.skipWhile=e.Enumerable.prototype.skipWhile)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),i++,i>t?!1:(r.current=void 0,n.moveNext()?(r.current=n.current,!0):!1)}};return r}function n(e,t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),n.moveNext()&&t(n.current,i)?(i++,r.current=n.current,!0):(r.current=void 0,!1)}};return r}e.Enumerable.prototype.take=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.Enumerable.prototype.takeWhile=function(t){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return n(i,t)},r},e.List&&(e.List.prototype.take=e.Enumerable.prototype.take,e.List.prototype.takeWhile=e.Enumerable.prototype.takeWhile)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n){var i,r=!1,o=[],s={current:void 0,moveNext:function(){if(r){if(null==i)return!1;o.push(i),i=e.selectorEnumerator(n(s.current))}else i=t.getEnumerator(),r=!0;for(;!(i&&i.moveNext()||o.length<1);)i=o.pop();return s.current=null==i?void 0:i.current,void 0!==s.current}};return s}function n(t,n,i){var r,o=!1,s=[],a={current:void 0,moveNext:function(){if(o){if(null==r)return!1;s.push(r),r=e.selectorEnumerator(n(a.current))}else r=t.getEnumerator(),o=!0;do{for(;!(r&&r.moveNext()||s.length<1);)r=s.pop();a.current=null==r?void 0:r.current}while(i(a.current));return void 0!==a.current}};return a}e.Enumerable.prototype.traverse=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.Enumerable.prototype.traverseUnique=function(t,i){var r=this,o=[],s=new e.Enumerable;return i?s.getEnumerator=function(){return n(r,t,function(e){return o.some(function(t){return i(e,t)})?!0:(o.push(e),!1)})}:s.getEnumerator=function(){return n(r,t,function(e){return o.indexOf(e)>-1?!0:(o.push(e),!1)})},s},e.List&&(e.List.prototype.traverse=e.Enumerable.prototype.traverse,e.List.prototype.traverseUnique=e.Enumerable.prototype.traverseUnique)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n,i){i=i||function(e,t){return e===t};var r,o,s=[],a={current:void 0,moveNext:function(){if(r||(r=e.en(t).distinct().getEnumerator()),a.current=void 0,!o&&r.moveNext())return s.push(a.current=r.current),!0;for(o=o||e.en(n).distinct().getEnumerator();o.moveNext();){for(var u=0,c=!1,l=s.length;l>u&&!c;u++)c=i(s[u],o.current);if(!c)return a.current=o.current,!0}return!1}};return a}e.Enumerable.prototype.union=function(n,i){var r=this,o=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(r,o,i)},s},e.List&&(e.List.prototype.union=e.Enumerable.prototype.union)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i={current:void 0,moveNext:function(){n||(n=e.getEnumerator());for(var r;n.moveNext();)if(t(r=n.current))return i.current=r,!0;return!1}};return i}e.Enumerable.prototype.where=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.List&&(e.List.prototype.where=e.Enumerable.prototype.where)}(exjs||(exjs={}));var exjs;!function(e){function t(t){var i=new e.Enumerable;return i.getEnumerator=function(){return n(t)},i}function n(e){var t=e.getEnumerator(),n={current:void 0,moveNext:void 0};return n.moveNext=function(){return t.moveNext()?(n.current=t.current,!0):(n.current=void 0,!1)},n}e.en=t}(exjs||(exjs={}));var ex=exjs.en,exjs;!function(e){function t(e,t,n){var i,r,o={current:void 0,moveNext:function(){return i||(i=e.getEnumerator()),r||(r=t.getEnumerator()),o.current=void 0,i.moveNext()&&r.moveNext()?(o.current=n(i.current,r.current),!0):!1}};return o}e.Enumerable.prototype.zip=function(n,i){var r=this,o=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(r,o,i)},s},e.List&&(e.List.prototype.zip=e.Enumerable.prototype.zip)}(exjs||(exjs={})),define("ex",function(){}),Array.prototype.clone||(Array.prototype.clone=function(){return this.slice(0)}),Array.prototype.contains||(Array.prototype.contains=function(e){return-1!==this.indexOf(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n=t||0,i=this.length;for(n;i>n;n++)if(this[n]===e)return n;return-1}),Array.prototype.indexOfTest=function(e,t){var n=t||0,i=this.length;for(n;i>n;n++)if(e(this[n]))return n;return-1},Array.prototype.insert=function(e,t){this.splice(t,0,e)},Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),Array.prototype.move=function(e,t){this.splice(t,0,this.splice(e,1)[0])},Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},Array.prototype.removeAt=function(e){this.splice(e,1)},Math.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},Math.constrain=function(e,t,n){return Math.clamp(e,t,n)},Math.degreesToRadians=function(e){return Math.TAU*(e/360)},Math.distanceBetween=function(e,t,n,i){return Math.sqrt(Math.sq(n-e)+Math.sq(i-t))},Math.lerp=function(e,t,n){return e+(t-e)*n},Math.mag=function(e,t,n){return Math.sqrt(e*e+t*t+n*n)},Math.map=function(e,t,n,i,r){return i+(r-i)*((e-t)/(n-t))},Math.median=function(e){e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},Math.normalise=function(e,t,n){return(e-t)/(n-t)},Math.radiansToDegrees=function(e){return 360*e/Math.TAU},Math.randomBetween=function(e,t){return t||(t=e,e=0),e>=t?e:e+(t-e)*Math.random()},Math.roundToDecimalPlace=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},Math.sq=function(e){return e*e},Math.TAU=2*Math.PI,Number.prototype.isInteger||(Number.prototype.isInteger=function(){return this%1===0}),"function"!=typeof Object.create&&(Object.create=function(e,t){function n(){}n.prototype=e;var i=new n;if("object"==typeof t)for(var r in t)t.hasOwnProperty(r)&&(i[r]=t[r].value);return i}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=n.length;return function(r){if("object"!=typeof r&&"function"!=typeof r||null===r)throw new TypeError("Object.keys called on non-object");var o=[];for(var s in r)e.call(r,s)&&o.push(s);if(t)for(var a=0;i>a;a++)e.call(r,n[a])&&o.push(n[a]);return o}}()),String.prototype.b64_to_utf8=function(){return decodeURIComponent(escape(window.atob(this)))},String.prototype.contains=function(e){return-1!==this.indexOf(e)},String.prototype.endsWith||(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),String.format=function(){for(var e=arguments[0],t=0;t<arguments.length-1;t++){var n=new RegExp("\\{"+t+"\\}","gm");e=e.replace(n,arguments[t+1])}return e},String.prototype.hashCode=function(){var e,t,n,i=0;if(0===this.length)return i.toString();for(e=0,n=this.length;n>e;e++)t=this.charCodeAt(e),i=(i<<5)-i+t,i|=0;return i.toString()},String.prototype.isAlphanumeric=function(){return/^[a-zA-Z0-9]*$/.test(this)},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.startsWith||(String.prototype.startsWith=function(e){return 0==this.indexOf(e)}),String.prototype.toCssClass=function(){return this.replace(/[^a-z0-9]/g,function(e){var t=e.charCodeAt(0);return 32==t?"-":t>=65&&90>=t?"_"+e.toLowerCase():"__"+("000"+t.toString(16)).slice(-4)})},String.prototype.toFileName=function(){return this.replace(/[^a-z0-9]/gi,"_").toLowerCase()},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),String.prototype.utf8_to_b64=function(){return window.btoa(unescape(encodeURIComponent(this)))},define("ext",function(){});var HTTPStatusCode;!function(e){e.CONTINUE=100,e.SWITCHING_PROTOCOLS=101,e.PROCESSING=102,e.OK=200,e.CREATED=201,e.ACCEPTED=202,e.NON_AUTHORITATIVE_INFORMATION=203,e.NO_CONTENT=204,e.RESET_CONTENT=205,e.PARTIAL_CONTENT=206,e.MULTI_STATUS=207,e.MULTIPLE_CHOICES=300,e.MOVED_PERMANENTLY=301,e.MOVED_TEMPORARILY=302,e.SEE_OTHER=303,e.NOT_MODIFIED=304,e.USE_PROXY=305,e.TEMPORARY_REDIRECT=307,e.BAD_REQUEST=400,e.UNAUTHORIZED=401,e.PAYMENT_REQUIRED=402,e.FORBIDDEN=403,e.NOT_FOUND=404,e.METHOD_NOT_ALLOWED=405,e.NOT_ACCEPTABLE=406,e.PROXY_AUTHENTICATION_REQUIRED=407,e.REQUEST_TIME_OUT=408,e.CONFLICT=409,e.GONE=410,e.LENGTH_REQUIRED=411,e.PRECONDITION_FAILED=412,e.REQUEST_ENTITY_TOO_LARGE=413,e.REQUEST_URI_TOO_LARGE=414,e.UNSUPPORTED_MEDIA_TYPE=415,e.REQUESTED_RANGE_NOT_SATISFIABLE=416,e.EXPECTATION_FAILED=417,e.IM_A_TEAPOT=418,e.UNPROCESSABLE_ENTITY=422,e.LOCKED=423,e.FAILED_DEPENDENCY=424,e.UNORDERED_COLLECTION=425,e.UPGRADE_REQUIRED=426,e.PRECONDITION_REQUIRED=428,e.TOO_MANY_REQUESTS=429,e.REQUEST_HEADER_FIELDS_TOO_LARGE=431,e.INTERNAL_SERVER_ERROR=500,e.NOT_IMPLEMENTED=501,e.BAD_GATEWAY=502,e.SERVICE_UNAVAILABLE=503,e.GATEWAY_TIME_OUT=504,e.HTTP_VERSION_NOT_SUPPORTED=505,e.VARIANT_ALSO_NEGOTIATES=506,e.INSUFFICIENT_STORAGE=507,e.BANDWIDTH_LIMIT_EXCEEDED=509,e.NOT_EXTENDED=510,e.NETWORK_AUTHENTICATION_REQUIRED=511}(HTTPStatusCode||(HTTPStatusCode={})),define("httpstatuscodes",function(){});var KeyCodes;!function(e){var t;!function(e){e.Backspace=8,e.Tab=9,e.Enter=13,e.Shift=16,e.Ctrl=17,e.Alt=18,e.PauseBreak=19,e.CapsLock=20,e.Escape=27,e.Spacebar=32,e.PageUp=33,e.PageDown=34,e.End=35,e.Home=36,e.LeftArrow=37,e.UpArrow=38,e.RightArrow=39,e.DownArrow=40,e.PrintScrn=44,e.Insert=45,e.Delete=46,e.Zero=48,e.One=49,e.Two=50,e.Three=51,e.Four=52,e.Five=53,e.Six=54,e.Seven=55,e.Eight=56,e.Nine=57,e.a=65,e.b=66,e.c=67,e.d=68,e.e=69,e.f=70,e.g=71,e.h=72,e.i=73,e.j=74,e.k=75,e.l=76,e.m=77,e.n=78,e.o=79,e.p=80,e.q=81,e.r=82,e.s=83,e.t=84,e.u=85,e.v=86,e.w=87,e.x=88,e.y=89,e.z=90,e.LeftWindowKey=91,e.RightWindowKey=92,e.SelectKey=93,e.Numpad0=96,e.Numpad1=97,e.Numpad2=98,e.Numpad3=99,e.Numpad4=100,e.Numpad5=101,e.Numpad6=102,e.Numpad7=103,e.Numpad8=104,e.Numpad9=105,e.Multiply=106,e.NumpadPlus=107,e.NumpadMinus=109,e.DecimalPoint=110,e.Divide=111,e.F1=112,e.F2=113,e.F3=114,e.F4=115,e.F5=116,e.F6=117,e.F7=118,e.F8=119,e.F9=120,e.F10=121,e.F11=122,e.F12=123,e.NumLock=144,e.ScrollLock=145,e.Semicolon=186,e.Equals=187,e.Comma=188,e.LessThan=188,e.Dash=189,e.Period=190,e.GreaterThan=190,e.ForwardSlash=191,e.QuestionMark=191,e.GraveAccent=192,e.Tilde=192,e.OpenCurlyBracket=219,e.OpenSquareBracket=219,e.BackSlash=220,e.VerticalPipe=220,e.CloseCurlyBracket=221,e.CloseSquareBracket=221,e.Quote=222,e.CommandFF=224}(t=e.KeyDown||(e.KeyDown={}))}(KeyCodes||(KeyCodes={}));var KeyCodes;!function(e){var t;!function(e){e.Backspace=8,e.Enter=13,e.Spacebar=32,e.Hash=35,e.GraveAccent=39,e.ForwardSlash=32,e.Asterisk=42,e.Plus=43,e.Comma=44,e.Minus=45,e.Period=46,e.ForwardSlash=47,e.Zero=48,e.One=49,e.Two=50,e.Three=51,e.Four=52,e.Five=53,e.Six=54,e.Seven=55,e.Eight=56,e.Nine=57,e.Colon=58,e.Semicolon=59,e.LessThan=60,e.Equals=61,e.GreaterThan=62,e.QuestionMark=63,e.At=64,e.OpenSquareBracket=91,e.BackSlash=92,e.CloseSquareBracket=93,e.a=97,e.b=98,e.c=99,e.d=100,e.e=101,e.f=102,e.g=103,e.h=104,e.i=105,e.j=106,e.k=107,e.l=108,e.m=109,e.n=110,e.o=111,e.p=112,e.q=113,e.r=114,e.s=115,e.t=116,e.u=117,e.v=118,e.w=119,e.x=120,e.y=121,e.z=122,e.OpenCurlyBracket=123,e.VerticalPipe=124,e.CloseCurlyBracket=125,e.Tilde=126}(t=e.KeyPress||(e.KeyPress={}))}(KeyCodes||(KeyCodes={})),define("keycodes",function(){}),function(e,t,n){"use strict";function i(e,t,i,o){i=i||"width";var s,u,c,p=(t.match(l)||[])[2],d="px"===p?1:h[p+"toPx"],f=/r?em/i;if(d||f.test(p)&&!o)e=d?e:"rem"===p?a:"fontSize"===i?e.parentNode||e:e,d=d||parseFloat(r(e,"fontSize")),c=parseFloat(t)*d;else{s=e.style,u=s[i];try{s[i]=t}catch(g){return 0}c=s[i]?parseFloat(r(e,i)):0,s[i]=u!==n?u:null}return c}function r(e,t){var n,s,a,u,h,p=/^top|bottom/,d=["paddingTop","paddingBottom","borderTop","borderBottom"],f=4;if(n=c?c(e)[t]:(s=e.style["pixel"+t.charAt(0).toUpperCase()+t.slice(1)])?s+"px":"fontSize"===t?i(e,"1em","left",1)+"px":e.currentStyle[t],a=(n.match(l)||[])[2],"%"===a&&o)if(p.test(t)){for(u=(h=e.parentNode||e).offsetHeight;f--;)u-=parseFloat(r(h,d[f]));n=parseFloat(n)/100*u+"px"}else n=i(e,n);else("auto"===n||a&&"px"!==a)&&c?n=0:a&&"px"!==a&&!c&&(n=i(e,n)+"px");return n}var o,s=t.createElement("test"),a=t.documentElement,u=t.defaultView,c=u&&u.getComputedStyle,l=/^(-?[\d+\.\-]+)([a-z]+|%)$/i,h={},p=[1/25.4,1/2.54,1/72,1/6],d=["mm","cm","pt","pc","in","mozmm"],f=6;for(a.appendChild(s),c&&(s.style.marginTop="1%",o="1%"===c(s).marginTop);f--;)h[d[f]+"toPx"]=p[f]?p[f]*h.inToPx:i(s,"1"+d[f]);a.removeChild(s),s=n,e.Length={toPx:i}}(this,this.document),define("length",function(){});var exjs;!function(e){e.version="0.3.0"}(exjs||(exjs={}));var exjs;!function(e){Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)})}(exjs||(exjs={}));var exjs;!function(e){var t=function(){function e(){}return e.prototype.getEnumerator=function(){return{moveNext:function(){return!1},current:void 0}},e.prototype.aggregate=function(e,t){for(var n=e,i=this.getEnumerator();i.moveNext();)n=t(n,i.current);return n},e.prototype.all=function(e){if(e)for(var t=this.getEnumerator(),n=0;t.moveNext();){if(!e(t.current,n))return!1;n++}return!0},e.prototype.any=function(e){for(var t=this.getEnumerator(),n=0;t.moveNext();){if(!e)return!0;if(e(t.current,n))return!0;n++}return!1},e.prototype.apply=function(e){throw new Error("Not implemented")},e.prototype.at=function(e){for(var t=this.getEnumerator(),n=0;t.moveNext();){if(n===e)return t.current;n++}},e.prototype.average=function(e){var t=0,n=0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var i=this.getEnumerator();i.moveNext();)n+=e(i.current),t++;return 0===t?0:n/t},e.prototype.concat=function(e){throw new Error("Not implemented")},e.prototype.count=function(e){for(var t=0,n=this.getEnumerator();n.moveNext();)(!e||e(n.current))&&t++;return t},e.prototype.difference=function(e,t){return t=t||function(e,t){return e===t},e instanceof Array&&(e=e.en()),{intersection:this.intersect(e,t).toArray().en(),aNotB:this.except(e,t).toArray().en(),bNotA:e.except(this,t).toArray().en()}},e.prototype.distinct=function(e){throw new Error("Not implemented")},e.prototype.except=function(e,t){throw new Error("Not implemented")},e.prototype.first=function(e){for(var t=this.getEnumerator();t.moveNext();)if(!e||e(t.current))return t.current},e.prototype.firstIndex=function(e){for(var t=this.getEnumerator(),n=0;t.moveNext();n++)if(!e||e(t.current))return n;return-1},e.prototype.forEach=function(e){for(var t=this.getEnumerator();t.moveNext();)e(t.current)},e.prototype.groupBy=function(e,t){throw new Error("Not implemented")},e.prototype.intersect=function(e,t){throw new Error("Not implemented")},e.prototype.join=function(e,t,n,i,r){throw new Error("Not implemented")},e.prototype.last=function(e){for(var t,n=this.getEnumerator();n.moveNext();)(!e||e(n.current))&&(t=n.current);return t},e.prototype.lastIndex=function(e){for(var t=-1,n=this.getEnumerator(),i=0;n.moveNext();i++)(!e||e(n.current))&&(t=i);return t},e.prototype.max=function(e){var t=this.getEnumerator();if(!t.moveNext())return 0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var n=e(t.current);t.moveNext();)n=Math.max(n,e(t.current));return n},e.prototype.min=function(e){var t=this.getEnumerator();if(!t.moveNext())return 0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var n=e(t.current);t.moveNext();)n=Math.min(n,e(t.current));return n},e.prototype.orderBy=function(e,t){throw new Error("Not implemented")},e.prototype.orderByDescending=function(e,t){throw new Error("Not implemented")},e.prototype.reverse=function(){throw new Error("Not implemented")},e.prototype.select=function(e){throw new Error("Not implemented")},e.prototype.selectMany=function(e){throw new Error("Not implemented")},e.prototype.skip=function(e){throw new Error("Not implemented")},e.prototype.skipWhile=function(e){throw new Error("Not implemented")},e.prototype.standardDeviation=function(e){var t=this.average(e),n=0,i=0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var r=this.getEnumerator();r.moveNext();){var o=e(r.current)-t;n+=o*o,i++}return Math.sqrt(n/i)},e.prototype.sum=function(e){var t=0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var n=this.getEnumerator();n.moveNext();)t+=e(n.current);
return t},e.prototype.take=function(e){throw new Error("Not implemented")},e.prototype.takeWhile=function(e){throw new Error("Not implemented")},e.prototype.traverse=function(e){throw new Error("Not implemented")},e.prototype.traverseUnique=function(e,t){throw new Error("Not implemented")},e.prototype.toArray=function(){for(var e=[],t=this.getEnumerator();t.moveNext();)e.push(t.current);return e},e.prototype.toMap=function(e,t){throw new Error("Not implemented")},e.prototype.toList=function(){throw new Error("Not implemented")},e.prototype.union=function(e,t){throw new Error("Not implemented")},e.prototype.where=function(e){throw new Error("Not implemented")},e.prototype.zip=function(e,t){throw new Error("Not implemented")},e}();e.Enumerable=t}(exjs||(exjs={}));var Symbol,exjs;!function(e){function t(e){var t;return{next:function(){var n={done:!0,value:void 0};return e&&(t=t||e.getEnumerator())?(n.done=!t.moveNext(),n.value=t.current,n):n}}}Symbol&&Symbol.iterator&&(e.Enumerable.prototype[Symbol.iterator]=function(){return t(this)})}(exjs||(exjs={}));var exjs;!function(e){var t=function(){function t(e){this.size=0,this._keys=[],this._values=[];var t;if(e instanceof Array?t=e.en():e&&e.getEnumerator instanceof Function&&(t=e),t)for(var n=t.getEnumerator();n&&n.moveNext();)this.set(n.current[0],n.current[1])}return t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this.size=0},t.prototype["delete"]=function(e){var t=this._keys.indexOf(e);return t>-1?(this._keys.splice(t,1),this._values.splice(t,1),this.size--,!0):!1},t.prototype.entries=function(){var t=this;return e.range(0,this.size).select(function(e){return[t._keys[e],t._values[e]]})},t.prototype.forEach=function(e,t){null==t&&(t=this);for(var n=0,i=this._keys,r=this._values,o=i.length;o>n;n++)e.call(t,r[n],i[n],this)},t.prototype.get=function(e){var t=this._keys.indexOf(e);return this._values[t]},t.prototype.has=function(e){return this._keys.indexOf(e)>-1},t.prototype.keys=function(){return this._keys.en()},t.prototype.set=function(e,t){var n=this._keys.indexOf(e);return void(n>-1?this._values[n]=t:(this._keys.push(e),this._values.push(t),this.size++))},t.prototype.values=function(){return this._values.en()},t}();e.Map3=t,e.Enumerable.prototype.toMap=function(e,n){for(var i=new t,r=this.getEnumerator();r.moveNext();)i.set(e(r.current),n(r.current));return i},e.List&&(e.List.prototype.toMap=e.Enumerable.prototype.toMap)}(exjs||(exjs={})),function(e){e.Map||(e.Map=exjs.Map3)}("undefined"==typeof window?global:window);var exjs;!function(e){function t(e,t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),n.moveNext()?(t(r.current=n.current,i),i++,!0):!1}};return r}e.Enumerable.prototype.apply=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.List&&(e.List.prototype.apply=e.Enumerable.prototype.apply)}(exjs||(exjs={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);n.prototype=t.prototype,e.prototype=new n},exjs;!function(e){function t(e){var t=e.length,n={moveNext:void 0,current:void 0},i=-1;return n.moveNext=function(){return i++,i>=t?(n.current=void 0,!1):(n.current=e[i],!0)},n}function n(){return this&&Array.isArray(this)?new i(this):new e.Enumerable}var i=function(e){function n(n){e.call(this),this.getEnumerator=function(){return t(n)},this.toArray=function(){return n.slice(0)}}return __extends(n,e),n}(e.Enumerable);try{Object.defineProperty(Array.prototype,"en",{value:n,enumerable:!1,writable:!1,configurable:!1})}catch(r){Array.prototype.en=n}}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=!1,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),r.current=void 0,n.moveNext()?(r.current=n.current,!0):i?!1:(i=!0,n=t.getEnumerator(),n.moveNext()?(r.current=n.current,!0):!1)}};return r}e.Enumerable.prototype.concat=function(n){var i=this,r=n instanceof Array?n.en():n,o=new e.Enumerable;return o.getEnumerator=function(){return t(i,r)},o},e.List&&(e.List.prototype.concat=e.Enumerable.prototype.concat)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=[],r={current:void 0,moveNext:function(){if(n||(n=e.getEnumerator()),r.current=void 0,!t){for(;n.moveNext();)if(i.indexOf(n.current)<0)return i.push(r.current=n.current),!0;return!1}for(;n.moveNext();){for(var o=0,s=i.length,a=!1;s>o&&!a;o++)a=!!t(i[o],n.current);if(!a)return i.push(r.current=n.current),!0}return!1}};return r}e.Enumerable.prototype.distinct=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.List&&(e.List.prototype.distinct=e.Enumerable.prototype.distinct)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t,n){n=n||function(e,t){return e===t};var i,r={current:void 0,moveNext:function(){for(i||(i=e.getEnumerator()),r.current=void 0;i.moveNext();){for(var o=!1,s=t.getEnumerator();s.moveNext()&&!o;)o=n(i.current,s.current);if(!o)return r.current=i.current,!0}return!1}};return r}e.Enumerable.prototype.except=function(n,i){var r=this,o=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(r,o,i)},s},e.List&&(e.List.prototype.except=e.Enumerable.prototype.except)}(exjs||(exjs={})),Function.prototype.fromJson=function(e,t){function n(e,t){if(null==e)return e;if(t instanceof Function)return t(e);if(t instanceof Array){if(t=t[0],!(t instanceof Function&&e instanceof Array))return;for(var n=[],i=0;i<e.length;i++)n.push(t(e[i]));return n}}var i=new this;if(null==e)return i;var r=[];for(var o in t){var s=n(e[o],t[o]);void 0!==s&&(i[o]=s,r.push(o))}for(var o in this.$jsonMappings)if(!(r.indexOf(o)>-1)){var s=n(e[o],this.$jsonMappings[o]);void 0!==s&&(i[o]=s,r.push(o))}for(var o in e)r.indexOf(o)>-1||(i[o]=e[o]);return i};var exjs;!function(e){function t(e,t,i){var r,o=0,s={current:void 0,moveNext:function(){return r||(r=n(e,t,i)),s.current=void 0,o>=r.length?!1:(s.current=r[o],o++,!0)}};return s}function n(e,t,n){n=n||function(e,t){return e===t};for(var r,o=[],s=[],a=e.getEnumerator();a.moveNext();){r=t(a.current);for(var u=-1,c=0,l=s.length;l>c;c++)if(n(r,s[c])){u=c;break}var h;0>u?(s.push(r),o.push(h=new i(r))):h=o[u],h._add(a.current)}return o}var i=function(e){function t(t){var n=this;e.call(this),this.key=t,this._arr=[],this.getEnumerator=function(){return n._arr.en().getEnumerator()}}return __extends(t,e),t.prototype._add=function(e){this._arr.push(e)},t}(e.Enumerable);e.Enumerable.prototype.groupBy=function(n,i){var r=this,o=new e.Enumerable;return o.getEnumerator=function(){return t(r,n,i)},o},e.List&&(e.List.prototype.groupBy=e.Enumerable.prototype.groupBy)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n,i){i=i||function(e,t){return e===t};var r,o={current:void 0,moveNext:function(){for(r||(r=e.en(t).distinct().getEnumerator()),o.current=void 0;r.moveNext();){for(var s=!1,a=n.getEnumerator();a.moveNext()&&!s;)s=i(r.current,a.current);if(s)return o.current=r.current,!0}return!1}};return o}e.Enumerable.prototype.intersect=function(n,i){var r=this,o=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(r,o,i)},s},e.List&&(e.List.prototype.intersect=e.Enumerable.prototype.intersect)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n,i,r,o,s){s=s||function(e,t){return e===t};var a,u,c=0,l={current:void 0,moveNext:function(){if(l.current=void 0,!a){if(a=t.getEnumerator(),!a.moveNext())return!1;u=e.en(n).toArray()}var h;do{for(;c<u.length;c++)if(h=u[c],s(i(a.current),r(h)))return c++,l.current=o(a.current,h),!0;c=0}while(a.moveNext());return!1}};return l}e.Enumerable.prototype.join=function(n,i,r,o,s){var a=this,u=n instanceof Array?n.en():n,c=new e.Enumerable;return c.getEnumerator=function(){return t(a,u,i,r,o,s)},c},e.List&&(e.List.prototype.join=e.Enumerable.prototype.join)}(exjs||(exjs={}));var exjs;!function(e){function t(){this.constructor=n}e.Enumerable.prototype.toList=function(){for(var e=new n,t=this.getEnumerator();t.moveNext();)e.push(t.current);return e};var n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.toString=function(){throw new Error("Not implemented")},t.prototype.toLocaleString=function(){throw new Error("Not implemented")},t.prototype.pop=function(){throw new Error("Not implemented")},t.prototype.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];throw new Error("Not implemented")},t.prototype.shift=function(){throw new Error("Not implemented")},t.prototype.slice=function(e,t){throw new Error("Not implemented")},t.prototype.sort=function(e){throw new Error("Not implemented")},t.prototype.splice=function(){throw new Error("Not implemented")},t.prototype.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];throw new Error("Not implemented")},t.prototype.indexOf=function(e,t){throw new Error("Not implemented")},t.prototype.lastIndexOf=function(e,t){throw new Error("Not implemented")},t.prototype.every=function(e,t){throw new Error("Not implemented")},t.prototype.some=function(e,t){throw new Error("Not implemented")},t.prototype.forEach=function(e,t){throw new Error("Not implemented")},t.prototype.map=function(e,t){throw new Error("Not implemented")},t.prototype.filter=function(e,t){throw new Error("Not implemented")},t.prototype.reduce=function(e,t){throw new Error("Not implemented")},t.prototype.reduceRight=function(e,t){throw new Error("Not implemented")},t.prototype.remove=function(e){throw new Error("Not implemented")},t.prototype.removeWhere=function(e){throw new Error("Not implemented")},t}(e.Enumerable);e.List=n;for(var i in Array)Array.hasOwnProperty(i)&&(n[i]=Array[i]);t.prototype=Array.prototype,n.prototype=new t;for(var r in e.Enumerable.prototype)"getEnumerator"!==r&&(n.prototype[r]=e.Enumerable.prototype[r]);n.prototype.getEnumerator=function(){var e=this,t=e.length,n={moveNext:void 0,current:void 0},i=-1;return n.moveNext=function(){return i++,i>=t?(n.current=void 0,!1):(n.current=e[i],!0)},n},n.prototype.remove=function(e){return this.removeWhere(function(t){return t===e}).any()},n.prototype.removeWhere=function(e){for(var t,n=[],i=this.length-1;i>=0;i--)t=this[i],e(t,i)===!0&&(this.splice(i,1),n.push(t));return n.en().reverse()}}(exjs||(exjs={}));var exjs;!function(e){function t(e,t,i,r){return new n(e,t,i,r)}var n=function(t){function n(e,n,i,r){t.call(this),this.Source=e,r=r||function(e,t){return e>t?1:t>e?-1:0};var o=i===!0?-1:1;this.Sorter=function(e,t){return o*r(n(e),n(t))}}return __extends(n,t),n.prototype.getEnumerator=function(){var t,n=this.Source,i=this.Sorter,r=0,o={current:void 0,moveNext:function(){return t||(t=e.en(n).toArray(),t.sort(i)),o.current=void 0,r>=t.length?!1:(o.current=t[r],r++,!0)}};return o},n.prototype.thenBy=function(e,t){return new i(this,e,!1,t)},n.prototype.thenByDescending=function(e,t){return new i(this,e,!0,t)},n}(e.Enumerable),i=function(e){function t(t,n,i,r){e.call(this,t,n,i,r);var o=t.Sorter,s=this.Sorter;this.Sorter=function(e,t){return o(e,t)||s(e,t)}}return __extends(t,e),t}(n),r=e.Enumerable.prototype;r.orderBy=function(e,n){return t(this,e,!1,n)},r.orderByDescending=function(e,n){return t(this,e,!0,n)},e.List&&(e.List.prototype.orderBy=e.Enumerable.prototype.orderBy,e.List.prototype.orderByDescending=e.Enumerable.prototype.orderByDescending)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t,n){var i=e-n,r={current:void 0,moveNext:function(){return i+=n,i>=t?!1:(r.current=i,!0)}};return r}function n(n,i,r){if(n=n||0,i=i||0,n>i)throw new Error("Start cannot be greater than end.");null==r&&(r=1);var o=new e.Enumerable;return o.getEnumerator=function(){return t(n,i,r)},o}e.range=n}(exjs||(exjs={}));var exjs;!function(e){function t(t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.en(t).toArray(),i=n.length),i--,r.current=n[i],i>=0}};return r}e.Enumerable.prototype.reverse=function(){var n=this,i=new e.Enumerable;return i.getEnumerator=function(){return t(n)},i},e.List&&(e.List.prototype.reverse=e.Enumerable.prototype.reverse)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){if(t=t||0,0===t)return Math.round(e);var n=Math.pow(10,t);return Math.round(e*n)/n}e.round=t}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),n.moveNext()?(r.current=t(n.current,i),i++,!0):!1}};return r}function n(t,n){var i,r,o={current:void 0,moveNext:function(){for(o.current=void 0,i||(i=t.getEnumerator());!r||!r.moveNext();){if(!i.moveNext())return!1;r=e.selectorEnumerator(n(i.current))}return o.current=r.current,!0}};return o}e.Enumerable.prototype.select=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.Enumerable.prototype.selectMany=function(t){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return n(i,t)},r},e.List&&(e.List.prototype.select=e.Enumerable.prototype.select,e.List.prototype.selectMany=e.Enumerable.prototype.selectMany)}(exjs||(exjs={}));var exjs;!function(e){function t(e){return Array.isArray(e)?e.en().getEnumerator():null!=e&&"function"==typeof e.getEnumerator?e.getEnumerator():null}e.selectorEnumerator=t}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i={current:void 0,moveNext:function(){if(!n){n=e.getEnumerator();for(var r=0;t>r;r++)if(!n.moveNext())return!1}return n.moveNext()?(i.current=n.current,!0):(i.current=void 0,!1)}};return i}function n(e,t){var n,i={current:void 0,moveNext:function(){if(!n){n=e.getEnumerator();for(var r=0;n.moveNext();r++)if(!t(i.current=n.current,r))return!0;return i.current=void 0,!1}return n.moveNext()?(i.current=n.current,!0):(i.current=void 0,!1)}};return i}e.Enumerable.prototype.skip=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.Enumerable.prototype.skipWhile=function(t){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return n(i,t)},r},e.List&&(e.List.prototype.skip=e.Enumerable.prototype.skip,e.List.prototype.skipWhile=e.Enumerable.prototype.skipWhile)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),i++,i>t?!1:(r.current=void 0,n.moveNext()?(r.current=n.current,!0):!1)}};return r}function n(e,t){var n,i=0,r={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),n.moveNext()&&t(n.current,i)?(i++,r.current=n.current,!0):(r.current=void 0,!1)}};return r}e.Enumerable.prototype.take=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.Enumerable.prototype.takeWhile=function(t){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return n(i,t)},r},e.List&&(e.List.prototype.take=e.Enumerable.prototype.take,e.List.prototype.takeWhile=e.Enumerable.prototype.takeWhile)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n){var i,r=!1,o=[],s={current:void 0,moveNext:function(){if(r){if(null==i)return!1;o.push(i),i=e.selectorEnumerator(n(s.current))}else i=t.getEnumerator(),r=!0;for(;!(i&&i.moveNext()||o.length<1);)i=o.pop();return s.current=null==i?void 0:i.current,void 0!==s.current}};return s}function n(t,n,i){var r,o=!1,s=[],a={current:void 0,moveNext:function(){if(o){if(null==r)return!1;s.push(r),r=e.selectorEnumerator(n(a.current))}else r=t.getEnumerator(),o=!0;do{for(;!(r&&r.moveNext()||s.length<1);)r=s.pop();a.current=null==r?void 0:r.current}while(i(a.current));return void 0!==a.current}};return a}e.Enumerable.prototype.traverse=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.Enumerable.prototype.traverseUnique=function(t,i){var r=this,o=[],s=new e.Enumerable;return i?s.getEnumerator=function(){return n(r,t,function(e){return o.some(function(t){return i(e,t)})?!0:(o.push(e),!1)})}:s.getEnumerator=function(){return n(r,t,function(e){return o.indexOf(e)>-1?!0:(o.push(e),!1)})},s},e.List&&(e.List.prototype.traverse=e.Enumerable.prototype.traverse,e.List.prototype.traverseUnique=e.Enumerable.prototype.traverseUnique)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n,i){i=i||function(e,t){return e===t};var r,o,s=[],a={current:void 0,moveNext:function(){if(r||(r=e.en(t).distinct().getEnumerator()),a.current=void 0,!o&&r.moveNext())return s.push(a.current=r.current),!0;for(o=o||e.en(n).distinct().getEnumerator();o.moveNext();){for(var u=0,c=!1,l=s.length;l>u&&!c;u++)c=i(s[u],o.current);if(!c)return a.current=o.current,!0}return!1}};return a}e.Enumerable.prototype.union=function(n,i){var r=this,o=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(r,o,i)},s},e.List&&(e.List.prototype.union=e.Enumerable.prototype.union)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i={current:void 0,moveNext:function(){n||(n=e.getEnumerator());for(var r;n.moveNext();)if(t(r=n.current))return i.current=r,!0;return!1}};return i}e.Enumerable.prototype.where=function(n){var i=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,n)},r},e.List&&(e.List.prototype.where=e.Enumerable.prototype.where)}(exjs||(exjs={}));var exjs;!function(e){function t(t){var i=new e.Enumerable;return i.getEnumerator=function(){return n(t)},i}function n(e){var t=e.getEnumerator(),n={current:void 0,moveNext:void 0};return n.moveNext=function(){return t.moveNext()?(n.current=t.current,!0):(n.current=void 0,!1)},n}e.en=t}(exjs||(exjs={}));var ex=exjs.en,exjs;!function(e){function t(e,t,n){var i,r,o={current:void 0,moveNext:function(){return i||(i=e.getEnumerator()),r||(r=t.getEnumerator()),o.current=void 0,i.moveNext()&&r.moveNext()?(o.current=n(i.current,r.current),!0):!1}};return o}e.Enumerable.prototype.zip=function(n,i){var r=this,o=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(r,o,i)},s},e.List&&(e.List.prototype.zip=e.Enumerable.prototype.zip)}(exjs||(exjs={})),Array.prototype.clone||(Array.prototype.clone=function(){return this.slice(0)}),Array.prototype.contains||(Array.prototype.contains=function(e){return-1!==this.indexOf(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n=t||0,i=this.length;for(n;i>n;n++)if(this[n]===e)return n;return-1}),Array.prototype.indexOfTest=function(e,t){var n=t||0,i=this.length;for(n;i>n;n++)if(e(this[n]))return n;return-1},Array.prototype.insert=function(e,t){this.splice(t,0,e)},Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),Array.prototype.move=function(e,t){this.splice(t,0,this.splice(e,1)[0])},Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},Array.prototype.removeAt=function(e){this.splice(e,1)},Math.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},Math.constrain=function(e,t,n){return Math.clamp(e,t,n)},Math.degreesToRadians=function(e){return Math.TAU*(e/360)},Math.distanceBetween=function(e,t,n,i){return Math.sqrt(Math.sq(n-e)+Math.sq(i-t))},Math.lerp=function(e,t,n){return e+(t-e)*n},Math.mag=function(e,t,n){return Math.sqrt(e*e+t*t+n*n)},Math.map=function(e,t,n,i,r){return i+(r-i)*((e-t)/(n-t))},Math.median=function(e){e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},Math.normalise=function(e,t,n){return(e-t)/(n-t)},Math.radiansToDegrees=function(e){return 360*e/Math.TAU},Math.randomBetween=function(e,t){return t||(t=e,e=0),e>=t?e:e+(t-e)*Math.random()},Math.roundToDecimalPlace=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},Math.sq=function(e){return e*e},Math.TAU=2*Math.PI,Number.prototype.isInteger||(Number.prototype.isInteger=function(){return this%1===0}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=n.length;return function(r){if("object"!=typeof r&&"function"!=typeof r||null===r)throw new TypeError("Object.keys called on non-object");var o=[];for(var s in r)e.call(r,s)&&o.push(s);if(t)for(var a=0;i>a;a++)e.call(r,n[a])&&o.push(n[a]);return o}}()),String.prototype.b64_to_utf8=function(){return decodeURIComponent(escape(window.atob(this)))},String.prototype.contains=function(e){return-1!==this.indexOf(e)},String.prototype.endsWith||(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),String.format=function(){for(var e=arguments[0],t=0;t<arguments.length-1;t++){var n=new RegExp("\\{"+t+"\\}","gm");e=e.replace(n,arguments[t+1])}return e},String.prototype.hashCode=function(){var e,t,n,i=0;if(0==this.length)return i;for(e=0,n=this.length;n>e;e++)t=this.charCodeAt(e),i=(i<<5)-i+t,i|=0;return i.toString()},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.startsWith||(String.prototype.startsWith=function(e){return 0==this.indexOf(e)}),String.prototype.toCssClass=function(){return this.replace(/[^a-z0-9]/g,function(e){var t=e.charCodeAt(0);return 32==t?"-":t>=65&&90>=t?"_"+e.toLowerCase():"__"+("000"+t.toString(16)).slice(-4)})},String.prototype.toFileName=function(){return this.replace(/[^a-z0-9]/gi,"_").toLowerCase()},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),String.prototype.utf8_to_b64=function(){return window.btoa(unescape(encodeURIComponent(this)))},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("manifesto",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.manifesto=e()}}(function(){var e;return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return r(n?n:t)},l,l.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){(function(n){var i;!function(e){var t=function(){function e(e){this.value="",e&&(this.value=e.toLowerCase())}return e.prototype.toString=function(){return this.value},e}();e.StringValue=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.bookmarking=function(){return new t(t.BOOKMARKING.toString())},t.prototype.classifying=function(){return new t(t.CLASSIFYING.toString())},t.prototype.commenting=function(){return new t(t.COMMENTING.toString())},t.prototype.describing=function(){return new t(t.DESCRIBING.toString())},t.prototype.editing=function(){return new t(t.EDITING.toString())},t.prototype.highlighting=function(){return new t(t.HIGHLIGHTING.toString())},t.prototype.identifying=function(){return new t(t.IDENTIFYING.toString())},t.prototype.linking=function(){return new t(t.LINKING.toString())},t.prototype.moderating=function(){return new t(t.MODERATING.toString())},t.prototype.painting=function(){return new t(t.PAINTING.toString())},t.prototype.questioning=function(){return new t(t.QUESTIONING.toString())},t.prototype.replying=function(){return new t(t.REPLYING.toString())},t.prototype.tagging=function(){return new t(t.TAGGING.toString())},t.prototype.transcribing=function(){return new t(t.TRANSCRIBING.toString())},t.BOOKMARKING=new t("oa:bookmarking"),t.CLASSIFYING=new t("oa:classifying"),t.COMMENTING=new t("oa:commenting"),t.DESCRIBING=new t("oa:describing"),t.EDITING=new t("oa:editing"),t.HIGHLIGHTING=new t("oa:highlighting"),t.IDENTIFYING=new t("oa:identifying"),t.LINKING=new t("oa:linking"),t.MODERATING=new t("oa:moderating"),t.PAINTING=new t("sc:painting"),t.QUESTIONING=new t("oa:questioning"),t.REPLYING=new t("oa:replying"),t.TAGGING=new t("oa:tagging"),t.TRANSCRIBING=new t("oad:transcribing"),t}(e.StringValue);e.AnnotationMotivation=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.canvas=function(){return new t(t.CANVAS.toString())},t.prototype.document=function(){return new t(t.DOCUMENT.toString())},t.prototype.image=function(){return new t(t.IMAGE.toString())},t.prototype.movingimage=function(){return new t(t.MOVINGIMAGE.toString())},t.prototype.physicalobject=function(){return new t(t.PHYSICALOBJECT.toString())},t.prototype.sound=function(){return new t(t.SOUND.toString())},t.CANVAS=new t("sc:canvas"),t.DOCUMENT=new t("foaf:document"),t.IMAGE=new t("dcTypes:image"),t.MOVINGIMAGE=new t("dctypes:movingimage"),t.PHYSICALOBJECT=new t("dctypes:physicalobject"),t.SOUND=new t("dctypes:sound"),t}(e.StringValue);e.ElementType=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.manifest=function(){return new t(t.MANIFEST.toString())},t.prototype.collection=function(){return new t(t.COLLECTION.toString())},t.MANIFEST=new t("sc:manifest"),t.COLLECTION=new t("sc:collection"),t}(e.StringValue);e.IIIFResourceType=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.empty=function(){return new t(t.EMPTY.toString())},t.prototype.manuscript=function(){return new t(t.MANUSCRIPT.toString())},t.prototype.monograph=function(){return new t(t.MONOGRAPH.toString())},t.EMPTY=new t(""),t.MANUSCRIPT=new t("manuscript"),t.MONOGRAPH=new t("monograph"),t}(e.StringValue);e.ManifestType=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.pdf=function(){return new t(t.PDF.toString())},t.prototype.doc=function(){return new t(t.DOC.toString())},t.prototype.docx=function(){return new t(t.DOCX.toString())},t.PDF=new t("application/pdf"),t.DOC=new t("application/msword"),t.DOCX=new t("application/vnd.openxmlformats-officedocument.wordprocessingml.document"),t}(e.StringValue);e.RenderingFormat=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.jpgimage=function(){return new t(t.JPGIMAGE.toString())},t.prototype.pdf=function(){return new t(t.PDF.toString())},t.JPGIMAGE=new t("image/jpeg"),t.PDF=new t("application/pdf"),t}(e.StringValue);e.ResourceFormat=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.image=function(){return new t(t.IMAGE.toString())},t.IMAGE=new t("dctypes:image"),t}(e.StringValue);e.ResourceType=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.autoComplete=function(){return new t(t.AUTOCOMPLETE.toString())},t.prototype.iiif1ImageLevel1=function(){return new t(t.IIIF1IMAGELEVEL1.toString())},t.prototype.iiif1ImageLevel2=function(){return new t(t.IIIF1IMAGELEVEL2.toString())},t.prototype.iiif2ImageLevel1=function(){return new t(t.IIIF2IMAGELEVEL1.toString())},t.prototype.iiif2ImageLevel2=function(){return new t(t.IIIF2IMAGELEVEL2.toString())},t.prototype.ixif=function(){return new t(t.IXIF.toString())},t.prototype.login=function(){return new t(t.LOGIN.toString())},t.prototype.clickThrough=function(){return new t(t.CLICKTHROUGH.toString())},t.prototype.restricted=function(){return new t(t.RESTRICTED.toString())},t.prototype.logout=function(){return new t(t.LOGOUT.toString())},t.prototype.otherManifestations=function(){return new t(t.OTHERMANIFESTATIONS.toString())},t.prototype.searchWithin=function(){return new t(t.SEARCHWITHIN.toString())},t.prototype.stanfordIIIFImageCompliance1=function(){return new t(t.STANFORDIIIFIMAGECOMPLIANCE1.toString())},t.prototype.stanfordIIIFImageCompliance2=function(){return new t(t.STANFORDIIIFIMAGECOMPLIANCE2.toString())},t.prototype.stanfordIIIFImageConformance1=function(){return new t(t.STANFORDIIIFIMAGECONFORMANCE1.toString())},t.prototype.stanfordIIIFImageConformance2=function(){return new t(t.STANFORDIIIFIMAGECONFORMANCE2.toString())},t.prototype.stanfordIIIF1ImageCompliance1=function(){return new t(t.STANFORDIIIF1IMAGECOMPLIANCE1.toString())},t.prototype.stanfordIIIF1ImageCompliance2=function(){return new t(t.STANFORDIIIF1IMAGECOMPLIANCE2.toString())},t.prototype.stanfordIIIF1ImageConformance1=function(){return new t(t.STANFORDIIIF1IMAGECONFORMANCE1.toString())},t.prototype.stanfordIIIF1ImageConformance2=function(){return new t(t.STANFORDIIIF1IMAGECONFORMANCE2.toString())},t.prototype.token=function(){return new t(t.TOKEN.toString())},t.prototype.trackingExtensions=function(){return new t(t.TRACKINGEXTENSIONS.toString())},t.prototype.uiExtensions=function(){return new t(t.UIEXTENSIONS.toString())},t.AUTOCOMPLETE=new t("http://iiif.io/api/search/0/autocomplete"),t.STANFORDIIIFIMAGECOMPLIANCE0=new t("http://library.stanford.edu/iiif/image-api/compliance.html#level0"),t.STANFORDIIIFIMAGECOMPLIANCE1=new t("http://library.stanford.edu/iiif/image-api/compliance.html#level1"),t.STANFORDIIIFIMAGECOMPLIANCE2=new t("http://library.stanford.edu/iiif/image-api/compliance.html#level2"),t.STANFORDIIIFIMAGECONFORMANCE0=new t("http://library.stanford.edu/iiif/image-api/conformance.html#level0"),t.STANFORDIIIFIMAGECONFORMANCE1=new t("http://library.stanford.edu/iiif/image-api/conformance.html#level1"),t.STANFORDIIIFIMAGECONFORMANCE2=new t("http://library.stanford.edu/iiif/image-api/conformance.html#level2"),t.STANFORDIIIF1IMAGECOMPLIANCE0=new t("http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0"),t.STANFORDIIIF1IMAGECOMPLIANCE1=new t("http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1"),t.STANFORDIIIF1IMAGECOMPLIANCE2=new t("http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2"),t.STANFORDIIIF1IMAGECONFORMANCE0=new t("http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0"),t.STANFORDIIIF1IMAGECONFORMANCE1=new t("http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1"),t.STANFORDIIIF1IMAGECONFORMANCE2=new t("http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2"),t.IIIF1IMAGELEVEL0=new t("http://iiif.io/api/image/1/level0.json"),t.IIIF1IMAGELEVEL0PROFILE=new t("http://iiif.io/api/image/1/profiles/level0.json"),t.IIIF1IMAGELEVEL1=new t("http://iiif.io/api/image/1/level1.json"),t.IIIF1IMAGELEVEL1PROFILE=new t("http://iiif.io/api/image/1/profiles/level1.json"),
t.IIIF1IMAGELEVEL2=new t("http://iiif.io/api/image/1/level2.json"),t.IIIF1IMAGELEVEL2PROFILE=new t("http://iiif.io/api/image/1/profiles/level2.json"),t.IIIF2IMAGELEVEL0=new t("http://iiif.io/api/image/2/level0.json"),t.IIIF2IMAGELEVEL0PROFILE=new t("http://iiif.io/api/image/2/profiles/level0.json"),t.IIIF2IMAGELEVEL1=new t("http://iiif.io/api/image/2/level1.json"),t.IIIF2IMAGELEVEL1PROFILE=new t("http://iiif.io/api/image/2/profiles/level1.json"),t.IIIF2IMAGELEVEL2=new t("http://iiif.io/api/image/2/level2.json"),t.IIIF2IMAGELEVEL2PROFILE=new t("http://iiif.io/api/image/2/profiles/level2.json"),t.IXIF=new t("http://wellcomelibrary.org/ld/ixif/0/alpha.json"),t.LOGIN=new t("http://iiif.io/api/auth/0/login"),t.CLICKTHROUGH=new t("http://iiif.io/api/auth/0/login/clickthrough"),t.RESTRICTED=new t("http://iiif.io/api/auth/0/login/restricted"),t.LOGOUT=new t("http://iiif.io/api/auth/0/logout"),t.OTHERMANIFESTATIONS=new t("http://iiif.io/api/otherManifestations.json"),t.SEARCHWITHIN=new t("http://iiif.io/api/search/0/search"),t.TOKEN=new t("http://iiif.io/api/auth/0/token"),t.TRACKINGEXTENSIONS=new t("http://universalviewer.io/tracking-extensions-profile"),t.UIEXTENSIONS=new t("http://universalviewer.io/ui-extensions-profile"),t}(e.StringValue);e.ServiceProfile=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.leftToRight=function(){return new t(t.LEFTTORIGHT.toString())},t.prototype.rightToLeft=function(){return new t(t.RIGHTTOLEFT.toString())},t.prototype.topToBottom=function(){return new t(t.TOPTOBOTTOM.toString())},t.prototype.bottomToTop=function(){return new t(t.BOTTOMTOTOP.toString())},t.LEFTTORIGHT=new t("left-to-right"),t.RIGHTTOLEFT=new t("right-to-left"),t.TOPTOBOTTOM=new t("top-to-bottom"),t.BOTTOMTOTOP=new t("bottom-to-top"),t}(e.StringValue);e.ViewingDirection=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.continuous=function(){return new t(t.CONTINUOUS.toString())},t.prototype.empty=function(){return new t(t.EMPTY.toString())},t.prototype.individuals=function(){return new t(t.INDIVIDUALS.toString())},t.prototype.nonPaged=function(){return new t(t.NONPAGED.toString())},t.prototype.paged=function(){return new t(t.PAGED.toString())},t.prototype.top=function(){return new t(t.TOP.toString())},t.CONTINUOUS=new t("continuous"),t.EMPTY=new t(""),t.INDIVIDUALS=new t("individuals"),t.NONPAGED=new t("non-paged"),t.PAGED=new t("paged"),t.TOP=new t("top"),t}(e.StringValue);e.ViewingHint=t}(i||(i={}));var i;!function(e){var t=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("@context"),this.id=this.getProperty("@id")}return e.prototype.getProperty=function(e){return this.__jsonld[e]},e}();e.JSONLDResource=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(t){function n(e,n){t.call(this,e),this.options=n}return r(n,t),n.prototype.getLabel=function(){return e.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},n.prototype.getMetadata=function(){var t=this.getProperty("metadata");if(!t)return[];for(var n=0;n<t.length;n++){var i=t[n];i.label=e.Utils.getLocalisedValue(i.label,this.options.locale),i.value=e.Utils.getLocalisedValue(i.value,this.options.locale)}return t},n.prototype.getRendering=function(e){var t=this.getRenderings();"string"!=typeof e&&(e=e.toString());for(var n=0;n<t.length;n++){var i=t[n];if(i.getFormat().toString()===e)return i}return null},n.prototype.getRenderings=function(){var t;t=this.__jsonld?this.__jsonld.rendering:this.rendering;var n=[];if(!t)return n;u(t)||(t=[t]);for(var i=0;i<t.length;i++){var r=t[i];n.push(new e.Rendering(r,this.options))}return n},n.prototype.getService=function(t){return e.Utils.getService(this,t)},n.prototype.getServices=function(){return e.Utils.getServices(this)},n}(e.JSONLDResource);e.ManifestResource=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return r(n,t),n.prototype.getResources=function(){var t=[];if(!this.__jsonld.resources)return t;for(var n=0;n<this.__jsonld.resources.length;n++){var i=this.__jsonld.resources[n],r=new e.Annotation(i,this.options);t.push(r)}return t},n.prototype.getType=function(){return new e.ElementType(this.getProperty("@type"))},n}(e.ManifestResource);e.Element=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("lodash.endswith"),s=e("lodash.last");!function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return r(n,t),n.prototype.getCanonicalImageUri=function(t){var n,i,r="full",o=0,s="default",a=t;if(this.externalResource&&this.externalResource.data)n=this.externalResource.data["@id"],a||(a=this.externalResource.data.width),(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(s="native");else{var u=this.getImages();if(u&&u.length){var c=u[0],l=c.getResource(),h=l.getServices();if(a||(a=l.getWidth()),h.length){var p=h[0];n=p.id,s=e.Utils.getImageQuality(p.getProfile())}}if(!n)return"undefined"==typeof this.__jsonld.thumbnail?null:this.__jsonld.thumbnail}i=a+",";var d=[n,r,i,o,s+".jpg"].join("/");return d},n.prototype.getImages=function(){var t=[];if(!this.__jsonld.images)return t;for(var n=0;n<this.__jsonld.images.length;n++){var i=this.__jsonld.images[n],r=new e.Annotation(i,this.options);t.push(r)}return t},n.prototype.getIndex=function(){return this.getProperty("index")},n.prototype.getWidth=function(){return this.getProperty("width")},n.prototype.getHeight=function(){return this.getProperty("height")},n}(e.Element);e.Canvas=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},a=e("lodash.assign");!function(e){var t=function(t){function n(e,n){t.call(this,e,n),this.index=-1,this.isLoaded=!1;var i={defaultLabel:"-",locale:"en-GB",resource:this,pessimisticAccessControl:!1};this.options=a(i,n)}return r(n,t),n.prototype.generateTreeNodeIds=function(e,t){void 0===t&&(t=0);var n;n=e.parentNode?e.parentNode.id+"-"+t:"0",e.id=n;for(var i=0;i<e.nodes.length;i++){var r=e.nodes[i];this.generateTreeNodeIds(r,i)}},n.prototype.getAttribution=function(){return e.Utils.getLocalisedValue(this.getProperty("attribution"),this.options.locale)},n.prototype.getDescription=function(){return e.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},n.prototype.getIIIFResourceType=function(){return new e.IIIFResourceType(this.getProperty("@type"))},n.prototype.getLogo=function(){var e=this.getProperty("logo");return e?l(e)?e:e["@id"]:null},n.prototype.getLicense=function(){return e.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},n.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},n.prototype.getSeeAlso=function(){return e.Utils.getLocalisedValue(this.getProperty("seeAlso"),this.options.locale)},n.prototype.getLabel=function(){return e.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},n.prototype.getTree=function(){return this.treeRoot=new e.TreeNode("root"),this.treeRoot.data=this,this.treeRoot},n.prototype.load=function(){var t=this;return new Promise(function(n,i){if(t.isLoaded)n(t);else{var r=t.options;r.navDate=t.getNavDate(),e.Utils.loadResource(t.__jsonld["@id"]).then(function(i){t.parentLabel=t.getLabel();var o=e.Deserialiser.parse(i,r);t=a(t,o),t.index=r.index,n(t)})}})},n}(e.ManifestResource);e.IIIFResource=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},u=e("lodash.isarray"),c=e("lodash.map");!function(e){var t=function(t){function n(e,n){if(t.call(this,e,n),this.index=0,this._ranges=null,this._sequences=null,this.__jsonld.structures&&this.__jsonld.structures.length){var i=this._getRootRange();this._parseRanges(i,"")}}return r(n,t),n.prototype._getRootRange=function(){var t;if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var n=0;n<this.__jsonld.structures.length;n++){var i=this.__jsonld.structures[n];i.viewingHint===e.ViewingHint.TOP.toString()&&(t=i)}t||(t={},t.ranges=this.__jsonld.structures)}return t},n.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];if(n["@id"]===e)return n}return null},n.prototype._parseRanges=function(t,n,i){var r;if(l(t)&&(t=this._getRangeById(t)),r=new e.Range(t,this.options),i?(r.parentRange=i,i.ranges.push(r)):this.rootRange=r,r.path=n,t.ranges)for(var o=0;o<t.ranges.length;o++)this._parseRanges(t.ranges[o],n+"/"+o,r)},n.prototype.getRanges=function(){return null!=this._ranges?this._ranges:(this._ranges=[],this.rootRange&&(this._ranges=this.rootRange.ranges.en().traverseUnique(function(e){return e.ranges}).toArray()),this._ranges)},n.prototype.getRangeById=function(e){for(var t=this.getRanges(),n=0;n<t.length;n++){var i=t[n];if(i.id===e)return i}return null},n.prototype.getRangeByPath=function(e){for(var t=this.getRanges(),n=0;n<t.length;n++){var i=t[n];if(i.path===e)return i}return null},n.prototype.getSequences=function(){if(null!=this._sequences)return this._sequences;this._sequences=[];var t=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(t)for(var n=0;n<t.length;n++){var i=t[n],r=new e.Sequence(i,this.options);this._sequences.push(r)}return this._sequences},n.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},n.prototype.getTotalSequences=function(){return this.getSequences().length},n.prototype.getTree=function(){if(t.prototype.getTree.call(this),this.treeRoot.data.type=e.TreeNodeType.MANIFEST.toString(),!this.isLoaded)return this.treeRoot;if(!this.rootRange)return this.treeRoot;if(this.treeRoot.data=this.rootRange,this.rootRange.treeNode=this.treeRoot,this.rootRange.ranges)for(var n=0;n<this.rootRange.ranges.length;n++){var i=this.rootRange.ranges[n],r=new e.TreeNode;this.treeRoot.addNode(r),this._parseTreeNode(r,i)}return this.generateTreeNodeIds(this.treeRoot),this.treeRoot},n.prototype._parseTreeNode=function(t,n){if(t.label=n.getLabel(),t.data=n,t.data.type=e.TreeNodeType.RANGE.toString(),n.treeNode=t,n.ranges)for(var i=0;i<n.ranges.length;i++){var r=n.ranges[i],o=new e.TreeNode;t.addNode(o),this._parseTreeNode(o,r)}},n.prototype.getManifestType=function(){var t=this.getService(e.ServiceProfile.UIEXTENSIONS);return t?new e.ManifestType(t.getProperty("manifestType")):new e.ManifestType("")},n.prototype.getTrackingLabel=function(){var t=this.getService(e.ServiceProfile.TRACKINGEXTENSIONS);return t?t.getProperty("trackingLabel"):""},n.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},n.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?new e.ViewingDirection(this.getProperty("viewingDirection")):e.ViewingDirection.LEFTTORIGHT},n.prototype.getViewingHint=function(){return this.getProperty("viewingHint")?new e.ViewingHint(this.getProperty("viewingHint")):e.ViewingHint.EMPTY},n}(e.IIIFResource);e.Manifest=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(t){function n(e,n){t.call(this,e,n),this.collections=[],this.manifests=[],e.__collection=this}return r(n,t),n.prototype.getCollectionByIndex=function(e){var t=this.collections[e];return t.options.index=e,t.load()},n.prototype.getManifestByIndex=function(e){var t=this.manifests[e];return t.options.index=e,t.load()},n.prototype.getTotalCollections=function(){return this.collections.length},n.prototype.getTotalManifests=function(){return this.manifests.length},n.prototype.getTree=function(){return t.prototype.getTree.call(this),this.treeRoot.data.type=e.TreeNodeType.COLLECTION.toString(),this._parseManifests(this),this._parseCollections(this),this.generateTreeNodeIds(this.treeRoot),this.treeRoot},n.prototype._parseManifests=function(t){if(t.manifests&&t.manifests.length)for(var n=0;n<t.manifests.length;n++){var i=t.manifests[n],r=i.getTree();r.label=i.parentLabel||i.getLabel()||"manifest "+(n+1),r.navDate=i.getNavDate(),r.data.id=i.id,r.data.type=e.TreeNodeType.MANIFEST.toString(),t.treeRoot.addNode(r)}},n.prototype._parseCollections=function(t){if(t.collections&&t.collections.length)for(var n=0;n<t.collections.length;n++){var i=t.collections[n],r=i.getTree();r.label=i.parentLabel||i.getLabel()||"collection "+(n+1),r.navDate=i.getNavDate(),r.data.id=i.id,r.data.type=e.TreeNodeType.COLLECTION.toString(),t.treeRoot.addNode(r),this._parseCollections(i)}},n}(e.IIIFResource);e.Collection=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(t){function n(e,n){t.call(this,e,n),this.ranges=[]}return r(n,t),n.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:[]},n.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?new e.ViewingDirection(this.getProperty("viewingDirection")):null},n.prototype.getViewingHint=function(){return this.getProperty("viewingHint")?new e.ViewingHint(this.getProperty("viewingHint")):null},n}(e.ManifestResource);e.Range=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return r(n,t),n.prototype.getFormat=function(){return new e.RenderingFormat(this.getProperty("format"))},n}(e.ManifestResource);e.Rendering=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},s=e("lodash.last");!function(e){var t=function(t){function n(e,n){t.call(this,e,n),this.canvases=null}return r(n,t),n.prototype.getCanvases=function(){if(null!=this.canvases)return this.canvases;this.canvases=[];var t=this.__jsonld.elements||this.__jsonld.canvases;if(t)for(var n=0;n<t.length;n++){var i=t[n],r=new e.Canvas(i,this.options);r.index=n,this.canvases.push(r)}return this.canvases},n.prototype.getCanvasById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var n=this.getCanvasByIndex(t);if(n.id===e)return n}return null},n.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},n.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var n=this.getCanvasByIndex(t);if(n.id===e)return t}return null},n.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var n,i,r,o,s,a=/(\d*)\D+(\d*)/,u=0;u<this.getTotalCanvases();u++){var c=this.getCanvasByIndex(u);if(c.getLabel()===e)return u;if(n=a.exec(e),n&&(o=n[1],s=n[2],s&&(r="^"+o+"\\D+"+s+"$",i=new RegExp(r),i.test(c.getLabel()))))return u}return-1},n.prototype.getLastCanvasLabel=function(e){for(var t=this.getTotalCanvases()-1;t>=0;t--){var n=this.getCanvasByIndex(t),i=n.getLabel();if(e){var r=/^[a-zA-Z0-9]*$/;if(r.test(i))return i}else if(i)return i}return this.options.defaultLabel},n.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},n.prototype.getNextPageIndex=function(t,n){var i;if(n){var r=this.getPagedIndices(t);i=this.getViewingDirection().toString()===e.ViewingDirection.RIGHTTOLEFT.toString()?r[0]+1:s(r)+1}else i=t+1;return i>this.getLastPageIndex()?-1:i},n.prototype.getPagedIndices=function(t,n){var i=[];return n?(i=this.isFirstCanvas(t)||this.isLastCanvas(t)?[t]:t%2?[t,t+1]:[t-1,t],this.getViewingDirection().toString()===e.ViewingDirection.RIGHTTOLEFT.toString()&&(i=i.reverse())):i.push(t),i},n.prototype.getPrevPageIndex=function(t,n){var i;if(n){var r=this.getPagedIndices(t);i=this.getViewingDirection().toString()===e.ViewingDirection.RIGHTTOLEFT.toString()?s(r)-1:r[0]-1}else i=t-1;return i},n.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var t=0;t<this.getTotalCanvases();t++){var n=this.getCanvasByIndex(t);if(n.id===e)return t}return 0},n.prototype.getThumbs=function(t,n){for(var i=[],r=this.getTotalCanvases(),o=0;r>o;o++){var s=this.getCanvasByIndex(o);i.push(new e.Thumb(t,s))}return i},n.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},n.prototype.getTotalCanvases=function(){return this.getCanvases().length},n.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?new e.ViewingDirection(this.getProperty("viewingDirection")):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():e.ViewingDirection.LEFTTORIGHT},n.prototype.getViewingHint=function(){return this.getProperty("viewingHint")?new e.ViewingHint(this.getProperty("viewingHint")):e.ViewingHint.EMPTY},n.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},n.prototype.isFirstCanvas=function(e){return 0===e},n.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},n.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},n.prototype.isPagingEnabled=function(){return this.getViewingHint().toString()===e.ViewingHint.PAGED.toString()},n.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2===0},n}(e.ManifestResource);e.Sequence=t}(i||(i={}));var i,l=e("lodash.isstring");!function(e){var t=function(){function t(){}return t.parse=function(e,t){return this.parseJson(JSON.parse(e),t)},t.parseJson=function(e,t){var n;switch(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"]){case"sc:Collection":n=this.parseCollection(e,t);break;case"sc:Manifest":n=this.parseManifest(e,t);break;default:return null}return n.isLoaded=!0,n},t.parseCollection=function(t,n){var i=new e.Collection(t,n);return n?i.index=n.index||0:i.index=0,this.parseCollections(i,n),this.parseManifests(i,n),i},t.parseCollections=function(e,t){var n=e.__jsonld.collections;if(n)for(var i=0;i<n.length;i++){t&&(t.index=i);var r=this.parseCollection(n[i],t);r.parentCollection=e,e.collections.push(r)}},t.parseManifest=function(t,n){var i=new e.Manifest(t,n);return i},t.parseManifests=function(e,t){var n=e.__jsonld.manifests;if(n)for(var i=0;i<n.length;i++){var r=this.parseManifest(n[i],t);r.index=i,r.parentCollection=e,e.manifests.push(r)}},t}();e.Deserialiser=t;var n=function(){function e(){}return e.serialise=function(e){return""},e}();e.Serialiser=n}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("lodash.endswith"),u=e("lodash.isarray");!function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return r(n,t),n.prototype.getProfile=function(){var t=this.getProperty("profile");return t||(t=this.getProperty("dcterms:conformsTo")),u(t)?new e.ServiceProfile(t[0]):new e.ServiceProfile(t)},n.prototype.getDescription=function(){return e.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},n.prototype.getInfoUri=function(){var e=this.id;return o(e,"/")||(e+="/"),e+="info.json"},n}(e.ManifestResource);e.Service=t}(i||(i={}));var i;!function(e){var t=function(){function e(e,t){this.data=t,this.index=t.index,this.width=e;var n=t.getHeight()/t.getWidth();n?this.height=Math.floor(this.width*n):this.height=e,this.uri=t.getCanonicalImageUri(e),this.label=t.getLabel()}return e}();e.Thumb=t}(i||(i={}));var i;!function(e){var t=function(){function t(e,t){this.label=e,this.data=t||{},this.nodes=[]}return t.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},t.prototype.isCollection=function(){return this.data.type===e.TreeNodeType.COLLECTION.toString()},t.prototype.isManifest=function(){return this.data.type===e.TreeNodeType.MANIFEST.toString()},t.prototype.isRange=function(){return this.data.type===e.TreeNodeType.RANGE.toString()},t}();e.TreeNode=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.collection=function(){return new t(t.COLLECTION.toString())},t.prototype.manifest=function(){return new t(t.MANIFEST.toString())},t.prototype.range=function(){return new t(t.RANGE.toString())},t.COLLECTION=new t("sc:collection"),t.MANIFEST=new t("sc:manifest"),t.RANGE=new t("sc:range"),t}(e.StringValue);e.TreeNodeType=t}(i||(i={}));var i,h=e("http"),p=e("url");!function(e){var t=function(){function t(){}return t.getImageQuality=function(t){var n=t.toString();return n===e.ServiceProfile.STANFORDIIIFIMAGECOMPLIANCE1.toString()||n===e.ServiceProfile.STANFORDIIIFIMAGECOMPLIANCE2.toString()||n===e.ServiceProfile.STANFORDIIIF1IMAGECOMPLIANCE1.toString()||n===e.ServiceProfile.STANFORDIIIF1IMAGECOMPLIANCE2.toString()||n===e.ServiceProfile.STANFORDIIIFIMAGECONFORMANCE1.toString()||n===e.ServiceProfile.STANFORDIIIFIMAGECONFORMANCE2.toString()||n===e.ServiceProfile.STANFORDIIIF1IMAGECONFORMANCE1.toString()||n===e.ServiceProfile.STANFORDIIIF1IMAGECONFORMANCE2.toString()||n===e.ServiceProfile.IIIF1IMAGELEVEL1.toString()||n===e.ServiceProfile.IIIF1IMAGELEVEL1PROFILE.toString()||n===e.ServiceProfile.IIIF1IMAGELEVEL2.toString()||n===e.ServiceProfile.IIIF1IMAGELEVEL2PROFILE.toString()?"native":"default"},t.getLocalisedValue=function(e,t){if(!u(e))return e;for(var n=0;n<e.length;n++){var i=e[n],r=i["@language"];if(t===r)return i["@value"]}for(var o=t.substr(0,t.indexOf("-")),n=0;n<e.length;n++){var i=e[n],r=i["@language"];if(r===o)return i["@value"]}return null},t.loadResource=function(e){return new Promise(function(t,n){var i=p.parse(e),r=h.request({host:i.hostname,port:i.port,path:i.path,method:"GET",withCredentials:!1},function(e){var n="";e.on("data",function(e){n+=e}),e.on("end",function(){t(n)})});r.on("error",function(e){n(e)}),r.end()})},t.loadExternalResource=function(e,n,i,r,o,s,a,u,c,l){return new Promise(function(h,p){l&&l.pessimisticAccessControl?e.getData().then(function(){e.isAccessControlled()?e.clickThroughService?h(i(e)):e.restrictedService?h(r(e)):o(e).then(function(){s(e,!0).then(function(n){e.getData(n).then(function(){h(c(e))})["catch"](function(e){p(t.createInternalServerError(e))})})["catch"](function(e){p(t.createInternalServerError(e))})})["catch"](function(e){p(t.createInternalServerError(e))}):h(e)})["catch"](function(e){p(t.createInternalServerError(e))}):u(e,n).then(function(l){l?e.getData(l).then(function(){e.status===HTTPStatusCode.OK?h(c(e)):t.authorize(e,n,i,r,o,s,a,u).then(function(){h(c(e))})["catch"](function(n){p(e.restrictedService?t.createRestrictedError():t.createAuthorizationFailedError())})})["catch"](function(e){p(t.createAuthorizationFailedError())}):t.authorize(e,n,i,r,o,s,a,u).then(function(){h(c(e))})["catch"](function(e){p(t.createAuthorizationFailedError())})})["catch"](function(e){p(t.createAuthorizationFailedError())})})},t.createError=function(e,t){var n=new Error;return n.message=t,n.name=e,n},t.createAuthorizationFailedError=function(){return t.createError(manifesto.StatusCodes.AUTHORIZATION_FAILED.toString(),"Authorization failed")},t.createRestrictedError=function(){return t.createError(manifesto.StatusCodes.RESTRICTED.toString(),"Restricted")},t.createInternalServerError=function(e){return t.createError(manifesto.StatusCodes.INTERNAL_SERVER_ERROR.toString(),e)},t.loadExternalResources=function(e,n,i,r,o,s,a,u,l,h){return new Promise(function(p,d){var f=c(e,function(e){return t.loadExternalResource(e,n,i,r,o,s,a,u,l,h)});Promise.all(f).then(function(){p(e)})["catch"](function(e){d(e)})})},t.authorize=function(e,n,i,r,o,s,a,u){return new Promise(function(c,l){e.getData().then(function(){e.isAccessControlled()?u(e,n).then(function(u){u?e.getData(u).then(function(){e.status===HTTPStatusCode.OK?c(e):t.showAuthInteraction(e,n,i,r,o,s,a,c,l)})["catch"](function(e){l(t.createInternalServerError(e))}):s(e,!1).then(function(u){u?a(e,u,n).then(function(){e.getData(u).then(function(){e.status===HTTPStatusCode.OK?c(e):t.showAuthInteraction(e,n,i,r,o,s,a,c,l)})["catch"](function(e){l(t.createInternalServerError(e))})})["catch"](function(e){l(t.createInternalServerError(e))}):t.showAuthInteraction(e,n,i,r,o,s,a,c,l)})})["catch"](function(e){l(t.createInternalServerError(e))}):c(e)})})},t.showAuthInteraction=function(e,n,i,r,o,s,a,u,c){e.status!==HTTPStatusCode.MOVED_TEMPORARILY||e.isResponseHandled?e.restrictedService?u(r(e)):e.clickThroughService&&!e.isResponseHandled?i(e).then(function(){s(e,!0).then(function(i){a(e,i,n).then(function(){e.getData(i).then(function(){u(e)})["catch"](function(e){c(t.createInternalServerError(e))})})["catch"](function(e){c(t.createInternalServerError(e))})})["catch"](function(e){c(t.createInternalServerError(e))})}):o(e).then(function(){s(e,!0).then(function(i){a(e,i,n).then(function(){e.getData(i).then(function(){u(e)})["catch"](function(e){c(t.createInternalServerError(e))})})["catch"](function(e){c(t.createInternalServerError(e))})})["catch"](function(e){c(t.createInternalServerError(e))})}):u(e)},t.getService=function(e,t){var n=this.getServices(e);"string"!=typeof t&&(t=t.toString());for(var i=0;i<n.length;i++){var r=n[i];if(r.getProfile().toString()===t)return r}return null},t.getResourceById=function(e,n){return[e.__jsonld].en().traverseUnique(function(e){return t.getAllArrays(e)}).first(function(e){return e["@id"]===n})},t.getAllArrays=function(e){var t=[].en();if(!e)return t;for(var n in e){var i=e[n];u(i)&&(t=t.concat(i))}return t},t.getServices=function(t){var n;n=t.__jsonld?t.__jsonld.service:t.service;var i=[];if(!n)return i;u(n)||(n=[n]);for(var r=0;r<n.length;r++){var o=n[r];if(l(o)){var s=this.getResourceById(t.options.resource,o);s&&i.push(new e.Service(s.__jsonld||s,t.options))}else i.push(new e.Service(o,t.options))}return i},t}();e.Utils=t}(i||(i={})),n.manifesto=t.exports={AnnotationMotivation:new i.AnnotationMotivation,ElementType:new i.ElementType,IIIFResourceType:new i.IIIFResourceType,ManifestType:new i.ManifestType,RenderingFormat:new i.RenderingFormat,ResourceFormat:new i.ResourceFormat,ResourceType:new i.ResourceType,ServiceProfile:new i.ServiceProfile,TreeNodeType:new i.TreeNodeType,ViewingDirection:new i.ViewingDirection,ViewingHint:new i.ViewingHint,StatusCodes:{AUTHORIZATION_FAILED:1,FORBIDDEN:2,INTERNAL_SERVER_ERROR:3,RESTRICTED:4},create:function(e,t){return i.Deserialiser.parse(e,t)},getService:function(e,t){return i.Utils.getService(e,t)},getTreeNode:function(){return new i.TreeNode},isImageProfile:function(e){return e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECOMPLIANCE0.toString()||e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECOMPLIANCE1.toString()||e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECOMPLIANCE2.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECOMPLIANCE0.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECOMPLIANCE1.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECOMPLIANCE2.toString()||e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECONFORMANCE0.toString()||e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECONFORMANCE1.toString()||e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECONFORMANCE2.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECONFORMANCE0.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECONFORMANCE1.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECONFORMANCE2.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL0.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL0PROFILE.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL1.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL1PROFILE.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL2.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL2PROFILE.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL0.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL0PROFILE.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL1.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL1PROFILE.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL2.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL2PROFILE.toString()?!0:!1},isLevel0ImageProfile:function(e){return e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECOMPLIANCE0.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECOMPLIANCE0.toString()||e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECONFORMANCE0.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECONFORMANCE0.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL0.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL0PROFILE.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL0.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL0PROFILE.toString()?!0:!1},isLevel1ImageProfile:function(e){return e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECOMPLIANCE1.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECOMPLIANCE1.toString()||e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECONFORMANCE1.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECONFORMANCE1.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL1.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL1PROFILE.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL1.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL1PROFILE.toString()?!0:!1},isLevel2ImageProfile:function(e){return e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECOMPLIANCE2.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECOMPLIANCE2.toString()||e.toString()===i.ServiceProfile.STANFORDIIIFIMAGECONFORMANCE2.toString()||e.toString()===i.ServiceProfile.STANFORDIIIF1IMAGECONFORMANCE2.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL2.toString()||e.toString()===i.ServiceProfile.IIIF1IMAGELEVEL2PROFILE.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL2.toString()||e.toString()===i.ServiceProfile.IIIF2IMAGELEVEL2PROFILE.toString()?!0:!1},loadExternalResources:function(e,t,n,r,o,s,a,u,c,l){return i.Utils.loadExternalResources(e,t,n,r,o,s,a,u,c,l)},loadManifest:function(e){return i.Utils.loadResource(e)}};var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(t){function n(e,n){t.call(this,e,n);
}return r(n,t),n.prototype.getMotivation=function(){var t=this.getProperty("motivation");return t?new e.AnnotationMotivation(t.toLowerCase()):null},n.prototype.getOn=function(){return this.getProperty("on")},n.prototype.getResource=function(){return new e.Resource(this.getProperty("resource"),this.options)},n}(e.ManifestResource);e.Annotation=t}(i||(i={}));var i,r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return r(n,t),n.prototype.getFormat=function(){var t=this.getProperty("format");return t?new e.ResourceFormat(t.toLowerCase()):null},n.prototype.getType=function(){var t=this.getProperty("@type");return t?new e.ResourceType(t.toLowerCase()):null},n.prototype.getWidth=function(){return this.getProperty("width")},n.prototype.getHeight=function(){return this.getProperty("height")},n.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},n.prototype.getMaxHeight=function(){var e=this.getProperty("maxHeight");return e?void 0:this.getMaxWidth()},n}(e.ManifestResource);e.Resource=t}(i||(i={}))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{http:26,"lodash.assign":36,"lodash.endswith":46,"lodash.isarray":48,"lodash.isstring":49,"lodash.last":50,"lodash.map":51,url:33}],2:[function(e,t,n){},{}],3:[function(e,t,n){(function(t){"use strict";function i(){try{var e=new Uint8Array(1);return e.foo=function(){return 42},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}function r(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=s.prototype):(null===e&&(e=new s(t)),e.length=t),e}function s(e,t,n){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return a(this,e,t,n)}function a(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?d(e,t,n,i):"string"==typeof t?h(e,t,n):f(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number')}function c(e,t,n,i){return u(t),0>=t?o(e,t):void 0!==n?"string"==typeof i?o(e,t).fill(n,i):o(e,t).fill(n):o(e,t)}function l(e,t){if(u(t),e=o(e,0>t?0:0|g(t)),!s.TYPED_ARRAY_SUPPORT)for(var n=0;t>n;n++)e[n]=0;return e}function h(e,t,n){if(("string"!=typeof n||""===n)&&(n="utf8"),!s.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|v(t,n);return e=o(e,i),e.write(t,n),e}function p(e,t){var n=0|g(t.length);e=o(e,n);for(var i=0;n>i;i+=1)e[i]=255&t[i];return e}function d(e,t,n,i){if(t.byteLength,0>n||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),s.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=s.prototype):e=p(e,t),e}function f(e,t){if(s.isBuffer(t)){var n=0|g(t.length);return e=o(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||Y(t.length)?o(e,0):p(e,t);if("Buffer"===t.type&&Q(t.data))return p(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function g(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function m(e){return+e!=e&&(e=0),s.alloc(+e)}function v(e,t){if(s.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"binary":case"raw":case"raws":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(e).length;default:if(i)return V(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,n){var i=!1;if((void 0===t||0>t)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),0>=n)return"";if(n>>>=0,t>>>=0,t>=n)return"";for(e||(e="utf8");;)switch(e){case"hex":return N(this,t,n);case"utf8":case"utf-8":return C(this,t,n);case"ascii":return O(this,t,n);case"binary":return R(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function b(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function E(e,t,n,i){function r(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}var o=1,s=e.length,a=t.length;if(void 0!==i&&(i=String(i).toLowerCase(),"ucs2"===i||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;o=2,s/=2,a/=2,n/=2}for(var u=-1,c=0;s>n+c;c++)if(r(e,n+c)===r(t,-1===u?0:c-u)){if(-1===u&&(u=c),c-u+1===a)return(n+u)*o}else-1!==u&&(c-=c-u),u=-1;return-1}function w(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i),i>r&&(i=r)):i=r;var o=t.length;if(o%2!==0)throw new Error("Invalid hex string");i>o/2&&(i=o/2);for(var s=0;i>s;s++){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function S(e,t,n,i){return K(V(t,e.length-n),e,n,i)}function x(e,t,n,i){return K(z(t),e,n,i)}function $(e,t,n,i){return x(e,t,n,i)}function _(e,t,n,i){return K(W(t),e,n,i)}function I(e,t,n,i){return K(q(t,e.length-n),e,n,i)}function T(e,t,n){return 0===t&&n===e.length?X.fromByteArray(e):X.fromByteArray(e.slice(t,n))}function C(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;n>r;){var o=e[r],s=null,a=o>239?4:o>223?3:o>191?2:1;if(n>=r+a){var u,c,l,h;switch(a){case 1:128>o&&(s=o);break;case 2:u=e[r+1],128===(192&u)&&(h=(31&o)<<6|63&u,h>127&&(s=h));break;case 3:u=e[r+1],c=e[r+2],128===(192&u)&&128===(192&c)&&(h=(15&o)<<12|(63&u)<<6|63&c,h>2047&&(55296>h||h>57343)&&(s=h));break;case 4:u=e[r+1],c=e[r+2],l=e[r+3],128===(192&u)&&128===(192&c)&&128===(192&l)&&(h=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l,h>65535&&1114112>h&&(s=h))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),r+=a}return A(i)}function A(e){var t=e.length;if(Z>=t)return String.fromCharCode.apply(String,e);for(var n="",i=0;t>i;)n+=String.fromCharCode.apply(String,e.slice(i,i+=Z));return n}function O(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;n>r;r++)i+=String.fromCharCode(127&e[r]);return i}function R(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;n>r;r++)i+=String.fromCharCode(e[r]);return i}function N(e,t,n){var i=e.length;(!t||0>t)&&(t=0),(!n||0>n||n>i)&&(n=i);for(var r="",o=t;n>o;o++)r+=G(e[o]);return r}function L(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function P(e,t,n){if(e%1!==0||0>e)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,n,i,r,o){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||o>t)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function B(e,t,n,i){0>t&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);o>r;r++)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function M(e,t,n,i){0>t&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);o>r;r++)e[n+r]=t>>>8*(i?r:3-r)&255}function k(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(0>n)throw new RangeError("Index out of range")}function U(e,t,n,i,r){return r||k(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(e,t,n,i,23,4),n+4}function F(e,t,n,i,r){return r||k(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(e,t,n,i,52,8),n+8}function H(e){if(e=j(e).replace(ee,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function j(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function G(e){return 16>e?"0"+e.toString(16):e.toString(16)}function V(e,t){t=t||1/0;for(var n,i=e.length,r=null,o=[],s=0;i>s;s++){if(n=e.charCodeAt(s),n>55295&&57344>n){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(56320>n){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,128>n){if((t-=1)<0)break;o.push(n)}else if(2048>n){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(65536>n){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(1114112>n))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function z(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}function q(e,t){for(var n,i,r,o=[],s=0;s<e.length&&!((t-=2)<0);s++)n=e.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}function W(e){return X.toByteArray(H(e))}function K(e,t,n,i){for(var r=0;i>r&&!(r+n>=t.length||r>=e.length);r++)t[r+n]=e[r];return r}function Y(e){return e!==e}var X=e("base64-js"),J=e("ieee754"),Q=e("isarray");n.Buffer=s,n.SlowBuffer=m,n.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:i(),n.kMaxLength=r(),s.poolSize=8192,s._augment=function(e){return e.__proto__=s.prototype,e},s.from=function(e,t,n){return a(null,e,t,n)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(e,t,n){return c(null,e,t,n)},s.allocUnsafe=function(e){return l(null,e)},s.allocUnsafeSlow=function(e){return l(null,e)},s.isBuffer=function(e){return!(null==e||!e._isBuffer)},s.compare=function(e,t){if(!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);o>r;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return i>n?-1:n>i?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Q(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;n++)t+=e[n].length;var i=s.allocUnsafe(t),r=0;for(n=0;n<e.length;n++){var o=e[n];if(!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},s.byteLength=v,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;e>t;t+=2)b(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;e>t;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},s.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?C(this,0,e):y.apply(this,arguments)},s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:0===s.compare(this,e)},s.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},s.prototype.compare=function(e,t,n,i,r){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),0>t||n>e.length||0>i||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var o=r-i,a=n-t,u=Math.min(o,a),c=this.slice(i,r),l=e.slice(t,n),h=0;u>h;++h)if(c[h]!==l[h]){o=c[h],a=l[h];break}return a>o?-1:o>a?1:0},s.prototype.indexOf=function(e,t,n){if("string"==typeof t?(n=t,t=0):t>2147483647?t=2147483647:-2147483648>t&&(t=-2147483648),t>>=0,0===this.length)return-1;if(t>=this.length)return-1;if(0>t&&(t=Math.max(this.length+t,0)),"string"==typeof e&&(e=s.from(e,n)),s.isBuffer(e))return 0===e.length?-1:E(this,e,t,n);if("number"==typeof e)return s.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,e,t):E(this,[e],t,n);throw new TypeError("val must be string, number or Buffer")},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t=0|t,isFinite(n)?(n=0|n,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(0>n||0>t)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return w(this,e,t,n);case"utf8":case"utf-8":return S(this,e,t,n);case"ascii":return x(this,e,t,n);case"binary":return $(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;s.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),e>t&&(t=e);var i;if(s.TYPED_ARRAY_SUPPORT)i=this.subarray(e,t),i.__proto__=s.prototype;else{var r=t-e;i=new s(r,void 0);for(var o=0;r>o;o++)i[o]=this[o+e]}return i},s.prototype.readUIntLE=function(e,t,n){e=0|e,t=0|t,n||P(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},s.prototype.readUIntBE=function(e,t,n){e=0|e,t=0|t,n||P(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},s.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e=0|e,t=0|t,n||P(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},s.prototype.readIntBE=function(e,t,n){e=0|e,t=0|t,n||P(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*t)),o},s.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),J.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),J.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),J.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),J.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=0|t,n=0|n,!i){var r=Math.pow(2,8*n)-1;D(this,e,t,n,r,0)}var o=1,s=0;for(this[t]=255&e;++s<n&&(o*=256);)this[t+s]=e/o&255;return t+n},s.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=0|t,n=0|n,!i){var r=Math.pow(2,8*n)-1;D(this,e,t,n,r,0)}var o=n-1,s=1;for(this[t+o]=255&e;--o>=0&&(s*=256);)this[t+o]=e/s&255;return t+n},s.prototype.writeUInt8=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,1,255,0),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},s.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=0|t,!i){var r=Math.pow(2,8*n-1);D(this,e,t,n,r-1,-r)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)0>e&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},s.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=0|t,!i){var r=Math.pow(2,8*n-1);D(this,e,t,n,r-1,-r)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)0>e&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,1,127,-128),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),0>e&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t=0|t,n||D(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},s.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return F(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return F(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&n>i&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(0>t)throw new RangeError("targetStart out of bounds");if(0>n||n>=this.length)throw new RangeError("sourceStart out of bounds");if(0>i)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&t>n&&i>t)for(r=o-1;r>=0;r--)e[r+t]=this[r+n];else if(1e3>o||!s.TYPED_ARRAY_SUPPORT)for(r=0;o>r;r++)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},s.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);256>r&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!s.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e=255&e);if(0>t||this.length<t||this.length<n)throw new RangeError("Out of range index");if(t>=n)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var o;if("number"==typeof e)for(o=t;n>o;o++)this[o]=e;else{var a=s.isBuffer(e)?e:V(new s(e,i).toString()),u=a.length;for(o=0;n-t>o;o++)this[o+t]=a[o%u]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":4,ieee754:5,isarray:6}],4:[function(e,t,n){"use strict";function i(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,n=e.length;n>t;++t)u[t]=e[t],c[e.charCodeAt(t)]=t;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63}function r(e){var t,n,i,r,o,s,a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[a-2]?2:"="===e[a-1]?1:0,s=new l(3*a/4-o),i=o>0?a-4:a;var u=0;for(t=0,n=0;i>t;t+=4,n+=3)r=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],s[u++]=r>>16&255,s[u++]=r>>8&255,s[u++]=255&r;return 2===o?(r=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,s[u++]=255&r):1===o&&(r=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,s[u++]=r>>8&255,s[u++]=255&r),s}function o(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}function s(e,t,n){for(var i,r=[],s=t;n>s;s+=3)i=(e[s]<<16)+(e[s+1]<<8)+e[s+2],r.push(o(i));return r.join("")}function a(e){for(var t,n=e.length,i=n%3,r="",o=[],a=16383,c=0,l=n-i;l>c;c+=a)o.push(s(e,c,c+a>l?l:c+a));return 1===i?(t=e[n-1],r+=u[t>>2],r+=u[t<<4&63],r+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],r+=u[t>>10],r+=u[t>>4&63],r+=u[t<<2&63],r+="="),o.push(r),o.join("")}n.toByteArray=r,n.fromByteArray=a;var u=[],c=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array;i()},{}],5:[function(e,t,n){n.read=function(e,t,n,i,r){var o,s,a=8*r-i-1,u=(1<<a)-1,c=u>>1,l=-7,h=n?r-1:0,p=n?-1:1,d=e[t+h];for(h+=p,o=d&(1<<-l)-1,d>>=-l,l+=a;l>0;o=256*o+e[t+h],h+=p,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=i;l>0;s=256*s+e[t+h],h+=p,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:(d?-1:1)*(1/0);s+=Math.pow(2,i),o-=c}return(d?-1:1)*s*Math.pow(2,o-i)},n.write=function(e,t,n,i,r,o){var s,a,u,c=8*o-r-1,l=(1<<c)-1,h=l>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,f=i?1:-1,g=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),t+=s+h>=1?p/u:p*Math.pow(2,1-h),t*u>=2&&(s++,u/=2),s+h>=l?(a=0,s=l):s+h>=1?(a=(t*u-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[n+d]=255&a,d+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+d]=255&s,d+=f,s/=256,c-=8);e[n+d-f]|=128*g}},{}],6:[function(e,t,n){var i={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},{}],7:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(s(n))for(o=Array.prototype.slice.call(arguments,1),c=n.slice(),i=c.length,u=0;i>u;u++)c[u].apply(this,o);return!0},i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var n,i,o,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],8:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],9:[function(e,t,n){t.exports=function(e){return!(null==e||!(e._isBuffer||e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)))}},{}],10:[function(e,t,n){function i(){l&&a&&(l=!1,a.length?c=a.concat(c):h=-1,c.length&&r())}function r(){if(!l){var e=setTimeout(i);l=!0;for(var t=c.length;t;){for(a=c,c=[];++h<t;)a&&a[h].run();h=-1,t=c.length}a=null,l=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function s(){}var a,u=t.exports={},c=[],l=!1,h=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new o(e,t)),1!==c.length||l||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=s,u.addListener=s,u.once=s,u.off=s,u.removeListener=s,u.removeAllListeners=s,u.emit=s,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],11:[function(t,n,i){(function(t){!function(r){function o(e){throw new RangeError(P[e])}function s(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function a(e,t){var n=e.split("@"),i="";n.length>1&&(i=n[0]+"@",e=n[1]),e=e.replace(L,".");var r=e.split("."),o=s(r,t).join(".");return i+o}function u(e){for(var t,n,i=[],r=0,o=e.length;o>r;)t=e.charCodeAt(r++),t>=55296&&56319>=t&&o>r?(n=e.charCodeAt(r++),56320==(64512&n)?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--)):i.push(t);return i}function c(e){return s(e,function(e){var t="";return e>65535&&(e-=65536,t+=M(e>>>10&1023|55296),e=56320|1023&e),t+=M(e)}).join("")}function l(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:x}function h(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function p(e,t,n){var i=0;for(e=n?B(e/T):e>>1,e+=B(e/t);e>D*_>>1;i+=x)e=B(e/D);return B(i+(D+1)*e/(e+I))}function d(e){var t,n,i,r,s,a,u,h,d,f,g=[],m=e.length,v=0,y=A,b=C;for(n=e.lastIndexOf(O),0>n&&(n=0),i=0;n>i;++i)e.charCodeAt(i)>=128&&o("not-basic"),g.push(e.charCodeAt(i));for(r=n>0?n+1:0;m>r;){for(s=v,a=1,u=x;r>=m&&o("invalid-input"),h=l(e.charCodeAt(r++)),(h>=x||h>B((S-v)/a))&&o("overflow"),v+=h*a,d=b>=u?$:u>=b+_?_:u-b,!(d>h);u+=x)f=x-d,a>B(S/f)&&o("overflow"),a*=f;t=g.length+1,b=p(v-s,t,0==s),B(v/t)>S-y&&o("overflow"),y+=B(v/t),v%=t,g.splice(v++,0,y)}return c(g)}function f(e){var t,n,i,r,s,a,c,l,d,f,g,m,v,y,b,E=[];for(e=u(e),m=e.length,t=A,n=0,s=C,a=0;m>a;++a)g=e[a],128>g&&E.push(M(g));for(i=r=E.length,r&&E.push(O);m>i;){for(c=S,a=0;m>a;++a)g=e[a],g>=t&&c>g&&(c=g);for(v=i+1,c-t>B((S-n)/v)&&o("overflow"),n+=(c-t)*v,t=c,a=0;m>a;++a)if(g=e[a],t>g&&++n>S&&o("overflow"),g==t){for(l=n,d=x;f=s>=d?$:d>=s+_?_:d-s,!(f>l);d+=x)b=l-f,y=x-f,E.push(M(h(f+b%y,0))),l=B(b/y);E.push(M(h(l,0))),s=p(n,v,i==r),n=0,++i}++n,++t}return E.join("")}function g(e){return a(e,function(e){return R.test(e)?d(e.slice(4).toLowerCase()):e})}function m(e){return a(e,function(e){return N.test(e)?"xn--"+f(e):e})}var v="object"==typeof i&&i&&!i.nodeType&&i,y="object"==typeof n&&n&&!n.nodeType&&n,b="object"==typeof t&&t;(b.global===b||b.window===b||b.self===b)&&(r=b);var E,w,S=2147483647,x=36,$=1,_=26,I=38,T=700,C=72,A=128,O="-",R=/^xn--/,N=/[^\x20-\x7E]/,L=/[\x2E\u3002\uFF0E\uFF61]/g,P={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},D=x-$,B=Math.floor,M=String.fromCharCode;if(E={version:"1.4.1",ucs2:{decode:u,encode:c},decode:d,encode:f,toASCII:m,toUnicode:g},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return E});else if(v&&y)if(n.exports==v)y.exports=E;else for(w in E)E.hasOwnProperty(w)&&(v[w]=E[w]);else r.punycode=E}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(e,t,n){function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;c>l;++l){var h,p,d,f,g=e[l].replace(a,"%20"),m=g.indexOf(n);m>=0?(h=g.substr(0,m),p=g.substr(m+1)):(h=g,p=""),d=decodeURIComponent(h),f=decodeURIComponent(p),i(s,d)?r(s[d])?s[d].push(f):s[d]=[s[d],f]:s[d]=f}return s};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],13:[function(e,t,n){function i(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i));return n}var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),function(s){var a=encodeURIComponent(r(s))+n;return o(e[s])?i(e[s],function(e){
return a+encodeURIComponent(r(e))}).join(t):a+encodeURIComponent(r(e[s]))}).join(t):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],14:[function(e,t,n){n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":12,"./encode":13}],15:[function(e,t,n){function i(e){return this instanceof i?(c.call(this,e),l.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",r)):new i(e)}function r(){this.allowHalfOpen||this._writableState.ended||a(o,this)}function o(e){e.end()}var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=i;var a=e("process-nextick-args"),u=e("core-util-is");u.inherits=e("inherits");var c=e("./_stream_readable"),l=e("./_stream_writable");u.inherits(i,c);for(var h=s(l.prototype),p=0;p<h.length;p++){var d=h[p];i.prototype[d]||(i.prototype[d]=l.prototype[d])}},{"./_stream_readable":17,"./_stream_writable":19,"core-util-is":21,inherits:8,"process-nextick-args":23}],16:[function(e,t,n){function i(e){return this instanceof i?void r.call(this,e):new i(e)}t.exports=i;var r=e("./_stream_transform"),o=e("core-util-is");o.inherits=e("inherits"),o.inherits(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":18,"core-util-is":21,inherits:8}],17:[function(e,t,n){(function(n){function i(e,t,n){return k?e.prependListener(t,n):void(e._events&&e._events[t]?T(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n))}function r(t,n){M=M||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,n instanceof M&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(B||(B=e("string_decoder/").StringDecoder),this.decoder=new B(t.encoding),this.encoding=t.encoding)}function o(t){return M=M||e("./_stream_duplex"),this instanceof o?(this._readableState=new r(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),void C.call(this)):new o(t)}function s(e,t,n,i,r){var o=l(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,h(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!r){var s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&r){var u=new Error("stream.unshift() after end event");e.emit("error",u)}else{var c;!t.decoder||r||i||(n=t.decoder.write(n),c=!t.objectMode&&0===n.length),r||(t.reading=!1),c||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&p(e))),f(e,t)}else r||(t.reading=!1);return a(t)}function a(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function u(e){return e>=U?e=U:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function c(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:0>=e?0:(e>t.highWaterMark&&(t.highWaterMark=u(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function l(e,t){var n=null;return R.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function h(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,p(e)}}function p(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(D("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?I(d,e):d(e))}function d(e){D("emit readable"),e.emit("readable"),E(e)}function f(e,t){t.readingMore||(t.readingMore=!0,I(g,e,t))}function g(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(D("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function m(e){return function(){var t=e._readableState;D("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&O(e,"data")&&(t.flowing=!0,E(e))}}function v(e){D("readable nexttick read 0"),e.read(0)}function y(e,t){t.resumeScheduled||(t.resumeScheduled=!0,I(b,e,t))}function b(e,t){t.reading||(D("resume read 0"),e.read(0)),t.resumeScheduled=!1,e.emit("resume"),E(e),t.flowing&&!t.reading&&e.read(0)}function E(e){var t=e._readableState;if(D("flow",t.flowing),t.flowing)do var n=e.read();while(null!==n&&t.flowing)}function w(e,t){var n,i=t.buffer,r=t.length,o=!!t.decoder,s=!!t.objectMode;if(0===i.length)return null;if(0===r)n=null;else if(s)n=i.shift();else if(!e||e>=r)n=o?i.join(""):1===i.length?i[0]:R.concat(i,r),i.length=0;else if(e<i[0].length){var a=i[0];n=a.slice(0,e),i[0]=a.slice(e)}else if(e===i[0].length)n=i.shift();else{n=o?"":N.allocUnsafe(e);for(var u=0,c=0,l=i.length;l>c&&e>u;c++){var h=i[0],p=Math.min(e-u,h.length);o?n+=h.slice(0,p):h.copy(n,u,0,p),p<h.length?i[0]=h.slice(p):i.shift(),u+=p}}return n}function S(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,I(x,t,e))}function x(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function $(e,t){for(var n=0,i=e.length;i>n;n++)t(e[n],n)}function _(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1}t.exports=o;var I=e("process-nextick-args"),T=e("isarray");o.ReadableState=r;var C,A=e("events").EventEmitter,O=function(e,t){return e.listeners(t).length};!function(){try{C=e("stream")}catch(t){}finally{C||(C=e("events").EventEmitter)}}();var R=e("buffer").Buffer,N=e("buffer-shims"),L=e("core-util-is");L.inherits=e("inherits");var P=e("util"),D=void 0;D=P&&P.debuglog?P.debuglog("stream"):function(){};var B;L.inherits(o,C);var M,M,k="function"==typeof A.prototype.prependListener;o.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding,t!==n.encoding&&(e=N.from(e,t),t="")),s(this,n,e,t,!1)},o.prototype.unshift=function(e){var t=this._readableState;return s(this,t,e,"",!0)},o.prototype.isPaused=function(){return this._readableState.flowing===!1},o.prototype.setEncoding=function(t){return B||(B=e("string_decoder/").StringDecoder),this._readableState.decoder=new B(t),this._readableState.encoding=t,this};var U=8388608;o.prototype.read=function(e){D("read",e);var t=this._readableState,n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return D("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?S(this):p(this),null;if(e=c(e,t),0===e&&t.ended)return 0===t.length&&S(this),null;var i=t.needReadable;D("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&(i=!0,D("length less than watermark",i)),(t.ended||t.reading)&&(i=!1,D("reading or ended",i)),i&&(D("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),i&&!t.reading&&(e=c(n,t));var r;return r=e>0?w(e,t):null,null===r&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),n!==e&&t.ended&&0===t.length&&S(this),null!==r&&this.emit("data",r),r},o.prototype._read=function(e){this.emit("error",new Error("not implemented"))},o.prototype.pipe=function(e,t){function r(e){D("onunpipe"),e===p&&s()}function o(){D("onend"),e.end()}function s(){D("cleanup"),e.removeListener("close",c),e.removeListener("finish",l),e.removeListener("drain",v),e.removeListener("error",u),e.removeListener("unpipe",r),p.removeListener("end",o),p.removeListener("end",s),p.removeListener("data",a),y=!0,!d.awaitDrain||e._writableState&&!e._writableState.needDrain||v()}function a(t){D("ondata");var n=e.write(t);!1===n&&((1===d.pipesCount&&d.pipes===e||d.pipesCount>1&&-1!==_(d.pipes,e))&&!y&&(D("false write response, pause",p._readableState.awaitDrain),p._readableState.awaitDrain++),p.pause())}function u(t){D("onerror",t),h(),e.removeListener("error",u),0===O(e,"error")&&e.emit("error",t)}function c(){e.removeListener("finish",l),h()}function l(){D("onfinish"),e.removeListener("close",c),h()}function h(){D("unpipe"),p.unpipe(e)}var p=this,d=this._readableState;switch(d.pipesCount){case 0:d.pipes=e;break;case 1:d.pipes=[d.pipes,e];break;default:d.pipes.push(e)}d.pipesCount+=1,D("pipe count=%d opts=%j",d.pipesCount,t);var f=(!t||t.end!==!1)&&e!==n.stdout&&e!==n.stderr,g=f?o:s;d.endEmitted?I(g):p.once("end",g),e.on("unpipe",r);var v=m(p);e.on("drain",v);var y=!1;return p.on("data",a),i(e,"error",u),e.once("close",c),e.once("finish",l),e.emit("pipe",p),d.flowing||(D("pipe resume"),p.resume()),e},o.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var r=0;i>r;r++)n[r].emit("unpipe",this);return this}var o=_(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},o.prototype.on=function(e,t){var n=C.prototype.on.call(this,e,t);if("data"===e&&!1!==this._readableState.flowing&&this.resume(),"readable"===e&&!this._readableState.endEmitted){var i=this._readableState;i.readableListening||(i.readableListening=!0,i.emittedReadable=!1,i.needReadable=!0,i.reading?i.length&&p(this,i):I(v,this))}return n},o.prototype.addListener=o.prototype.on,o.prototype.resume=function(){var e=this._readableState;return e.flowing||(D("resume"),e.flowing=!0,y(this,e)),this},o.prototype.pause=function(){return D("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(D("pause"),this._readableState.flowing=!1,this.emit("pause")),this},o.prototype.wrap=function(e){var t=this._readableState,n=!1,i=this;e.on("end",function(){if(D("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&i.push(e)}i.push(null)}),e.on("data",function(r){if(D("wrapped data"),t.decoder&&(r=t.decoder.write(r)),(!t.objectMode||null!==r&&void 0!==r)&&(t.objectMode||r&&r.length)){var o=i.push(r);o||(n=!0,e.pause())}});for(var r in e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));var o=["error","close","destroy","pause","resume"];return $(o,function(t){e.on(t,i.emit.bind(i,t))}),i._read=function(t){D("wrapped _read",t),n&&(n=!1,e.resume())},i},o._fromList=w}).call(this,e("_process"))},{"./_stream_duplex":15,_process:10,buffer:3,"buffer-shims":20,"core-util-is":21,events:7,inherits:8,isarray:22,"process-nextick-args":23,"string_decoder/":32,util:2}],18:[function(e,t,n){function i(e){this.afterTransform=function(t,n){return r(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function r(e,t,n){var i=e._transformState;i.transforming=!1;var r=i.writecb;if(!r)return e.emit("error",new Error("no writecb in Transform class"));i.writechunk=null,i.writecb=null,null!==n&&void 0!==n&&e.push(n),r(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);a.call(this,e),this._transformState=new i(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){s(t,e)}):s(t)})}function s(e,t){if(t)return e.emit("error",t);var n=e._writableState,i=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}t.exports=o;var a=e("./_stream_duplex"),u=e("core-util-is");u.inherits=e("inherits"),u.inherits(o,a),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("Not implemented")},o.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":15,"core-util-is":21,inherits:8}],19:[function(e,t,n){(function(n){function i(){}function r(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function o(t,n){O=O||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,n instanceof O&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=t.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){f(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new S(this)}function s(t){return O=O||e("./_stream_duplex"),this instanceof s||this instanceof O?(this._writableState=new o(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),void I.call(this)):new s(t)}function a(e,t){var n=new Error("write after end");e.emit("error",n),x(t,n)}function u(e,t,n,i){var r=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):C.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),x(i,o),r=!1),r}function c(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=A.from(t,n)),t}function l(e,t,n,i,o){n=c(t,n,i),C.isBuffer(n)&&(i="buffer");var s=t.objectMode?1:n.length;t.length+=s;var a=t.length<t.highWaterMark;if(a||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest=new r(n,i,o),u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else h(e,t,!1,s,n,i,o);return a}function h(e,t,n,i,r,o,s){t.writelen=i,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function p(e,t,n,i,r){--t.pendingcb,n?x(r,i):r(i),e._writableState.errorEmitted=!0,e.emit("error",i)}function d(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function f(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if(d(n),t)p(e,n,i,t,r);else{var o=y(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||v(e,n),i?$(g,e,n,o,r):g(e,n,o,r)}}function g(e,t,n,i){n||m(e,t),t.pendingcb--,i(),E(e,t)}function m(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function v(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),o=t.corkedRequestsFree;o.entry=n;for(var s=0;n;)r[s]=n,n=n.next,s+=1;h(e,t,!0,t.length,r,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new S(t)}else{for(;n;){var a=n.chunk,u=n.encoding,c=n.callback,l=t.objectMode?1:a.length;if(h(e,t,!1,l,a,u,c),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function E(e,t){var n=y(t);return n&&(0===t.pendingcb?(b(e,t),t.finished=!0,e.emit("finish")):b(e,t)),n}function w(e,t,n){t.ending=!0,E(e,t),n&&(t.finished?x(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function S(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var i=t.entry;for(t.entry=null;i;){var r=i.callback;e.pendingcb--,r(n),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}t.exports=s;var x=e("process-nextick-args"),$=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?setImmediate:x;s.WritableState=o;var _=e("core-util-is");_.inherits=e("inherits");var I,T={deprecate:e("util-deprecate")};!function(){try{I=e("stream")}catch(t){}finally{I||(I=e("events").EventEmitter)}}();var C=e("buffer").Buffer,A=e("buffer-shims");_.inherits(s,I);var O;o.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(o.prototype,"buffer",{get:T.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var O;s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},s.prototype.write=function(e,t,n){var r=this._writableState,o=!1;return"function"==typeof t&&(n=t,t=null),C.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=i),r.ended?a(this,n):u(this,r,e,n)&&(r.pendingcb++,o=l(this,r,e,t,n)),o},s.prototype.cork=function(){var e=this._writableState;e.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||v(this,e))},s.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},s.prototype._write=function(e,t,n){n(new Error("not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||w(this,i,n)}}).call(this,e("_process"))},{"./_stream_duplex":15,_process:10,buffer:3,"buffer-shims":20,"core-util-is":21,events:7,inherits:8,"process-nextick-args":23,"util-deprecate":24}],20:[function(e,t,n){(function(t){var i=e("buffer"),r=i.Buffer,o=i.SlowBuffer,s=i.kMaxLength||2147483647;n.alloc=function(e,t,n){if("function"==typeof r.alloc)return r.alloc(e,t,n);if("number"==typeof n)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>s)throw new RangeError("size is too large");var i=n,o=t;void 0===o&&(i=void 0,o=0);var a=new r(e);if("string"==typeof o)for(var u=new r(o,i),c=u.length,l=-1;++l<e;)a[l]=u[l%c];else a.fill(o);return a},n.allocUnsafe=function(e){if("function"==typeof r.allocUnsafe)return r.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>s)throw new RangeError("size is too large");return new r(e)},n.from=function(e,n,i){if("function"==typeof r.from&&(!t.Uint8Array||Uint8Array.from!==r.from))return r.from(e,n,i);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new r(e,n);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){var o=n;if(1===arguments.length)return new r(e);"undefined"==typeof o&&(o=0);var s=i;if("undefined"==typeof s&&(s=e.byteLength-o),o>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(s>e.byteLength-o)throw new RangeError("'length' is out of bounds");return new r(e.slice(o,o+s))}if(r.isBuffer(e)){var a=new r(e.length);return e.copy(a,0,0,e.length),a}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new r(e);if("Buffer"===e.type&&Array.isArray(e.data))return new r(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},n.allocUnsafeSlow=function(e){if("function"==typeof r.allocUnsafeSlow)return r.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=s)throw new RangeError("size is too large");return new o(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:3}],21:[function(e,t,n){(function(e){function t(e){return Array.isArray?Array.isArray(e):"[object Array]"===m(e)}function i(e){return"boolean"==typeof e}function r(e){return null===e}function o(e){return null==e}function s(e){return"number"==typeof e}function a(e){return"string"==typeof e}function u(e){return"symbol"==typeof e}function c(e){return void 0===e}function l(e){return"[object RegExp]"===m(e)}function h(e){return"object"==typeof e&&null!==e}function p(e){return"[object Date]"===m(e)}function d(e){return"[object Error]"===m(e)||e instanceof Error}function f(e){return"function"==typeof e}function g(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function m(e){return Object.prototype.toString.call(e)}n.isArray=t,n.isBoolean=i,n.isNull=r,n.isNullOrUndefined=o,n.isNumber=s,n.isString=a,n.isSymbol=u,n.isUndefined=c,n.isRegExp=l,n.isObject=h,n.isDate=p,n.isError=d,n.isFunction=f,n.isPrimitive=g,n.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../../../insert-module-globals/node_modules/is-buffer/index.js")})},{"../../../../insert-module-globals/node_modules/is-buffer/index.js":9}],22:[function(e,t,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],23:[function(e,t,n){(function(e){function n(t,n,i,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,n)});case 3:return e.nextTick(function(){t.call(null,n,i)});case 4:return e.nextTick(function(){t.call(null,n,i,r)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick(function(){t.apply(null,o)})}}!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=n:t.exports=e.nextTick}).call(this,e("_process"))},{_process:10}],24:[function(e,t,n){(function(e){function n(e,t){function n(){if(!r){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}if(i("noDeprecation"))return e;var r=!1;return n}function i(t){try{if(!e.localStorage)return!1}catch(n){return!1}var i=e.localStorage[t];return null==i?!1:"true"===String(i).toLowerCase()}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(e,t,n){(function(i){var r=function(){try{return e("stream")}catch(t){}}();n=t.exports=e("./lib/_stream_readable.js"),n.Stream=r||n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),!i.browser&&"disable"===i.env.READABLE_STREAM&&r&&(t.exports=r)}).call(this,e("_process"))},{"./lib/_stream_duplex.js":15,"./lib/_stream_passthrough.js":16,"./lib/_stream_readable.js":17,"./lib/_stream_transform.js":18,"./lib/_stream_writable.js":19,_process:10}],26:[function(e,t,n){(function(t){var i=e("./lib/request"),r=e("xtend"),o=e("builtin-status-codes"),s=e("url"),a=n;a.request=function(e,n){e="string"==typeof e?s.parse(e):r(e);var o=-1===t.location.protocol.search(/^https?:$/)?"http:":"",a=e.protocol||o,u=e.hostname||e.host,c=e.port,l=e.path||"/";u&&-1!==u.indexOf(":")&&(u="["+u+"]"),e.url=(u?a+"//"+u:"")+(c?":"+c:"")+l,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};var h=new i(e);return n&&h.on("response",n),h},a.get=function(e,t){var n=a.request(e,t);return n.end(),n},a.Agent=function(){},a.Agent.defaultMaxSockets=4,a.STATUS_CODES=o,a.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/request":28,"builtin-status-codes":30,url:33,xtend:35}],27:[function(e,t,n){(function(e){function t(e){try{return o.responseType=e,o.responseType===e}catch(t){}return!1}function i(e){return"function"==typeof e}n.fetch=i(e.fetch)&&i(e.ReadableByteStream),n.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),n.blobConstructor=!0}catch(r){}var o=new e.XMLHttpRequest;o.open("GET",e.location.host?"/":"https://example.com");var s="undefined"!=typeof e.ArrayBuffer,a=s&&i(e.ArrayBuffer.prototype.slice);n.arraybuffer=s&&t("arraybuffer"),n.msstream=!n.fetch&&a&&t("ms-stream"),n.mozchunkedarraybuffer=!n.fetch&&s&&t("moz-chunked-arraybuffer"),n.overrideMimeType=i(o.overrideMimeType),n.vbArray=i(e.VBArray),o=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(e,t,n){(function(n,i,r){function o(e){return a.fetch?"fetch":a.mozchunkedarraybuffer?"moz-chunked-arraybuffer":a.msstream?"ms-stream":a.arraybuffer&&e?"arraybuffer":a.vbArray&&e?"text:vbarray":"text"}function s(e){try{var t=e.status;return null!==t&&0!==t}catch(n){return!1}}var a=e("./capability"),u=e("inherits"),c=e("./response"),l=e("readable-stream"),h=e("to-arraybuffer"),p=c.IncomingMessage,d=c.readyStates,f=t.exports=function(e){var t=this;l.Writable.call(t),t._opts=e,t._body=[],t._headers={},e.auth&&t.setHeader("Authorization","Basic "+new r(e.auth).toString("base64")),Object.keys(e.headers).forEach(function(n){t.setHeader(n,e.headers[n])});var n;if("prefer-streaming"===e.mode)n=!1;else if("allow-wrong-content-type"===e.mode)n=!a.overrideMimeType;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");n=!0}t._mode=o(n),t.on("finish",function(){t._onFinish()})};u(f,l.Writable),f.prototype.setHeader=function(e,t){var n=this,i=e.toLowerCase();-1===g.indexOf(i)&&(n._headers[i]={name:e,value:t})},f.prototype.getHeader=function(e){var t=this;return t._headers[e.toLowerCase()].value},f.prototype.removeHeader=function(e){var t=this;delete t._headers[e.toLowerCase()]},f.prototype._onFinish=function(){var e=this;if(!e._destroyed){var t,o=e._opts,s=e._headers;if(("POST"===o.method||"PUT"===o.method||"PATCH"===o.method)&&(t=a.blobConstructor?new i.Blob(e._body.map(function(e){return h(e)}),{type:(s["content-type"]||{}).value||""}):r.concat(e._body).toString()),"fetch"===e._mode){var u=Object.keys(s).map(function(e){return[s[e].name,s[e].value]});i.fetch(e._opts.url,{method:e._opts.method,headers:u,body:t,mode:"cors",credentials:o.withCredentials?"include":"same-origin"}).then(function(t){e._fetchResponse=t,e._connect()},function(t){e.emit("error",t)})}else{var c=e._xhr=new i.XMLHttpRequest;try{c.open(e._opts.method,e._opts.url,!0)}catch(l){return void n.nextTick(function(){e.emit("error",l)})}"responseType"in c&&(c.responseType=e._mode.split(":")[0]),"withCredentials"in c&&(c.withCredentials=!!o.withCredentials),"text"===e._mode&&"overrideMimeType"in c&&c.overrideMimeType("text/plain; charset=x-user-defined"),Object.keys(s).forEach(function(e){c.setRequestHeader(s[e].name,s[e].value)}),e._response=null,c.onreadystatechange=function(){switch(c.readyState){case d.LOADING:case d.DONE:e._onXHRProgress()}},"moz-chunked-arraybuffer"===e._mode&&(c.onprogress=function(){e._onXHRProgress()}),c.onerror=function(){e._destroyed||e.emit("error",new Error("XHR error"))};try{c.send(t)}catch(l){return void n.nextTick(function(){e.emit("error",l)})}}}},f.prototype._onXHRProgress=function(){var e=this;s(e._xhr)&&!e._destroyed&&(e._response||e._connect(),e._response._onXHRProgress())},f.prototype._connect=function(){var e=this;e._destroyed||(e._response=new p(e._xhr,e._fetchResponse,e._mode),e.emit("response",e._response))},f.prototype._write=function(e,t,n){var i=this;i._body.push(e),n()},f.prototype.abort=f.prototype.destroy=function(){var e=this;e._destroyed=!0,e._response&&(e._response._destroyed=!0),e._xhr&&e._xhr.abort()},f.prototype.end=function(e,t,n){var i=this;"function"==typeof e&&(n=e,e=void 0),l.Writable.prototype.end.call(i,e,t,n)},f.prototype.flushHeaders=function(){},f.prototype.setTimeout=function(){},f.prototype.setNoDelay=function(){},f.prototype.setSocketKeepAlive=function(){};var g=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{"./capability":27,"./response":29,_process:10,buffer:3,inherits:8,"readable-stream":25,"to-arraybuffer":31}],29:[function(e,t,n){(function(t,i,r){var o=e("./capability"),s=e("inherits"),a=e("readable-stream"),u=n.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},c=n.IncomingMessage=function(e,n,i){function s(){p.read().then(function(e){if(!u._destroyed){if(e.done)return void u.push(null);u.push(new r(e.value)),s()}})}var u=this;if(a.Readable.call(u),u._mode=i,u.headers={},u.rawHeaders=[],u.trailers={},u.rawTrailers=[],u.on("end",function(){t.nextTick(function(){u.emit("close")})}),"fetch"===i){u._fetchResponse=n,u.url=n.url,u.statusCode=n.status,u.statusMessage=n.statusText;for(var c,l,h=n.headers[Symbol.iterator]();c=(l=h.next()).value,!l.done;)u.headers[c[0].toLowerCase()]=c[1],u.rawHeaders.push(c[0],c[1]);var p=n.body.getReader();s()}else{u._xhr=e,u._pos=0,u.url=e.responseURL,u.statusCode=e.status,u.statusMessage=e.statusText;var d=e.getAllResponseHeaders().split(/\r?\n/);if(d.forEach(function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var n=t[1].toLowerCase();"set-cookie"===n?(void 0===u.headers[n]&&(u.headers[n]=[]),u.headers[n].push(t[2])):void 0!==u.headers[n]?u.headers[n]+=", "+t[2]:u.headers[n]=t[2],u.rawHeaders.push(t[1],t[2])}}),u._charset="x-user-defined",!o.overrideMimeType){var f=u.rawHeaders["mime-type"];if(f){var g=f.match(/;\s*charset=([^;])(;|$)/);g&&(u._charset=g[1].toLowerCase())}u._charset||(u._charset="utf-8")}}};s(c,a.Readable),c.prototype._read=function(){},c.prototype._onXHRProgress=function(){var e=this,t=e._xhr,n=null;switch(e._mode){case"text:vbarray":if(t.readyState!==u.DONE)break;try{n=new i.VBArray(t.responseBody).toArray()}catch(o){}if(null!==n){e.push(new r(n));break}case"text":try{n=t.responseText}catch(o){e._mode="text:vbarray";break}if(n.length>e._pos){var s=n.substr(e._pos);if("x-user-defined"===e._charset){for(var a=new r(s.length),c=0;c<s.length;c++)a[c]=255&s.charCodeAt(c);e.push(a)}else e.push(s,e._charset);e._pos=n.length}break;case"arraybuffer":if(t.readyState!==u.DONE)break;n=t.response,e.push(new r(new Uint8Array(n)));break;case"moz-chunked-arraybuffer":if(n=t.response,
t.readyState!==u.LOADING||!n)break;e.push(new r(new Uint8Array(n)));break;case"ms-stream":if(n=t.response,t.readyState!==u.LOADING)break;var l=new i.MSStreamReader;l.onprogress=function(){l.result.byteLength>e._pos&&(e.push(new r(new Uint8Array(l.result.slice(e._pos)))),e._pos=l.result.byteLength)},l.onload=function(){e.push(null)},l.readAsArrayBuffer(n)}e._xhr.readyState===u.DONE&&"ms-stream"!==e._mode&&e.push(null)}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{"./capability":27,_process:10,buffer:3,inherits:8,"readable-stream":25}],30:[function(e,t,n){t.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],31:[function(e,t,n){var i=e("buffer").Buffer;t.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(i.isBuffer(e)){for(var t=new Uint8Array(e.length),n=e.length,r=0;n>r;r++)t[r]=e[r];return t.buffer}throw new Error("Argument must be a Buffer")}},{buffer:3}],32:[function(e,t,n){function i(e){if(e&&!u(e))throw new Error("Unknown encoding: "+e)}function r(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function s(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var a=e("buffer").Buffer,u=a.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},c=n.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),i(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=s;break;default:return void(this.write=r)}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};c.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var i=t.charCodeAt(t.length-1);if(!(i>=55296&&56319>=i)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,r),r-=this.charReceived),t+=e.toString(this.encoding,0,r);var r=t.length-1,i=t.charCodeAt(r);if(i>=55296&&56319>=i){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,r)}return t},c.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(2>=t&&n>>4==14){this.charLength=3;break}if(3>=t&&n>>3==30){this.charLength=4;break}}this.charReceived=t},c.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,i=this.charBuffer,r=this.encoding;t+=i.slice(0,n).toString(r)}return t}},{buffer:3}],33:[function(e,t,n){function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function r(e,t,n){if(e&&c.isObject(e)&&e instanceof i)return e;var r=new i;return r.parse(e,t,n),r}function o(e){return c.isString(e)&&(e=r(e)),e instanceof i?e.format():i.prototype.format.call(e)}function s(e,t){return r(e,!1,!0).resolve(t)}function a(e,t){return e?r(e,!1,!0).resolveObject(t):t}var u=e("punycode"),c=e("./util");n.parse=r,n.resolve=s,n.resolveObject=a,n.format=o,n.Url=i;var l=/^([a-z0-9.+-]+:)/i,h=/:[0-9]*$/,p=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,d=["<",">",'"',"`"," ","\r","\n","	"],f=["{","}","|","\\","^","`"].concat(d),g=["'"].concat(f),m=["%","/","?",";","#"].concat(g),v=["/","?","#"],y=255,b=/^[+a-z0-9A-Z_-]{0,63}$/,E=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,w={javascript:!0,"javascript:":!0},S={javascript:!0,"javascript:":!0},x={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},$=e("querystring");i.prototype.parse=function(e,t,n){if(!c.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),r=-1!==i&&i<e.indexOf("#")?"?":"#",o=e.split(r),s=/\\/g;o[0]=o[0].replace(s,"/"),e=o.join(r);var a=e;if(a=a.trim(),!n&&1===e.split("#").length){var h=p.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=$.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var d=l.exec(a);if(d){d=d[0];var f=d.toLowerCase();this.protocol=f,a=a.substr(d.length)}if(n||d||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var _="//"===a.substr(0,2);!_||d&&S[d]||(a=a.substr(2),this.slashes=!0)}if(!S[d]&&(_||d&&!x[d])){for(var I=-1,T=0;T<v.length;T++){var C=a.indexOf(v[T]);-1!==C&&(-1===I||I>C)&&(I=C)}var A,O;O=-1===I?a.lastIndexOf("@"):a.lastIndexOf("@",I),-1!==O&&(A=a.slice(0,O),a=a.slice(O+1),this.auth=decodeURIComponent(A)),I=-1;for(var T=0;T<m.length;T++){var C=a.indexOf(m[T]);-1!==C&&(-1===I||I>C)&&(I=C)}-1===I&&(I=a.length),this.host=a.slice(0,I),a=a.slice(I),this.parseHost(),this.hostname=this.hostname||"";var R="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!R)for(var N=this.hostname.split(/\./),T=0,L=N.length;L>T;T++){var P=N[T];if(P&&!P.match(b)){for(var D="",B=0,M=P.length;M>B;B++)D+=P.charCodeAt(B)>127?"x":P[B];if(!D.match(b)){var k=N.slice(0,T),U=N.slice(T+1),F=P.match(E);F&&(k.push(F[1]),U.unshift(F[2])),U.length&&(a="/"+U.join(".")+a),this.hostname=k.join(".");break}}}this.hostname.length>y?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=u.toASCII(this.hostname));var H=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+H,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!w[f])for(var T=0,L=g.length;L>T;T++){var G=g[T];if(-1!==a.indexOf(G)){var V=encodeURIComponent(G);V===G&&(V=escape(G)),a=a.split(G).join(V)}}var z=a.indexOf("#");-1!==z&&(this.hash=a.substr(z),a=a.slice(0,z));var q=a.indexOf("?");if(-1!==q?(this.search=a.substr(q),this.query=a.substr(q+1),t&&(this.query=$.parse(this.query)),a=a.slice(0,q)):t&&(this.search="",this.query={}),a&&(this.pathname=a),x[f]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var H=this.pathname||"",W=this.search||"";this.path=H+W}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",i=this.hash||"",r=!1,o="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&c.isObject(this.query)&&Object.keys(this.query).length&&(o=$.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||x[t])&&r!==!1?(r="//"+(r||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):r||(r=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),s=s.replace("#","%23"),t+r+n+s+i},i.prototype.resolve=function(e){return this.resolveObject(r(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(c.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var n=new i,r=Object.keys(this),o=0;o<r.length;o++){var s=r[o];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),u=0;u<a.length;u++){var l=a[u];"protocol"!==l&&(n[l]=e[l])}return x[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!x[e.protocol]){for(var h=Object.keys(e),p=0;p<h.length;p++){var d=h[p];n[d]=e[d]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||S[e.protocol])n.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var g=n.pathname||"",m=n.search||"";n.path=g+m}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),y=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=y||v||n.host&&e.pathname,E=b,w=n.pathname&&n.pathname.split("/")||[],f=e.pathname&&e.pathname.split("/")||[],$=n.protocol&&!x[n.protocol];if($&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),b=b&&(""===f[0]||""===w[0])),y)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,w=f;else if(f.length)w||(w=[]),w.pop(),w=w.concat(f),n.search=e.search,n.query=e.query;else if(!c.isNullOrUndefined(e.search)){if($){n.hostname=n.host=w.shift();var _=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;_&&(n.auth=_.shift(),n.host=n.hostname=_.shift())}return n.search=e.search,n.query=e.query,c.isNull(n.pathname)&&c.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!w.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var I=w.slice(-1)[0],T=(n.host||e.host||w.length>1)&&("."===I||".."===I)||""===I,C=0,A=w.length;A>=0;A--)I=w[A],"."===I?w.splice(A,1):".."===I?(w.splice(A,1),C++):C&&(w.splice(A,1),C--);if(!b&&!E)for(;C--;C)w.unshift("..");!b||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),T&&"/"!==w.join("/").substr(-1)&&w.push("");var O=""===w[0]||w[0]&&"/"===w[0].charAt(0);if($){n.hostname=n.host=O?"":w.length?w.shift():"";var _=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;_&&(n.auth=_.shift(),n.host=n.hostname=_.shift())}return b=b||n.host&&w.length,b&&!O&&w.unshift(""),w.length?n.pathname=w.join("/"):(n.pathname=null,n.path=null),c.isNull(n.pathname)&&c.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},i.prototype.parseHost=function(){var e=this.host,t=h.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":34,punycode:11,querystring:14}],34:[function(e,t,n){t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],35:[function(e,t,n){function i(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e}t.exports=i;var r=Object.prototype.hasOwnProperty},{}],36:[function(e,t,n){function i(e,t,n){for(var i=-1,r=s(t),o=r.length;++i<o;){var a=r[i],u=e[a],c=n(u,t[a],a,e,t);(c===c?c===u:u!==u)&&(void 0!==u||a in e)||(e[a]=c)}return e}var r=e("lodash._baseassign"),o=e("lodash._createassigner"),s=e("lodash.keys"),a=o(function(e,t,n){return n?i(e,t,n):r(e,t)});t.exports=a},{"lodash._baseassign":37,"lodash._createassigner":39,"lodash.keys":43}],37:[function(e,t,n){function i(e,t){return null==t?e:r(t,o(t),e)}var r=e("lodash._basecopy"),o=e("lodash.keys");t.exports=i},{"lodash._basecopy":38,"lodash.keys":43}],38:[function(e,t,n){function i(e,t,n){n||(n={});for(var i=-1,r=t.length;++i<r;){var o=t[i];n[o]=e[o]}return n}t.exports=i},{}],39:[function(e,t,n){function i(e){return s(function(t,n){var i=-1,s=null==t?0:n.length,a=s>2?n[s-2]:void 0,u=s>2?n[2]:void 0,c=s>1?n[s-1]:void 0;for("function"==typeof a?(a=r(a,c,5),s-=2):(a="function"==typeof c?c:void 0,s-=a?1:0),u&&o(n[0],n[1],u)&&(a=3>s?void 0:a,s=1);++i<s;){var l=n[i];l&&e(t,l,a)}return t})}var r=e("lodash._bindcallback"),o=e("lodash._isiterateecall"),s=e("lodash.restparam");t.exports=i},{"lodash._bindcallback":40,"lodash._isiterateecall":41,"lodash.restparam":42}],40:[function(e,t,n){function i(e,t,n){if("function"!=typeof e)return r;if(void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,o){return e.call(t,n,i,r,o)};case 5:return function(n,i,r,o,s){return e.call(t,n,i,r,o,s)}}return function(){return e.apply(t,arguments)}}function r(e){return e}t.exports=i},{}],41:[function(e,t,n){function i(e){return function(t){return null==t?void 0:t[e]}}function r(e){return null!=e&&a(h(e))}function o(e,t){return e="number"==typeof e||c.test(e)?+e:-1,t=null==t?l:t,e>-1&&e%1==0&&t>e}function s(e,t,n){if(!u(n))return!1;var i=typeof t;if("number"==i?r(n)&&o(t,n.length):"string"==i&&t in n){var s=n[t];return e===e?e===s:s!==s}return!1}function a(e){return"number"==typeof e&&e>-1&&e%1==0&&l>=e}function u(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var c=/^\d+$/,l=9007199254740991,h=i("length");t.exports=s},{}],42:[function(e,t,n){function i(e,t){if("function"!=typeof e)throw new TypeError(r);return t=o(void 0===t?e.length-1:+t||0,0),function(){for(var n=arguments,i=-1,r=o(n.length-t,0),s=Array(r);++i<r;)s[i]=n[t+i];switch(t){case 0:return e.call(this,s);case 1:return e.call(this,n[0],s);case 2:return e.call(this,n[0],n[1],s)}var a=Array(t+1);for(i=-1;++i<t;)a[i]=n[i];return a[t]=s,e.apply(this,a)}}var r="Expected a function",o=Math.max;t.exports=i},{}],43:[function(e,t,n){function i(e){return function(t){return null==t?void 0:t[e]}}function r(e){return null!=e&&s(y(e))}function o(e,t){return e="number"==typeof e||d.test(e)?+e:-1,t=null==t?v:t,e>-1&&e%1==0&&t>e}function s(e){return"number"==typeof e&&e>-1&&e%1==0&&v>=e}function a(e){for(var t=c(e),n=t.length,i=n&&e.length,r=!!i&&s(i)&&(p(e)||h(e)),a=-1,u=[];++a<n;){var l=t[a];(r&&o(l,i)||g.call(e,l))&&u.push(l)}return u}function u(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function c(e){if(null==e)return[];u(e)||(e=Object(e));var t=e.length;t=t&&s(t)&&(p(e)||h(e))&&t||0;for(var n=e.constructor,i=-1,r="function"==typeof n&&n.prototype===e,a=Array(t),c=t>0;++i<t;)a[i]=i+"";for(var l in e)c&&o(l,t)||"constructor"==l&&(r||!g.call(e,l))||a.push(l);return a}var l=e("lodash._getnative"),h=e("lodash.isarguments"),p=e("lodash.isarray"),d=/^\d+$/,f=Object.prototype,g=f.hasOwnProperty,m=l(Object,"keys"),v=9007199254740991,y=i("length"),b=m?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&r(e)?a(e):u(e)?m(e):[]}:a;t.exports=b},{"lodash._getnative":44,"lodash.isarguments":45,"lodash.isarray":48}],44:[function(e,t,n){function i(e){return!!e&&"object"==typeof e}function r(e,t){var n=null==e?void 0:e[t];return a(n)?n:void 0}function o(e){return s(e)&&d.call(e)==u}function s(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function a(e){return null==e?!1:o(e)?f.test(h.call(e)):i(e)&&c.test(e)}var u="[object Function]",c=/^\[object .+?Constructor\]$/,l=Object.prototype,h=Function.prototype.toString,p=l.hasOwnProperty,d=l.toString,f=RegExp("^"+h.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=r},{}],45:[function(e,t,n){function i(e){return!!e&&"object"==typeof e}function r(e){return function(t){return null==t?void 0:t[e]}}function o(e){return null!=e&&s(p(e))}function s(e){return"number"==typeof e&&e>-1&&e%1==0&&h>=e}function a(e){return i(e)&&o(e)&&c.call(e,"callee")&&!l.call(e,"callee")}var u=Object.prototype,c=u.hasOwnProperty,l=u.propertyIsEnumerable,h=9007199254740991,p=r("length");t.exports=a},{}],46:[function(e,t,n){function i(e,t,n){return e===e&&(void 0!==n&&(e=n>=e?e:n),void 0!==t&&(e=e>=t?e:t)),e}function r(e){var t=o(e)?_.call(e):"";return t==m||t==v}function o(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function s(e){return!!e&&"object"==typeof e}function a(e){return"symbol"==typeof e||s(e)&&_.call(e)==y}function u(e){if(!e)return 0===e?e:0;if(e=c(e),e===d||e===-d){var t=0>e?-1:1;return t*f}var n=e%1;return e===e?n?e-n:e:0}function c(e){if(o(e)){var t=r(e.valueOf)?e.valueOf():e;e=o(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(b,"");var n=w.test(e);return n||S.test(e)?x(e.slice(2),n?2:8):E.test(e)?g:+e}function l(e){if("string"==typeof e)return e;if(null==e)return"";if(a(e))return I?C.call(e):"";var t=e+"";return"0"==t&&1/e==-d?"-0":t}function h(e,t,n){e=l(e),t="string"==typeof t?t:t+"";var r=e.length;return n=void 0===n?r:i(u(n),0,r),n-=t.length,n>=0&&e.indexOf(t,n)==n}var p=e("lodash._root"),d=1/0,f=1.7976931348623157e308,g=NaN,m="[object Function]",v="[object GeneratorFunction]",y="[object Symbol]",b=/^\s+|\s+$/g,E=/^[-+]0x[0-9a-f]+$/i,w=/^0b[01]+$/i,S=/^0o[0-7]+$/i,x=parseInt,$=Object.prototype,_=$.toString,I=p.Symbol,T=I?I.prototype:void 0,C=I?T.toString:void 0;t.exports=h},{"lodash._root":47}],47:[function(e,t,n){(function(e){function i(e){return e&&e.Object===Object?e:null}var r={"function":!0,object:!0},o=r[typeof n]&&n&&!n.nodeType?n:null,s=r[typeof t]&&t&&!t.nodeType?t:null,a=i(o&&s&&"object"==typeof e&&e),u=i(r[typeof self]&&self),c=i(r[typeof window]&&window),l=i(r[typeof this]&&this),h=a||c!==(l&&l.window)&&c||u||l||Function("return this")();t.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(e,t,n){function i(e){return!!e&&"object"==typeof e}function r(e,t){var n=null==e?void 0:e[t];return u(n)?n:void 0}function o(e){return"number"==typeof e&&e>-1&&e%1==0&&y>=e}function s(e){return a(e)&&g.call(e)==l}function a(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function u(e){return null==e?!1:s(e)?m.test(d.call(e)):i(e)&&h.test(e)}var c="[object Array]",l="[object Function]",h=/^\[object .+?Constructor\]$/,p=Object.prototype,d=Function.prototype.toString,f=p.hasOwnProperty,g=p.toString,m=RegExp("^"+d.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),v=r(Array,"isArray"),y=9007199254740991,b=v||function(e){return i(e)&&o(e.length)&&g.call(e)==c};t.exports=b},{}],49:[function(e,t,n){function i(e){return!!e&&"object"==typeof e}function r(e){return"string"==typeof e||i(e)&&a.call(e)==o}var o="[object String]",s=Object.prototype,a=s.toString;t.exports=r},{}],50:[function(e,t,n){function i(e){var t=e?e.length:0;return t?e[t-1]:void 0}t.exports=i},{}],51:[function(e,t,n){function i(e,t){var n=-1,i=o(e)?Array(e.length):[];return l(e,function(e,r,o){i[++n]=t(e,r,o)}),i}function r(e){return function(t){return null==t?void 0:t[e]}}function o(e){return null!=e&&s(d(e))}function s(e){return"number"==typeof e&&e>-1&&e%1==0&&p>=e}function a(e,t,n){var r=h(e)?u:i;return t=c(t,n,3),r(e,t)}var u=e("lodash._arraymap"),c=e("lodash._basecallback"),l=e("lodash._baseeach"),h=e("lodash.isarray"),p=9007199254740991,d=r("length");t.exports=a},{"lodash._arraymap":52,"lodash._basecallback":53,"lodash._baseeach":58,"lodash.isarray":48}],52:[function(e,t,n){function i(e,t){for(var n=-1,i=e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}t.exports=i},{}],53:[function(e,t,n){function i(e){return null==e?"":e+""}function r(e,t,n){var i=typeof e;return"function"==i?void 0===t?e:S(e,t,n):null==e?b:"object"==i?a(e):void 0===t?E(e):u(e,t)}function o(e,t,n){if(null!=e){void 0!==n&&n in g(e)&&(t=[n]);for(var i=0,r=t.length;null!=e&&r>i;)e=e[t[i++]];return i&&i==r?e:void 0}}function s(e,t,n){var i=t.length,r=i,o=!n;if(null==e)return!r;for(e=g(e);i--;){var s=t[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<r;){s=t[i];var a=s[0],u=e[a],c=s[1];if(o&&s[2]){if(void 0===u&&!(a in e))return!1}else{var l=n?n(u,c,a):void 0;if(!(void 0===l?w(c,u,n,!0):l))return!1}}return!0}function a(e){var t=p(e);if(1==t.length&&t[0][2]){var n=t[0][0],i=t[0][1];return function(e){return null==e?!1:e[n]===i&&(void 0!==i||n in g(e))}}return function(e){return s(e,t)}}function u(e,t){var n=x(e),i=d(e)&&f(t),r=e+"";return e=m(e),function(s){if(null==s)return!1;var a=r;if(s=g(s),(n||!i)&&!(a in s)){if(s=1==e.length?s:o(s,h(e,0,-1)),null==s)return!1;a=v(e),s=g(s)}return s[a]===t?void 0!==t||a in s:w(t,s[a],void 0,!0)}}function c(e){return function(t){return null==t?void 0:t[e]}}function l(e){var t=e+"";return e=m(e),function(n){return o(n,e,t)}}function h(e,t,n){var i=-1,r=e.length;t=null==t?0:+t||0,0>t&&(t=-t>r?0:r+t),n=void 0===n||n>r?r:+n||0,0>n&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(r);++i<r;)o[i]=e[i+t];return o}function p(e){for(var t=$(e),n=t.length;n--;)t[n][2]=f(t[n][1]);return t}function d(e,t){var n=typeof e;if("string"==n&&I.test(e)||"number"==n)return!0;if(x(e))return!1;var i=!_.test(e);return i||null!=t&&e in g(t)}function f(e){return e===e&&!y(e)}function g(e){return y(e)?e:Object(e)}function m(e){if(x(e))return e;var t=[];return i(e).replace(T,function(e,n,i,r){t.push(i?r.replace(C,"$1"):n||e)}),t}function v(e){var t=e?e.length:0;return t?e[t-1]:void 0}function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function b(e){return e}function E(e){return d(e)?c(e):l(e)}var w=e("lodash._baseisequal"),S=e("lodash._bindcallback"),x=e("lodash.isarray"),$=e("lodash.pairs"),_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,I=/^\w*$/,T=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,C=/\\(\\)?/g;t.exports=r},{"lodash._baseisequal":54,"lodash._bindcallback":56,"lodash.isarray":48,"lodash.pairs":57}],54:[function(e,t,n){function i(e){return!!e&&"object"==typeof e}function r(e,t){for(var n=-1,i=e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}function o(e,t,n,r,a,u){return e===t?!0:null==e||null==t||!l(e)&&!i(t)?e!==e&&t!==t:s(e,t,o,n,r,a,u)}function s(e,t,n,i,r,o,s){var l=h(e),d=h(t),m=g,v=g;l||(m=_.call(e),m==f?m=E:m!=E&&(l=p(e))),d||(v=_.call(t),v==f?v=E:v!=E&&(d=p(t)));var y=m==E,b=v==E,w=m==v;if(w&&!l&&!y)return u(e,t,m);if(!r){var S=y&&$.call(e,"__wrapped__"),x=b&&$.call(t,"__wrapped__");if(S||x)return n(S?e.value():e,x?t.value():t,i,r,o,s)}if(!w)return!1;o||(o=[]),s||(s=[]);for(var I=o.length;I--;)if(o[I]==e)return s[I]==t;o.push(e),s.push(t);var T=(l?a:c)(e,t,n,i,r,o,s);return o.pop(),s.pop(),T}function a(e,t,n,i,o,s,a){var u=-1,c=e.length,l=t.length;if(c!=l&&!(o&&l>c))return!1;for(;++u<c;){var h=e[u],p=t[u],d=i?i(o?p:h,o?h:p,u):void 0;if(void 0!==d){if(d)continue;return!1}if(o){if(!r(t,function(e){return h===e||n(h,e,i,o,s,a)}))return!1}else if(h!==p&&!n(h,p,i,o,s,a))return!1}return!0}function u(e,t,n){switch(n){case m:case v:return+e==+t;case y:return e.name==t.name&&e.message==t.message;case b:return e!=+e?t!=+t:e==+t;case w:case S:return e==t+""}return!1}function c(e,t,n,i,r,o,s){var a=d(e),u=a.length,c=d(t),l=c.length;if(u!=l&&!r)return!1;for(var h=u;h--;){var p=a[h];if(!(r?p in t:$.call(t,p)))return!1}for(var f=r;++h<u;){p=a[h];var g=e[p],m=t[p],v=i?i(r?m:g,r?g:m,p):void 0;if(!(void 0===v?n(g,m,i,r,o,s):v))return!1;f||(f="constructor"==p)}if(!f){var y=e.constructor,b=t.constructor;if(y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b))return!1}return!0}function l(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var h=e("lodash.isarray"),p=e("lodash.istypedarray"),d=e("lodash.keys"),f="[object Arguments]",g="[object Array]",m="[object Boolean]",v="[object Date]",y="[object Error]",b="[object Number]",E="[object Object]",w="[object RegExp]",S="[object String]",x=Object.prototype,$=x.hasOwnProperty,_=x.toString;t.exports=o},{"lodash.isarray":48,"lodash.istypedarray":55,"lodash.keys":59}],55:[function(e,t,n){function i(e){return!!e&&"object"==typeof e}function r(e){return"number"==typeof e&&e>-1&&e%1==0&&N>=e}function o(e){return i(e)&&r(e.length)&&!!A[R.call(e)]}var s="[object Arguments]",a="[object Array]",u="[object Boolean]",c="[object Date]",l="[object Error]",h="[object Function]",p="[object Map]",d="[object Number]",f="[object Object]",g="[object RegExp]",m="[object Set]",v="[object String]",y="[object WeakMap]",b="[object ArrayBuffer]",E="[object Float32Array]",w="[object Float64Array]",S="[object Int8Array]",x="[object Int16Array]",$="[object Int32Array]",_="[object Uint8Array]",I="[object Uint8ClampedArray]",T="[object Uint16Array]",C="[object Uint32Array]",A={};A[E]=A[w]=A[S]=A[x]=A[$]=A[_]=A[I]=A[T]=A[C]=!0,A[s]=A[a]=A[b]=A[u]=A[c]=A[l]=A[h]=A[p]=A[d]=A[f]=A[g]=A[m]=A[v]=A[y]=!1;var O=Object.prototype,R=O.toString,N=9007199254740991;t.exports=o},{}],56:[function(e,t,n){arguments[4][40][0].apply(n,arguments)},{dup:40}],57:[function(e,t,n){function i(e){return r(e)?e:Object(e)}function r(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function o(e){e=i(e);for(var t=-1,n=s(e),r=n.length,o=Array(r);++t<r;){var a=n[t];o[t]=[a,e[a]]}return o}var s=e("lodash.keys");t.exports=o},{"lodash.keys":59}],58:[function(e,t,n){function i(e,t){return d(e,t,l)}function r(e){return function(t){return null==t?void 0:t[e]}}function o(e,t){return function(n,i){var r=n?f(n):0;if(!a(r))return e(n,i);for(var o=t?r:-1,s=u(n);(t?o--:++o<r)&&i(s[o],o,s)!==!1;);return n}}function s(e){return function(t,n,i){for(var r=u(t),o=i(t),s=o.length,a=e?s:-1;e?a--:++a<s;){var c=o[a];if(n(r[c],c,r)===!1)break}return t}}function a(e){return"number"==typeof e&&e>-1&&e%1==0&&h>=e}function u(e){return c(e)?e:Object(e)}function c(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var l=e("lodash.keys"),h=9007199254740991,p=o(i),d=s(),f=r("length");t.exports=p},{"lodash.keys":59}],59:[function(e,t,n){arguments[4][43][0].apply(n,arguments)},{dup:43,"lodash._getnative":60,"lodash.isarguments":61,"lodash.isarray":48}],60:[function(e,t,n){arguments[4][44][0].apply(n,arguments)},{dup:44}],61:[function(e,t,n){arguments[4][45][0].apply(n,arguments)},{dup:45}]},{},[1])(1)}),window.Modernizr=function(e,t,n){function i(e){f.cssText=e}function r(e,t){return typeof e===t}function o(){c.input=function(n){for(var i=0,r=n.length;r>i;i++)b[n[i]]=n[i]in g;return b.list&&(b.list=!!t.createElement("datalist")&&!!e.HTMLDataListElement),b}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),c.inputtypes=function(e){for(var i,r,o,s=0,a=e.length;a>s;s++)g.setAttribute("type",r=e[s]),i="text"!==g.type,i&&(g.value=m,g.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(r)&&g.style.WebkitAppearance!==n?(h.appendChild(g),o=t.defaultView,i=o.getComputedStyle&&"textfield"!==o.getComputedStyle(g,null).WebkitAppearance&&0!==g.offsetHeight,h.removeChild(g)):/^(search|tel)$/.test(r)||(i=/^(url|email)$/.test(r)?g.checkValidity&&g.checkValidity()===!1:g.value!=m)),y[e[s]]=!!i;return y}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var s,a,u="2.8.3",c={},l=!0,h=t.documentElement,p="modernizr",d=t.createElement(p),f=d.style,g=t.createElement("input"),m=":)",v=({}.toString,{}),y={},b={},E=[],w=E.slice,S={}.hasOwnProperty;a=r(S,"undefined")||r(S.call,"undefined")?function(e,t){return t in e&&r(e.constructor.prototype[t],"undefined")}:function(e,t){return S.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=w.call(arguments,1),i=function(){if(this instanceof i){var r=function(){};r.prototype=t.prototype;var o=new r,s=t.apply(o,n.concat(w.call(arguments)));return Object(s)===s?s:o}return t.apply(e,n.concat(w.call(arguments)))};return i});for(var x in v)a(v,x)&&(s=x.toLowerCase(),c[s]=v[x](),E.push((c[s]?"":"no-")+s));return c.input||o(),c.addTest=function(e,t){if("object"==typeof e)for(var i in e)a(e,i)&&c.addTest(i,e[i]);else{if(e=e.toLowerCase(),c[e]!==n)return c;t="function"==typeof t?t():t,"undefined"!=typeof l&&l&&(h.className+=" "+(t?"":"no-")+e),c[e]=t}return c},i(""),d=g=null,c._version=u,h.className=h.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(l?" js "+E.join(" "):""),c}(this,this.document),function(e,t,n){function i(e){return"[object Function]"==m.call(e)}function r(e){return"string"==typeof e}function o(){}function s(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function a(){var e=v.shift();y=1,e?e.t?f(function(){("c"==e.t?p.injectCss:p.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),a()):y=0}function u(e,n,i,r,o,u,c){function l(t){if(!d&&s(h.readyState)&&(b.r=d=1,!y&&a(),h.onload=h.onreadystatechange=null,t)){"img"!=e&&f(function(){w.removeChild(h)},50);for(var i in I[n])I[n].hasOwnProperty(i)&&I[n][i].onload()}}var c=c||p.errorTimeout,h=t.createElement(e),d=0,m=0,b={t:i,s:n,e:o,a:u,x:c};1===I[n]&&(m=1,I[n]=[]),"object"==e?h.data=n:(h.src=n,h.type=e),h.width=h.height="0",h.onerror=h.onload=h.onreadystatechange=function(){l.call(this,m)},v.splice(r,0,b),"img"!=e&&(m||2===I[n]?(w.insertBefore(h,E?null:g),f(l,c)):I[n].push(h))}function c(e,t,n,i,o){return y=0,t=t||"j",r(e)?u("c"==t?x:S,e,t,this.i++,n,i,o):(v.splice(this.i++,0,e),1==v.length&&a()),this}function l(){var e=p;return e.loader={load:c,i:0},e}var h,p,d=t.documentElement,f=e.setTimeout,g=t.getElementsByTagName("script")[0],m={}.toString,v=[],y=0,b="MozAppearance"in d.style,E=b&&!!t.createRange().compareNode,w=E?d:g.parentNode,d=e.opera&&"[object Opera]"==m.call(e.opera),d=!!t.attachEvent&&!d,S=b?"object":d?"script":"img",x=d?"script":S,$=Array.isArray||function(e){return"[object Array]"==m.call(e)},_=[],I={},T={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};p=function(e){function t(e){var t,n,i,e=e.split("!"),r=_.length,o=e.pop(),s=e.length,o={url:o,origUrl:o,prefixes:e};for(n=0;s>n;n++)i=e[n].split("="),(t=T[i.shift()])&&(o=t(o,i));for(n=0;r>n;n++)o=_[n](o);return o}function s(e,r,o,s,a){var u=t(e),c=u.autoCallback;u.url.split(".").pop().split("?").shift(),u.bypass||(r&&(r=i(r)?r:r[e]||r[s]||r[e.split("/").pop().split("?")[0]]),u.instead?u.instead(e,r,o,s,a):(I[u.url]?u.noexec=!0:I[u.url]=1,o.load(u.url,u.forceCSS||!u.forceJS&&"css"==u.url.split(".").pop().split("?").shift()?"c":n,u.noexec,u.attrs,u.timeout),(i(r)||i(c))&&o.load(function(){l(),r&&r(u.origUrl,a,s),c&&c(u.origUrl,a,s),I[u.url]=2})))}function a(e,t){function n(e,n){
if(e){if(r(e))n||(h=function(){var e=[].slice.call(arguments);p.apply(this,e),d()}),s(e,h,t,0,c);else if(Object(e)===e)for(u in a=function(){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}(),e)e.hasOwnProperty(u)&&(!n&&!--a&&(i(h)?h=function(){var e=[].slice.call(arguments);p.apply(this,e),d()}:h[u]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),d()}}(p[u])),s(e[u],h,t,u,c))}else!n&&d()}var a,u,c=!!e.test,l=e.load||e.both,h=e.callback||o,p=h,d=e.complete||o;n(c?e.yep:e.nope,!!l),l&&n(l)}var u,c,h=this.yepnope.loader;if(r(e))s(e,0,h,0);else if($(e))for(u=0;u<e.length;u++)c=e[u],r(c)?s(c,0,h,0):$(c)?p(c):Object(c)===c&&a(c,h);else Object(e)===e&&a(e,h)},p.addPrefix=function(e,t){T[e]=t},p.addFilter=function(e){_.push(e)},p.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",h=function(){t.removeEventListener("DOMContentLoaded",h,0),t.readyState="complete"},0)),e.yepnope=l(),e.yepnope.executeStack=a,e.yepnope.injectJs=function(e,n,i,r,u,c){var l,h,d=t.createElement("script"),r=r||p.errorTimeout;d.src=e;for(h in i)d.setAttribute(h,i[h]);n=c?a:n||o,d.onreadystatechange=d.onload=function(){!l&&s(d.readyState)&&(l=1,n(),d.onload=d.onreadystatechange=null)},f(function(){l||(l=1,n(1))},r),u?d.onload():g.parentNode.insertBefore(d,g)},e.yepnope.injectCss=function(e,n,i,r,s,u){var c,r=t.createElement("link"),n=u?a:n||o;r.href=e,r.rel="stylesheet",r.type="text/css";for(c in i)r.setAttribute(c,i[c]);s||(g.parentNode.insertBefore(r,g),f(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("cors",!!(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest)),define("modernizr",function(){}),function(e){function t(){var n=this===document?e(this):e(this).contents();n.mousemove(function(e){jQuery.mlp={x:e.pageX,y:e.pageY}}),n.find("iframe").load(t)}e.fn.checkboxButton=function(t){return this.each(function(){var n=e(this);n.on("click",function(n){var i,r=n.target.tagName;"INPUT"!==r?(n.preventDefault(),i=e(this).find(":checkbox"),i.prop("checked",!i.prop("checked"))):i=e(this);var o=i.is(":checked");t.call(this,o)})})},e.fn.disable=function(){return this.each(function(){var t=e(this);t.addClass("disabled"),t.data("tabindex",t.attr("tabindex")),t.removeAttr("tabindex")})},e.fn.ellipsis=function(t){return this.each(function(){var n=e(this),i=n.text();if(i.length>t){var r=i.substr(0,t);r=r.substr(0,Math.min(r.length,r.lastIndexOf(" "))),n.empty().html(r+"&hellip;")}})},e.fn.ellipsisFill=function(t){var n=!0;return t||(n=!1),this.each(function(){var i=e(this);if(n||(t=i.text()),i.empty(),i.spanElem=e('<span title="'+t+'"></span>'),i.append(i.spanElem),i.css("overflow","hidden"),i.spanElem.css("white-space","nowrap"),i.spanElem.html(t),i.spanElem.width()>i.width())for(var r;i.spanElem.width()>i.width();){var o=i.spanElem.html();if(o=o.substring(0,o.lastIndexOf(" "))+"&hellip;",o===r)break;i.spanElem.html(o),r=o}})},e.fn.ellipsisFixed=function(t,n){return this.each(function(){var i=e(this),r=i.text();i.empty();var o=e("<span></span>"),s=e('<a href="#" title="more" class="ellipsis"></a>');if(n?s.html(n):s.html("&hellip;"),s.click(function(t){t.preventDefault();var n=e(this);o.html(r),n.remove()}),r.length>t){var a=r.substr(0,t);a=a.substr(0,Math.min(a.length,a.lastIndexOf(" "))),o.html(a+"&nbsp;"),o.append(s)}else o.html(r);i.append(o)})},e.fn.ellipsisHtmlFixed=function(t,n){return this.each(function(){var i=e(this),r=i.html(),o=e("<span></span>");if(o.html(i.html().replace(/\s[\s]*/g," ").trim()),!(o.text().trim().length<=t)){for(;o.text().trim().length>t;)o.removeLastWord(t);var s=o.html(),a=!1;i.toggle=function(){i.empty();var t=e('<a href="#" class="toggle"></a>');a?(i.html(r+" "),t.text("less"),t.toggleClass("less","more")):(i.html(s+"&hellip; "),t.text("more"),t.toggleClass("more","less")),t.one("click",function(e){e.preventDefault(),i.toggle()}),a=!a,i.append(t),n&&n()},i.toggle()}})},e.fn.enable=function(){return this.each(function(){var t=e(this);t.removeClass("disabled"),t.attr("tabindex",t.data("tabindex"))})},e.fn.equaliseHeight=function(t,n){var i=-1,r=Number.MAX_VALUE,o=[];t&&this.each(function(){e(this).height("auto")}),this.each(function(){var t=e(this).height();o.push(t),i=i>t?i:t,r=t>r?r:t});var s=i;return n&&(s=Math.median(o)),this.each(function(){e(this).height(s)}),this},e.fn.getVisibleElementWithGreatestTabIndex=function(){var t=e(this),n=0,i=null;return t.find("*:visible[tabindex]").each(function(t,r){var o=e(r),s=parseInt(o.attr("tabindex"));s>n&&(n=s,i=o)}),i},e.fn.horizontalMargins=function(){var t=e(this);return parseInt(t.css("marginLeft"))+parseInt(t.css("marginRight"))},e.fn.leftMargin=function(){var t=e(this);return parseInt(t.css("marginLeft"))},e.fn.rightMargin=function(){var t=e(this);return parseInt(t.css("marginRight"))},e.fn.horizontalPadding=function(){var t=e(this);return parseInt(t.css("paddingLeft"))+parseInt(t.css("paddingRight"))},e.fn.leftPadding=function(){var t=e(this);return parseInt(t.css("paddingLeft"))},e.fn.rightPadding=function(){var t=e(this);return parseInt(t.css("paddingRight"))},e.mlp={x:0,y:0},e(t),e.fn.ismouseover=function(t){var n=!1;return this.eq(0).each(function(){var t=e(this).is("iframe")?e(this).contents().find("body"):e(this),i=t.offset();n=i.left<=e.mlp.x&&i.left+t.outerWidth()>e.mlp.x&&i.top<=e.mlp.y&&i.top+t.outerHeight()>e.mlp.y}),n};var n,i=e.fn.on;e.fn.on=function(){var e=Array.apply(null,arguments),t=e[e.length-1];if(isNaN(t)||1===t&&e.pop())return i.apply(this,e);var r=e.pop(),o=e.pop();return e.push(function(){var e=this,t=arguments;clearTimeout(n),n=setTimeout(function(){o.apply(e,t)},r)}),i.apply(this,e)},e.fn.onEnter=function(t){return this.each(function(){var n=e(this);n.on("keyup",function(e){13===e.keyCode&&(e.preventDefault(),t())})})},e.fn.onPressed=function(t){return this.each(function(){var n=e(this);n.on("click",function(e){e.preventDefault(),t()}),n.on("keyup",function(e){13===e.keyCode&&(e.preventDefault(),t())})})},e.fn.removeLastWord=function(t,n){return"undefined"==typeof t&&(t=8),"undefined"==typeof n&&(n=0),this.each(function(){var i=e(this);if(i.contents().length>0){var r=i.contents().last();if(3===r[0].nodeType){var o=r.text().trim().split(" ");if(o.length>1)return o.splice(o.length-1,1),void(r[0].data=o.join(" "));if("undefined"!=typeof t&&1===o.length&&o[0].length>t)return void(r[0].data=o.join(" ").substring(0,t))}r.removeLastWord(t,n+1)}else n>0&&i.remove()})},e.fn.swapClass=function(t,n){return this.each(function(){e(this).removeClass(t).addClass(n)})},e.fn.targetBlank=function(){return this.each(function(){e(this).find("a").prop("target","_blank")})},e.fn.toggleClass=function(t,n){return this.each(function(){var i=e(this);i.hasClass(t)?e(this).removeClass(t).addClass(n):e(this).removeClass(n).addClass(t)})},e.fn.toggleExpandText=function(t,n,i,r){return this.each(function(){var o=e(this),s=o.html();if(!(t>s.length)){var a=!1,u=s.substr(0,t);u=u.substr(0,Math.min(u.length,u.lastIndexOf(" "))),o.toggle=function(){o.empty();var t=e('<a href="#" class="toggle"></a>');a?(o.html(s+"&nbsp;"),t.text(n),t.toggleClass("less","more")):(o.html(u+"&nbsp;"),t.text(i),t.toggleClass("more","less")),t.one("click",function(e){e.preventDefault(),o.toggle()}),a=!a,o.append(t),r&&r()},o.toggle()}})},e.fn.toggleExpandTextByLines=function(t,n,i,r){return this.each(function(){for(var o=e(this),s=o.html(),a=e('<span>&hellip; <a href="#" class="toggle more">morepad</a></span>'),u=[s],c=o.height();o.text().length>0;){o.removeLastWord();var l=o.html();o.append(a),c>o.height()&&(u.unshift(l),c=o.height()),a.remove()}if(u.length<=t)return void o.html(s);var h=u[t-1],p=!1;o.toggle=function(){o.empty();var t=e('<a href="#" class="toggle"></a>');p?(o.html(s+" "),t.text(n),t.toggleClass("less","more")):(o.html(h+"&hellip; "),t.text(i),t.toggleClass("more","less")),t.one("click",function(e){e.preventDefault(),o.toggle()}),p=!p,o.append(t),r&&r()},o.toggle()})},e.fn.toggleText=function(t,n){return this.each(function(){var i=e(this);i.text()===t?e(this).text(n):e(this).text(t)})},e.fn.updateAttr=function(t,n,i){return this.each(function(){var r=e(this),o=r.attr(t);o&&0===o.indexOf(n)&&(o=o.replace(n,i),r.attr(t,o))})},e.fn.verticalMargins=function(){var t=e(this);return parseInt(t.css("marginTop"))+parseInt(t.css("marginBottom"))},e.fn.verticalPadding=function(){var t=e(this);return parseInt(t.css("paddingTop"))+parseInt(t.css("paddingBottom"))}}(jQuery),define("plugins",function(){}),!function(e){var t=null;e.initPubSub=function(){t=e({})},e.subscribe=function(){t||e.initPubSub(),t.on.apply(t,arguments)},e.unsubscribe=function(){t||e.initPubSub(),t.off.apply(t,arguments)},e.disposePubSub=function(){t=null},e.publish=function(){t||e.initPubSub(),t.trigger.apply(t,arguments)}}(jQuery),define("pubsub",function(){}),Sanitize.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,Sanitize.RELATIVE="__RELATIVE__",Sanitize.ALL="__ALL__",Sanitize.prototype.clean_node=function(e){function t(e,t){var n;for(n=0;n<t.length;n++)if(t[n]==e)return n;return-1}function n(){var e,t,n=[],i={};for(e=0;e<arguments.length;e++)if(arguments[e]&&arguments[e].length)for(t=0;t<arguments[e].length;t++)i[arguments[e][t]]||(i[arguments[e][t]]=!0,n.push(arguments[e][t]));return n}function r(e){var t;switch(e.nodeType){case 1:o.call(this,e);break;case 3:t=e.cloneNode(!1),this.current_element.appendChild(t);break;case 5:t=e.cloneNode(!1),this.current_element.appendChild(t);break;case 8:this.config.allow_comments&&(t=e.cloneNode(!1),this.current_element.appendChild(t));break;default:console&&console.log&&console.log("unknown node type",e.nodeType)}}function o(e){var i,o,a,u,c,l,h,p,d,f,g=s.call(this,e);if(e=g.node,a=e.nodeName.toLowerCase(),o=this.current_element,this.allowed_elements[a]||g.whitelist){this.current_element=this.dom.createElement(e.nodeName),o.appendChild(this.current_element);var m=this.config.attributes;for(u=n(m[a],m[Sanitize.ALL],g.attr_whitelist),i=0;i<u.length;i++)l=u[i],c=e.attributes[l],c&&(f=!0,this.config.protocols[a]&&this.config.protocols[a][l]&&(p=this.config.protocols[a][l],d=c.value.toLowerCase().match(Sanitize.REGEX_PROTOCOL),f=d?-1!=t(d[1],p):-1!=t(Sanitize.RELATIVE,p)),f&&(h=document.createAttribute(l),h.value=c.value,this.current_element.setAttributeNode(h)));if(this.config.add_attributes[a])for(l in this.config.add_attributes[a])h=document.createAttribute(l),h.value=this.config.add_attributes[a][l],this.current_element.setAttributeNode(h)}else if(-1!=t(e,this.whitelist_nodes)){for(this.current_element=e.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);o.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[a])for(i=0;i<e.childNodes.length;i++)r.call(this,e.childNodes[i]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=o}function s(e){var i,r,o,s={attr_whitelist:[],node:e,whitelist:!1};for(i=0;i<this.transformers.length;i++)if(o=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:e,node_name:e.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!=o){if("object"!=typeof o)throw new Error("transformer output must be an object or null");if(o.whitelist_nodes&&o.whitelist_nodes instanceof Array)for(r=0;r<o.whitelist_nodes.length;r++)-1==t(o.whitelist_nodes[r],this.whitelist_nodes)&&this.whitelist_nodes.push(o.whitelist_nodes[r]);s.whitelist=o.whitelist?!0:!1,o.attr_whitelist&&(s.attr_whitelist=n(s.attr_whitelist,o.attr_whitelist)),s.node=o.node?o.node:s.node}return s}var a=this.dom.createDocumentFragment();for(this.current_element=a,this.whitelist_nodes=[],i=0;i<e.childNodes.length;i++)r.call(this,e.childNodes[i]);return a.normalize&&a.normalize(),a},"function"==typeof define&&define("sanitize",[],function(){return Sanitize}),function(e){e(jQuery)}(function(e){if(e.support.cors||!e.ajaxTransport||!window.XDomainRequest)return e;var t=/^(https?:)?\/\//i,n=/^get|post$/i,i=new RegExp("^(//|"+location.protocol+")","i");return e.ajaxTransport("* text html xml json",function(r,o,s){if(r.crossDomain&&r.async&&n.test(r.type)&&t.test(r.url)&&i.test(r.url)){var a=null;return{send:function(t,n){var i="",s=(o.dataType||"").toLowerCase();a=new XDomainRequest,/^\d+$/.test(o.timeout)&&(a.timeout=o.timeout),a.ontimeout=function(){n(500,"timeout")},a.onload=function(){var t="Content-Length: "+a.responseText.length+"\r\nContent-Type: "+a.contentType,i={code:200,message:"success"},r={text:a.responseText};try{if("html"===s||/text\/html/i.test(a.contentType))r.html=a.responseText;else if("json"===s||"text"!==s&&/\/json/i.test(a.contentType))try{r.json=e.parseJSON(a.responseText)}catch(o){i.code=500,i.message="parseerror"}else if("xml"===s||"text"!==s&&/\/xml/i.test(a.contentType)){var u=new ActiveXObject("Microsoft.XMLDOM");u.async=!1;try{u.loadXML(a.responseText)}catch(o){u=void 0}if(!u||!u.documentElement||u.getElementsByTagName("parsererror").length)throw i.code=500,i.message="parseerror","Invalid XML: "+a.responseText;r.xml=u}}catch(c){throw c}finally{n(i.code,i.message,r,t)}},a.onprogress=function(){},a.onerror=function(){n(401,"error",{text:a.responseText})},o.data&&(i="string"===e.type(o.data)?o.data:e.param(o.data)),a.open(r.type,r.url),a.send(i)},abort:function(){a&&a.abort()}}}}),e}),define("xdomainrequest",function(){}),function(e,t,n){yepnope.injectCss=function(e,t,n,i,r,o){function s(){try{for(var e=document.styleSheets,t=0,n=e.length;n>t;t++)if(e[t].ownerNode.id==p&&e[t].cssRules.length)return h();throw new Error}catch(i){setTimeout(s,20)}}var a,u,c,l=document.createElement("link"),h=function(){u||(u=1,l.removeAttribute("id"),setTimeout(t,0))},p="yn"+ +new Date;t=o?yepnope.executeStack:t||function(){},i=i||yepnope.errorTimeout,l.href=e,l.rel="stylesheet",l.type="text/css",l.id=p;for(c in n)l.setAttribute(c,n[c]);r||(a=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0],a.parentNode.insertBefore(l,a),l.onload=h,s())}}(this,this.document),define("yepnopecss",function(){}),require.config({paths:{browserdetect:"lib/browserdetect",ex:"lib/ex.es3.min",ext:"lib/extensions",httpstatuscodes:"lib/http-status-codes",keycodes:"lib/key-codes",length:"lib/Length.min",manifesto:"lib/manifesto",modernizr:"lib/modernizr",plugins:"lib/jquery-plugins",pubsub:"lib/ba-tiny-pubsub.min",sanitize:"lib/sanitize",utils:"lib/utils",xdomainrequest:"lib/jquery.xdomainrequest",yepnopecss:"lib/yepnope.css"}}),require(["Bootstrapper","extensions/uv-mediaelement-extension/Extension","extensions/uv-mediaelement-extension/Provider","extensions/uv-pdf-extension/Extension","extensions/uv-pdf-extension/Provider","extensions/uv-seadragon-extension/Extension","extensions/uv-seadragon-extension/Provider","extensions/uv-virtex-extension/Extension","extensions/uv-virtex-extension/Provider","browserdetect","ex","ext","httpstatuscodes","keycodes","length","manifesto","modernizr","plugins","pubsub","sanitize","utils","xdomainrequest","yepnopecss"],function(e,t,n,i,r,o,s,a,u){var c={};c[manifesto.ElementType.canvas().toString()]={type:o,provider:s,name:"uv-seadragon-extension"},c[manifesto.ElementType.movingimage().toString()]={type:t,provider:n,name:"uv-mediaelement-extension"},c[manifesto.ElementType.physicalobject().toString()]={type:a,provider:u,name:"uv-virtex-extension"},c[manifesto.ElementType.sound().toString()]={type:t,provider:n,name:"uv-mediaelement-extension"},c[manifesto.RenderingFormat.pdf().toString()]={type:i,provider:r,name:"uv-pdf-extension"};var l=new e(c);l.bootStrap()}),define("app",function(){});